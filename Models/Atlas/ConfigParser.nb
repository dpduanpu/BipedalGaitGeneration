Notebook[{

Cell[CellGroupData[{
Cell["Begin Package", \
"Section",ExpressionUUID->"c6b6af92-f4bd-411a-be67-ab66a4e5ba29"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<BipedalLocomotion`Atlas`\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<GlobalVariables`\>\"", ",", " ", "\"\<RigidBodyDynamics`\>\"", ",", 
      " ", "\"\<BipedalLocomotion`\>\"", ",", " ", 
      "\"\<BipedalLocomotion`Model`\>\""}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"e2c4f744-43d7-494b-a61f-0c759b87e8bb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Load Atlas's .cfg file", \
"Section",ExpressionUUID->"02ae3bd0-a21f-4f64-8742-31732e72dafa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"model", " ", "=", " ", 
   RowBox[{"Import", "[", "\"\<Atlas/atlas.cfg\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"model", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "#"}], " ", "\[Equal]", " ", "0"}], ",", " ", 
        RowBox[{"{", "\"\<\>\"", "}"}], ",", " ", "#"}], "]"}], "&"}], " ", "/@",
      " ", "model"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"footDAE", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{
    "\"\<./Atlas/Atlas/meshes/l_foot.dae\>\"", ",", " ", 
     "\"\<Graphics3D\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"coordsDAE", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{
    "\"\<./Atlas/Atlas/meshes/l_foot.dae\>\"", ",", " ", 
     "\"\<VertexData\>\""}], "]"}]}], ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"49428acc-077f-4f22-b7cf-e7439930b411"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions for parsing Atlas's .cfg file", \
"Section",ExpressionUUID->"138cb99d-91e5-42e8-8634-7a159af38f6f"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetRecord", "[", "n_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "struct", ",", " ", "start", ",", " ", "stop", ",", " ", "N", ",", " ",
         "pos", ",", " ", "joint", ",", " ", "r"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"N", " ", "=", " ", 
        RowBox[{"Length", "@", "model"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"struct", " ", "=", " ", 
        RowBox[{"StringSplit", "[", 
         RowBox[{"n", ",", " ", "\"\<.\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"start", " ", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"start", " ", "\[LessEqual]", " ", "N"}], " ", "&&", " ", 
            RowBox[{"!", 
             RowBox[{"StringMatchQ", "[", 
              RowBox[{"s", ",", " ", 
               RowBox[{"StringTrim", "[", 
                RowBox[{"model", "\[LeftDoubleBracket]", 
                 RowBox[{"start", ",", " ", "1"}], "\[RightDoubleBracket]"}], 
                "]"}]}], "]"}]}]}], ",", " ", 
           RowBox[{"start", "++"}]}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"s", ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"\"\<struct \>\"", " ", "<>", " ", "#"}], "&"}], " ", "/@",
             "  ", "struct"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"stop", " ", "=", " ", "start"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"stop", " ", "<", " ", "N"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"stop", " ", "\[LessEqual]", " ", "N"}], " ", "&&", " ", 
             RowBox[{
              RowBox[{"StringLength", "[", 
               RowBox[{"StringTrim", "[", 
                RowBox[{"model", "\[LeftDoubleBracket]", 
                 RowBox[{"stop", ",", " ", "1"}], "\[RightDoubleBracket]"}], 
                "]"}], "]"}], " ", ">", " ", "0"}]}], ",", " ", 
            RowBox[{"stop", "++"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"start", ",", " ", "stop"}], "}"}]}]}], "\[IndentingNewLine]",
      "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"GetValue", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetValue", "[", "m_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "vals", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vals", " ", "=", " ", 
        RowBox[{"StringSplit", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "vals"}], " ", "\[Equal]", " ", "1"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Internal`StringToDouble", "[", 
          RowBox[{"First", "@", "vals"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Internal`StringToDouble", " ", "/@", " ", "vals"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetLinkNames", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"l", ",", " ", "rc"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rc", " ", "=", " ", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"l", " ", "=", " ", 
           RowBox[{"StringSplit", "[", 
            RowBox[{"model", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", " ", "1"}], "\[RightDoubleBracket]"}], "]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", "l"}], " ", ">", " ", "0"}], " ", "&&", 
             " ", 
             RowBox[{"StringMatchQ", "[", 
              RowBox[{"\"\<link_names\>\"", ",", " ", 
               RowBox[{
               "l", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              "]"}]}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"rc", " ", "=", " ", 
              RowBox[{"l", "\[LeftDoubleBracket]", 
               RowBox[{"3", ";;"}], "\[RightDoubleBracket]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Break", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
          ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", 
           RowBox[{"Length", "@", "model"}]}], "}"}]}], "\[IndentingNewLine]",
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "rc"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ParseLink", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ParseLink", "[", "rec_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", " ", "m", ",", " ", "start", ",", " ", "stop", ",", " ", 
        "pat"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"start", ",", " ", "stop"}], "}"}], " ", "=", " ", 
        RowBox[{"GetRecord", "[", "rec", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"start", " ", "\[Equal]", " ", "stop"}], ",", " ", 
         RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{
         RowBox[{"StringSplit", "[", 
          RowBox[{"model", "\[LeftDoubleBracket]", 
           RowBox[{"start", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], 
         "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{"Flatten", "@", 
           RowBox[{"model", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"start", "+", "1"}], ";;", 
             RowBox[{"stop", "-", "1"}]}], "\[RightDoubleBracket]"}]}], ",", 
          " ", "\"\<=\>\"", ",", " ", "2"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"StringTrim", " ", "/@", " ", "m"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"pat", " ", "=", " ", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"m", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], 
            "\[Rule]", " ", 
            RowBox[{"m", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<parent_link\>\"", "\[Rule]", " ", "\"\<root\>\""}], 
            ",", 
            RowBox[{
            "\"\<parent_kin_dof\>\"", "\[Rule]", " ", 
             "\"\<float.base\>\""}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\"\<index\>\"", ",", "\"\<parent_link\>\"", ",", 
           "\"\<parent_kin_dof\>\"", ",", "\"\<mass\>\"", ",", "\"\<0\>\"", 
           ",", "\"\<0\>\"", ",", "\"\<0\>\"", ",", " ", "\"\<com_x\>\"", 
           ",", "\"\<com_y\>\"", ",", "\"\<com_z\>\"", ",", " ", 
           "\"\<moi_xx\>\"", ",", "\"\<moi_xy\>\"", ",", "\"\<moi_xz\>\"", 
           ",", "\"\<moi_xy\>\"", ",", "\"\<moi_yy\>\"", ",", 
           "\"\<moi_yz\>\"", ",", "\"\<moi_xz\>\"", ",", " ", 
           "\"\<moi_yz\>\"", ",", "\"\<moi_zz\>\""}], "}"}], " ", "/.", " ", 
         "pat"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
        " ", "=", " ", 
        RowBox[{"n", "\[Rule]", " ", 
         RowBox[{
          RowBox[{"Floor", "[", 
           RowBox[{"GetValue", "[", 
            RowBox[{
            "m", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}], "]"}], " ", "+", " ", "1"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"4", ";;"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
        RowBox[{"GetValue", "[", 
         RowBox[{"m", "\[LeftDoubleBracket]", 
          RowBox[{"4", ";;"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "m"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ParseJoint", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ParseJoint", "[", "\"\<float.base\>\"", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "\"\<float.base\>\"", ",", " ", "\"\<fb\>\"", ",", " ", "z6", ",", " ", 
     "z3"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParseJoint", "[", "rec_", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "m", ",", " ", "j", ",", " ", "pat", ",", " ", "start", ",", " ", "stop",
       ",", " ", "\[Theta]", ",", " ", "axis"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"start", ",", " ", "stop"}], "}"}], " ", "=", "  ", 
      RowBox[{"GetRecord", "[", "rec", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"start", " ", "\[Equal]", " ", "stop"}], ",", " ", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"j", " ", "=", " ", 
      RowBox[{"\"\<r\>\"", " ", "<>", " ", 
       RowBox[{"StringTake", "[", 
        RowBox[{"rec", ",", " ", 
         RowBox[{"-", "1"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"m", " ", "=", " ", 
      RowBox[{"StringSplit", "[", 
       RowBox[{
        RowBox[{"Flatten", "@", 
         RowBox[{"model", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"start", "+", "1"}], ";;", 
           RowBox[{"stop", "-", "1"}]}], "\[RightDoubleBracket]"}]}], ",", 
        " ", "\"\<=\>\"", ",", " ", "2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m", " ", "=", " ", 
      RowBox[{"StringTrim", " ", "/@", " ", "m"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"pat", " ", "=", " ", 
      RowBox[{"Thread", "[", 
       RowBox[{
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], "\[Rule]",
         " ", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"m", " ", "=", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "rec", ",", " ", "j", ",", " ", "\"\<offset\>\"", ",", " ", 
         "\"\<axis\>\""}], "}"}], " ", "/.", " ", "pat"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"m", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
      " ", "=", " ", 
      RowBox[{"\"\<0 0 0 \>\"", " ", "<>", " ", 
       RowBox[{
       "m", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"m", "\[LeftDoubleBracket]", 
       RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
      RowBox[{"GetValue", "[", 
       RowBox[{"m", "\[LeftDoubleBracket]", 
        RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "m"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 InitializationCell->
  True,ExpressionUUID->"f06be6d3-18c9-49e1-a8a3-2ef14dac6f16"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AxisAngleToQuaternion", "[", 
     RowBox[{"axis_", ",", " ", "\[Theta]_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", " ", "s", ",", " ", "c"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", " ", "=", " ", 
        RowBox[{"\[Theta]", "/", "2"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"s", " ", "=", " ", 
        RowBox[{"Sin", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"Cos", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"s", " ", 
          RowBox[{"Normalize", "@", "axis"}]}], ",", " ", "c"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AxisAngleToRotation", "[", 
     RowBox[{"axis_", ",", " ", "\[Theta]_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", " ", "y", ",", " ", "z", ",", " ", "w"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "y", ",", " ", "z", ",", " ", "w"}], "}"}], 
        " ", "=", " ", 
        RowBox[{"AxisAngleToQuaternion", "[", 
         RowBox[{"axis", ",", " ", "\[Theta]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "-", 
            RowBox[{"2", 
             RowBox[{"y", "^", "2"}]}], "-", 
            RowBox[{"2", 
             RowBox[{"z", "^", "2"}]}]}], ",", " ", 
           RowBox[{
            RowBox[{"2", "x", " ", "y"}], "-", 
            RowBox[{"2", "z", " ", "w"}]}], ",", " ", 
           RowBox[{
            RowBox[{"2", "x", " ", "z"}], "+", 
            RowBox[{"2", "y", " ", "w"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "x", " ", "y"}], "+", 
            RowBox[{"2", "z", " ", "w"}]}], ",", " ", 
           RowBox[{"1", "-", 
            RowBox[{"2", 
             RowBox[{"x", "^", "2"}]}], "-", 
            RowBox[{"2", 
             RowBox[{"z", "^", "2"}]}]}], ",", " ", 
           RowBox[{
            RowBox[{"2", "y", " ", "z"}], "-", 
            RowBox[{"2", "x", " ", "w"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"2", "x", " ", "z"}], "-", 
            RowBox[{"2", "y", " ", "w"}]}], ",", " ", 
           RowBox[{
            RowBox[{"2", "y", " ", "z"}], "+", 
            RowBox[{"2", "x", " ", "w"}]}], ",", " ", 
           RowBox[{"1", "-", 
            RowBox[{"2", 
             RowBox[{"x", "^", "2"}]}], "-", 
            RowBox[{"2", 
             RowBox[{"y", "^", "2"}]}]}]}], "}"}]}], "\[IndentingNewLine]", 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Eaxis\[Theta]", "[", 
     RowBox[{"axis_", ",", " ", "\[Theta]_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{
         RowBox[{"RBDExpandExpression", "@", 
          RowBox[{"AxisAngleToRotation", "[", 
           RowBox[{"axis", ",", " ", "\[Theta]"}], "]"}]}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"RigidBodyDynamics`Private`Mat6", "[", 
        RowBox[{"E", ",", " ", "Z3", ",", " ", "Z3", ",", " ", "E"}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CreateModelData", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"parent", ",", " ", "links", ",", " ", "joints", ",", " ", "p", 
       RowBox[{"(*", 
        RowBox[{",", " ", "axis", ",", " ", "\[Theta]"}], "*)"}], ",", " ", 
       "frames", ",", " ", "inertia", ",", " ", "S"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"links", " ", "=", " ", 
       RowBox[{"GetLinkNames", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"links", " ", "=", " ", 
       RowBox[{"ParseLink", "[", "links", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"joints", " ", "=", " ", 
       RowBox[{"ParseJoint", "[", 
        RowBox[{"links", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "3"}], "\[RightDoubleBracket]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"parent", " ", "=", " ", 
       RowBox[{
        RowBox[{"links", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}], " ", "/.",
         " ", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"links", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", 
          " ", 
          RowBox[{"\"\<root\>\"", "\[Rule]", " ", "0"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"frames", " ", "=", " ", 
       RowBox[{"joints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "3"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"inertia", " ", "=", " ", 
       RowBox[{"links", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"4", ";;"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{".", "cfg"}], " ", "file", " ", "has", " ", "two", " ", 
        "frames", " ", "a", " ", "joint", " ", "frame", " ", "and", " ", 
        "axis", " ", "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "the", " ", "axis", " ", "frame", " ", "describes", " ", "the", " ", 
         "dof", " ", "using", " ", "axis"}], "-", 
        RowBox[{"angle", " ", "notation"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"so", " ", "add", " ", "to", " ", "joint", " ", "library"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"RBDJoint", "[", 
       RowBox[{"\"\<float.base\>\"", ",", " ", 
        RowBox[{"RBDJoint", "[", "\"\<fb\>\"", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"axis", " ", "=", " ", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
           "}"}], ",", " ", 
          RowBox[{"RBDJoint", "[", 
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{"axis", ",", " ", "z3"}], "]"}], "&"}], ",", " ", 
            RowBox[{
             RowBox[{"Eaxis\[Theta]", "[", 
              RowBox[{"axis", ",", " ", "#"}], "]"}], "&"}]}], "]"}]}], "]"}],
         " ", "&"}], " ", "/@", " ", 
       RowBox[{"joints", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"2", ";;", 
          RowBox[{"-", "1"}]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2", ",", 
           RowBox[{"-", "1"}]}], "}"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"replace", " ", "#s", " ", "with", " ", "names"}], " ", "*)"}],
       "\[IndentingNewLine]", 
      RowBox[{"parent", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"#", " ", ">", " ", "0"}], ",", " ", 
           RowBox[{"joints", "\[LeftDoubleBracket]", 
            RowBox[{"#", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", " ",
            "Root"}], "]"}], "&"}], " ", "/@", " ", "parent"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"joint", " ", "type"}], " ", "\[Rule]", " ", 
        RowBox[{"joint", " ", "name"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"S", " ", "=", " ", 
       RowBox[{"joints", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"return", " ", "robot", " ", "model"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", " ", "/@", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"joints", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", 
           " ", "parent", ",", " ", "S", ",", " ", "frames", ",", " ", 
           "inertia"}], "}"}], "\[Transpose]"}], ")"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 InitializationCell->
  True,ExpressionUUID->"a2a7c71c-b98c-406c-9b4d-4c29b8976d31"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PutArmsDown", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", " ", "sides", ",", " ", "arms", ",", " ", "R", ",", " ", 
        "total", ",", " ", "pt", ",", " ", "ang", ",", " ", "p", ",", " ", 
        "i", ",", " ", "ind", ",", " ", "L"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sides", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"\"\<l.arm.\>\"", ",", " ", "\"\<r.arm.\>\""}], "}"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"arms", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
         "\"\<ely\>\"", ",", " ", "\"\<elx\>\"", ",", " ", "\"\<wry\>\"", ",",
           " ", "\"\<wrx\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"L", " ", "=", " ", 
        RowBox[{"atlas", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", 
          RowBox[{"RBDindex", "[", "\"\<n\>\"", "]"}]}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"total", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"n", " ", "=", " ", 
              RowBox[{"s", " ", "<>", " ", "a"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"find", " ", "link"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"i", " ", "=", " ", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{"L", ",", " ", "n"}], "]"}], "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"find", " ", "parent"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"p", " ", "=", " ", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{"L", ",", " ", 
                 RowBox[{"atlas", "\[LeftDoubleBracket]", 
                  RowBox[{"i", ",", " ", 
                   RowBox[{"RBDindex", "[", "\"\<p\>\"", "]"}]}], 
                  "\[RightDoubleBracket]"}]}], "]"}], "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ind", " ", "=", " ", 
              RowBox[{"RBDindex", "[", "\"\<f[xyz]\>\"", "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"get", " ", "link", " ", "frame"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"pt", " ", "=", " ", 
              RowBox[{"atlas", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", " ", "ind"}], "\[RightDoubleBracket]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"R", " ", "=", " ", 
              RowBox[{"RigidBodyDynamics`Private`rotX", "[", "total", "]"}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"pt", " ", "=", " ", 
              RowBox[{"RigidBodyDynamics`Private`MovePoint", "[", 
               RowBox[{"R", ",", " ", "pt"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"ang", " ", "=", " ", 
              RowBox[{"ArcCos", "[", 
               RowBox[{
                RowBox[{"Dot", "[", 
                 RowBox[{"pt", ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}], "/", 
                RowBox[{"Norm", "[", "pt", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ang", " ", "=", " ", 
              RowBox[{
               RowBox[{"-", 
                RowBox[{"Sign", "[", 
                 RowBox[{
                 "pt", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                  "]"}]}], " ", "ang"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"add", " ", "RX", " ", "rotation"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"ind", " ", "=", " ", 
              RowBox[{
               RowBox[{"RBDindex", "[", "\"\<f\>\"", "]"}], 
               "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"atlas", "\[LeftDoubleBracket]", 
               RowBox[{"p", ",", " ", "ind"}], "\[RightDoubleBracket]"}], " ",
               "=", " ", "ang"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"update", " ", "absolute", " ", "angle"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"total", " ", "=", " ", 
              RowBox[{"total", " ", "+", " ", "ang"}]}], ";"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"a", ",", " ", "arms"}], "}"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"s", ",", " ", "sides"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"POI", ",", " ", "Listable"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"POI", "[", "n_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", " ", "c", ",", " ", "poi"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"i", " ", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"atlas", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", 
           RowBox[{"RBDindex", "[", "\"\<n\>\"", "]"}]}], 
          "\[RightDoubleBracket]"}], ",", " ", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "i"}], " ", "\[Equal]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"i", " ", "=", " ", 
       RowBox[{"i", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "the", " ", "child", " ", "link"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"atlas", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", 
           RowBox[{"RBDindex", "[", "\"\<p\>\"", "]"}]}], 
          "\[RightDoubleBracket]"}], ",", " ", "n"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "c"}], " ", "\[Equal]", " ", "0"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"get", " ", 
          RowBox[{"point", " ", "@", " ", "com"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"poi", " ", "=", " ", 
          RowBox[{"atlas", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", " ", 
            RowBox[{"RBDindex", "[", "\"\<c\>\"", "]"}]}], 
           "\[RightDoubleBracket]"}]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"get", " ", 
          RowBox[{"point", " ", "@", " ", "end"}], " ", "of", " ", "link"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"c", " ", "=", " ", 
          RowBox[{"c", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"poi", " ", "=", " ", 
          RowBox[{"atlas", "\[LeftDoubleBracket]", 
           RowBox[{"c", ",", " ", 
            RowBox[{"RBDindex", "[", "\"\<f\>\"", "]"}]}], 
           "\[RightDoubleBracket]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"n", ",", " ", 
        RowBox[{"poi", "\[LeftDoubleBracket]", 
         RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 InitializationCell->
  True,ExpressionUUID->"f51e6109-02eb-4069-99ec-dc95bd593ccd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FootPOI", "[", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "toe", ",", " ", "heel", ",", " ", "wt", ",", " ", "wh", ",", " ", "h"}],
      "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"toe", ",", " ", "heel"}], "}"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"GetFootData", "[", "]"}], "\[LeftDoubleBracket]", 
       RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Join", "@@", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "#"}], "}"}], "&"}], " ", "/@", " ", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "toe", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
               "toe", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "/", "2"}], ",", " ", 
             RowBox[{
             "toe", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
            "}"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "toe", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{
              "toe", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "/", "2"}], ",", " ", 
             RowBox[{
             "toe", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
            "}"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "heel", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
               "heel", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "/", "2"}], ",", " ", 
             RowBox[{
             "heel", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}],
             "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "heel", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
             ",", " ", 
             RowBox[{
              RowBox[{
              "heel", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "/", "2"}], ",", " ", 
             RowBox[{
             "heel", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}],
             "}"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", 
          RowBox[{"{", 
           RowBox[{"\"\<l.leg.akx\>\"", ",", " ", "\"\<r.leg.akx\>\""}], 
           "}"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 InitializationCell->
  True,ExpressionUUID->"3503542b-100d-4364-8318-6565eccaeeae"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetFootData", "[", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"box", ",", " ", "h", ",", " ", "toe", ",", " ", "heel"}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"get", " ", "bottom", " ", "four", " ", "corners"}], " ", "*)"}],
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"box", " ", "=", " ", 
      RowBox[{"MinimalBy", "[", 
       RowBox[{"coordsDAE", ",", " ", 
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "&"}], ",", " ", "32"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"box", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"MinimalBy", "[", 
         RowBox[{"box", ",", " ", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "&"}],
           ",", " ", "6"}], "]"}], ",", " ", 
        RowBox[{"MaximalBy", "[", 
         RowBox[{"box", ",", " ", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "&"}],
           ",", " ", "6"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"box", " ", "=", " ", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"box", ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Norm", "[", 
           RowBox[{"#1", "-", "#2"}], "]"}], "\[LessEqual]", " ", 
          RowBox[{"10", "^", 
           RowBox[{"-", "6"}]}]}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"box", " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"MinimalBy", "[", 
         RowBox[{"box", ",", " ", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "&"}],
           ",", " ", "2"}], "]"}], ",", " ", 
        RowBox[{"MaximalBy", "[", 
         RowBox[{"box", ",", " ", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "&"}],
           ",", " ", "2"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "sort", " ", "heel", " ", "coords", " ", "then", " ", "toe", " ", 
       "coords"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"box", " ", "=", " ", 
      RowBox[{"SortBy", "[", 
       RowBox[{"box", ",", " ", "First"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"h", " ", "=", " ", 
      RowBox[{"Mean", "@", 
       RowBox[{"box", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "3"}], "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"heel", " ", "=", " ", 
       RowBox[{"(", 
        RowBox[{"heel", ",", " ", "wh", ",", " ", "h"}], ")"}]}], " ", "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"heel", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Mean", "@", 
         RowBox[{"box", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "2"}], ",", " ", "1"}], 
          "\[RightDoubleBracket]"}]}], ",", " ", 
        RowBox[{"Total", "@", 
         RowBox[{"Abs", "@", 
          RowBox[{"box", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", "2"}], ",", " ", "2"}], 
           "\[RightDoubleBracket]"}]}]}], ",", " ", "h"}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", "toe", " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"toe", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Mean", "@", 
         RowBox[{"box", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"3", ";;", "4"}], ",", " ", "1"}], 
          "\[RightDoubleBracket]"}]}], ",", " ", 
        RowBox[{"Total", "@", 
         RowBox[{"Abs", "@", 
          RowBox[{"box", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"3", ";;", "4"}], ",", " ", "2"}], 
           "\[RightDoubleBracket]"}]}]}], ",", " ", "h"}], "}"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"x", " ", "left", " ", "to", " ", "right"}], ",", " ", 
       RowBox[{"y", " ", "into", " ", "screen"}], ",", " ", 
       RowBox[{"z", " ", "up"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"toe", ",", " ", "heel", ",", " ", 
       RowBox[{"Show", "[", 
        RowBox[{"{", 
         RowBox[{"footDAE", ",", " ", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "@", "0.01"}], ",", " ", "Red", ",", " ", 
             RowBox[{"Point", "[", "z3", "]"}]}], "}"}], "]"}], ",", " ", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "@", "0.01"}], ",", " ", "Blue", ",", " ", 
             RowBox[{"Point", "[", 
              RowBox[{"box", "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], "]"}], 
             ",", " ", "Green", ",", " ", 
             RowBox[{"Point", "[", 
              RowBox[{"box", "\[LeftDoubleBracket]", 
               RowBox[{"3", ";;", "4"}], "\[RightDoubleBracket]"}], "]"}]}], 
            "}"}], "]"}]}], "}"}], "]"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"90a28496-5e1b-46d4-aa3a-b0144a6322e0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",
 InitializationCell->
  True,ExpressionUUID->"39ea531a-559a-49cc-aad2-bdcbf6dec132"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellLabel->
  "In[4582]:=",ExpressionUUID->"2d347607-a447-4fd8-9424-96ecf5aa99fd"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1505},
WindowMargins->{{0, Automatic}, {0, Automatic}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
TrackCellChangeTimes->False,
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
