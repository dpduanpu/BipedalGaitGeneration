(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    115926,       2246]
NotebookOptionsPosition[    113060,       2183]
NotebookOutlinePosition[    113427,       2199]
CellTagsIndexPosition[    113384,       2196]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"RigidBodyDerivatives", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{"High", "-", 
      RowBox[{
      "level", " ", "functions", " ", "used", " ", "to", " ", "define", " ", 
       "a", " ", "rigid", " ", 
       RowBox[{"body", ".", "\n", "Copyright"}], " ", 
       RowBox[{"(", "C", ")"}], " ", "2016", " ", "Nelson", " ", "Rosa", " ", 
       RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", 
       " ", "free", " ", "software"}]}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 3.6103712325731497`*^9}, {
  3.610371305900334*^9, 3.610371331708816*^9}, {3.610371368620943*^9, 
  3.61037139802861*^9}, {3.6103714917959795`*^9, 3.6103715279410496`*^9}, {
  3.6901267523786774`*^9, 
  3.6901267578419495`*^9}},ExpressionUUID->"36a9df72-93f1-4f0b-8886-\
624339e55a43"],

Cell["Notes", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.6033805874918413`*^9, 3.6033805878768606`*^9}, {3.6803943892488117`*^9, 
  3.680394389689533*^9}},ExpressionUUID->"54dbf9c8-8ef1-4b5f-b90a-\
b2e70c033c9e"],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<Derivatives`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Df", "::", "usage"}], " ", "=", " ", "\"\<\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DfToFunction", "::", "usage"}], " ", "=", " ", "\"\<\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DfToCompiledFunction", "::", "usage"}], " ", "=", " ", 
    "\"\<\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.592241768075292*^9, 3.5922417692471714`*^9}, {3.592242084931059*^9, 
   3.5922420876966925`*^9}, 3.5922421309311514`*^9, {3.592255703284815*^9, 
   3.592255706497998*^9}, {3.59225574155902*^9, 3.592255745349224*^9}, {
   3.5922557821253295`*^9, 3.592255815751254*^9}, {3.5922559034172745`*^9, 
   3.5922559113667307`*^9}, {3.5922800860555387`*^9, 3.592280103747531*^9}, {
   3.59275716675933*^9, 3.5927571696474915`*^9}, 3.5927838101231008`*^9, {
   3.5933676479376955`*^9, 3.5933676483126965`*^9}, 3.602872256432743*^9, 
   3.717347290726308*^9, {3.717350836430551*^9, 3.7173508372274337`*^9}, {
   3.717350945197308*^9, 3.7173509468223104`*^9}, {3.717351150753493*^9, 
   3.7173511551597834`*^9}, {3.7178900494090204`*^9, 
   3.7178900546747046`*^9}},ExpressionUUID->"3cf3e4b0-4a71-4941-9549-\
2d45368eddd0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Convert Expression into Function", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.6729228450322733`*^9, 3.6729228470646935`*^9}, {3.6729235232568893`*^9, 
  3.6729235256788254`*^9}, {3.6731965701825666`*^9, 3.6731966061576476`*^9}, {
  3.67319669842465*^9, 3.6731966990809608`*^9}, {3.6731979878874626`*^9, 
  3.6731980015527925`*^9}, {3.6746087427962484`*^9, 3.674608744499389*^9}, {
  3.6802698935528655`*^9, 3.680269894758434*^9}, {3.6802699426263723`*^9, 
  3.6802699439305487`*^9}, {3.680269984469505*^9, 3.6802700149850855`*^9}, {
  3.690264432671048*^9, 3.690264435709285*^9}, {3.717350200229728*^9, 
  3.717350207979808*^9}},ExpressionUUID->"3b0634af-914f-4e4a-a440-\
9581e0be479f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DfToFunction", "[", 
     RowBox[{"f_", ",", " ", "v_"}], "]"}], " ", ":=", " ", 
    RowBox[{"MapIndexed", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"DfToFunction", "[", 
        RowBox[{"#1", ",", " ", "v", ",", " ", 
         RowBox[{
          RowBox[{
          "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
          "1"}]}], "]"}], "&"}], ",", " ", "f"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DfToFunction", "[", 
     RowBox[{"expr_", ",", " ", "v_List", ",", " ", "n_Integer"}], "]"}], " ",
     ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", " ", "u", ",", " ", "m"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"List", "@", 
            RowBox[{"CreateArguments", "[", 
             RowBox[{
              RowBox[{"{", "#", "}"}], ",", " ", "n"}], "]"}]}], "&"}], " ", "/@",
           " ", 
          RowBox[{"v", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"u", " ", "=", " ", 
        RowBox[{"Dispatch", "@", 
         RowBox[{"Thread", "[", 
          RowBox[{"a", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{"Slot", " ", "/@", " ", 
             RowBox[{"Range", "[", 
              RowBox[{"1", ",", " ", 
               RowBox[{"Length", "@", "a"}]}], "]"}]}], ")"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"a", " ", "=", " ", 
        RowBox[{"Dispatch", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", "i__", "]"}], " ", "\[RuleDelayed]", "  ", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           "&"}], " ", "/@", " ", "a"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Function", "@", "expr"}], " ", "/.", "a"}], " ", "/.", 
          " ", "u"}], " ", "/.", " ", 
         RowBox[{
          RowBox[{"Hold", "[", "m_", "]"}], " ", "\[RuleDelayed]", " ", 
          "m"}]}], " ", "/.", "  ", 
        RowBox[{
         RowBox[{"C", "[", "m_", "]"}], " ", "\[RuleDelayed]", " ", 
         "m"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DfToFunction", "[", 
    RowBox[{
    "expr_", ",", " ", "v_List", ",", " ", "n_Integer", ",", " ", "t_", ",", 
     " ", 
     RowBox[{"o", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"DfToCompiledFunction", "[", 
    RowBox[{
    "expr", ",", " ", "v", ",", " ", "n", ",", " ", "t", ",", " ", "o"}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7118962400144577`*^9, 3.711896265327224*^9}, {
   3.7118963443590984`*^9, 3.711896345812272*^9}, {3.7118963978126745`*^9, 
   3.7118964347348537`*^9}, {3.7118967651594925`*^9, 
   3.7118969057857046`*^9}, {3.711896974551868*^9, 3.7118969770831394`*^9}, {
   3.7118971036467175`*^9, 3.7118971125217724`*^9}, {3.7118971488970757`*^9, 
   3.711897150397088*^9}, 3.711897189084914*^9, {3.711897285007573*^9, 
   3.711897285648219*^9}, {3.7118991924610405`*^9, 3.7118992183362722`*^9}, {
   3.7118994044941015`*^9, 3.711899425650491*^9}, {3.7118998366346073`*^9, 
   3.711899847994076*^9}, {3.7119031911001954`*^9, 3.7119031971783347`*^9}, {
   3.711904103451539*^9, 3.711904164952053*^9}, {3.7119043114845285`*^9, 
   3.7119043116720304`*^9}, {3.7119758338764668`*^9, 
   3.7119758446421947`*^9}, {3.7119787496856766`*^9, 3.711978834061398*^9}, {
   3.7119788677960396`*^9, 3.7119788984056716`*^9}, {3.7119790882510076`*^9, 
   3.7119790892041416`*^9}, {3.712238492589507*^9, 3.7122385395898833`*^9}, {
   3.712243067560852*^9, 3.7122431202487907`*^9}, {3.7122431664562416`*^9, 
   3.7122431846438923`*^9}, {3.712243311473095*^9, 3.712243337520174*^9}, {
   3.71224860950828*^9, 3.7122486446179466`*^9}, {3.7126653351511106`*^9, 
   3.7126653729482656`*^9}, 3.7126758470456038`*^9, 3.7126771681660137`*^9, {
   3.7178828627889795`*^9, 3.7178828717890654`*^9}, {3.717883348121717*^9, 
   3.7178834096847982`*^9}, {3.717883454778965*^9, 3.7178834754666624`*^9}, {
   3.7178835098732495`*^9, 3.7178835381860075`*^9}, {3.7178835829364495`*^9, 
   3.717883617483652*^9}, {3.7178837477661533`*^9, 3.7178837695319557`*^9}, {
   3.7178838044321885`*^9, 3.717883878151634*^9}, {3.7178840822004356`*^9, 
   3.7178841772638407`*^9}, {3.7178842460301175`*^9, 
   3.7178842519364247`*^9}, {3.7178843261558914`*^9, 
   3.7178843282027903`*^9}, {3.7178843875783377`*^9, 
   3.7178845141576653`*^9}, {3.717884635940076*^9, 3.7178847367847986`*^9}, {
   3.7178847775351686`*^9, 3.717884785847761*^9}, {3.7178848939894133`*^9, 
   3.7178849626306953`*^9}, {3.7178850722723455`*^9, 
   3.7178850802255454`*^9}, {3.7178851897890887`*^9, 
   3.7178852196174974`*^9}, {3.7178852518521757`*^9, 
   3.7178853019776545`*^9}, {3.7178853536187863`*^9, 3.717885361165717*^9}, {
   3.717885420603793*^9, 3.7178854645104494`*^9}, {3.7178857496745796`*^9, 
   3.717885751908973*^9}, {3.717885874316389*^9, 3.717885886441515*^9}, 
   3.7178859703798046`*^9, {3.717886011864581*^9, 3.7178860337241507`*^9}, 
   3.717886086782813*^9, {3.7178861199393654`*^9, 3.7178861441583614`*^9}, {
   3.717886183643096*^9, 3.717886235252961*^9}, {3.7178863211131525`*^9, 
   3.7178863531134567`*^9}, {3.717886388441919*^9, 3.717886400629545*^9}, {
   3.7178864330517163`*^9, 3.7178865887094483`*^9}, {3.717886646756872*^9, 
   3.7178866683195763`*^9}, {3.7178867021792855`*^9, 3.717886767570537*^9}, {
   3.71788681468036*^9, 3.71788699582269*^9}, {3.717887096948662*^9, 
   3.7178871494022865`*^9}, 3.717887182699481*^9, {3.717887452467654*^9, 
   3.7178874600927277`*^9}, {3.7178874916399136`*^9, 3.717887502749382*^9}, {
   3.7178875466404395`*^9, 3.717887564546844*^9}, {3.7178876962981243`*^9, 
   3.717887705954439*^9}, {3.717887736173477*^9, 3.717887773798845*^9}, {
   3.717887817533641*^9, 3.7178878729247766`*^9}, {3.717887957941225*^9, 
   3.71788800669168*^9}, 3.717888059707802*^9, {3.7178881384429364`*^9, 
   3.7178881489430323`*^9}, {3.7178882159592896`*^9, 3.717888236303228*^9}, {
   3.7178882819755383`*^9, 3.71788830335074*^9}, {3.7178883554606123`*^9, 
   3.717888536493581*^9}, {3.717888580150247*^9, 3.7178886090880227`*^9}, {
   3.717888642353975*^9, 3.7178886545259542`*^9}, {3.7178886851043854`*^9, 
   3.717888734917343*^9}, {3.717888765902011*^9, 3.71788878394907*^9}, {
   3.7178888442152643`*^9, 3.717888850277814*^9}, {3.7178888986376467`*^9, 
   3.717889015341899*^9}, {3.7178890656548724`*^9, 3.71788907713936*^9}, {
   3.717889126342937*^9, 3.7178891590463724`*^9}, {3.7178891971717367`*^9, 
   3.717889249501996*^9}, {3.7178892811272955`*^9, 3.717889327783989*^9}, {
   3.717889370159379*^9, 3.717889462457133*^9}, {3.7178896739679484`*^9, 
   3.7178896896555843`*^9}, {3.7178898631259856`*^9, 3.717889920860908*^9}, {
   3.71788995115807*^9, 3.717889952392457*^9}, {3.7178900634247627`*^9, 
   3.717890103456395*^9}, {3.717890156456909*^9, 3.717890306223962*^9}, {
   3.717891226638959*^9, 3.717891245185993*^9}, {3.717892051099903*^9, 
   3.71789211955369*^9}, 3.7178933703900633`*^9, {3.717893713393307*^9, 
   3.717893717815239*^9}},ExpressionUUID->"c41b7053-c318-443f-a504-\
ba3f67ad84d0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DfToCompiledFunction", "[", 
     RowBox[{"f_", ",", " ", "v_", ",", " ", 
      RowBox[{"t_:", "_Real"}], ",", " ", 
      RowBox[{"o", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"MapIndexed", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"DfToCompiledFunction", "[", 
        RowBox[{"#1", ",", " ", "v", ",", " ", 
         RowBox[{
          RowBox[{
          "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "-", 
          "1"}], ",", " ", "t", ",", " ", "o"}], "]"}], "&"}], ",", " ", 
      "f"}], "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DfToCompiledFunction", "[", 
    RowBox[{"expr_", ",", " ", "v_List", ",", " ", "n_Integer", ",", " ", 
     RowBox[{"t_:", "_Real"}], ",", " ", 
     RowBox[{"o", ":", 
      RowBox[{"OptionsPattern", "[", "Compile", "]"}]}]}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", " ", "f", ",", " ", "g", ",", " ", "e"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"get", " ", "args"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"List", "@", 
           RowBox[{"CreateArguments", "[", 
            RowBox[{
             RowBox[{"{", "#", "}"}], ",", " ", "n"}], "]"}]}], "&"}], " ", "/@",
          " ", 
         RowBox[{"v", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"replace", " ", 
        RowBox[{"x", "[", "]"}], " ", 
        RowBox[{"w", "/", " ", 
         RowBox[{"x", "\[LeftDoubleBracket]", "\[RightDoubleBracket]"}]}], 
        " ", "and", " ", "removes", " ", "Hold", " ", "and", " ", "C", " ", 
        "from", " ", 
        RowBox[{"Df", "[", 
         RowBox[{"...", ",", " ", "\"\<ch\>\""}], "]"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"Dispatch", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "i__", "]"}], " ", "\[RuleDelayed]", "  ", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
          "&"}], " ", "/@", " ", "a"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\[FormalP]", "[", 
           RowBox[{"a", ",", " ", "expr", ",", " ", "o"}], "]"}], " ", "/.", 
          " ", "e"}], "  ", "/.", " ", 
         RowBox[{
          RowBox[{"Hold", "[", "m_", "]"}], " ", "\[RuleDelayed]", " ", 
          "m"}]}], " ", "/.", " ", 
        RowBox[{
         RowBox[{"C", "[", "m_", "]"}], " ", "\[RuleDelayed]", " ", "m"}]}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"create", " ", "args", " ", "for", " ", 
        RowBox[{"compile", ":", " ", 
         RowBox[{"{", 
          RowBox[{"{", 
           RowBox[{"vi", ",", " ", "ui", ",", " ", 
            RowBox[{"len", 
             RowBox[{"(", "vi", ")"}]}]}], "}"}], "}"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"g", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"VectorQ", "[", 
            RowBox[{"v", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", " ", "2"}], "\[RightDoubleBracket]"}], "]"}], ",", " ", 
           RowBox[{"Length", "@", 
            RowBox[{"v", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
              "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", " ", "2"}], "\[RightDoubleBracket]"}]}], ",", " ", "1"}], 
          "]"}], "+", 
         RowBox[{"#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
          "-", "1"}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"#1", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"VectorQ", "[", "t", "]"}], ",", " ", 
              RowBox[{"t", "\[LeftDoubleBracket]", 
               RowBox[{
               "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "\[RightDoubleBracket]"}], ",", " ", "t"}], "]"}], ",", " ", 
            RowBox[{"g", "[", "##", "]"}]}], "}"}]}], "]"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"ArrayReshape", "[", 
        RowBox[{"a", ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Length", "@", "v"}], ",", " ", 
           RowBox[{"n", "+", "1"}], ",", " ", "1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"Join", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{"f", ",", " ", "a", ",", " ", 
          RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", "compile", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e", " ", "/.", " ", 
        RowBox[{
         RowBox[{"HoldPattern", "[", "a", "]"}], " ", "\[RuleDelayed]", " ", 
         RowBox[{"Evaluate", "@", "a"}]}]}], " ", "/.", " ", 
       RowBox[{"\[FormalP]", " ", "\[Rule]", " ", "Compile"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7118962400144577`*^9, 3.711896265327224*^9}, {
   3.7118963443590984`*^9, 3.711896345812272*^9}, {3.7118963978126745`*^9, 
   3.7118964347348537`*^9}, {3.7118967651594925`*^9, 
   3.7118969057857046`*^9}, {3.711896974551868*^9, 3.7118969770831394`*^9}, {
   3.7118971036467175`*^9, 3.7118971125217724`*^9}, {3.7118971488970757`*^9, 
   3.711897150397088*^9}, 3.711897189084914*^9, {3.711897285007573*^9, 
   3.711897285648219*^9}, {3.7118991924610405`*^9, 3.7118992183362722`*^9}, {
   3.7118994044941015`*^9, 3.711899425650491*^9}, {3.7118998366346073`*^9, 
   3.711899847994076*^9}, {3.7119031911001954`*^9, 3.7119031971783347`*^9}, {
   3.711904103451539*^9, 3.711904164952053*^9}, {3.7119043114845285`*^9, 
   3.7119043116720304`*^9}, {3.7119758338764668`*^9, 
   3.7119758446421947`*^9}, {3.7119787496856766`*^9, 3.711978834061398*^9}, {
   3.7119788677960396`*^9, 3.7119788984056716`*^9}, {3.7119790882510076`*^9, 
   3.7119790892041416`*^9}, {3.712238492589507*^9, 3.7122385395898833`*^9}, {
   3.712243067560852*^9, 3.7122431202487907`*^9}, {3.7122431664562416`*^9, 
   3.7122431846438923`*^9}, {3.712243311473095*^9, 3.712243337520174*^9}, {
   3.71224860950828*^9, 3.7122486446179466`*^9}, {3.7126653351511106`*^9, 
   3.7126653729482656`*^9}, 3.7126758470456038`*^9, 3.7126771681660137`*^9, {
   3.7178828627889795`*^9, 3.7178828717890654`*^9}, {3.717883348121717*^9, 
   3.7178834096847982`*^9}, {3.717883454778965*^9, 3.7178834754666624`*^9}, {
   3.7178835098732495`*^9, 3.7178835381860075`*^9}, {3.7178835829364495`*^9, 
   3.717883617483652*^9}, {3.7178837477661533`*^9, 3.7178837695319557`*^9}, {
   3.7178838044321885`*^9, 3.717883878151634*^9}, {3.7178840822004356`*^9, 
   3.7178841772638407`*^9}, {3.7178842460301175`*^9, 
   3.7178842519364247`*^9}, {3.7178843261558914`*^9, 
   3.7178843282027903`*^9}, {3.7178843875783377`*^9, 
   3.7178845141576653`*^9}, {3.717884635940076*^9, 3.7178847367847986`*^9}, {
   3.7178847775351686`*^9, 3.717884785847761*^9}, {3.7178848939894133`*^9, 
   3.7178849626306953`*^9}, {3.7178850722723455`*^9, 
   3.7178850802255454`*^9}, {3.7178851897890887`*^9, 
   3.7178852196174974`*^9}, {3.7178852518521757`*^9, 
   3.7178853019776545`*^9}, {3.7178853536187863`*^9, 3.717885361165717*^9}, {
   3.717885420603793*^9, 3.7178854645104494`*^9}, {3.7178857496745796`*^9, 
   3.717885751908973*^9}, {3.717885874316389*^9, 3.717885886441515*^9}, 
   3.7178859703798046`*^9, {3.717886011864581*^9, 3.7178860337241507`*^9}, 
   3.717886086782813*^9, {3.7178861199393654`*^9, 3.7178861441583614`*^9}, {
   3.717886183643096*^9, 3.717886235252961*^9}, {3.7178863211131525`*^9, 
   3.7178863531134567`*^9}, {3.717886388441919*^9, 3.717886400629545*^9}, {
   3.7178864330517163`*^9, 3.7178865887094483`*^9}, {3.717886646756872*^9, 
   3.7178866683195763`*^9}, {3.7178867021792855`*^9, 3.717886767570537*^9}, {
   3.71788681468036*^9, 3.71788699582269*^9}, {3.717887096948662*^9, 
   3.7178871494022865`*^9}, 3.717887182699481*^9, {3.717887452467654*^9, 
   3.7178874600927277`*^9}, {3.7178874916399136`*^9, 3.717887502749382*^9}, {
   3.7178875466404395`*^9, 3.717887564546844*^9}, {3.7178876962981243`*^9, 
   3.717887705954439*^9}, {3.717887736173477*^9, 3.717887773798845*^9}, {
   3.717887817533641*^9, 3.7178878729247766`*^9}, {3.717887957941225*^9, 
   3.71788800669168*^9}, 3.717888059707802*^9, {3.7178881384429364`*^9, 
   3.7178881489430323`*^9}, {3.7178882159592896`*^9, 3.717888236303228*^9}, {
   3.7178882819755383`*^9, 3.71788830335074*^9}, {3.7178883554606123`*^9, 
   3.717888536493581*^9}, {3.717888580150247*^9, 3.7178886090880227`*^9}, {
   3.717888642353975*^9, 3.7178886545259542`*^9}, {3.7178886851043854`*^9, 
   3.717888734917343*^9}, {3.717888765902011*^9, 3.71788878394907*^9}, {
   3.7178888442152643`*^9, 3.717888850277814*^9}, {3.7178888986376467`*^9, 
   3.717889015341899*^9}, {3.7178890656548724`*^9, 3.71788907713936*^9}, {
   3.717889126342937*^9, 3.7178891590463724`*^9}, {3.7178891971717367`*^9, 
   3.717889249501996*^9}, {3.7178892811272955`*^9, 3.717889327783989*^9}, {
   3.717889370159379*^9, 3.717889462457133*^9}, {3.7178896739679484`*^9, 
   3.7178896896555843`*^9}, {3.7178898631259856`*^9, 3.717889920860908*^9}, {
   3.71788995115807*^9, 3.717889952392457*^9}, {3.717890031549461*^9, 
   3.717890043283945*^9}, {3.7178903403336554`*^9, 3.717890436100179*^9}, {
   3.7178906711493053`*^9, 3.717890671508666*^9}, {3.7178907406499605`*^9, 
   3.717890748556275*^9}, {3.7178907922441907`*^9, 3.717890849229122*^9}, {
   3.7178909986992874`*^9, 3.7178910017618046`*^9}, {3.7178910358558917`*^9, 
   3.717891054981061*^9}, {3.7178911106534767`*^9, 3.717891111465972*^9}, {
   3.7178911463100533`*^9, 3.7178911556382675`*^9}, {3.717891197685559*^9, 
   3.717891222451414*^9}, {3.717891284936387*^9, 3.7178913116710157`*^9}, {
   3.7178913642965126`*^9, 3.717891386031083*^9}, {3.7178914772506986`*^9, 
   3.7178915331106043`*^9}, {3.7178916473304567`*^9, 3.717891718409257*^9}, {
   3.717891793738083*^9, 3.7178918002225175`*^9}, {3.7178918618481207`*^9, 
   3.717891876520121*^9}, {3.7178919280206065`*^9, 3.7178919923024807`*^9}, {
   3.7178925984019947`*^9, 3.7178925985738544`*^9}, {3.717892632027297*^9, 
   3.717892633761689*^9}, {3.7178928122008963`*^9, 3.7178928180446944`*^9}, {
   3.7178928706077023`*^9, 3.717892879420274*^9}, 3.7178931229501953`*^9, 
   3.717893374327595*^9, {3.7178937035963383`*^9, 3.7178937099714108`*^9}, {
   3.7180553646647606`*^9, 3.7180554175526237`*^9}, {3.718055564536191*^9, 
   3.7180555765697784`*^9}, {3.7182248436640444`*^9, 
   3.7182248799456706`*^9}, {3.7182295113727417`*^9, 
   3.7182295118102484`*^9}, {3.71838194152188*^9, 3.718381968881529*^9}, {
   3.7203939474894705`*^9, 3.7203939485363803`*^9}, 3.7203939957086797`*^9, {
   3.7203940676156125`*^9, 
   3.720394068521888*^9}},ExpressionUUID->"2785f515-8275-4f06-ba21-\
bed330550834"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derivatives of Expressions & Pure Functions", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.6729228450322733`*^9, 3.6729228470646935`*^9}, {3.6729235232568893`*^9, 
  3.6729235256788254`*^9}, {3.6731965701825666`*^9, 3.6731966061576476`*^9}, {
  3.67319669842465*^9, 3.6731966990809608`*^9}, {3.6731979878874626`*^9, 
  3.6731980015527925`*^9}, {3.6746087427962484`*^9, 3.674608744499389*^9}, {
  3.6802698935528655`*^9, 3.680269894758434*^9}, {3.6802699426263723`*^9, 
  3.6802699439305487`*^9}, {3.680269984469505*^9, 3.6802700149850855`*^9}, {
  3.690264432671048*^9, 
  3.690264435709285*^9}},ExpressionUUID->"f3602233-0ba7-4bf4-b85c-\
ea69048d7f3c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "Df", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"D", " ", "\[Rule]", " ", "2"}], ",", " ", 
      RowBox[{"Simplify", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"N", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"max", " ", "for", " ", "D", " ", "is", " ", "2"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Df", "::", "zero"}], " ", "=", " ", 
    "\"\<Cannot differentiate.  There exist variables with zero length: \
``\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Df", "[", 
     RowBox[{"f_Function", ",", " ", "x_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "e", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"create", " ", "args", " ", "and", " ", "func"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"Df", "[", 
         RowBox[{"x", ",", " ", "\"\<args\>\"", ",", " ", 
          RowBox[{"D", "\[Rule]", " ", "0"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"f", "[", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"e", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Df", "[", 
        RowBox[{"e", ",", " ", "x", ",", " ", "opts"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Df", "[", 
    RowBox[{"expr_", ",", " ", "x_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "e", ",", " ", "f", ",", " ", "n", ",", " ", "v", ",", " ", "F", ",", 
       " ", "J", ",", " ", "H"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"if", " ", "x", " ", "has", " ", "a", " ", "var", " ", 
        RowBox[{"w", "/", " ", "zero"}], " ", "parameters", " ", "D", " ", 
        "crashes", " ", "MMA"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"v", " ", "=", " ", 
       RowBox[{"Or", "@@", 
        RowBox[{"PossibleZeroQ", "@", 
         RowBox[{"Flatten", "@", 
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"v", ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"Df", "::", "zero"}], ",", " ", "x"}], "]"}], ";", " ", 
         RowBox[{"Throw", "[", "$Failed", "]"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "regular", " ", "simplify", " ", "does", " ", "not", " ", "execute", 
        " ", "in", " ", "reasonable", " ", "amount", " ", "of", " ", "time"}],
        " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"expr", " ", "//.", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"HoldPattern", "[", 
            RowBox[{"a___", " ", "+", " ", 
             RowBox[{"(", 
              RowBox[{"0.", "|", "0"}], ")"}], " ", "+", " ", "b___"}], "]"}],
            " ", "\[RuleDelayed]", " ", 
           RowBox[{"(", 
            RowBox[{"a", "+", "b"}], ")"}]}], ",", " ", 
          RowBox[{
           RowBox[{"HoldPattern", "[", 
            RowBox[{"a___", " ", "*", " ", 
             RowBox[{"(", 
              RowBox[{"1.", "|", "1"}], ")"}], " ", "*", " ", "b___"}], "]"}],
            " ", "\[RuleDelayed]", " ", 
           RowBox[{"(", 
            RowBox[{"a", "*", "b"}], ")"}]}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"get", " ", "vectorized", " ", "derivatives", " ", "v"}], " ",
         "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x", "[", "1", "]"}], ",", " ", 
            RowBox[{"dx", "[", "1", "]"}], ",", " ", 
            RowBox[{"ddx", "[", "1", "]"}], ",", " ", ".."}], "}"}], ",", " ",
           ".."}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"v", " ", "=", " ", 
       RowBox[{"Df", "[", 
        RowBox[{"x", ",", " ", "\"\<vec\>\"", ",", " ", "opts"}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"compute", " ", "derivatives", " ", "1"}], ".."}], "n"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"F", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"D", "[", 
          RowBox[{"e", ",", " ", 
           RowBox[{"{", 
            RowBox[{"i", ",", " ", "j"}], "}"}]}], "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", 
           RowBox[{"v", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], 
          "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", " ", "n"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"F", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"F", ",", " ", 
         RowBox[{"v", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", 
           RowBox[{"2", ";;", 
            RowBox[{"n", "+", "1"}]}]}], "\[RightDoubleBracket]"}]}], "}"}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"J", " ", "=", " ", 
       RowBox[{"Df", "[", 
        RowBox[{"F", ",", " ", "\"\<J\>\"", ",", " ", "opts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"H", " ", "=", " ", 
       RowBox[{"Df", "[", 
        RowBox[{"F", ",", " ", "\"\<H\>\"", ",", " ", "opts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"F", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"e", ",", " ", "J", ",", " ", "H"}], "}"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"1", ";;", 
         RowBox[{"n", "+", "1"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Simplify", "]"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"v", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Element", "[", 
             RowBox[{"#", ",", " ", "Reals"}], "]"}], "&"}], " ", "/@", " ", 
           RowBox[{"Flatten", "@", "v"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Simplify", "[", 
          RowBox[{"F", ",", " ", 
           RowBox[{"Assumptions", "\[Rule]", " ", "v"}]}], "]"}]}], ",", " ", 
        "\[IndentingNewLine]", "F"}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7118835530831633`*^9, 3.7118836411151133`*^9}, {
   3.711884306597843*^9, 3.711884346473177*^9}, {3.7118843892860355`*^9, 
   3.7118844471615195`*^9}, {3.711884667694562*^9, 3.711884669835256*^9}, {
   3.711885019947523*^9, 3.711885022088202*^9}, {3.7118865827731285`*^9, 
   3.7118866024764194`*^9}, {3.711886753602646*^9, 3.711886772540305*^9}, {
   3.711886844025262*^9, 3.7118868454471645`*^9}, {3.7118870456363215`*^9, 
   3.7118870498395205`*^9}, {3.7118870892773657`*^9, 3.711887127949563*^9}, {
   3.711887212575218*^9, 3.7118872153096704`*^9}, {3.711887252903697*^9, 
   3.711887327638733*^9}, {3.711887438530269*^9, 3.71188746612423*^9}, {
   3.711887496546379*^9, 3.711887597375327*^9}, {3.7118876536726694`*^9, 
   3.7118877474078283`*^9}, {3.7118877951582317`*^9, 
   3.7118878547056293`*^9}, {3.7118879143467293`*^9, 
   3.7118879145342255`*^9}, {3.7118879853161087`*^9, 
   3.7118880482541375`*^9}, {3.711888078316845*^9, 3.711888082957497*^9}, {
   3.711888115410909*^9, 3.711888143879898*^9}, {3.711888180739582*^9, 
   3.7118882017710276`*^9}, {3.7118883631629815`*^9, 
   3.7118884261322584`*^9}, {3.7118884723826447`*^9, 
   3.7118885513520765`*^9}, {3.7118888256512456`*^9, 
   3.7118888509326706`*^9}, {3.7118888918236904`*^9, 3.711888969230587*^9}, {
   3.7118890142934103`*^9, 3.711889104247341*^9}, {3.711889141513237*^9, 
   3.711889293280137*^9}, {3.711889324686631*^9, 3.711889413874894*^9}, 
   3.711889446078288*^9, {3.7118894942036886`*^9, 3.711889502781872*^9}, {
   3.711889594813909*^9, 3.7118896165797157`*^9}, {3.7118896488456097`*^9, 
   3.711889692455349*^9}, {3.711889730846278*^9, 3.711889731971304*^9}, {
   3.71188976640913*^9, 3.7118901700530767`*^9}, {3.7118902015377674`*^9, 
   3.7118902545537987`*^9}, 3.7118902888040705`*^9, {3.7118912219256716`*^9, 
   3.711891324582779*^9}, {3.711891361489338*^9, 3.71189141305227*^9}, {
   3.7118914502088304`*^9, 3.711891499052946*^9}, {3.7118915293032255`*^9, 
   3.7118916532574024`*^9}, {3.711891715179747*^9, 3.711891728883035*^9}, {
   3.71189227351259*^9, 3.7118923193879743`*^9}, {3.7118930739411592`*^9, 
   3.7118930851600027`*^9}, {3.711893461538099*^9, 3.711893464881892*^9}, {
   3.711893499491556*^9, 3.711893586757947*^9}, {3.71189366366479*^9, 
   3.711893692571292*^9}, {3.711893737134206*^9, 3.711893920370076*^9}, {
   3.711894024917821*^9, 3.711894061199379*^9}, {3.7118940960121703`*^9, 
   3.7118941098560705`*^9}, {3.711894235185209*^9, 3.7118942355133204`*^9}, {
   3.7118942822325134`*^9, 3.7118943575455923`*^9}, {3.711894455749555*^9, 
   3.7118944973124013`*^9}, {3.711894550828474*^9, 3.711894589844425*^9}, {
   3.7118946228134356`*^9, 3.7118946384854565`*^9}, {3.71189467951705*^9, 
   3.7118947170642385`*^9}, {3.7118947472676163`*^9, 3.711894758205208*^9}, {
   3.7118947890023403`*^9, 3.7118948553778906`*^9}, {3.7118949148940134`*^9, 
   3.711894917190913*^9}, {3.711895223287218*^9, 3.7118952280216208`*^9}, {
   3.7118952879596233`*^9, 3.711895296647211*^9}, {3.711895331678754*^9, 
   3.7118953593508606`*^9}, {3.7118954507266083`*^9, 
   3.7118954888675632`*^9}, {3.711895598305984*^9, 3.7118956578377686`*^9}, {
   3.7118957024474797`*^9, 3.711895746713458*^9}, {3.7118960240907955`*^9, 
   3.7118960301064606`*^9}, {3.7118960752787075`*^9, 3.711896075888103*^9}, {
   3.711898748801081*^9, 3.711898828504859*^9}, {3.711898860239514*^9, 
   3.7118989386464186`*^9}, 3.711899457510118*^9, {3.7118995099168215`*^9, 
   3.7118995181981354`*^9}, {3.711975622046568*^9, 3.7119756320622787`*^9}, {
   3.7119770595780964`*^9, 3.711977072546961*^9}, {3.7119775124256315`*^9, 
   3.71197751555066*^9}, {3.7119851780630255`*^9, 3.7119852004850893`*^9}, {
   3.71198523490944*^9, 3.711985245003272*^9}, {3.7122428259338465`*^9, 
   3.7122428546215863`*^9}, {3.7122486551649275`*^9, 3.712248675165078*^9}, {
   3.712250341959754*^9, 3.712250369225603*^9}, {3.7122532199313774`*^9, 
   3.7122532529629035`*^9}, {3.7122616378444767`*^9, 3.712261665532195*^9}, {
   3.7123277853693113`*^9, 3.712327806728877*^9}, {3.712327867854393*^9, 
   3.712327902604684*^9}, {3.7125979946869526`*^9, 3.712597999062003*^9}, {
   3.712598107641038*^9, 3.712598107797284*^9}, {3.7125989743106422`*^9, 
   3.712598975341891*^9}, {3.7126607286441436`*^9, 3.712660730456622*^9}, {
   3.71266881484468*^9, 3.712668856079402*^9}, {3.7126718624686346`*^9, 
   3.712671881031253*^9}, {3.7126757785919065`*^9, 3.712675792138896*^9}, {
   3.7173503093558493`*^9, 3.717350310527734*^9}, {3.7173514130999303`*^9, 
   3.717351417818738*^9}, 3.7182279418227077`*^9, {3.718227991838829*^9, 
   3.718228046683118*^9}, {3.7182282783729253`*^9, 3.7182283019825325`*^9}, {
   3.718229187572669*^9, 3.7182292153385677`*^9}, {3.718245931084263*^9, 
   3.7182459445843973`*^9}, {3.718246062866801*^9, 3.718246096257772*^9}, {
   3.718246173758521*^9, 3.718246215883938*^9}, {3.7182463284162993`*^9, 
   3.71824639254195*^9}, {3.718246455042568*^9, 3.7182464582300987`*^9}, {
   3.7182464883710065`*^9, 3.7182465254963894`*^9}, 3.7182466828104296`*^9, 
   3.7182467700144167`*^9, {3.7182468407651143`*^9, 3.718246849624575*^9}, {
   3.7182469866259313`*^9, 3.718247073033046*^9}, {3.7182471497681675`*^9, 
   3.7182471702214947`*^9}, {3.718247203299959*^9, 3.718247239940934*^9}, {
   3.7182811446660414`*^9, 3.7182812017291145`*^9}, {3.718281297401923*^9, 
   3.718281306042636*^9}, {3.7182813484805536`*^9, 3.7182813741058073`*^9}, {
   3.7182814189968777`*^9, 3.718281449684678*^9}, {3.7182824088528423`*^9, 
   3.718282412462266*^9}, {3.7182836092865944`*^9, 3.7182836212710733`*^9}, 
   3.71828368145918*^9, {3.718283834973369*^9, 3.718283863989293*^9}, {
   3.7183039702532616`*^9, 3.718304004534862*^9}, 3.71830959096424*^9, {
   3.71952620055488*^9, 3.7195262110549507`*^9}, {3.7195266306906624`*^9, 
   3.719526631034433*^9}},ExpressionUUID->"5138e62a-d14c-48ed-98bb-\
ac1831fd9f7d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Helper Functions", "Section",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311074368497*^9}, {
  3.7173486011764507`*^9, 3.71734863662994*^9}, {3.7173487180370255`*^9, 
  3.717348721037054*^9}, {3.7173488395382724`*^9, 3.717348844319579*^9}, {
  3.7173502441833043`*^9, 3.7173502534334154`*^9}, {3.717350329387319*^9, 
  3.7173503315748262`*^9}},ExpressionUUID->"f6194841-fa43-4082-bf8d-\
eb05d7a12951"],

Cell[CellGroupData[{

Cell["Parse N option", "Subsection",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311074368497*^9}, {
  3.7173486011764507`*^9, 3.71734863662994*^9}, {3.7173487180370255`*^9, 
  3.717348721037054*^9}, {3.7173488395382724`*^9, 3.717348844319579*^9}, {
  3.7173502441833043`*^9, 3.7173502534334154`*^9}, {3.717350342684316*^9, 
  3.717350346168727*^9}},ExpressionUUID->"bd2438b2-d6ec-4235-9489-\
c1efaa780a19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Df", "::", "D"}], " ", "=", " ", 
   "\"\<Maximum value for D is 2.  It's currently ``.  Errors are \
likely.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Df", "[", 
   RowBox[{"v_", ",", " ", "N", ",", " ", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"n", " ", ">", " ", "2"}], " ", "||", " ", 
        RowBox[{"n", " ", "<", " ", "0"}]}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"Df", "::", "D"}], ",", " ", "n"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"OptionValue", "[", "N", "]"}]}], ";", " ", 
     RowBox[{"(*", " ", 
      RowBox[{"#", " ", "of", " ", "variables", " ", "to", " ", "diff", " ", 
       RowBox[{"w", ".", "r", ".", "t"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
       RowBox[{"Total", "[", 
        RowBox[{"Times", "@@@", 
         RowBox[{"v", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
       ",", " ", "n"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717350354028183*^9, 3.7173504319977326`*^9}, {
  3.717350486310789*^9, 3.7173504985296645`*^9}, {3.7173515042258663`*^9, 
  3.717351671399454*^9}, {3.717882947539768*^9, 3.7178829695868692`*^9}, {
  3.71788313236965*^9, 
  3.71788314361977*^9}},ExpressionUUID->"dff51cd6-db22-4b68-8450-\
e03149bffb88"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Derivative Directions, dx, dy, etc.", "Subsection",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311074368497*^9}, {
  3.7173486011764507`*^9, 3.71734863662994*^9}, {3.7173487180370255`*^9, 
  3.717348721037054*^9}, {3.7173488395382724`*^9, 3.717348844319579*^9}, {
  3.7173502441833043`*^9, 
  3.7173502534334154`*^9}},ExpressionUUID->"a4c29a68-3a40-49d1-84b6-\
2f35aca77f19"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Df", "[", 
     RowBox[{"v_", ",", " ", "\"\<args\>\"", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", " ", "m", ",", " ", "d", ",", " ", "u", ",", " ", "nd"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nd", " ", "=", " ", 
        RowBox[{"Df", "[", 
         RowBox[{"v", ",", " ", "N", ",", " ", "opts"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"u", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"List", "@", 
           RowBox[{"CreateArguments", "[", 
            RowBox[{
             RowBox[{"{", "#", "}"}], ",", " ", "n"}], "]"}]}], "&"}], " ", "/@",
          " ", 
         RowBox[{"v", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"VectorQ", "[", "#", "]"}], ",", " ", "#", ",", " ", 
            RowBox[{"{", "#", "}"}]}], "]"}], "&"}], " ", "/@", " ", 
         RowBox[{"v", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"m", " ", "=", " ", 
           RowBox[{"Length", "@", 
            RowBox[{
            "d", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"m", " ", "=", " ", 
           RowBox[{"PadRight", "[", 
            RowBox[{
             RowBox[{
             "d", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ",",
              " ", 
             RowBox[{"{", 
              RowBox[{"m", "+", "j"}], "}"}], ",", " ", "nd"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Array", "[", 
           RowBox[{
            RowBox[{"u", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", " ", 
              RowBox[{"j", "+", "1"}]}], "\[RightDoubleBracket]"}], ",", " ", 
            "m"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", 
           RowBox[{"Length", "@", "v"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", " ", "0", ",", " ", "n"}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Df", "[", 
    RowBox[{"v_", ",", " ", "\"\<vec\>\"", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "m", ",", " ", "d", ",", " ", "u", ",", " ", "nd"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"Length", "@", "v"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nd", " ", "=", " ", 
       RowBox[{"Df", "[", 
        RowBox[{"v", ",", " ", "N", ",", " ", "opts"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"u", " ", "=", " ", 
       RowBox[{"Df", "[", 
        RowBox[{"v", ",", " ", "\"\<args\>\"", ",", " ", "opts", ",", " ", 
         RowBox[{"N", " ", "\[Rule]", " ", "nd"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"vectorize", " ", "derivatives"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"d", " ", "=", " ", 
          RowBox[{"Times", "@@", 
           RowBox[{"v", "\[LeftDoubleBracket]", 
            RowBox[{"i", ",", " ", "2"}], "\[RightDoubleBracket]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"d", " ", "=", " ", 
          RowBox[{"PadRight", "[", 
           RowBox[{
            RowBox[{"{", "d", "}"}], ",", " ", "j", ",", " ", "nd"}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{"u", "\[LeftDoubleBracket]", 
            RowBox[{"i", ",", " ", "j"}], "\[RightDoubleBracket]"}], ",", " ",
            "d"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "m"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"j", ",", " ", 
          RowBox[{"n", "+", "1"}]}], "}"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7118817456885033`*^9, 3.7118818453768406`*^9}, {
   3.7118819224399624`*^9, 3.711881995003089*^9}, {3.7118823555418987`*^9, 
   3.711882429261265*^9}, {3.7118824881054664`*^9, 3.7118824946368113`*^9}, {
   3.711882532465255*^9, 3.7118826419036694`*^9}, {3.711882677185214*^9, 
   3.711882677435215*^9}, {3.7118837699287267`*^9, 3.711883809554059*^9}, {
   3.711884028649643*^9, 3.7118840600092616`*^9}, {3.7118841277597923`*^9, 
   3.711884234769065*^9}, {3.7118950061291933`*^9, 3.7118951497553487`*^9}, {
   3.7118990619599867`*^9, 3.711899082350746*^9}, {3.7118991456325617`*^9, 
   3.7118991503200636`*^9}, {3.7118993937752247`*^9, 
   3.7118993951189814`*^9}, {3.711899432869297*^9, 3.7118994518382483`*^9}, {
   3.711984922451515*^9, 3.711985146875264*^9}, {3.7121687348857656`*^9, 
   3.712168794355031*^9}, {3.7121688611993237`*^9, 3.7121688617305794`*^9}, {
   3.712169224764865*^9, 3.7121693043905315`*^9}, {3.7121696983186383`*^9, 
   3.712169727225129*^9}, {3.712169800009879*^9, 3.712169871180711*^9}, 
   3.7121699997771015`*^9, {3.712170426147869*^9, 3.7121704289760184`*^9}, {
   3.712170641805922*^9, 3.712170642555912*^9}, {3.7121708677609367`*^9, 
   3.7121708869642057`*^9}, {3.712170930042693*^9, 3.7121709316208453`*^9}, {
   3.712171612910308*^9, 3.712171699004763*^9}, {3.712171754114615*^9, 
   3.712171821646429*^9}, {3.7121718672092953`*^9, 3.7121719504443645`*^9}, {
   3.7121719819602704`*^9, 3.712172026554392*^9}, {3.7121720766798077`*^9, 
   3.7121720912268095`*^9}, {3.7121722629469786`*^9, 3.712172266509508*^9}, {
   3.712172351775846*^9, 3.712172393901215*^9}, {3.7121725187460103`*^9, 
   3.7121725418243265`*^9}, {3.7121726959193487`*^9, 3.712172745169773*^9}, {
   3.712172958593437*^9, 3.712172977374841*^9}, {3.71217302248376*^9, 
   3.712173029180273*^9}, {3.712173080401499*^9, 3.712173085237404*^9}, {
   3.7121731402983503`*^9, 3.7121731436382895`*^9}, 3.7121733117445273`*^9, {
   3.7121733568329105`*^9, 3.7121734677541065`*^9}, 3.712173545120055*^9, {
   3.712173606019807*^9, 3.712173724115328*^9}, {3.7121737579423504`*^9, 
   3.7121737937830286`*^9}, {3.7121738672244196`*^9, 3.712173874833292*^9}, {
   3.7121739705020585`*^9, 3.7121740082760143`*^9}, {3.712174073507397*^9, 
   3.712174103714423*^9}, {3.7121741965596185`*^9, 3.7121742008089604`*^9}, {
   3.7121744632942476`*^9, 3.712174468547966*^9}, {3.7121745352463455`*^9, 
   3.7121745611136613`*^9}, {3.7121745933958225`*^9, 
   3.7121747488798246`*^9}, {3.7121748087089987`*^9, 
   3.7121748692311974`*^9}, {3.7121749122122097`*^9, 3.712174963829838*^9}, {
   3.7121751482390337`*^9, 3.712175164850258*^9}, {3.712175320592618*^9, 
   3.7121753317955513`*^9}, {3.71217557910868*^9, 3.712175616018675*^9}, {
   3.7121756524168673`*^9, 3.7121756545018125`*^9}, {3.712175686796209*^9, 
   3.7121757621030493`*^9}, {3.7121757959771185`*^9, 3.712175830811759*^9}, {
   3.712175982953495*^9, 3.7121761016450925`*^9}, {3.712176131857727*^9, 
   3.712176157376436*^9}, {3.7121762088685474`*^9, 3.712176245802804*^9}, {
   3.71217637101733*^9, 3.712176483141696*^9}, {3.7121785028767147`*^9, 
   3.7121785029548235`*^9}, {3.7121812665404525`*^9, 3.712181266759204*^9}, {
   3.7121820597797966`*^9, 3.7121820619985666`*^9}, {3.7121820939206944`*^9, 
   3.7121820940769434`*^9}, {3.7121821734674597`*^9, 3.712182174045585*^9}, {
   3.712328671157981*^9, 3.712328674751749*^9}, {3.7123287053770046`*^9, 
   3.7123287793932486`*^9}, {3.712328923191338*^9, 3.7123289421914854`*^9}, {
   3.712329039895443*^9, 3.712329071833213*^9}, {3.7123291917716994`*^9, 
   3.7123291950842266`*^9}, {3.7123292254438534`*^9, 
   3.7123292426940007`*^9}, {3.7123293187415085`*^9, 3.712329321366547*^9}, {
   3.7123293782331867`*^9, 3.712329488140355*^9}, {3.7123295965318995`*^9, 
   3.7123296049694757`*^9}, {3.7123297325330257`*^9, 
   3.7123298620966253`*^9}, {3.7123300759577713`*^9, 3.712330104489273*^9}, {
   3.7123301576928463`*^9, 3.712330175927369*^9}, {3.712330222646499*^9, 
   3.712330240099785*^9}, 3.7123304103668337`*^9, {3.7123304746642303`*^9, 
   3.7123305008364487`*^9}, {3.712330781057543*^9, 3.712330814265989*^9}, {
   3.712331059549308*^9, 3.712331093971469*^9}, 3.7123312254256907`*^9, 
   3.712331273988586*^9, {3.71233139019268*^9, 3.7123314067084565`*^9}, {
   3.7123314937716713`*^9, 3.7123315040061316`*^9}, {3.7123316066476316`*^9, 
   3.712331647897977*^9}, {3.712332477983028*^9, 3.7123325341397467`*^9}, {
   3.7123326601170516`*^9, 3.712332662820204*^9}, {3.712332710164332*^9, 
   3.7123327153675003`*^9}, {3.7123328744711804`*^9, 3.712332940831109*^9}, {
   3.712333233505423*^9, 3.712333333678133*^9}, {3.7123333833347993`*^9, 
   3.7123333845691843`*^9}, {3.7123334227101293`*^9, 
   3.7123334992420197`*^9}, {3.7123340723429832`*^9, 
   3.7123341268122015`*^9}, {3.712334165359386*^9, 3.7123343155950346`*^9}, {
   3.712334378017414*^9, 3.7123343798611817`*^9}, {3.712334455525719*^9, 
   3.7123344764009094`*^9}, {3.7123346196208515`*^9, 
   3.7123346255583887`*^9}, {3.712334674480699*^9, 3.7123346809494896`*^9}, {
   3.7123352694700356`*^9, 3.71233530131404*^9}, {3.712335336642476*^9, 
   3.712335355048877*^9}, {3.7123355544411697`*^9, 3.7123355557068043`*^9}, {
   3.712335795036933*^9, 3.712335797333831*^9}, {3.7123360987269745`*^9, 
   3.712336102148864*^9}, {3.712336190368361*^9, 3.7123362135302825`*^9}, 
   3.7123362549525003`*^9, {3.712336287937154*^9, 3.7123362880934024`*^9}, {
   3.712336346750144*^9, 3.7123363767347813`*^9}, {3.7123364324071093`*^9, 
   3.7123364373134127`*^9}, {3.712336534267337*^9, 3.712336534407976*^9}, {
   3.7125983387523284`*^9, 3.7125983563149767`*^9}, {3.712598430049968*^9, 
   3.7125984509095373`*^9}, 3.7125986494580636`*^9, {3.712618497354581*^9, 
   3.7126185149953394`*^9}, {3.7126601709831944`*^9, 
   3.7126603490471816`*^9}, {3.7126604346728973`*^9, 3.712660489532717*^9}, {
   3.712660831848132*^9, 3.712660857285807*^9}, {3.7126609068330965`*^9, 
   3.7126609527397313`*^9}, {3.7126623660510225`*^9, 
   3.7126623798636007`*^9}, {3.712662428676509*^9, 3.712662481036322*^9}, {
   3.712662531474244*^9, 3.71266270649951*^9}, {3.7126631504361577`*^9, 
   3.7126631744207325`*^9}, {3.712663587152074*^9, 3.7126635989802895`*^9}, {
   3.7126637308251424`*^9, 3.7126639821554213`*^9}, {3.7126641146877427`*^9, 
   3.7126641188440275`*^9}, {3.7126641633287754`*^9, 3.712664169000682*^9}, {
   3.712664265095251*^9, 3.712664273626572*^9}, {3.7126643103612537`*^9, 
   3.7126643225957317`*^9}, {3.7126644767532578`*^9, 3.712664477878265*^9}, {
   3.712664752708704*^9, 3.7126647554274635`*^9}, {3.7126651058991575`*^9, 
   3.712665218478261*^9}, {3.712665306775838*^9, 3.7126653121352434`*^9}, {
   3.712665719356374*^9, 3.712665748231616*^9}, {3.712665781200641*^9, 
   3.712665870237239*^9}, 3.7126659427222185`*^9, {3.7126659913007493`*^9, 
   3.7126660447387514`*^9}, {3.712666118645565*^9, 3.7126661298331585`*^9}, {
   3.712666188052413*^9, 3.712666227427725*^9}, {3.7126662894282427`*^9, 
   3.712666310287792*^9}, {3.712666458304659*^9, 3.712666476007945*^9}, {
   3.7126665156176353`*^9, 3.712666566649311*^9}, {3.7126666960253935`*^9, 
   3.7126667349319696`*^9}, {3.7126668111826057`*^9, 
   3.7126668409641056`*^9}, {3.712666968012043*^9, 3.7126669719808264`*^9}, {
   3.7126671242321014`*^9, 3.712667125060231*^9}, {3.7126674955595922`*^9, 
   3.7126675348879924`*^9}, {3.7126676917955537`*^9, 3.712667725991824*^9}, {
   3.712668014541113*^9, 3.712668179136239*^9}, {3.7126683116060967`*^9, 
   3.7126684187632437`*^9}, {3.712668478279403*^9, 3.712668484076289*^9}, {
   3.7126685302641587`*^9, 3.7126685304516773`*^9}, {3.712668653812085*^9, 
   3.712668655593335*^9}, {3.712669080268775*^9, 3.712669097847048*^9}, 
   3.712669188769684*^9, {3.7126692234582605`*^9, 3.712669281302494*^9}, {
   3.7126693465779343`*^9, 3.712669346843545*^9}, {3.7126694517976*^9, 
   3.7126694835322046`*^9}, {3.712669521938813*^9, 3.7126695951268883`*^9}, {
   3.7126696855495195`*^9, 3.712669688799529*^9}, {3.7126697402218504`*^9, 
   3.7126697485031557`*^9}, {3.7126698759051113`*^9, 3.712669877045745*^9}, {
   3.71266992270236*^9, 3.712669952186999*^9}, {3.712669997968627*^9, 
   3.7126700025467787`*^9}, {3.7126701487824287`*^9, 
   3.7126701856420746`*^9}, {3.712670349565321*^9, 3.712670384925028*^9}, {
   3.712671049758676*^9, 3.7126711009934797`*^9}, {3.712671964000697*^9, 
   3.7126719761414604`*^9}, {3.712672038266943*^9, 3.712672073501614*^9}, {
   3.7126724853488073`*^9, 3.712672488458211*^9}, {3.712672528489793*^9, 
   3.712672546255566*^9}, {3.7126731998704443`*^9, 3.712673212104885*^9}, 
   3.7126732707460003`*^9, {3.7126733073869534`*^9, 3.7126733858875885`*^9}, {
   3.712673825500624*^9, 3.712673832985077*^9}, {3.712674088440338*^9, 
   3.712674164878478*^9}, {3.712674201488162*^9, 3.7126742037382145`*^9}, {
   3.7126742906139045`*^9, 3.712674291426447*^9}, {3.712674327895466*^9, 
   3.712674370192695*^9}, {3.7126744526621346`*^9, 3.712674456474666*^9}, {
   3.7126745314440565`*^9, 3.7126746254572997`*^9}, {3.712674672801394*^9, 
   3.712674743677001*^9}, {3.712674824755805*^9, 3.7126748249433064`*^9}, {
   3.712674913006542*^9, 3.7126750063666983`*^9}, {3.712675050617069*^9, 
   3.7126750968674545`*^9}, {3.712675173993122*^9, 3.7126752853690176`*^9}, {
   3.712675350838329*^9, 3.712675389885515*^9}, {3.7126754440578604`*^9, 
   3.712675496855212*^9}, {3.7126755381055565`*^9, 3.712675542074303*^9}, {
   3.7126755742933607`*^9, 3.7126756188718204`*^9}, {3.7126756880286493`*^9, 
   3.7126757413884706`*^9}, {3.7126758698426695`*^9, 
   3.7126758881709476`*^9}, {3.7126760121251106`*^9, 3.712676136798026*^9}, {
   3.712676284064884*^9, 3.7126762847680516`*^9}, {3.7126764973166533`*^9, 
   3.712676500629181*^9}, {3.712676545645232*^9, 3.712676584692419*^9}, {
   3.7126766276615067`*^9, 3.7126767684752216`*^9}, {3.7126768208662696`*^9, 
   3.712676873038559*^9}, {3.7126782929388285`*^9, 3.7126782937200985`*^9}, {
   3.712678978608781*^9, 3.712679004640211*^9}, {3.712679760981598*^9, 
   3.712679942768704*^9}, 3.71268000048792*^9, {3.7126800457873745`*^9, 
   3.712680050224927*^9}, {3.7126807427775745`*^9, 3.7126807454025974`*^9}, 
   3.7126813634002995`*^9, {3.712682564402464*^9, 3.7126825719181366`*^9}, {
   3.7126826143247414`*^9, 3.7126826193247833`*^9}, {3.7127930250261106`*^9, 
   3.7127930251979856`*^9}, 3.712887593171484*^9, {3.7173475292746773`*^9, 
   3.7173475299934487`*^9}, 3.717348633020526*^9, {3.7173486734584427`*^9, 
   3.717348674724081*^9}, 3.7173487080056725`*^9, {3.717349118556773*^9, 
   3.717349140978866*^9}, {3.717349199463843*^9, 3.7173492004013605`*^9}, {
   3.717349316821109*^9, 3.717349377071727*^9}, {3.717349432697299*^9, 
   3.7173494840259495`*^9}, {3.7173503051370554`*^9, 3.71735030609019*^9}, {
   3.7173505305456185`*^9, 3.7173505773824224`*^9}, {3.717350865462098*^9, 
   3.7173508661496077`*^9}},ExpressionUUID->"b90534fc-6ac5-4fb9-b1f9-\
b53a072c3c5d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Chain rule for Jacobians and Hessians", "Subsection",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311074368497*^9}, {
  3.7173486011764507`*^9, 3.71734863662994*^9}, {3.7173487180370255`*^9, 
  3.717348721037054*^9}},ExpressionUUID->"a21b86bc-f87f-4cf8-8259-\
3c711b1ef6e1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Df", "[", 
     RowBox[{"F_", ",", " ", "\"\<J\>\"", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"J", ",", " ", "d"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"chain", " ", "rule", " ", 
        RowBox[{"Jacobian", ":", " ", 
         RowBox[{
          RowBox[{"df", "/", "dx"}], " ", 
          RowBox[{"dx", "/", "dc"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"F", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"df", "/", "dx1"}], ",", " ", "...", ",", " ", 
            RowBox[{"df", "/", "dxn"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"dx1", "/", "dc"}], ",", " ", "...", ",", " ", 
            RowBox[{"dxn", "/", "dc"}]}], "}"}]}], "}"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"J", " ", "=", " ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"#1", "\[LeftDoubleBracket]", 
                RowBox[{"1", ";;", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
               RowBox[{"#2", "\[LeftDoubleBracket]", 
                RowBox[{"1", ";;", "1"}], "\[RightDoubleBracket]"}]}], "]"}], 
             ",", " ", 
             RowBox[{"{", "}"}]}], "]"}], ",", " ", 
           RowBox[{"{", "}"}], ",", " ", 
           RowBox[{
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ".", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
          "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "D", "]"}], " ", "\[GreaterEqual]", " ",
           "1"}], ",", " ", 
         RowBox[{"Plus", "@@", 
          RowBox[{"MapThread", "[", 
           RowBox[{"J", ",", " ", "F"}], "]"}]}], ",", 
         RowBox[{"{", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Df", "[", 
    RowBox[{"F_", ",", " ", "\"\<H\>\"", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"H", ",", " ", "t", ",", " ", "d", ",", " ", "h"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"chain", " ", "rule", " ", 
       RowBox[{"Hessian", ":", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"dx", "/", "dc"}], ")"}], "\[Transpose]"}], ".", 
           RowBox[{"d", "^", "2"}]}], 
          RowBox[{"f", "/", 
           RowBox[{"dx", "^", "2."}]}], 
          RowBox[{"(", 
           RowBox[{"dx", "/", "dc"}], ")"}]}], " ", "+", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"df", "/", "dx"}], ")"}], ".", 
           RowBox[{"d", "^", "2"}]}], 
          RowBox[{"x", "/", 
           RowBox[{"dc", "^", "2"}]}]}]}]}]}], "  ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"F", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"df", "/", "dx"}], ",", " ", 
             RowBox[{
              RowBox[{"d", "^", "2"}], 
              RowBox[{"f", "/", 
               RowBox[{"dx", "^", "2"}]}]}]}], "}"}], ",", " ", ".."}], "}"}],
          ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"dx", "/", "dc"}], ",", " ", 
             RowBox[{
              RowBox[{"d", "^", "2"}], 
              RowBox[{"x", "/", 
               RowBox[{"dc", "^", "2"}]}]}]}], "}"}], ",", " ", ".."}], 
          "}"}]}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"d", " ", "=", " ", "ArrayDepth"}], ";", "\[IndentingNewLine]", 
      RowBox[{"t", " ", "=", " ", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{"#1", ",", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"1", ",", " ", 
              RowBox[{"#2", "-", "2"}]}], "]"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"#2", ",", " ", 
              RowBox[{"#2", " ", "-", " ", "1"}]}], "}"}]}], "]"}]}], "]"}], 
        "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"h", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"t", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"t", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               ".", 
               RowBox[{
               "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
               ",", " ", 
              RowBox[{"d", "[", 
               RowBox[{
               "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
               "]"}]}], "]"}], ".", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
           ",", " ", 
           RowBox[{"d", "[", 
            RowBox[{
            "#1", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "]"}]}], "]"}], "+", " ", 
         RowBox[{
          RowBox[{
          "#1", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ".", 
          RowBox[{
          "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], 
        "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"H", " ", "=", " ", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"#1", "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
              RowBox[{"#2", "\[LeftDoubleBracket]", 
               RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}]}], "]"}], 
            ",", " ", 
            RowBox[{"{", "}"}]}], "]"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"h", "@", "##"}]}], "]"}], "&"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "D", "]"}], " ", "\[GreaterEqual]", " ", 
         "2"}], ",", " ", 
        RowBox[{"Plus", "@@", 
         RowBox[{"MapThread", "[", 
          RowBox[{"H", ",", " ", "F"}], "]"}]}], ",", " ", 
        RowBox[{"{", "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7118817456885033`*^9, 3.7118818453768406`*^9}, {
   3.7118819224399624`*^9, 3.711881995003089*^9}, {3.7118823555418987`*^9, 
   3.711882429261265*^9}, {3.7118824881054664`*^9, 3.7118824946368113`*^9}, {
   3.711882532465255*^9, 3.7118826419036694`*^9}, {3.711882677185214*^9, 
   3.711882677435215*^9}, {3.7118837699287267`*^9, 3.711883809554059*^9}, {
   3.711884028649643*^9, 3.7118840600092616`*^9}, {3.7118841277597923`*^9, 
   3.711884234769065*^9}, {3.7118950061291933`*^9, 3.7118951497553487`*^9}, {
   3.7118990619599867`*^9, 3.711899082350746*^9}, {3.7118991456325617`*^9, 
   3.7118991503200636`*^9}, {3.7118993937752247`*^9, 
   3.7118993951189814`*^9}, {3.711899432869297*^9, 3.7118994518382483`*^9}, {
   3.711984922451515*^9, 3.711985146875264*^9}, {3.7121687348857656`*^9, 
   3.712168794355031*^9}, {3.7121688611993237`*^9, 3.7121688617305794`*^9}, {
   3.712169224764865*^9, 3.7121693043905315`*^9}, {3.7121696983186383`*^9, 
   3.712169727225129*^9}, {3.712169800009879*^9, 3.712169871180711*^9}, 
   3.7121699997771015`*^9, {3.712170426147869*^9, 3.7121704289760184`*^9}, {
   3.712170641805922*^9, 3.712170642555912*^9}, {3.7121708677609367`*^9, 
   3.7121708869642057`*^9}, {3.712170930042693*^9, 3.7121709316208453`*^9}, {
   3.712171612910308*^9, 3.712171699004763*^9}, {3.712171754114615*^9, 
   3.712171821646429*^9}, {3.7121718672092953`*^9, 3.7121719504443645`*^9}, {
   3.7121719819602704`*^9, 3.712172026554392*^9}, {3.7121720766798077`*^9, 
   3.7121720912268095`*^9}, {3.7121722629469786`*^9, 3.712172266509508*^9}, {
   3.712172351775846*^9, 3.712172393901215*^9}, {3.7121725187460103`*^9, 
   3.7121725418243265`*^9}, {3.7121726959193487`*^9, 3.712172745169773*^9}, {
   3.712172958593437*^9, 3.712172977374841*^9}, {3.71217302248376*^9, 
   3.712173029180273*^9}, {3.712173080401499*^9, 3.712173085237404*^9}, {
   3.7121731402983503`*^9, 3.7121731436382895`*^9}, 3.7121733117445273`*^9, {
   3.7121733568329105`*^9, 3.7121734677541065`*^9}, 3.712173545120055*^9, {
   3.712173606019807*^9, 3.712173724115328*^9}, {3.7121737579423504`*^9, 
   3.7121737937830286`*^9}, {3.7121738672244196`*^9, 3.712173874833292*^9}, {
   3.7121739705020585`*^9, 3.7121740082760143`*^9}, {3.712174073507397*^9, 
   3.712174103714423*^9}, {3.7121741965596185`*^9, 3.7121742008089604`*^9}, {
   3.7121744632942476`*^9, 3.712174468547966*^9}, {3.7121745352463455`*^9, 
   3.7121745611136613`*^9}, {3.7121745933958225`*^9, 
   3.7121747488798246`*^9}, {3.7121748087089987`*^9, 
   3.7121748692311974`*^9}, {3.7121749122122097`*^9, 3.712174963829838*^9}, {
   3.7121751482390337`*^9, 3.712175164850258*^9}, {3.712175320592618*^9, 
   3.7121753317955513`*^9}, {3.71217557910868*^9, 3.712175616018675*^9}, {
   3.7121756524168673`*^9, 3.7121756545018125`*^9}, {3.712175686796209*^9, 
   3.7121757621030493`*^9}, {3.7121757959771185`*^9, 3.712175830811759*^9}, {
   3.712175982953495*^9, 3.7121761016450925`*^9}, {3.712176131857727*^9, 
   3.712176157376436*^9}, {3.7121762088685474`*^9, 3.712176245802804*^9}, {
   3.71217637101733*^9, 3.712176483141696*^9}, {3.7121785028767147`*^9, 
   3.7121785029548235`*^9}, {3.7121812665404525`*^9, 3.712181266759204*^9}, {
   3.7121820597797966`*^9, 3.7121820619985666`*^9}, {3.7121820939206944`*^9, 
   3.7121820940769434`*^9}, {3.7121821734674597`*^9, 3.712182174045585*^9}, {
   3.712328671157981*^9, 3.712328674751749*^9}, {3.7123287053770046`*^9, 
   3.7123287793932486`*^9}, {3.712328923191338*^9, 3.7123289421914854`*^9}, {
   3.712329039895443*^9, 3.712329071833213*^9}, {3.7123291917716994`*^9, 
   3.7123291950842266`*^9}, {3.7123292254438534`*^9, 
   3.7123292426940007`*^9}, {3.7123293187415085`*^9, 3.712329321366547*^9}, {
   3.7123293782331867`*^9, 3.712329488140355*^9}, {3.7123295965318995`*^9, 
   3.7123296049694757`*^9}, {3.7123297325330257`*^9, 
   3.7123298620966253`*^9}, {3.7123300759577713`*^9, 3.712330104489273*^9}, {
   3.7123301576928463`*^9, 3.712330175927369*^9}, {3.712330222646499*^9, 
   3.712330240099785*^9}, 3.7123304103668337`*^9, {3.7123304746642303`*^9, 
   3.7123305008364487`*^9}, {3.712330781057543*^9, 3.712330814265989*^9}, {
   3.712331059549308*^9, 3.712331093971469*^9}, 3.7123312254256907`*^9, 
   3.712331273988586*^9, {3.71233139019268*^9, 3.7123314067084565`*^9}, {
   3.7123314937716713`*^9, 3.7123315040061316`*^9}, {3.7123316066476316`*^9, 
   3.712331647897977*^9}, {3.712332477983028*^9, 3.7123325341397467`*^9}, {
   3.7123326601170516`*^9, 3.712332662820204*^9}, {3.712332710164332*^9, 
   3.7123327153675003`*^9}, {3.7123328744711804`*^9, 3.712332940831109*^9}, {
   3.712333233505423*^9, 3.712333333678133*^9}, {3.7123333833347993`*^9, 
   3.7123333845691843`*^9}, {3.7123334227101293`*^9, 
   3.7123334992420197`*^9}, {3.7123340723429832`*^9, 
   3.7123341268122015`*^9}, {3.712334165359386*^9, 3.7123343155950346`*^9}, {
   3.712334378017414*^9, 3.7123343798611817`*^9}, {3.712334455525719*^9, 
   3.7123344764009094`*^9}, {3.7123346196208515`*^9, 
   3.7123346255583887`*^9}, {3.712334674480699*^9, 3.7123346809494896`*^9}, {
   3.7123352694700356`*^9, 3.71233530131404*^9}, {3.712335336642476*^9, 
   3.712335355048877*^9}, {3.7123355544411697`*^9, 3.7123355557068043`*^9}, {
   3.712335795036933*^9, 3.712335797333831*^9}, {3.7123360987269745`*^9, 
   3.712336102148864*^9}, {3.712336190368361*^9, 3.7123362135302825`*^9}, 
   3.7123362549525003`*^9, {3.712336287937154*^9, 3.7123362880934024`*^9}, {
   3.712336346750144*^9, 3.7123363767347813`*^9}, {3.7123364324071093`*^9, 
   3.7123364373134127`*^9}, {3.712336534267337*^9, 3.712336534407976*^9}, {
   3.7125983387523284`*^9, 3.7125983563149767`*^9}, {3.712598430049968*^9, 
   3.7125984509095373`*^9}, 3.7125986494580636`*^9, {3.712618497354581*^9, 
   3.7126185149953394`*^9}, {3.7126601709831944`*^9, 
   3.7126603490471816`*^9}, {3.7126604346728973`*^9, 3.712660489532717*^9}, {
   3.712660831848132*^9, 3.712660857285807*^9}, {3.7126609068330965`*^9, 
   3.7126609527397313`*^9}, {3.7126623660510225`*^9, 
   3.7126623798636007`*^9}, {3.712662428676509*^9, 3.712662481036322*^9}, {
   3.712662531474244*^9, 3.71266270649951*^9}, {3.7126631504361577`*^9, 
   3.7126631744207325`*^9}, {3.712663587152074*^9, 3.7126635989802895`*^9}, {
   3.7126637308251424`*^9, 3.7126639821554213`*^9}, {3.7126641146877427`*^9, 
   3.7126641188440275`*^9}, {3.7126641633287754`*^9, 3.712664169000682*^9}, {
   3.712664265095251*^9, 3.712664273626572*^9}, {3.7126643103612537`*^9, 
   3.7126643225957317`*^9}, {3.7126644767532578`*^9, 3.712664477878265*^9}, {
   3.712664752708704*^9, 3.7126647554274635`*^9}, {3.7126651058991575`*^9, 
   3.712665218478261*^9}, {3.712665306775838*^9, 3.7126653121352434`*^9}, {
   3.712665719356374*^9, 3.712665748231616*^9}, {3.712665781200641*^9, 
   3.712665870237239*^9}, 3.7126659427222185`*^9, {3.7126659913007493`*^9, 
   3.7126660447387514`*^9}, {3.712666118645565*^9, 3.7126661298331585`*^9}, {
   3.712666188052413*^9, 3.712666227427725*^9}, {3.7126662894282427`*^9, 
   3.712666310287792*^9}, {3.712666458304659*^9, 3.712666476007945*^9}, {
   3.7126665156176353`*^9, 3.712666566649311*^9}, {3.7126666960253935`*^9, 
   3.7126667349319696`*^9}, {3.7126668111826057`*^9, 
   3.7126668409641056`*^9}, {3.712666968012043*^9, 3.7126669719808264`*^9}, {
   3.7126671242321014`*^9, 3.712667125060231*^9}, {3.7126674955595922`*^9, 
   3.7126675348879924`*^9}, {3.7126676917955537`*^9, 3.712667725991824*^9}, {
   3.712668014541113*^9, 3.712668179136239*^9}, {3.7126683116060967`*^9, 
   3.7126684187632437`*^9}, {3.712668478279403*^9, 3.712668484076289*^9}, {
   3.7126685302641587`*^9, 3.7126685304516773`*^9}, {3.712668653812085*^9, 
   3.712668655593335*^9}, {3.712669080268775*^9, 3.712669097847048*^9}, 
   3.712669188769684*^9, {3.7126692234582605`*^9, 3.712669281302494*^9}, {
   3.7126693465779343`*^9, 3.712669346843545*^9}, {3.7126694517976*^9, 
   3.7126694835322046`*^9}, {3.712669521938813*^9, 3.7126695951268883`*^9}, {
   3.7126696855495195`*^9, 3.712669688799529*^9}, {3.7126697402218504`*^9, 
   3.7126697485031557`*^9}, {3.7126698759051113`*^9, 3.712669877045745*^9}, {
   3.71266992270236*^9, 3.712669952186999*^9}, {3.712669997968627*^9, 
   3.7126700025467787`*^9}, {3.7126701487824287`*^9, 
   3.7126701856420746`*^9}, {3.712670349565321*^9, 3.712670384925028*^9}, {
   3.712671049758676*^9, 3.7126711009934797`*^9}, {3.712671964000697*^9, 
   3.7126719761414604`*^9}, {3.712672038266943*^9, 3.712672073501614*^9}, {
   3.7126724853488073`*^9, 3.712672488458211*^9}, {3.712672528489793*^9, 
   3.712672546255566*^9}, {3.7126731998704443`*^9, 3.712673212104885*^9}, 
   3.7126732707460003`*^9, {3.7126733073869534`*^9, 3.7126733858875885`*^9}, {
   3.712673825500624*^9, 3.712673832985077*^9}, {3.712674088440338*^9, 
   3.712674164878478*^9}, {3.712674201488162*^9, 3.7126742037382145`*^9}, {
   3.7126742906139045`*^9, 3.712674291426447*^9}, {3.712674327895466*^9, 
   3.712674370192695*^9}, {3.7126744526621346`*^9, 3.712674456474666*^9}, {
   3.7126745314440565`*^9, 3.7126746254572997`*^9}, {3.712674672801394*^9, 
   3.712674743677001*^9}, {3.712674824755805*^9, 3.7126748249433064`*^9}, {
   3.712674913006542*^9, 3.7126750063666983`*^9}, {3.712675050617069*^9, 
   3.7126750968674545`*^9}, {3.712675173993122*^9, 3.7126752853690176`*^9}, {
   3.712675350838329*^9, 3.712675389885515*^9}, {3.7126754440578604`*^9, 
   3.712675496855212*^9}, {3.7126755381055565`*^9, 3.712675542074303*^9}, {
   3.7126755742933607`*^9, 3.7126756188718204`*^9}, {3.7126756880286493`*^9, 
   3.7126757413884706`*^9}, {3.7126758698426695`*^9, 
   3.7126758881709476`*^9}, {3.7126760121251106`*^9, 3.712676136798026*^9}, {
   3.712676284064884*^9, 3.7126762847680516`*^9}, {3.7126764973166533`*^9, 
   3.712676500629181*^9}, {3.712676545645232*^9, 3.712676584692419*^9}, {
   3.7126766276615067`*^9, 3.7126767684752216`*^9}, {3.7126768208662696`*^9, 
   3.712676873038559*^9}, {3.7126782929388285`*^9, 3.7126782937200985`*^9}, {
   3.712678978608781*^9, 3.712679004640211*^9}, {3.712679760981598*^9, 
   3.712679942768704*^9}, 3.71268000048792*^9, {3.7126800457873745`*^9, 
   3.712680050224927*^9}, {3.7126807427775745`*^9, 3.7126807454025974`*^9}, 
   3.7126813634002995`*^9, {3.712682564402464*^9, 3.7126825719181366`*^9}, {
   3.7126826143247414`*^9, 3.7126826193247833`*^9}, {3.7127930250261106`*^9, 
   3.7127930251979856`*^9}, 3.712887593171484*^9, {3.7173475292746773`*^9, 
   3.7173475299934487`*^9}, 3.717348633020526*^9, {3.7173486734584427`*^9, 
   3.717348674724081*^9}, 3.7173487080056725`*^9, {3.7173487625531073`*^9, 
   3.717348778365769*^9}, {3.7182293822152157`*^9, 3.71822940018416*^9}, {
   3.7182294640441675`*^9, 3.718229483247466*^9}, 3.718229523435379*^9, {
   3.7182296988284283`*^9, 3.718229706828507*^9}, {3.7183811995660286`*^9, 
   3.7183812219366426`*^9}, {3.718381311687529*^9, 3.7183813911883163`*^9}, {
   3.7183814285011687`*^9, 3.7183814341262374`*^9}, {3.718381510767622*^9, 
   3.7183815415179267`*^9}, {3.7183816196436815`*^9, 
   3.718381625284378*^9}},ExpressionUUID->"942e65eb-b458-4a6c-8404-\
4e8275100524"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Chain rule", "Subsection",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311074368497*^9}, {
  3.7173486011764507`*^9, 
  3.71734863662994*^9}},ExpressionUUID->"59470328-d6b2-4515-8923-\
505feb9dc60b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Df", "::", "i"}], " ", "=", " ", 
   "\"\<An index is out of bounds: `1` <= `2` \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Df", "[", 
    RowBox[{"F_", ",", " ", "\"\<i\>\"", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", " ", ",", "N"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"multi", "-", 
       RowBox[{"index", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "j", ",", " ", ".."}], "}"}], " ", "into", 
        " ", "linear", " ", "index", " ", "k"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"A", "[", 
        RowBox[{"i", ",", " ", "j", ",", " ", "..."}], "]"}], " ", "\[Rule]", 
       " ", 
       RowBox[{"vec", 
        RowBox[{
         RowBox[{"(", "A", ")"}], "[", "k", "]"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "N"}], "}"}], " ", "=", " ", "F"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MemberQ", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
           "1", " ", "\[LessEqual]", " ", "n", " ", "\[LessEqual]", " ", 
            "N"}], "]"}], ",", " ", "False"}], "]"}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"Df", "::", "i"}], ",", " ", "n", " ", ",", "N"}], "]"}], 
         ";", " ", 
         RowBox[{"Throw", "[", "$Failed", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "@", "n"}], " ", "\[Equal]", " ", "0"}], ",", " ", 
        "n", ",", " ", "\[IndentingNewLine]", "True", ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
              "n", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              "-", "1"}], ")"}], " ", 
            RowBox[{"Times", "@@", 
             RowBox[{"N", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"i", "+", "1"}], ";;"}], "\[RightDoubleBracket]"}]}]}],
            ",", " ", 
           RowBox[{"{", 
            RowBox[{"i", ",", " ", 
             RowBox[{
              RowBox[{"Length", "[", "n", "]"}], "-", "1"}]}], "}"}]}], "]"}],
          " ", "+", " ", 
         RowBox[{"n", "\[LeftDoubleBracket]", 
          RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"3fea569c-10fb-4bdb-8141-e94c0f6e3907"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Df", "[", 
    RowBox[{"F_", ",", " ", "\"\<ch\>\"", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "e", ",", " ", "f0", ",", " ", "f", ",", " ", "m", ",", " ", "u", ",", 
       " ", "d", ",", " ", "J", ",", " ", "H", ",", " ", "n", ",", " ", "r"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"chain", " ", "rule", " ", "with", " ", "symbols"}], " ", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"F", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f1", ",", " ", "...", ",", " ", "fn"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"v1", ",", " ", "...", ",", " ", "vm"}], "}"}]}], "}"}]}], 
       ",", " ", 
       RowBox[{"where", " ", "fi", " ", "is", " ", "a", " ", "vector"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f0", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"First", "@", 
          RowBox[{"Df", "[", 
           RowBox[{"#", ",", " ", 
            RowBox[{
            "F", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{"D", "\[Rule]", " ", "0"}], ",", " ", "opts"}], "]"}]}], 
         "&"}], " ", "/@", " ", 
        RowBox[{
        "F", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "D", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", " ", ">", " ", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", " ", "=", " ", 
          RowBox[{"Total", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"take", " ", "partial", " ", "derivative", " ", 
               RowBox[{"df", "/", "dv"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"m", " ", "=", " ", 
                RowBox[{"Times", "@@", 
                 RowBox[{
                 "v", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"e", " ", "=", " ", 
                RowBox[{"Df", "[", 
                 RowBox[{"f", ",", " ", 
                  RowBox[{"{", "v", "}"}], ",", " ", 
                  RowBox[{"N", " ", "\[Rule]", " ", "m"}], ",", " ", "opts"}],
                  "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"we", " ", "now", " ", "have", " ", 
                  RowBox[{"df", "/", "dv"}], " ", 
                  RowBox[{"dv", "/", "dc"}]}], ",", " ", 
                 RowBox[{
                  RowBox[{"let", " ", 
                   RowBox[{"dv", "/", "dc"}]}], " ", "=", " ", 
                  RowBox[{"dv", "/", "dv"}]}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                 "do", " ", "this", " ", "by", " ", "declaring", " ", "rules",
                   " ", "to", " ", "zero", " ", "out", " ", "non"}], "-", 
                 RowBox[{"diagonal", " ", "terms"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "and", " ", "set", " ", "diagonal", " ", "terms", " ", "to", 
                 " ", "1"}], " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"u", " ", "=", " ", 
                RowBox[{"List", "@", 
                 RowBox[{"CreateArguments", "[", 
                  RowBox[{
                   RowBox[{"Evaluate", "@", 
                    RowBox[{"{", 
                    RowBox[{
                    "v", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "}"}]}], ",", " ", "n"}], 
                  "]"}]}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"r", " ", "=", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", "__Integer", "]"}], " ", "\[Rule]", " ", 
                   "0"}], "&"}], " ", "/@", " ", 
                 RowBox[{"u", "\[LeftDoubleBracket]", 
                  RowBox[{"2", ";;", 
                   RowBox[{"n", "+", "1"}]}], "\[RightDoubleBracket]"}]}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"r", " ", "=", " ", 
                RowBox[{"Prepend", "[", 
                 RowBox[{"r", ",", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "[", 
                    RowBox[{"i__Integer", ",", " ", "j_Integer"}], "]"}], " ",
                     "/;", " ", 
                    RowBox[{
                    RowBox[{"Df", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", "i", "}"}], ",", " ", 
                    RowBox[{
                    "v", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], "}"}], ",", " ", "\"\<i\>\"",
                     ",", " ", "opts"}], "]"}], " ", "\[Equal]", " ", "j"}]}],
                    " ", "\[Rule]", " ", "1"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"d", " ", "=", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"e", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ";;", 
                    RowBox[{"n", "+", "1"}]}], "\[RightDoubleBracket]"}], " ",
                     "/.", " ", "r"}], "}"}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{"u", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ";;", 
                    RowBox[{"n", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                   "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "hacky", " ", "workaround", " ", "to", " ", "avoid", " ", 
                 "errors", " ", "from", " ", "Partition", " ", "and", " ", 
                 "Flatten"}], " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "would", " ", "like", " ", "to", " ", "keep", " ", "these", 
                 " ", "functions", " ", "in", " ", "unevaluated", " ", 
                 "state", " ", "while"}], " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "maintaining", " ", "rule", " ", "that", " ", "resulting", 
                 " ", "expressions", " ", 
                 RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "be",
                  " ", "held"}], " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"DfToFunction", " ", "removes", " ", 
                 RowBox[{"hold", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"J", " ", "=", " ", 
                RowBox[{"Df", "[", 
                 RowBox[{"d", ",", " ", "\"\<J\>\"", ",", " ", "opts"}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"H", " ", "=", " ", 
                RowBox[{"Df", "[", 
                 RowBox[{"d", ",", " ", "\"\<H\>\"", ",", " ", "opts"}], 
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", 
                   RowBox[{
                   "v", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], " ", ">", " ", "1"}], ",", 
                 " ", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                  "variable", " ", "C", " ", "has", " ", "attribute", " ", 
                   "NHoldAll"}], " ", "*)"}], "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"J", " ", "=", " ", 
                   RowBox[{"J", " ", "/.", " ", 
                    RowBox[{
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], " ", "\[Rule]", " ", 
                    "\[FormalX]"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"J", " ", "=", " ", 
                   RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"a", " ", "=", " ", "J"}], ",", " ", 
                    RowBox[{"b", " ", "=", " ", 
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}]}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Hold", "@", 
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", "\[FormalX]", "}"}], ",", " ", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"\[FormalX]", " ", "=", " ", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "b", "]"}], ",", " ", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", "b", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", "a"}]}], 
                    "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"n", " ", "\[GreaterEqual]", " ", "2"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"H", " ", "=", " ", 
                    RowBox[{"H", " ", "/.", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], " ", "\[Rule]", " ", 
                    "\[FormalX]"}], ",", " ", 
                    RowBox[{
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}], " ", "\[Rule]", " ", 
                    "\[FormalY]"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"H", " ", "=", " ", 
                    RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"a", " ", "=", " ", "H"}], ",", " ", 
                    RowBox[{"b", " ", "=", " ", 
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}]}], ",", " ", 
                    RowBox[{"c", " ", "=", " ", 
                    RowBox[{
                    "u", "\[LeftDoubleBracket]", "3", 
                    "\[RightDoubleBracket]"}]}]}], "}"}], ",", " ", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Hold", "@", 
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"\[FormalX]", ",", " ", "\[FormalY]"}], "}"}], 
                    ",", " ", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"\[FormalX]", " ", "=", " ", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "c", "]"}], ",", " ", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", "c", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"\[FormalY]", " ", "=", " ", 
                    RowBox[{"Partition", "[", 
                    RowBox[{"\[FormalX]", ",", " ", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", "c", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "2"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"\[FormalX]", " ", "=", " ", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "b", "]"}], ",", " ", 
                    RowBox[{
                    RowBox[{"Dimensions", "[", "b", "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
                    ";", "\[IndentingNewLine]", "a"}]}], 
                    "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
                    "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"J", ",", " ", "H"}], "}"}], "\[LeftDoubleBracket]", 
                RowBox[{"1", ";;", "n"}], "\[RightDoubleBracket]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"f", ",", " ", "f0"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{"v", ",", " ", 
                RowBox[{
                "F", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
                "}"}]}], "\[IndentingNewLine]", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "f0", "}"}], ",", " ", 
            RowBox[{"f", "\[Transpose]"}]}], "]"}], "\[Transpose]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", "f0", "}"}], "\[Transpose]"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"returns", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f1", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"df1", "/", "dv1"}], " ", 
             RowBox[{"dv1", "/", "dc"}]}], " ", "+"}], " ", ".."}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"d", "^", "2"}], 
             RowBox[{"f1", "/", 
              RowBox[{"dv1", "^", "2"}]}], " ", 
             RowBox[{"d", "^", "2"}], 
             RowBox[{"v1", "/", 
              RowBox[{"dc", "^", "2"}]}]}], " ", "+"}], " ", ".."}]}], "}"}], 
        ",", " ", ".."}], "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7118817456885033`*^9, 3.7118818453768406`*^9}, {
   3.7118819224399624`*^9, 3.711881995003089*^9}, {3.7118823555418987`*^9, 
   3.711882429261265*^9}, {3.7118824881054664`*^9, 3.7118824946368113`*^9}, {
   3.711882532465255*^9, 3.7118826419036694`*^9}, {3.711882677185214*^9, 
   3.711882677435215*^9}, {3.7118837699287267`*^9, 3.711883809554059*^9}, {
   3.711884028649643*^9, 3.7118840600092616`*^9}, {3.7118841277597923`*^9, 
   3.711884234769065*^9}, {3.7118950061291933`*^9, 3.7118951497553487`*^9}, {
   3.7118990619599867`*^9, 3.711899082350746*^9}, {3.7118991456325617`*^9, 
   3.7118991503200636`*^9}, {3.7118993937752247`*^9, 
   3.7118993951189814`*^9}, {3.711899432869297*^9, 3.7118994518382483`*^9}, {
   3.711984922451515*^9, 3.711985146875264*^9}, {3.7121687348857656`*^9, 
   3.712168794355031*^9}, {3.7121688611993237`*^9, 3.7121688617305794`*^9}, {
   3.712169224764865*^9, 3.7121693043905315`*^9}, {3.7121696983186383`*^9, 
   3.712169727225129*^9}, {3.712169800009879*^9, 3.712169871180711*^9}, 
   3.7121699997771015`*^9, {3.712170426147869*^9, 3.7121704289760184`*^9}, {
   3.712170641805922*^9, 3.712170642555912*^9}, {3.7121708677609367`*^9, 
   3.7121708869642057`*^9}, {3.712170930042693*^9, 3.7121709316208453`*^9}, {
   3.712171612910308*^9, 3.712171699004763*^9}, {3.712171754114615*^9, 
   3.712171821646429*^9}, {3.7121718672092953`*^9, 3.7121719504443645`*^9}, {
   3.7121719819602704`*^9, 3.712172026554392*^9}, {3.7121720766798077`*^9, 
   3.7121720912268095`*^9}, {3.7121722629469786`*^9, 3.712172266509508*^9}, {
   3.712172351775846*^9, 3.712172393901215*^9}, {3.7121725187460103`*^9, 
   3.7121725418243265`*^9}, {3.7121726959193487`*^9, 3.712172745169773*^9}, {
   3.712172958593437*^9, 3.712172977374841*^9}, {3.71217302248376*^9, 
   3.712173029180273*^9}, {3.712173080401499*^9, 3.712173085237404*^9}, {
   3.7121731402983503`*^9, 3.7121731436382895`*^9}, 3.7121733117445273`*^9, {
   3.7121733568329105`*^9, 3.7121734677541065`*^9}, 3.712173545120055*^9, {
   3.712173606019807*^9, 3.712173724115328*^9}, {3.7121737579423504`*^9, 
   3.7121737937830286`*^9}, {3.7121738672244196`*^9, 3.712173874833292*^9}, {
   3.7121739705020585`*^9, 3.7121740082760143`*^9}, {3.712174073507397*^9, 
   3.712174103714423*^9}, {3.7121741965596185`*^9, 3.7121742008089604`*^9}, {
   3.7121744632942476`*^9, 3.712174468547966*^9}, {3.7121745352463455`*^9, 
   3.7121745611136613`*^9}, {3.7121745933958225`*^9, 
   3.7121747488798246`*^9}, {3.7121748087089987`*^9, 
   3.7121748692311974`*^9}, {3.7121749122122097`*^9, 3.712174963829838*^9}, {
   3.7121751482390337`*^9, 3.712175164850258*^9}, {3.712175320592618*^9, 
   3.7121753317955513`*^9}, {3.71217557910868*^9, 3.712175616018675*^9}, {
   3.7121756524168673`*^9, 3.7121756545018125`*^9}, {3.712175686796209*^9, 
   3.7121757621030493`*^9}, {3.7121757959771185`*^9, 3.712175830811759*^9}, {
   3.712175982953495*^9, 3.7121761016450925`*^9}, {3.712176131857727*^9, 
   3.712176157376436*^9}, {3.7121762088685474`*^9, 3.712176245802804*^9}, {
   3.71217637101733*^9, 3.712176483141696*^9}, {3.7121785028767147`*^9, 
   3.7121785029548235`*^9}, {3.7121812665404525`*^9, 3.712181266759204*^9}, {
   3.7121820597797966`*^9, 3.7121820619985666`*^9}, {3.7121820939206944`*^9, 
   3.7121820940769434`*^9}, {3.7121821734674597`*^9, 3.712182174045585*^9}, {
   3.712328671157981*^9, 3.712328674751749*^9}, {3.7123287053770046`*^9, 
   3.7123287793932486`*^9}, {3.712328923191338*^9, 3.7123289421914854`*^9}, {
   3.712329039895443*^9, 3.712329071833213*^9}, {3.7123291917716994`*^9, 
   3.7123291950842266`*^9}, {3.7123292254438534`*^9, 
   3.7123292426940007`*^9}, {3.7123293187415085`*^9, 3.712329321366547*^9}, {
   3.7123293782331867`*^9, 3.712329488140355*^9}, {3.7123295965318995`*^9, 
   3.7123296049694757`*^9}, {3.7123297325330257`*^9, 
   3.7123298620966253`*^9}, {3.7123300759577713`*^9, 3.712330104489273*^9}, {
   3.7123301576928463`*^9, 3.712330175927369*^9}, {3.712330222646499*^9, 
   3.712330240099785*^9}, 3.7123304103668337`*^9, {3.7123304746642303`*^9, 
   3.7123305008364487`*^9}, {3.712330781057543*^9, 3.712330814265989*^9}, {
   3.712331059549308*^9, 3.712331093971469*^9}, 3.7123312254256907`*^9, 
   3.712331273988586*^9, {3.71233139019268*^9, 3.7123314067084565`*^9}, {
   3.7123314937716713`*^9, 3.7123315040061316`*^9}, {3.7123316066476316`*^9, 
   3.712331647897977*^9}, {3.712332477983028*^9, 3.7123325341397467`*^9}, {
   3.7123326601170516`*^9, 3.712332662820204*^9}, {3.712332710164332*^9, 
   3.7123327153675003`*^9}, {3.7123328744711804`*^9, 3.712332940831109*^9}, {
   3.712333233505423*^9, 3.712333333678133*^9}, {3.7123333833347993`*^9, 
   3.7123333845691843`*^9}, {3.7123334227101293`*^9, 
   3.7123334992420197`*^9}, {3.7123340723429832`*^9, 
   3.7123341268122015`*^9}, {3.712334165359386*^9, 3.7123343155950346`*^9}, {
   3.712334378017414*^9, 3.7123343798611817`*^9}, {3.712334455525719*^9, 
   3.7123344764009094`*^9}, {3.7123346196208515`*^9, 
   3.7123346255583887`*^9}, {3.712334674480699*^9, 3.7123346809494896`*^9}, {
   3.7123352694700356`*^9, 3.71233530131404*^9}, {3.712335336642476*^9, 
   3.712335355048877*^9}, {3.7123355544411697`*^9, 3.7123355557068043`*^9}, {
   3.712335795036933*^9, 3.712335797333831*^9}, {3.7123360987269745`*^9, 
   3.712336102148864*^9}, {3.712336190368361*^9, 3.7123362135302825`*^9}, 
   3.7123362549525003`*^9, {3.712336287937154*^9, 3.7123362880934024`*^9}, {
   3.712336346750144*^9, 3.7123363767347813`*^9}, {3.7123364324071093`*^9, 
   3.7123364373134127`*^9}, {3.712336534267337*^9, 3.712336534407976*^9}, {
   3.7125983387523284`*^9, 3.7125983563149767`*^9}, {3.712598430049968*^9, 
   3.7125984509095373`*^9}, 3.7125986494580636`*^9, {3.712618497354581*^9, 
   3.7126185149953394`*^9}, {3.7126601709831944`*^9, 
   3.7126603490471816`*^9}, {3.7126604346728973`*^9, 3.712660489532717*^9}, {
   3.712660831848132*^9, 3.712660857285807*^9}, {3.7126609068330965`*^9, 
   3.7126609527397313`*^9}, {3.7126623660510225`*^9, 
   3.7126623798636007`*^9}, {3.712662428676509*^9, 3.712662481036322*^9}, {
   3.712662531474244*^9, 3.71266270649951*^9}, {3.7126631504361577`*^9, 
   3.7126631744207325`*^9}, {3.712663587152074*^9, 3.7126635989802895`*^9}, {
   3.7126637308251424`*^9, 3.7126639821554213`*^9}, {3.7126641146877427`*^9, 
   3.7126641188440275`*^9}, {3.7126641633287754`*^9, 3.712664169000682*^9}, {
   3.712664265095251*^9, 3.712664273626572*^9}, {3.7126643103612537`*^9, 
   3.7126643225957317`*^9}, {3.7126644767532578`*^9, 3.712664477878265*^9}, {
   3.712664752708704*^9, 3.7126647554274635`*^9}, {3.7126651058991575`*^9, 
   3.712665218478261*^9}, {3.712665306775838*^9, 3.7126653121352434`*^9}, {
   3.712665719356374*^9, 3.712665748231616*^9}, {3.712665781200641*^9, 
   3.712665870237239*^9}, 3.7126659427222185`*^9, {3.7126659913007493`*^9, 
   3.7126660447387514`*^9}, {3.712666118645565*^9, 3.7126661298331585`*^9}, {
   3.712666188052413*^9, 3.712666227427725*^9}, {3.7126662894282427`*^9, 
   3.712666310287792*^9}, {3.712666458304659*^9, 3.712666476007945*^9}, {
   3.7126665156176353`*^9, 3.712666566649311*^9}, {3.7126666960253935`*^9, 
   3.7126667349319696`*^9}, {3.7126668111826057`*^9, 
   3.7126668409641056`*^9}, {3.712666968012043*^9, 3.7126669719808264`*^9}, {
   3.7126671242321014`*^9, 3.712667125060231*^9}, {3.7126674955595922`*^9, 
   3.7126675348879924`*^9}, {3.7126676917955537`*^9, 3.712667725991824*^9}, {
   3.712668014541113*^9, 3.712668179136239*^9}, {3.7126683116060967`*^9, 
   3.7126684187632437`*^9}, {3.712668478279403*^9, 3.712668484076289*^9}, {
   3.7126685302641587`*^9, 3.7126685304516773`*^9}, {3.712668653812085*^9, 
   3.712668655593335*^9}, {3.712669080268775*^9, 3.712669097847048*^9}, 
   3.712669188769684*^9, {3.7126692234582605`*^9, 3.712669281302494*^9}, {
   3.7126693465779343`*^9, 3.712669346843545*^9}, {3.7126694517976*^9, 
   3.7126694835322046`*^9}, {3.712669521938813*^9, 3.7126695951268883`*^9}, {
   3.7126696855495195`*^9, 3.712669688799529*^9}, {3.7126697402218504`*^9, 
   3.7126697485031557`*^9}, {3.7126698759051113`*^9, 3.712669877045745*^9}, {
   3.71266992270236*^9, 3.712669952186999*^9}, {3.712669997968627*^9, 
   3.7126700025467787`*^9}, {3.7126701487824287`*^9, 
   3.7126701856420746`*^9}, {3.712670349565321*^9, 3.712670384925028*^9}, {
   3.712671049758676*^9, 3.7126711009934797`*^9}, {3.712671964000697*^9, 
   3.7126719761414604`*^9}, {3.712672038266943*^9, 3.712672073501614*^9}, {
   3.7126724853488073`*^9, 3.712672488458211*^9}, {3.712672528489793*^9, 
   3.712672546255566*^9}, {3.7126731998704443`*^9, 3.712673212104885*^9}, 
   3.7126732707460003`*^9, {3.7126733073869534`*^9, 3.7126733858875885`*^9}, {
   3.712673825500624*^9, 3.712673832985077*^9}, {3.712674088440338*^9, 
   3.712674164878478*^9}, {3.712674201488162*^9, 3.7126742037382145`*^9}, {
   3.7126742906139045`*^9, 3.712674291426447*^9}, {3.712674327895466*^9, 
   3.712674370192695*^9}, {3.7126744526621346`*^9, 3.712674456474666*^9}, {
   3.7126745314440565`*^9, 3.7126746254572997`*^9}, {3.712674672801394*^9, 
   3.712674743677001*^9}, {3.712674824755805*^9, 3.7126748249433064`*^9}, {
   3.712674913006542*^9, 3.7126750063666983`*^9}, {3.712675050617069*^9, 
   3.7126750968674545`*^9}, {3.712675173993122*^9, 3.7126752853690176`*^9}, {
   3.712675350838329*^9, 3.712675389885515*^9}, {3.7126754440578604`*^9, 
   3.712675496855212*^9}, {3.7126755381055565`*^9, 3.712675542074303*^9}, {
   3.7126755742933607`*^9, 3.7126756188718204`*^9}, {3.7126756880286493`*^9, 
   3.7126757413884706`*^9}, {3.7126758698426695`*^9, 
   3.7126758881709476`*^9}, {3.7126760121251106`*^9, 3.712676136798026*^9}, {
   3.712676284064884*^9, 3.7126762847680516`*^9}, {3.7126764973166533`*^9, 
   3.712676500629181*^9}, {3.712676545645232*^9, 3.712676584692419*^9}, {
   3.7126766276615067`*^9, 3.7126767684752216`*^9}, {3.7126768208662696`*^9, 
   3.712676873038559*^9}, {3.7126782929388285`*^9, 3.7126782937200985`*^9}, {
   3.712678978608781*^9, 3.712679004640211*^9}, {3.712679760981598*^9, 
   3.712679942768704*^9}, 3.71268000048792*^9, {3.7126800457873745`*^9, 
   3.712680050224927*^9}, {3.7126807427775745`*^9, 3.7126807454025974`*^9}, 
   3.7126813634002995`*^9, {3.712682564402464*^9, 3.7126825719181366`*^9}, {
   3.7126826143247414`*^9, 3.7126826193247833`*^9}, {3.7127930250261106`*^9, 
   3.7127930251979856`*^9}, 3.712887593171484*^9, {3.7173475292746773`*^9, 
   3.7173475299934487`*^9}, 3.717348633020526*^9, {3.7173495811519475`*^9, 
   3.717349673262268*^9}, {3.7173497227159*^9, 3.7173497242940516`*^9}, {
   3.7173497688413734`*^9, 3.7173498149980965`*^9}, {3.717349914811637*^9, 
   3.7173499159053807`*^9}, {3.717350709319872*^9, 3.717350730851342*^9}, {
   3.7173512654577885`*^9, 3.717351301801923*^9}, {3.717871164027381*^9, 
   3.717871171855568*^9}, {3.7178713115131454`*^9, 3.7178713139038057`*^9}, 
   3.7178715631561613`*^9, {3.717871667485279*^9, 3.717871696610555*^9}, 
   3.717872090520549*^9, {3.7178722234280744`*^9, 3.71787222649059*^9}, {
   3.717872258350281*^9, 3.7178722672878532`*^9}, {3.717872320569622*^9, 
   3.7178723276946793`*^9}, {3.7178723991797485`*^9, 3.717872410773592*^9}, 
   3.717872459242804*^9, 3.717875534258444*^9, {3.7178766367610455`*^9, 
   3.7178766467767663`*^9}, {3.7178767711373234`*^9, 3.717876774402979*^9}, {
   3.717877374439934*^9, 3.7178775747855844`*^9}, {3.7178776190985227`*^9, 
   3.7178777333339734`*^9}, {3.7178777938032928`*^9, 3.717877796912696*^9}, {
   3.7178778469287977`*^9, 3.7178779542423153`*^9}, {3.717878046133813*^9, 
   3.7178781311189966`*^9}, {3.717878171353756*^9, 3.7178782445263243`*^9}, {
   3.71787950627271*^9, 3.717879563101355*^9}, {3.7178795937110214`*^9, 
   3.7178797716345873`*^9}, {3.7178798029317713`*^9, 
   3.7178799903866777`*^9}, {3.717880205685587*^9, 3.717880525079249*^9}, {
   3.7178806052206454`*^9, 3.7178806641586947`*^9}, {3.7178810243808684`*^9, 
   3.7178811013816*^9}, {3.7178811455070176`*^9, 3.717881201695052*^9}, {
   3.717881258992484*^9, 3.717881265976926*^9}, {3.717881310430462*^9, 
   3.7178813199305625`*^9}, {3.7178813509152374`*^9, 3.717881363009086*^9}, 
   3.717881409525164*^9, {3.7178814446036205`*^9, 3.7178814496817846`*^9}, {
   3.717881496463479*^9, 3.7178815128386497`*^9}, {3.7178817190905943`*^9, 
   3.717881734528243*^9}, {3.7178818339198103`*^9, 3.717881851982481*^9}, {
   3.7178821086880484`*^9, 3.7178821100318103`*^9}, {3.7178897027025843`*^9, 
   3.7178897195308857`*^9}, {3.71788978939091*^9, 3.717889846078949*^9}, 
   3.7178926769027414`*^9, {3.7178931687162724`*^9, 3.717893170060031*^9}, {
   3.717893200607185*^9, 3.717893245107606*^9}, {3.7178932889673996`*^9, 
   3.7178932929362016`*^9}, {3.7178935182977023`*^9, 3.717893545751091*^9}, {
   3.7178936515958433`*^9, 3.7178936575177755`*^9}, {3.7178937918159275`*^9, 
   3.7178937927222013`*^9}, {3.717893923598441*^9, 3.7178939406298428`*^9}, {
   3.7178939762239285`*^9, 3.717894020458724*^9}, {3.717894441415862*^9, 
   3.717894473572424*^9}, {3.717894518588458*^9, 3.7178945194322157`*^9}, {
   3.7178945594326086`*^9, 3.7178945613232517`*^9}, {3.7178947507937913`*^9, 
   3.717894752465681*^9}, {3.7178947984973793`*^9, 3.7178948343008337`*^9}, {
   3.7182249809466515`*^9, 3.7182249837748175`*^9}, {3.71822505727553*^9, 
   3.718225076213229*^9}, {3.718225537204485*^9, 3.718225571814186*^9}, 
   3.7182256167833815`*^9, {3.718226899598609*^9, 3.7182269669273987`*^9}, {
   3.718226999537097*^9, 3.718227001630884*^9}, {3.7182286570641537`*^9, 
   3.7182286682361526`*^9}, {3.7182287105959296`*^9, 3.718228738596208*^9}, {
   3.71822883819094*^9, 3.7182288718318996`*^9}, {3.718229314980178*^9, 
   3.718229322511501*^9}, {3.718229493325689*^9, 3.7182294996226263`*^9}, {
   3.7182295317167106`*^9, 3.7182295403417954`*^9}, {3.7182297690478597`*^9, 
   3.718229798782528*^9}, {3.718229893439716*^9, 3.7182299323932266`*^9}, {
   3.718230087910387*^9, 3.718230100422762*^9}, {3.7182301466107173`*^9, 
   3.7182301477982197`*^9}, {3.718246551246626*^9, 3.7182465647311363`*^9}, 
   3.7182799159495907`*^9, {3.718280132093543*^9, 3.7182801336091723`*^9}, {
   3.7183040463165135`*^9, 3.7183040595353928`*^9}, {3.7183094945258017`*^9, 
   3.718309518291645*^9}, {3.7183097627159386`*^9, 3.718309776591076*^9}, {
   3.7183098710138817`*^9, 3.7183099447646112`*^9}, {3.718310101406785*^9, 
   3.7183101051880884`*^9}, {3.71831041350362*^9, 3.7183104751761045`*^9}, {
   3.718310691272005*^9, 3.7183107142253575`*^9}, {3.718314582951047*^9, 
   3.718314721327416*^9}, {3.718314765984106*^9, 3.718314825750332*^9}, {
   3.7183148983604136`*^9, 3.7183149325951443`*^9}, {3.7183149963145084`*^9, 
   3.7183150169709606`*^9}, {3.718315068424613*^9, 3.7183151186750917`*^9}, {
   3.718315153534812*^9, 3.718315465897276*^9}, {3.7183155406636553`*^9, 
   3.7183155830859327`*^9}, {3.7183156327426844`*^9, 3.7183157006027184`*^9}, 
   3.718316257455125*^9, {3.7195258597551394`*^9, 3.7195258630364156`*^9}, {
   3.719525893552295*^9, 3.7195259130993505`*^9}, {3.7195259963969083`*^9, 
   3.7195260260846567`*^9}, {3.719526140335611*^9, 3.7195261733202777`*^9}, {
   3.7195266943977594`*^9, 
   3.719526695272752*^9}},ExpressionUUID->"51d94759-f40d-4089-b777-\
3f54d3415263"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.591486801989799*^9, 
  3.5914868026208353`*^9}},ExpressionUUID->"2143a952-ac86-44ce-80d6-\
af271244e104"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1509},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2937, 59, 547, "Code",ExpressionUUID->"36a9df72-93f1-4f0b-8886-624339e55a43",
 InitializationCell->True],
Cell[3498, 81, 253, 4, 95, "Section",ExpressionUUID->"54dbf9c8-8ef1-4b5f-b90a-b2e70c033c9e"],
Cell[CellGroupData[{
Cell[3776, 89, 100, 1, 81, "Section",ExpressionUUID->"aef2af04-1d60-4d36-b57f-64455d13a21c"],
Cell[3879, 92, 2455, 44, 302, "Input",ExpressionUUID->"3cf3e4b0-4a71-4941-9549-2d45368eddd0",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[6371, 141, 733, 10, 95, "Section",ExpressionUUID->"3b0634af-914f-4e4a-a440-9581e0be479f"],
Cell[7107, 153, 7665, 148, 462, "Input",ExpressionUUID->"c41b7053-c318-443f-a504-ba3f67ad84d0",
 InitializationCell->True],
Cell[14775, 303, 11776, 227, 917, "Input",ExpressionUUID->"2785f515-8275-4f06-ba21-bed330550834",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[26588, 535, 698, 10, 70, "Section",ExpressionUUID->"f3602233-0ba7-4bf4-b85c-ea69048d7f3c"],
Cell[27289, 547, 13354, 265, 733, "Input",ExpressionUUID->"5138e62a-d14c-48ed-98bb-ac1831fd9f7d",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[40680, 817, 413, 6, 70, "Section",ExpressionUUID->"f6194841-fa43-4082-bf8d-eb05d7a12951"],
Cell[CellGroupData[{
Cell[41118, 827, 412, 6, 49, "Subsection",ExpressionUUID->"bd2438b2-d6ec-4235-9489-c1efaa780a19"],
Cell[41533, 835, 1941, 46, 180, "Input",ExpressionUUID->"dff51cd6-db22-4b68-8450-e03149bffb88",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[43511, 886, 387, 6, 49, "Subsection",ExpressionUUID->"a4c29a68-3a40-49d1-84b6-2f35aca77f19"],
Cell[43901, 894, 16048, 274, 560, "Input",ExpressionUUID->"b90534fc-6ac5-4fb9-b1f9-b53a072c3c5d",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[59986, 1173, 285, 4, 49, "Subsection",ExpressionUUID->"a21b86bc-f87f-4cf8-8259-3c711b1ef6e1"],
Cell[60274, 1179, 18255, 345, 332, "Input",ExpressionUUID->"942e65eb-b458-4a6c-8404-4e8275100524",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[78566, 1529, 210, 4, 49, "Subsection",ExpressionUUID->"59470328-d6b2-4515-8923-505feb9dc60b"],
Cell[78779, 1535, 2929, 79, 256, "Input",ExpressionUUID->"3fea569c-10fb-4bdb-8141-e94c0f6e3907",
 InitializationCell->True],
Cell[81711, 1616, 30984, 550, 1313, "Input",ExpressionUUID->"51d94759-f40d-4089-b777-3f54d3415263",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[112744, 2172, 30, 0, 70, "Section",ExpressionUUID->"0ad6f41f-3a9f-42c2-bdf3-3fbee5af9367"],
Cell[112777, 2174, 267, 6, 66, "Input",ExpressionUUID->"2143a952-ac86-44ce-80d6-af271244e104",
 InitializationCell->True]
}, Open  ]]
}
]
*)

