(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[    105411,       2062]
NotebookOptionsPosition[    102947,       2008]
NotebookOutlinePosition[    103312,       2024]
CellTagsIndexPosition[    103269,       2021]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"PackageVariables", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{
     "Lists", " ", "global", " ", "variables", " ", "used", " ", "by", " ", 
      "the", " ", "NLinks", " ", 
      RowBox[{"package", ".", "\n", "Copyright"}], " ", 
      RowBox[{"(", "C", ")"}], " ", "2014", " ", "Nelson", " ", "Rosa", " ", 
      RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", " ",
       "free", " ", "software"}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 
  3.6103712828520317`*^9}},ExpressionUUID->"96f1530e-e5b4-45ee-9451-\
2118fe68c73c"],

Cell["TODO", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.7193690738742647`*^9, 
  3.719369075655526*^9}},ExpressionUUID->"b4a75db0-48b0-4e30-a12c-\
b22baf44dd9e"],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"09f8a0d7-89c9-43a0-8b39-\
721e60c15083"],

Cell[BoxData[{
 RowBox[{"BeginPackage", "[", 
  RowBox[{"\"\<RigidBodyDynamics`\>\"", ",", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<GlobalVariables`\>\"", ",", " ", "\"\<Derivatives`\>\""}], 
    "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.592290865938843*^9, 3.592290866173859*^9}, {
   3.5923240589825273`*^9, 3.592324059334548*^9}, {3.7173717115807986`*^9, 
   3.7173717524874687`*^9}, {3.717371813519357*^9, 3.7173718485197163`*^9}, {
   3.7173718820200496`*^9, 3.7173719810054393`*^9}, {3.7173720131151433`*^9, 
   3.717372014130781*^9}, {3.717372051443678*^9, 3.717372076553296*^9}, {
   3.7173721748511963`*^9, 3.717372175273059*^9}, {3.717372217367241*^9, 
   3.7173722335861588`*^9}, {3.717372263852104*^9, 3.7173722969930687`*^9}, {
   3.7174059848678765`*^9, 3.7174059945554767`*^9}, {3.7175319731848936`*^9, 
   3.7175320114509125`*^9}, {3.7175523279823484`*^9, 3.717552328966734*^9}, 
   3.7188326688058996`*^9, 3.7188962503901353`*^9, {3.7193242938571796`*^9, 
   3.7193244167644587`*^9}, {3.7193245722362256`*^9, 3.719324591064513*^9}, {
   3.719324919360301*^9, 3.7193250457051067`*^9}, {3.7193251452840652`*^9, 
   3.719325148018463*^9}, {3.7193251921282063`*^9, 3.7193252017376623`*^9}, {
   3.7193252805976963`*^9, 3.719325309832344*^9}, {3.719325352817049*^9, 
   3.71932537594226*^9}, {3.719325441177163*^9, 3.7193254525991354`*^9}, {
   3.7193255003495326`*^9, 3.7193255613500595`*^9}, {3.7193255973659863`*^9, 
   3.7193256021160107`*^9}, {3.719325675366624*^9, 3.7193257398671775`*^9}, {
   3.719325774367467*^9, 3.7193258311491957`*^9}, {3.7193259543533463`*^9, 
   3.7193259545408325`*^9}, {3.719326021822644*^9, 
   3.7193260778543644`*^9}},ExpressionUUID->"751af5ad-8043-4517-b9ef-\
40132f72aa50"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDMergeRecipes", "[", "x__", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"f", ",", " ", "a", ",", " ", "r", ",", " ", "X"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"f", " ", "=", " ", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", "#"}], " ", "\[LessEqual]", " ", "1"}], 
           ",", " ", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           " ", 
           RowBox[{"Join", "@@", "#"}]}], "]"}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r", " ", "=", " ", 
        RowBox[{
         RowBox[{"Hold", "[", "a_", "]"}], " ", "\[RuleDelayed]", " ", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"e", " ", "=", " ", 
             RowBox[{"f", "[", "a", "]"}]}], "}"}], ",", " ", 
           RowBox[{"e", " ", "/;", " ", "True"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"X", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "x", "}"}]}], " ", "/.", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<confun\>\"", " ", "\[Rule]", " ", "confun"}], ",", 
           " ", 
           RowBox[{"\"\<spatfun\>\"", " ", "\[Rule]", " ", "spatfun"}], ",", 
           " ", 
           RowBox[{"\"\<FMbJ\>\"", " ", "\[Rule]", " ", "FMbJ"}], ",", " ", 
           RowBox[{"\"\<HMbJ\>\"", " ", "\[Rule]", " ", "HMbJ"}], ",", " ", 
           RowBox[{"\"\<\[Eta]MbJ\>\"", " ", "\[Rule]", " ", "\[Eta]MbJ"}], 
           ",", " ", 
           RowBox[{"\"\<datrules\>\"", " ", "\[Rule]", " ", "datrules"}]}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"A", " ", "=", " ", "X"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"BlockExpression", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Merge", "[", 
             RowBox[{"A", ",", " ", "Hold"}], "]"}], " ", "/.", " ", "r"}], 
           ",", " ", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"f", ",", " ", "r", ",", " ", "True"}], "}"}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetRecipe", "::", "n"}], " ", "=", " ", 
   "\"\<`` is an unknown recipe.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetRecipe", "[", "name_", "]"}], " ", ":=", " ", 
   RowBox[{"Switch", "[", 
    RowBox[{"name", ",", " ", "\[IndentingNewLine]", "\"\<FMbJ\>\"", ",", " ", 
     RowBox[{"RBDMergeRecipes", "[", 
      RowBox[{"\"\<FMbJ\>\"", ",", " ", 
       RowBox[{"<|", 
        RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
         RowBox[{"{", "F", "}"}]}], "|>"}]}], "]"}], ",", 
     "\[IndentingNewLine]", "\"\<HMbJ\>\"", ",", " ", 
     RowBox[{"RBDMergeRecipes", "[", 
      RowBox[{"\"\<HMbJ\>\"", ",", " ", 
       RowBox[{"<|", 
        RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
         RowBox[{"{", "H", "}"}]}], "|>"}]}], "]"}], ",", 
     "\[IndentingNewLine]", "\"\<\[Eta]MbJ\>\"", ",", " ", 
     RowBox[{"RBDMergeRecipes", "[", 
      RowBox[{"\"\<\[Eta]MbJ\>\"", ",", " ", 
       RowBox[{"<|", 
        RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
         RowBox[{"{", "Eta", "}"}]}], "|>"}]}], "]"}], ",", 
     "\[IndentingNewLine]", "True", ",", " ", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RBDGetRecipe", "::", "n"}], ",", " ", "name"}], "]"}], ";", 
      " ", 
      RowBox[{"<|", "|>"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.719326236283943*^9, 3.7193263446286*^9}, {
  3.7193264077697525`*^9, 3.7193264324262266`*^9}, {3.7193269576391363`*^9, 
  3.71932696276418*^9}, {3.71932778928935*^9, 3.7193277970550394`*^9}, {
  3.7193279473687973`*^9, 3.719328055072838*^9}, {3.7193306644116044`*^9, 
  3.719330685286762*^9}, {3.719330720052677*^9, 3.719330720505807*^9}, {
  3.719368951482617*^9, 3.7193690254988613`*^9}, {3.7193692342037315`*^9, 
  3.719369236469375*^9}, {3.7193692746103053`*^9, 
  3.719369275469702*^9}},ExpressionUUID->"240b9f6a-7a87-4a7c-88dd-\
c612419e7448"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Inlined functions and data", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.7188327568692713`*^9, 
  3.7188327652131195`*^9}},ExpressionUUID->"2c5005e6-7196-4595-a709-\
0608eedea9a4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"spatfun", " ", "=", " ", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<I\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ufun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"agfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"sfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"sdotfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\[DoubleStruckCapitalI]fun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"XLfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"z1", ",", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"z3", ",", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"z6", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"zq", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"zspat", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"Z3", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"ZM", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}]}], "\[IndentingNewLine]", "}"}]}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<O\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"confun", " ", "=", " ", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<I\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Phi]fun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"rfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"rdotfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"Jfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"Tcbfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"\[Eta]fun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"Kfun", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}],
               "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "nc"}],
               "}"}]}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"zpos", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"ZAb", ",", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "nx"}], 
             "}"}], "}"}]}], "}"}]}], "\[IndentingNewLine]", "}"}]}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<O\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"datrules", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"HoldPattern", "[", "parent", "]"}], " ", "\[RuleDelayed]", 
      "  ", "parent"}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "bx", "]"}], " ", "\[RuleDelayed]", "  ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<bx\>\""}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "bs", "]"}], " ", "\[RuleDelayed]", " ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<bs\>\""}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "bo", "]"}], " ", "\[RuleDelayed]", "  ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<bo\>\""}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "ba", "]"}], " ", "\[RuleDelayed]", " ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<ba\>\""}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "pcons", "]"}], " ", "\[RuleDelayed]", "  ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<p\>\""}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "vcons", "]"}], " ", "\[RuleDelayed]", "  ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<v\>\""}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"HoldPattern", "[", "ucons", "]"}], " ", "\[RuleDelayed]", "  ", 
      RowBox[{"rb", "[", 
       RowBox[{"C", ",", " ", "\"\<u\>\""}], "]"}]}]}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7177296735436068`*^9, 3.7177296912937737`*^9}, {
   3.7177298616391597`*^9, 3.7177298629516706`*^9}, {3.7177301058914866`*^9, 
   3.7177301158603096`*^9}, 3.7177302024236317`*^9, {3.71773033565929*^9, 
   3.717730432050831*^9}, {3.7177304852075853`*^9, 3.717730565739585*^9}, {
   3.7177306449903536`*^9, 3.717730645552842*^9}, {3.7177307205848174`*^9, 
   3.717730724147369*^9}, {3.717730767897772*^9, 3.7177307858666925`*^9}, {
   3.7177312271365066`*^9, 3.7177313247311883`*^9}, {3.7177313735441537`*^9, 
   3.7177313863724*^9}, {3.717731426513401*^9, 3.7177314525605288`*^9}, {
   3.717731508264168*^9, 3.7177315104204364`*^9}, {3.717731577030445*^9, 
   3.7177316718126097`*^9}, 3.717731744078925*^9, {3.71773232927197*^9, 
   3.7177323388033085`*^9}, {3.717732382850604*^9, 3.717732386303777*^9}, {
   3.717732421147854*^9, 3.717732450679385*^9}, {3.717732621602872*^9, 
   3.71773262932171*^9}, {3.7177326651189113`*^9, 3.7177326694470935`*^9}, 
   3.717732703900545*^9, 3.717732735994599*^9, 3.7177328174797506`*^9, {
   3.717759039271948*^9, 3.7177590423500967`*^9}, {3.717772283055875*^9, 
   3.7177723198218613`*^9}, {3.717772660184458*^9, 3.7177726836690683`*^9}, {
   3.717773127735793*^9, 3.7177732248460855`*^9}, {3.7177732698933897`*^9, 
   3.7177733324564877`*^9}, {3.717773545599121*^9, 3.7177736019590344`*^9}, {
   3.717773674022219*^9, 3.7177736825222993`*^9}, {3.717773832258112*^9, 
   3.717773832773727*^9}, {3.7177738785398026`*^9, 3.7177739237902336`*^9}, {
   3.7177739688687816`*^9, 3.717774129839051*^9}, {3.7177742379182005`*^9, 
   3.717774239355732*^9}, {3.7177743397160597`*^9, 3.717774523624055*^9}, {
   3.7177745711401353`*^9, 3.7177745877965393`*^9}, {3.7177746277031674`*^9, 
   3.7177746424220624`*^9}, {3.7177746925162725`*^9, 3.71777470625079*^9}, {
   3.7177747874703107`*^9, 3.717774848252143*^9}, {3.7177749175809226`*^9, 
   3.7177749847690616`*^9}, {3.7177750478477755`*^9, 3.717775085457507*^9}, {
   3.7177751224266186`*^9, 3.7177751528018966`*^9}, {3.7177751861459637`*^9, 
   3.7177751972554445`*^9}, {3.71777527530306*^9, 3.7177753038814683`*^9}, {
   3.7177753344598846`*^9, 3.717775404601165*^9}, {3.717775557352615*^9, 
   3.717775559758906*^9}, {3.7177756007749147`*^9, 3.7177757848235393`*^9}, {
   3.717776942084527*^9, 3.717776946209567*^9}, 3.7177770236165533`*^9, {
   3.717777079601459*^9, 3.717777142055177*^9}, {3.717777973266201*^9, 
   3.717777977797495*^9}, {3.717778074845301*^9, 3.717778092907961*^9}, {
   3.7177781404084153`*^9, 3.717778142095929*^9}, {3.717778629475562*^9, 
   3.7177787343203077`*^9}, {3.717778768883147*^9, 3.7177787757894526`*^9}, {
   3.7177788219461517`*^9, 3.7177789258846292`*^9}, {3.7177789575255656`*^9, 
   3.7177789901977525`*^9}, {3.7177790283699927`*^9, 3.71777903065125*^9}, {
   3.717779616011091*^9, 3.717779621792405*^9}, {3.717870168736678*^9, 
   3.7178702216903005`*^9}, 3.7178707561172543`*^9, {3.7178710712139874`*^9, 
   3.7178710950267158`*^9}, {3.717895617011397*^9, 3.7178956294333925`*^9}, {
   3.717895894451534*^9, 3.717895897967194*^9}, 3.7180559853885593`*^9, 
   3.718056733073089*^9, 3.7180568894552975`*^9, {3.71806729236077*^9, 
   3.7180673002827272`*^9}, {3.718067335986201*^9, 3.7180673942680273`*^9}, 
   3.7180679882582765`*^9, {3.7180731998154345`*^9, 3.7180732210031548`*^9}, {
   3.718073251269083*^9, 3.7180732840194025`*^9}, {3.7180734104893885`*^9, 
   3.7180734878651686`*^9}, {3.718074159668682*^9, 3.71807417790324*^9}, {
   3.7180743250765533`*^9, 3.7180743524205914`*^9}, {3.718222871089555*^9, 
   3.718222878089632*^9}, 3.7182233944075584`*^9, {3.718223617941018*^9, 
   3.718223624784835*^9}, {3.7182239562724843`*^9, 3.718224028054446*^9}, 
   3.7182242080186777`*^9, {3.7182242397689934`*^9, 3.7182242478628216`*^9}, {
   3.718224330379262*^9, 3.718224386957947*^9}, {3.7182244338631325`*^9, 
   3.7182244403163085`*^9}, {3.7182245776926675`*^9, 3.718224583567725*^9}, {
   3.718278257299906*^9, 3.7182782624405823`*^9}, 3.718278474469368*^9, {
   3.7182786233771057`*^9, 3.718278624189598*^9}, {3.718316736100481*^9, 
   3.7183167373817434`*^9}, {3.7183168398046293`*^9, 
   3.7183168450703087`*^9}, {3.7183766022442865`*^9, 3.718376747808239*^9}, {
   3.718377540442931*^9, 3.7183775417085695`*^9}, {3.718380192166216*^9, 
   3.7183802142289495`*^9}, 3.7183865716507144`*^9, {3.7183870834424295`*^9, 
   3.718387083895547*^9}, 3.7183871769433413`*^9, {3.718403644367302*^9, 
   3.7184037123679743`*^9}, {3.7187091061756363`*^9, 3.7187091222539387`*^9}, 
   3.7187106719879866`*^9, {3.718722362989902*^9, 3.7187223710524774`*^9}, {
   3.718722528757162*^9, 3.7187226051954174`*^9}, {3.7187251149446507`*^9, 
   3.718725175320231*^9}, {3.718725249352228*^9, 3.7187253210560474`*^9}, {
   3.7187262946906705`*^9, 3.71872634478144*^9}, {3.7188921283307257`*^9, 
   3.7188921353307962`*^9}, {3.7190745770221586`*^9, 
   3.7190746082255964`*^9}, {3.719074777883507*^9, 3.719074781383541*^9}, {
   3.7191079862049055`*^9, 3.7191079929706087`*^9}, {3.719326957654773*^9, 
   3.7193269576860127`*^9}, {3.71932708014017*^9, 3.7193270801714125`*^9}, {
   3.7201635070833545`*^9, 
   3.720163511833383*^9}},ExpressionUUID->"08e5aa60-2d1b-4b05-ae60-\
874b05f90a54"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Equations of motion for constrained mechanical systems", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.591667897763588*^9, 3.591667900579752*^9}, {3.603136879308838*^9, 
  3.6031368796018543`*^9}, {3.7172091726889515`*^9, 3.71720918131404*^9}, {
  3.7172139197827697`*^9, 3.717213931689128*^9}, {3.7186289681349735`*^9, 
  3.7186289811819773`*^9}},ExpressionUUID->"cdfa3874-2044-4a4e-a2a8-\
b18153c8459c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FMbJ", " ", "=", " ", 
   RowBox[{"<|", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "\"\<f\>\""}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{
       "MbJQtys", ",", " ", "RNEA", ",", " ", "CRB", ",", " ", "X0", ",", " ",
         "rs0", ",", " ", "JOSIM", ",", " ", "EOM"}], "}"}]}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\"\<lcls\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{
       "q", ",", " ", "qd", ",", " ", "qdd", ",", " ", "u", ",", " ", "uJ", 
        ",", " ", "ag", ",", " ", "\[Phi]", ",", " ", "s", ",", " ", "sdot", 
        ",", " ", "v", ",", " ", "a", ",", " ", "f", ",", " ", "r", ",", " ", 
        "rdot", ",", " ", "sj", ",", " ", "ro", ",", " ", "sjdot", ",", " ", 
        "rodot", ",", " ", "posXco", ",", " ", "M", ",", " ", 
        "\[DoubleStruckCapitalI]", ",", " ", "XL", ",", " ", "Tcb", ",", " ", 
        "XL0", ",", " ", "X0L", ",", " ", "RL0", ",", " ", "R0L", ",", " ", 
        "sj", ",", " ", "sjdot", ",", " ", "ro", ",", " ", "rodot", ",", " ", 
        "Xo0", ",", " ", "J", ",", " ", "\[Phi]", ",", " ", "\[Eta]", ",", 
        " ", "K", ",", " ", "Ab", ",", " ", "b", ",", " ", "o", ",", " ", 
        "nq", ",", " ", "nx", ",", " ", "nf", ",", " ", "nv", ",", " ", 
        "nu"}], "}"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\"\<v\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "1"}], 
         "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "1"}], 
         "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"ufun", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"agfun", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"\[Phi]fun", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"sfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"sdotfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"rfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"rdotfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"Jfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"\[Eta]fun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"Kfun", ",", " ", "_Real", ",", " ", "3"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
         "\[DoubleStruckCapitalI]fun", ",", " ", "_Real", ",", " ", "3"}], 
         "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"XLfun", ",", " ", "_Real", ",", " ", "3"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Tcbfun", ",", " ", "_Real", ",", " ", "3"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"z1", ",", " ", "_Real", ",", " ", "0"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"z3", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"z6", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"zq", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"zpos", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"zspat", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Z3", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"ZM", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"ZAb", ",", " ", "_Real", ",", " ", "2"}], "}"}]}], "}"}]}], 
     ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\"\<d\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"parent", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"bx", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"bs", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"bo", ",", " ", "_Integer", ",", " ", "2"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"ba", ",", " ", "_Integer", ",", " ", "3"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"pcons", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"vcons", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"ucons", ",", " ", "_Integer", ",", " ", "1"}], "}"}]}], 
       "}"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\"\<I\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"mxv", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m", ",", " ", "_Real", ",", " ", "nm"}], "}"}], ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{"v", ",", " ", "_Real", ",", " ", "nm"}], "}"}]}], 
           "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"mxstarf", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m", ",", " ", "_Real", ",", " ", "nm"}], "}"}], ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{"v", ",", " ", "_Real", ",", " ", "nm"}], "}"}]}], 
           "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"posX", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"X", ",", " ", "_Real", ",", " ", 
              RowBox[{"{", 
               RowBox[{"nm", ",", " ", "nm"}], "}"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"Y", ",", " ", "_Real", ",", " ", 
              RowBox[{"{", 
               RowBox[{"nm", ",", " ", "nm"}], "}"}]}], "}"}]}], "}"}]}], 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"mxX", ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"m", ",", " ", "_Real", ",", " ", "nm"}], "}"}], ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{"X", ",", " ", "_Real", ",", " ", 
              RowBox[{"{", 
               RowBox[{"nm", ",", " ", "nm"}], "}"}]}], "}"}]}], "}"}]}], 
         "}"}]}], "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<O\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"mxv", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"mxstarf", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", 
        " ", 
        RowBox[{"{", 
         RowBox[{"posX", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"mxX", ",", " ", "_Real", ",", " ", "2"}], "}"}]}], "}"}]}], 
     ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"\"\<C\>\"", " ", "\[RuleDelayed]", " ", 
      RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.7177383178363934`*^9, {3.717738373352556*^9, 3.7177383736963143`*^9}, {
   3.7177384100560193`*^9, 3.717738410712291*^9}, {3.7177386500895653`*^9, 
   3.7177386678240924`*^9}, {3.7177393589250126`*^9, 3.717739417706832*^9}, {
   3.7177394743792353`*^9, 3.7177395180046496`*^9}, {3.7177395489580803`*^9, 
   3.717739569395774*^9}, {3.717739600833576*^9, 3.7177396026304636`*^9}, {
   3.7177396774905505`*^9, 3.71773973433484*^9}, {3.7177397647570047`*^9, 
   3.7177397656945143`*^9}, {3.717739938977398*^9, 3.7177399659776664`*^9}, {
   3.717740170182732*^9, 3.7177402314958024`*^9}, 3.7177402758868628`*^9, {
   3.7177593914813924`*^9, 3.717759394262679*^9}, {3.717759792110198*^9, 
   3.7177597921570826`*^9}, {3.717759947721069*^9, 3.7177599771900997`*^9}, {
   3.7177613285459566`*^9, 3.7177613640619087`*^9}, {3.717761503422619*^9, 
   3.717761550360565*^9}, {3.717761625439392*^9, 3.717761707737047*^9}, {
   3.717764318342185*^9, 3.717764319342179*^9}, {3.7177671251006174`*^9, 
   3.7177671580227966`*^9}, {3.71777010376954*^9, 3.7177701349260864`*^9}, {
   3.7177701658795156`*^9, 3.7177701660513797`*^9}, {3.717770243786495*^9, 
   3.7177702479271574`*^9}, {3.717772462291969*^9, 3.7177724788077364`*^9}, {
   3.717772512964321*^9, 3.7177725498240366`*^9}, {3.7177725934182186`*^9, 
   3.717772603730796*^9}, {3.7177727299351196`*^9, 3.71777274315401*^9}, {
   3.7177728103577757`*^9, 3.717772826811057*^9}, {3.7177728596082287`*^9, 
   3.7177730875166435`*^9}, 3.7177737987109146`*^9, {3.7177750332695103`*^9, 
   3.717775034191395*^9}, 3.7177766765351267`*^9, {3.7177768464586153`*^9, 
   3.7177768498180256`*^9}, 3.7177796991837573`*^9, {3.7177797543717794`*^9, 
   3.717779755418665*^9}, 3.7178962678457108`*^9, {3.717896768412965*^9, 
   3.7178967882100286`*^9}, {3.7178968697951803`*^9, 
   3.7178969036548944`*^9}, {3.7178970073554735`*^9, 3.71789703321511*^9}, {
   3.717897064418515*^9, 3.7178970691998243`*^9}, {3.7178971001532416`*^9, 
   3.7178971338254256`*^9}, {3.7178971707945385`*^9, 
   3.7178971756539493`*^9}, {3.7178972382014174`*^9, 3.71789723923269*^9}, {
   3.7178973119208837`*^9, 3.717897372171452*^9}, {3.7178974205156507`*^9, 
   3.717897423812555*^9}, {3.71790472773991*^9, 3.7179047508963833`*^9}, {
   3.717904783552928*^9, 3.717904858928644*^9}, {3.7179049045853405`*^9, 
   3.7179049050072083`*^9}, {3.717905297436214*^9, 3.7179052990299683`*^9}, {
   3.717905525001321*^9, 3.7179056128458967`*^9}, {3.7179056449243402`*^9, 
   3.7179056476743526`*^9}, 3.717905701081107*^9, {3.7179058005976934`*^9, 
   3.717905805378972*^9}, {3.7179137204420176`*^9, 3.717913745426631*^9}, {
   3.7179138384587636`*^9, 3.717913839052518*^9}, {3.7180515516371937`*^9, 
   3.7180515594497766`*^9}, {3.718051664091316*^9, 3.7180516643725796`*^9}, {
   3.718051724935582*^9, 3.718051839324789*^9}, {3.7180518833720493`*^9, 
   3.718051914403572*^9}, {3.7180520174513454`*^9, 3.718052058045434*^9}, {
   3.718052098327052*^9, 3.718052115077199*^9}, 3.718052728097419*^9, {
   3.7180527605820775`*^9, 3.7180528206294937`*^9}, {3.7180528555047812`*^9, 
   3.718052877270613*^9}, 3.7180547152574787`*^9, {3.718054776973626*^9, 
   3.718054781099023*^9}, {3.718054811712331*^9, 3.718054830050431*^9}, {
   3.7180549484599514`*^9, 3.718054969239645*^9}, 3.7180550771745105`*^9, {
   3.718055135154278*^9, 3.718055173344751*^9}, {3.718056490265394*^9, 
   3.7180564950532165`*^9}, {3.718056651215748*^9, 3.71805675471688*^9}, {
   3.718056801826311*^9, 3.7180568177926626`*^9}, {3.7180568996151485`*^9, 
   3.7180569039493594`*^9}, {3.718064482406929*^9, 3.7180644909603505`*^9}, {
   3.7180645844205875`*^9, 3.718064686475847*^9}, {3.718064720101024*^9, 
   3.718064724616028*^9}, {3.718064836485913*^9, 3.7180648444480085`*^9}, 
   3.7180669265734825`*^9, 3.7180739540728893`*^9, 3.718074008448425*^9, {
   3.718317301236906*^9, 3.718317343268572*^9}, 3.7183223681394525`*^9, {
   3.718322957919803*^9, 3.718323004981247*^9}, {3.718323206498864*^9, 
   3.7183232083738823`*^9}, {3.718323239747834*^9, 3.7183232532479677`*^9}, {
   3.7183234644026256`*^9, 3.718323495465432*^9}, {3.718323560309823*^9, 
   3.7183235666223855`*^9}, {3.7183236462244377`*^9, 3.718323647177574*^9}, {
   3.7183237116938453`*^9, 3.7183237165063844`*^9}, {3.7183238347575517`*^9, 
   3.718324031915752*^9}, {3.71832423352712*^9, 3.718324236730276*^9}, {
   3.7183243164498143`*^9, 3.718324340715679*^9}, {3.718374139719947*^9, 
   3.7183741991424246`*^9}, {3.7183742335646353`*^9, 3.718374243267844*^9}, {
   3.7183742762369227`*^9, 3.7183742945496025`*^9}, {3.718374683490947*^9, 
   3.718374690553518*^9}, {3.718386469159142*^9, 3.7183864857374244`*^9}, {
   3.7184045472199736`*^9, 3.718404567110798*^9}, {3.718405346165387*^9, 
   3.7184053476497765`*^9}, {3.7184153136615915`*^9, 
   3.7184153946155167`*^9}, {3.7184154321315084`*^9, 3.718415519398*^9}, {
   3.7184155656328325`*^9, 3.7184155717422633`*^9}, {3.718415611805146*^9, 
   3.7184156244927864`*^9}, {3.7184160258092556`*^9, 
   3.7184160853879685`*^9}, {3.7184161402635107`*^9, 
   3.7184161408260183`*^9}, {3.7184164332032366`*^9, 3.718416498938245*^9}, {
   3.718416543501186*^9, 3.7184165532981577`*^9}, {3.7184167227220664`*^9, 
   3.718416782584244*^9}, {3.718416878710209*^9, 3.7184168898978047`*^9}, {
   3.7184172080571995`*^9, 3.718417226713649*^9}, {3.7184172694328203`*^9, 
   3.7184172794797807`*^9}, {3.7185374762787724`*^9, 3.718537521576077*^9}, {
   3.71853758710795*^9, 3.7185375951549034`*^9}, 3.718624563491619*^9, {
   3.7186246340704412`*^9, 3.7186246491643395`*^9}, 3.7186284682550325`*^9, {
   3.7186691237761183`*^9, 3.718669124322999*^9}, {3.718669168354685*^9, 
   3.7186692560743017`*^9}, {3.7186693126842356`*^9, 3.718669313137382*^9}, {
   3.7186722246893883`*^9, 3.718672226705018*^9}, {3.7186731062848215`*^9, 
   3.7186731210037*^9}, {3.718673206863937*^9, 3.718673217989034*^9}, {
   3.718673338396476*^9, 3.7186733489434705`*^9}, 3.718673534132784*^9, {
   3.7186740189220314`*^9, 3.718674019922041*^9}, 3.7187099371525993`*^9, {
   3.718709987512474*^9, 3.7187100311066537`*^9}, {3.7187105644556837`*^9, 
   3.718710605206077*^9}, 3.7187296226732135`*^9, {3.718832721134544*^9, 
   3.718832722384556*^9}, {3.718832882433012*^9, 3.7188329537774677`*^9}, {
   3.7189045399149623`*^9, 3.718904540274337*^9}, {3.718905072388958*^9, 
   3.718905072717099*^9}, {3.71907466881993*^9, 3.719074671023077*^9}, {
   3.7190747156016407`*^9, 3.7190747424300423`*^9}, {3.719080317012839*^9, 
   3.719080370591507*^9}, 3.71908049571773*^9, {3.7190806532817907`*^9, 
   3.7190807086417093`*^9}, {3.7190962164166813`*^9, 3.7190962164948063`*^9}, 
   3.7191072592210827`*^9, {3.7191073303467855`*^9, 3.719107399222478*^9}, {
   3.7191081882069135`*^9, 3.719108194300729*^9}, 3.719108337942757*^9, 
   3.71932695770164*^9, 3.7193270801714125`*^9, {3.719327835742881*^9, 
   3.7193278763682175`*^9}, {3.7193279531813617`*^9, 3.719327953509473*^9}, {
   3.72015192387292*^9, 3.7201519241854076`*^9}, {3.720163904321504*^9, 
   3.720163908712165*^9}, {3.723844796350439*^9, 
   3.7238448001453447`*^9}},ExpressionUUID->"b0034c89-3b4a-4125-9258-\
1b2f348bb876"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MbJQtys", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ag", " ", "=", " ", "agfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"s", " ", "=", " ", "sfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"sdot", " ", "=", " ", "sdotfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"XL", " ", "=", " ", "XLfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{
      "\[DoubleStruckCapitalI]", " ", "=", " ", 
       "\[DoubleStruckCapitalI]fun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"u", " ", "=", " ", "ufun"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", "rfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"rdot", " ", "=", " ", "rdotfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Tcb", " ", "=", " ", "Tcbfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"J", " ", "=", " ", "Jfun"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Phi]", " ", "=", " ", "\[Phi]fun"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Eta]", " ", "=", " ", "\[Eta]fun"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"K", " ", "=", " ", "Kfun"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"nq", " ", "=", " ", 
       RowBox[{"Length", "[", "u", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nx", " ", "=", " ", 
       RowBox[{"2", "nq"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"nf", " ", "=", " ", 
       RowBox[{"Length", "@", "pcons"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nv", " ", "=", " ", 
       RowBox[{"Length", "@", "vcons"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nu", " ", "=", " ", 
       RowBox[{"Length", "@", "ucons"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"q", " ", "=", " ", 
       RowBox[{"\[DoubleStruckX]", "\[LeftDoubleBracket]", 
        RowBox[{"1", ";;", "nq"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"qd", " ", "=", " ", 
       RowBox[{"\[DoubleStruckX]", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"nq", "+", "1"}], ";;", "nx"}], "\[RightDoubleBracket]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"qdd", " ", "=", " ", "zq"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.7177383178363934`*^9, {3.717738373352556*^9, 3.7177383736963143`*^9}, {
   3.7177384100560193`*^9, 3.717738410712291*^9}, {3.7177386500895653`*^9, 
   3.7177386678240924`*^9}, {3.7177393589250126`*^9, 3.717739417706832*^9}, {
   3.7177394743792353`*^9, 3.7177395180046496`*^9}, {3.7177395489580803`*^9, 
   3.717739569395774*^9}, {3.717739600833576*^9, 3.7177396026304636`*^9}, {
   3.7177396774905505`*^9, 3.71773973433484*^9}, {3.7177397647570047`*^9, 
   3.7177397656945143`*^9}, {3.717739938977398*^9, 3.7177399659776664`*^9}, {
   3.717740170182732*^9, 3.7177402314958024`*^9}, 3.7177402758868628`*^9, {
   3.7177593914813924`*^9, 3.717759394262679*^9}, {3.717759792110198*^9, 
   3.7177597921570826`*^9}, {3.717759947721069*^9, 3.7177599771900997`*^9}, {
   3.7177613285459566`*^9, 3.7177613640619087`*^9}, {3.717761503422619*^9, 
   3.717761550360565*^9}, {3.717761625439392*^9, 3.717761707737047*^9}, {
   3.717764318342185*^9, 3.717764319342179*^9}, {3.7177671251006174`*^9, 
   3.7177671580227966`*^9}, {3.71777010376954*^9, 3.7177701349260864`*^9}, {
   3.7177701658795156`*^9, 3.7177701660513797`*^9}, {3.717770243786495*^9, 
   3.7177702479271574`*^9}, {3.717772462291969*^9, 3.7177724788077364`*^9}, {
   3.717772512964321*^9, 3.7177725498240366`*^9}, {3.7177725934182186`*^9, 
   3.717772603730796*^9}, {3.7177727299351196`*^9, 3.71777274315401*^9}, {
   3.7177728103577757`*^9, 3.717772826811057*^9}, {3.7177728596082287`*^9, 
   3.7177730875166435`*^9}, 3.7177737987109146`*^9, {3.7177750332695103`*^9, 
   3.717775034191395*^9}, 3.7177766765351267`*^9, {3.7177768464586153`*^9, 
   3.7177768498180256`*^9}, 3.7177796991837573`*^9, {3.7177797543717794`*^9, 
   3.717779755418665*^9}, 3.7178962678457108`*^9, {3.717896768412965*^9, 
   3.7178967882100286`*^9}, {3.7178968697951803`*^9, 
   3.7178969036548944`*^9}, {3.7178970073554735`*^9, 3.71789703321511*^9}, {
   3.717897064418515*^9, 3.7178970691998243`*^9}, {3.7178971001532416`*^9, 
   3.7178971338254256`*^9}, {3.7178971707945385`*^9, 
   3.7178971756539493`*^9}, {3.7178972382014174`*^9, 3.71789723923269*^9}, {
   3.7178973119208837`*^9, 3.717897372171452*^9}, {3.7178974205156507`*^9, 
   3.717897423812555*^9}, {3.71790472773991*^9, 3.7179047508963833`*^9}, {
   3.717904783552928*^9, 3.717904858928644*^9}, {3.7179049045853405`*^9, 
   3.7179049050072083`*^9}, {3.717905297436214*^9, 3.7179052990299683`*^9}, {
   3.717905525001321*^9, 3.7179056128458967`*^9}, {3.7179056449243402`*^9, 
   3.7179056476743526`*^9}, 3.717905701081107*^9, {3.7179058005976934`*^9, 
   3.717905805378972*^9}, {3.7179137204420176`*^9, 3.717913745426631*^9}, {
   3.7179138384587636`*^9, 3.717913839052518*^9}, {3.7180515516371937`*^9, 
   3.7180515594497766`*^9}, {3.718051664091316*^9, 3.7180516643725796`*^9}, {
   3.718051724935582*^9, 3.718051839324789*^9}, {3.7180518833720493`*^9, 
   3.718051914403572*^9}, {3.7180520174513454`*^9, 3.718052058045434*^9}, {
   3.718052098327052*^9, 3.718052115077199*^9}, 3.718052728097419*^9, {
   3.7180527605820775`*^9, 3.7180528206294937`*^9}, {3.7180528555047812`*^9, 
   3.718052877270613*^9}, 3.7180547152574787`*^9, {3.718054776973626*^9, 
   3.718054781099023*^9}, {3.718054811712331*^9, 3.718054830050431*^9}, {
   3.7180549484599514`*^9, 3.718054969239645*^9}, 3.7180550771745105`*^9, {
   3.718055135154278*^9, 3.718055173344751*^9}, {3.718056490265394*^9, 
   3.7180564950532165`*^9}, {3.718056651215748*^9, 3.71805675471688*^9}, {
   3.718056801826311*^9, 3.7180568177926626`*^9}, {3.7180568996151485`*^9, 
   3.7180569039493594`*^9}, {3.718064482406929*^9, 3.7180644909603505`*^9}, {
   3.7180645844205875`*^9, 3.718064686475847*^9}, {3.718064720101024*^9, 
   3.718064724616028*^9}, {3.718064836485913*^9, 3.7180648444480085`*^9}, 
   3.7180669265734825`*^9, 3.7180739540728893`*^9, 3.718074008448425*^9, {
   3.718317301236906*^9, 3.718317343268572*^9}, 3.7183223681394525`*^9, {
   3.718322957919803*^9, 3.718323004981247*^9}, {3.718323206498864*^9, 
   3.7183232083738823`*^9}, {3.718323239747834*^9, 3.7183232532479677`*^9}, {
   3.7183234644026256`*^9, 3.718323495465432*^9}, {3.718323560309823*^9, 
   3.7183235666223855`*^9}, {3.7183236462244377`*^9, 3.718323647177574*^9}, {
   3.7183237116938453`*^9, 3.7183237165063844`*^9}, {3.7183238347575517`*^9, 
   3.718324031915752*^9}, {3.71832423352712*^9, 3.718324236730276*^9}, {
   3.7183243164498143`*^9, 3.718324340715679*^9}, {3.718374139719947*^9, 
   3.7183741991424246`*^9}, {3.7183742335646353`*^9, 3.718374243267844*^9}, {
   3.7183742762369227`*^9, 3.7183742945496025`*^9}, {3.718374683490947*^9, 
   3.718374690553518*^9}, {3.718386469159142*^9, 3.7183864857374244`*^9}, {
   3.7184045472199736`*^9, 3.718404567110798*^9}, {3.718405346165387*^9, 
   3.7184053476497765`*^9}, 3.7184154187876315`*^9, {3.718717088143832*^9, 
   3.718717102909604*^9}, {3.718717149644434*^9, 3.718717156878872*^9}, 
   3.7187203554996305`*^9, {3.7187214879031286`*^9, 3.7187214895593944`*^9}, {
   3.718721663936118*^9, 3.71872166412362*^9}, {3.718722290176683*^9, 
   3.718722290489171*^9}, 3.718722354583563*^9, {3.7187230301833353`*^9, 
   3.7187230304958224`*^9}, 3.718723188011363*^9, {3.7187296051730394`*^9, 
   3.7187296114856014`*^9}, {3.718832797604049*^9, 3.7188328085885324`*^9}, {
   3.718904518195982*^9, 3.7189045187272367`*^9}, {3.7190746447728167`*^9, 
   3.719074648757231*^9}, {3.7190747956649446`*^9, 3.7190747990243397`*^9}, 
   3.71932695770164*^9, {3.7201517054415445`*^9, 3.720151728582385*^9}, {
   3.720151908544651*^9, 3.7201519093102818`*^9}, 3.777507607205625*^9, {
   3.777507690636178*^9, 3.777507697964437*^9}, 3.777507735566964*^9, {
   3.777508007344097*^9, 
   3.777508008846158*^9}},ExpressionUUID->"37c0a7a2-1e89-4a59-8302-\
20023054e4fe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EOM", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "nqfv", ",", " ", "nqfu", ",", " ", "nqfub", ",", " ", "pu", ",", " ", 
        "pv", ",", " ", "fosim", ",", " ", "xdot"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "set", " ", "up", " ", "lengths", " ", "of", " ", "the", " ", 
        "different", " ", "constraints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nqfv", " ", "=", " ", 
        RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nv"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nqfu", " ", "=", " ", 
        RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nu"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nqfub", " ", "=", " ", 
        RowBox[{"nqfu", " ", "+", " ", "1"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"solves", " ", "for", " ", "qdd"}], ",", " ", "f", ",", " ", 
         "u"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Ab", " ", "=", " ", "ZAb"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"formulate", " ", 
           RowBox[{"M", ".", "qdd"}]}], " ", "+", " ", "uJ"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"B", ".", "u"}], " ", "+", " ", "\[Tau]", " ", "+", " ", 
          RowBox[{
           RowBox[{"J", "\[Transpose]"}], ".", "f"}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Ab", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "nq"}], ",", " ", 
          RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}], " ", "=", 
        " ", "M"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Ab", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "nq"}], ",", " ", "nqfub"}], 
         "\[RightDoubleBracket]"}], " ", "=", " ", 
        RowBox[{"u", "-", "uJ"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"nf", " ", ">", "0"}], " ", "||", " ", 
          RowBox[{"nv", " ", ">", " ", "0"}]}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"pu", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{"pcons", ",", " ", "ucons"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"pv", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{"pcons", ",", " ", "vcons"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", "nq"}], ",", " ", 
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfu"}]}], 
            "\[RightDoubleBracket]"}], " ", "=", " ", 
           RowBox[{"-", 
            RowBox[{
             RowBox[{
             "J", "\[LeftDoubleBracket]", "pu", "\[RightDoubleBracket]"}], 
             "\[Transpose]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfv"}], ",", " ", 
             RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}], " ", "=",
            " ", 
           RowBox[{
           "J", "\[LeftDoubleBracket]", "pv", "\[RightDoubleBracket]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfv"}], ",", " ", "nqfub"}], 
            "\[RightDoubleBracket]"}], " ", "=", " ", 
           RowBox[{"-", 
            RowBox[{
            "\[Phi]", "\[LeftDoubleBracket]", "pv", 
             "\[RightDoubleBracket]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"UpperTriangularizeAb", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Jpv", ",", " ", "JBb", ",", " ", "MJBb", ",", " ", "JMJBb", ",", " ", 
        "\[CapitalLambda]p", ",", " ", "\[CapitalLambda]v", ",", " ", "nub", 
        ",", " ", "nfv", ",", " ", "nfub", ",", " ", "nqf", ",", " ", "nqfv", 
        ",", " ", "nqfu", ",", " ", "nqfub", ",", " ", "xdot", ",", " ", 
        "fosim"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"nf", " ", ">", " ", "0"}], " ", "&&", " ", 
          RowBox[{"nv", " ", ">", " ", "0"}]}], "*)"}], 
        RowBox[{
         RowBox[{
          RowBox[{"nf", " ", ">", " ", "0"}], " ", "||", " ", 
          RowBox[{"nv", " ", ">", " ", "0"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"nub", " ", "=", " ", 
           RowBox[{"nu", " ", "+", " ", "1"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nfv", " ", "=", " ", 
           RowBox[{"nf", " ", "+", " ", "nv"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nfub", " ", "=", " ", 
           RowBox[{"nf", " ", "+", " ", "nu", " ", "+", " ", "1"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"nqf", " ", "=", " ", 
           RowBox[{"nq", " ", "+", " ", "nf"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nqfv", " ", "=", " ", 
           RowBox[{"nq", " ", "+", " ", "nfv"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"nqfu", " ", "=", " ", 
           RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nu"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"nqfub", " ", "=", " ", 
           RowBox[{"nqfu", " ", "+", " ", "1"}]}], ";", "\[IndentingNewLine]",
           "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "extract", " ", "and", " ", "zero", " ", "Jp", " ", "and", " ", 
            "Jv"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Jpv", " ", "=", " ", 
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfv"}], ",", " ", 
             RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfv"}], ",", " ", 
             RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}], " ", "=",
            " ", 
           RowBox[{"ZAb", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfv"}], ",", " ", 
             RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"solve", " ", "for", " ", "operational"}], "-", 
            RowBox[{"space", " ", "inertia", " ", "matrices", " ", 
             RowBox[{"J", ".", 
              RowBox[{"Inverse", "[", "M", "]"}], ".", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"J", "\[Transpose]"}], "|", "B", "|", "b"}], 
               "]"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"JBb", " ", "=", " ", 
           RowBox[{"-", 
            RowBox[{"Ab", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"1", ";;", "nq"}], ",", " ", 
              RowBox[{
               RowBox[{"nq", "+", "1"}], ";;", "nqfub"}]}], 
             "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"MJBb", " ", "=", " ", 
           RowBox[{"LinearSolve", "[", 
            RowBox[{"M", ",", " ", "JBb"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"JMJBb", " ", "=", " ", 
           RowBox[{"Jpv", ".", "MJBb"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", "nfv"}], ",", " ", "nfub"}], 
            "\[RightDoubleBracket]"}], " ", "=", " ", 
           RowBox[{
            RowBox[{"Ab", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"nq", "+", "1"}], ";;", "nqfv"}], ",", " ", "nqfub"}], 
             "\[RightDoubleBracket]"}], " ", "+", " ", 
            RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"1", ";;", "nfv"}], ",", " ", "nfub"}], 
             "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"fills", " ", "in", " ", "physical", " ", "equations"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqf"}], ",", " ", 
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqfub"}]}], 
            "\[RightDoubleBracket]"}], " ", "=", " ", 
           RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", "nf"}], ",", " ", 
             RowBox[{"1", ";;", "nfub"}]}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nf", " ", ">", " ", "0"}], " ", "&&", " ", 
             RowBox[{"nv", " ", ">", " ", "0"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "fills", " ", "in", " ", "virtual", " ", "constraint", " ", 
              "equations"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"\[CapitalLambda]p", " ", "=", " ", 
              RowBox[{"LinearSolve", "[", 
               RowBox[{
                RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
                 RowBox[{
                  RowBox[{"1", ";;", "nf"}], ",", " ", 
                  RowBox[{"1", ";;", "nf"}]}], "\[RightDoubleBracket]"}], ",",
                 " ", 
                RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
                 RowBox[{
                  RowBox[{"1", ";;", "nf"}], ",", " ", 
                  RowBox[{
                   RowBox[{"nf", "+", "1"}], ";;", "nfub"}]}], 
                 "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"\[CapitalLambda]v", " ", "=", " ", 
              RowBox[{
               RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"nf", "+", "1"}], ";;", "nfv"}], ",", " ", 
                 RowBox[{
                  RowBox[{"nf", "+", "1"}], ";;", "nfub"}]}], 
                "\[RightDoubleBracket]"}], " ", "-", " ", 
               RowBox[{
                RowBox[{"JMJBb", "\[LeftDoubleBracket]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"nf", "+", "1"}], ";;", "nfv"}], ",", " ", 
                  RowBox[{"1", ";;", "nf"}]}], "\[RightDoubleBracket]"}], ".",
                 "\[CapitalLambda]p"}]}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Ab", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                 RowBox[{"nqf", "+", "1"}], ";;", "nqfv"}], ",", " ", 
                RowBox[{
                 RowBox[{"nqf", "+", "1"}], ";;", "nqfub"}]}], 
               "\[RightDoubleBracket]"}], " ", "=", " ", 
              RowBox[{"\[CapitalLambda]v", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{"1", ";;", "nv"}], ",", " ", 
                RowBox[{"1", ";;", "nub"}]}], "\[RightDoubleBracket]"}]}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"F", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "nqfv", ",", " ", "nqfu", ",", " ", "nqfub", ",", " ", "fosim", ",", 
       " ", "xdot"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nqfv", " ", "=", " ", 
       RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nv"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nqfu", " ", "=", " ", 
       RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nu"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nqfub", " ", "=", " ", 
       RowBox[{"nqfu", " ", "+", " ", "1"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fosim", " ", "=", " ", 
       RowBox[{"LinearSolve", "[", 
        RowBox[{
         RowBox[{"Ab", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nqfv"}], ",", " ", 
           RowBox[{"1", ";;", "nqfu"}]}], "\[RightDoubleBracket]"}], ",", " ", 
         RowBox[{"Ab", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nqfv"}], ",", " ", "nqfub"}], 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"qdd", " ", "=", " ", 
       RowBox[{"fosim", "\[LeftDoubleBracket]", 
        RowBox[{"1", ";;", "nq"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xdot", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"qd", ",", " ", "qdd"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "xdot", "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7172139722676687`*^9, 3.7172140488934546`*^9}, {
   3.717214101768999*^9, 3.717214149035107*^9}, {3.717234589826565*^9, 
   3.7172346182331066`*^9}, 3.71723778042463*^9, {3.7172379168322835`*^9, 
   3.7172380013800135`*^9}, {3.7172380748182645`*^9, 
   3.7172382787578573`*^9}, {3.717238336945955*^9, 3.717238460244114*^9}, {
   3.7172384969319887`*^9, 3.717238592573579*^9}, {3.717238644105358*^9, 
   3.717238648542905*^9}, {3.71723868023073*^9, 3.717238683621388*^9}, {
   3.717238764528469*^9, 3.717238796153793*^9}, {3.717239054328331*^9, 
   3.7172390679378347`*^9}, {3.717239166313861*^9, 3.7172391665794697`*^9}, {
   3.717239272252429*^9, 3.7172392751899595`*^9}, {3.7172393920661726`*^9, 
   3.71723942621483*^9}, {3.7172395771226273`*^9, 3.7172396719986005`*^9}, {
   3.7172442657131658`*^9, 3.7172442666350503`*^9}, {3.7172486376433444`*^9, 
   3.7172486460184155`*^9}, {3.71724867903438*^9, 3.717248681003148*^9}, {
   3.717249241055773*^9, 3.7172493116033726`*^9}, {3.717249463960656*^9, 
   3.7172494667106843`*^9}, {3.717249636977847*^9, 3.71724966036872*^9}, 
   3.7172497287444124`*^9, {3.7172497770417805`*^9, 3.7172498002763968`*^9}, {
   3.717250372396996*^9, 3.7172503757251573`*^9}, {3.7172813034720793`*^9, 
   3.7172813039408293`*^9}, {3.718416700815257*^9, 3.718416702877762*^9}, {
   3.7184168014750757`*^9, 3.7184168287878256`*^9}, {3.7184171383846517`*^9, 
   3.718417199213377*^9}, {3.7184172999643574`*^9, 3.7184173086519423`*^9}, {
   3.718537950564531*^9, 3.718537964252159*^9}, {3.7185379957524605`*^9, 
   3.718538055940546*^9}, {3.7185497404902844`*^9, 3.718549772881216*^9}, {
   3.718549847861807*^9, 3.718549872565152*^9}, {3.7185500282647047`*^9, 
   3.7185500396710477`*^9}, {3.718550113765518*^9, 3.718550142781419*^9}, {
   3.7185502200008855`*^9, 3.718550251063698*^9}, {3.718550283939006*^9, 
   3.7185503813774357`*^9}, 3.7185504124558396`*^9, {3.7185504486905584`*^9, 
   3.718550486612794*^9}, {3.718550791598176*^9, 3.718550795457588*^9}, {
   3.7185508311923037`*^9, 3.7185509321352806`*^9}, {3.718551149887334*^9, 
   3.7185511558405313`*^9}, {3.718552178253457*^9, 3.7185522132850533`*^9}, {
   3.7185522635511446`*^9, 3.7185522812857037`*^9}, {3.718552314348518*^9, 
   3.7185523163485203`*^9}, {3.718552380396005*^9, 3.7185523873804455`*^9}, {
   3.7185525452413206`*^9, 3.7185525923018856`*^9}, {3.718552661786922*^9, 
   3.718552667099489*^9}, {3.718552857866927*^9, 3.71855286072633*^9}, {
   3.718552939227058*^9, 3.718552973243024*^9}, 3.7185534458568726`*^9, {
   3.718553555920431*^9, 3.7185535862940536`*^9}, {3.7185537311704473`*^9, 
   3.718553731576683*^9}, 3.718553848515296*^9, 3.7186233006041517`*^9, {
   3.718623405652048*^9, 3.718623428902294*^9}, 3.7186235885757484`*^9, {
   3.7186236287948794`*^9, 3.7186236702640543`*^9}, {3.718623738452213*^9, 
   3.718623739061596*^9}, {3.7186238485158014`*^9, 3.718623894000641*^9}, {
   3.718624042830223*^9, 3.718624046627133*^9}, {3.718624089908811*^9, 
   3.718624109440254*^9}, {3.7186242210507345`*^9, 3.718624276629408*^9}, 
   3.7186243127078896`*^9, {3.718624472256341*^9, 3.7186246031170263`*^9}, {
   3.718624658914435*^9, 3.718624682977174*^9}, {3.7186247381183596`*^9, 
   3.7186247523059864`*^9}, {3.7186247945251503`*^9, 
   3.7186248056346517`*^9}, {3.718624899151184*^9, 3.7186249184638743`*^9}, {
   3.718625047387027*^9, 3.7186250542308426`*^9}, {3.718625229498201*^9, 
   3.7186252428577085`*^9}, {3.7186255599077168`*^9, 3.718625654330528*^9}, {
   3.7186257056904078`*^9, 3.7186257083466988`*^9}, {3.718625981208769*^9, 
   3.718626080772238*^9}, {3.718626177601337*^9, 3.7186262925772786`*^9}, {
   3.718626357577938*^9, 3.7186263582498207`*^9}, {3.718626390109496*^9, 
   3.7186263937814207`*^9}, {3.7186265146419916`*^9, 3.718626524079567*^9}, {
   3.7186267273628445`*^9, 3.71862673923796*^9}, {3.7186267930666027`*^9, 
   3.718626803301094*^9}, {3.7186270356002493`*^9, 3.7186270527723083`*^9}, {
   3.718627122272981*^9, 3.718627125773026*^9}, {3.7186271607108617`*^9, 
   3.7186271616952567`*^9}, {3.7186272282740273`*^9, 
   3.7186272679150457`*^9}, {3.718627361244091*^9, 3.718627376697386*^9}, {
   3.7186274238540864`*^9, 3.718627438838621*^9}, {3.718627519495655*^9, 
   3.718627522026947*^9}, {3.718627600512081*^9, 3.7186276478250484`*^9}, {
   3.7186276968880444`*^9, 3.718627697138053*^9}, {3.718627738888451*^9, 
   3.7186277434822483`*^9}, {3.718627829904975*^9, 3.718627830201867*^9}, {
   3.7186278849992843`*^9, 3.7186279037807035`*^9}, {3.718627934265381*^9, 
   3.7186279885003085`*^9}, 3.7186281368923836`*^9, {3.7186281979086275`*^9, 
   3.718628210783737*^9}, {3.71862824458095*^9, 3.7186282516435184`*^9}, 
   3.7186283603164816`*^9, {3.718628427270253*^9, 3.7186284622549896`*^9}, {
   3.718628542708895*^9, 3.718628545818301*^9}, {3.718628694007263*^9, 
   3.718628700616721*^9}, {3.7186287540391088`*^9, 3.7186288196491323`*^9}, {
   3.718628857680758*^9, 3.7186288668995996`*^9}, 3.718628992228961*^9, {
   3.7186295522970085`*^9, 3.7186295626095996`*^9}, {3.718629741252006*^9, 
   3.718629753939616*^9}, {3.718630067053707*^9, 3.7186301098666167`*^9}, {
   3.7186302783682804`*^9, 3.718630332071957*^9}, 3.7186305351520677`*^9, {
   3.7186306892942286`*^9, 3.71863076506059*^9}, {3.718630808482911*^9, 
   3.718630837295679*^9}, {3.7186313607539797`*^9, 3.718631375629141*^9}, {
   3.718631417848309*^9, 3.7186314236921015`*^9}, 3.7186314962709417`*^9, {
   3.7186328348935633`*^9, 3.7186328360654507`*^9}, {3.7186339552764077`*^9, 
   3.7186339609014635`*^9}, {3.718634461422104*^9, 3.718634463406499*^9}, {
   3.7186368366994224`*^9, 3.718636847730797*^9}, {3.7186631669657216`*^9, 
   3.7186632620586977`*^9}, {3.7186714630632744`*^9, 3.718671513220005*^9}, 
   3.71867167614349*^9, {3.718671756233604*^9, 3.718671797109006*^9}, {
   3.71867183740628*^9, 3.7186719274384203`*^9}, {3.7186719840483756`*^9, 
   3.718671993048444*^9}, {3.718672581146036*^9, 3.7186725886461067`*^9}, {
   3.7186727162879972`*^9, 3.7186727203505373`*^9}, {3.7186727752260647`*^9, 
   3.7186728154452105`*^9}, {3.7186729583059993`*^9, 3.71867299086882*^9}, 
   3.718674033719037*^9, {3.718709816885787*^9, 3.718709842307928*^9}, {
   3.7187099559965353`*^9, 3.7187099748404713`*^9}, {3.71883272382207*^9, 
   3.718832725009581*^9}, {3.718832986855935*^9, 3.7188329876840515`*^9}, {
   3.718903756469307*^9, 3.718903829266903*^9}, {3.7189039076426773`*^9, 
   3.718903930752281*^9}, {3.7189045258991823`*^9, 3.718904526586691*^9}, {
   3.718905046513703*^9, 3.7189051007017384`*^9}, {3.718905141108389*^9, 
   3.7189051630304804`*^9}, {3.7193304640036626`*^9, 
   3.7193306223175025`*^9}, {3.719331092977671*^9, 3.719331094602685*^9}, {
   3.7193410565039086`*^9, 3.7193410566289225`*^9}, {3.7193680077891555`*^9, 
   3.7193680299143577`*^9}, {3.7198773767336793`*^9, 
   3.7198774169983487`*^9}, {3.7198775167075014`*^9, 
   3.7198775410973606`*^9}, {3.719877676601963*^9, 3.7198776770137725`*^9}, {
   3.7198811226122108`*^9, 3.7198811287085195`*^9}, {3.719881429366669*^9, 
   3.7198814307363524`*^9}, {3.719881505200205*^9, 3.7198815311972847`*^9}, {
   3.7198819974247136`*^9, 3.71988199786336*^9}, 3.71988217752876*^9, {
   3.723918583962572*^9, 3.7239185876188545`*^9}, {3.723918641228665*^9, 
   3.7239186606350765`*^9}, 3.7239229798687687`*^9, {3.7398391903117156`*^9, 
   3.7398392000789423`*^9}},ExpressionUUID->"bbf7a297-3cb4-418c-95bf-\
035bb62a778b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Impact equations for constrained mechanical systems", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.591667897763588*^9, 3.591667900579752*^9}, {3.603136879308838*^9, 
  3.6031368796018543`*^9}, {3.7172091726889515`*^9, 3.71720918131404*^9}, {
  3.7172139197827697`*^9, 3.717213931689128*^9}, {3.7186289681349735`*^9, 
  3.7186289811819773`*^9}, {3.7189042185367694`*^9, 
  3.718904225380604*^9}},ExpressionUUID->"65496614-618e-4d77-9624-\
38a7aa71d685"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HMbJ", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{"FMbJ", ",", " ", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "\"\<h\>\""}], ",", " ", 
       RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
        RowBox[{"{", 
         RowBox[{
         "MbJQtys", ",", " ", "V", ",", " ", "CRB", ",", " ", "X0", ",", " ", 
          "rs0", ",", " ", "JOSIM", ",", " ", "IME"}], "}"}]}]}], "|>"}]}], 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.7177383178363934`*^9, {3.717738373352556*^9, 3.7177383736963143`*^9}, {
   3.7177384100560193`*^9, 3.717738410712291*^9}, {3.7177386500895653`*^9, 
   3.7177386678240924`*^9}, {3.7177393589250126`*^9, 3.717739417706832*^9}, {
   3.7177394743792353`*^9, 3.7177395180046496`*^9}, {3.7177395489580803`*^9, 
   3.717739569395774*^9}, {3.717739600833576*^9, 3.7177396026304636`*^9}, {
   3.7177396774905505`*^9, 3.71773973433484*^9}, {3.7177397647570047`*^9, 
   3.7177397656945143`*^9}, {3.717739938977398*^9, 3.7177399659776664`*^9}, {
   3.717740170182732*^9, 3.7177402314958024`*^9}, 3.7177402758868628`*^9, {
   3.7177593914813924`*^9, 3.717759394262679*^9}, {3.717759792110198*^9, 
   3.7177597921570826`*^9}, {3.717759947721069*^9, 3.7177599771900997`*^9}, {
   3.7177613285459566`*^9, 3.7177613640619087`*^9}, {3.717761503422619*^9, 
   3.717761550360565*^9}, {3.717761625439392*^9, 3.717761707737047*^9}, {
   3.717764318342185*^9, 3.717764319342179*^9}, {3.7177671251006174`*^9, 
   3.7177671580227966`*^9}, {3.71777010376954*^9, 3.7177701349260864`*^9}, {
   3.7177701658795156`*^9, 3.7177701660513797`*^9}, {3.717770243786495*^9, 
   3.7177702479271574`*^9}, {3.717772462291969*^9, 3.7177724788077364`*^9}, {
   3.717772512964321*^9, 3.7177725498240366`*^9}, {3.7177725934182186`*^9, 
   3.717772603730796*^9}, {3.7177727299351196`*^9, 3.71777274315401*^9}, {
   3.7177728103577757`*^9, 3.717772826811057*^9}, {3.7177728596082287`*^9, 
   3.7177730875166435`*^9}, 3.7177737987109146`*^9, {3.7177750332695103`*^9, 
   3.717775034191395*^9}, 3.7177766765351267`*^9, {3.7177768464586153`*^9, 
   3.7177768498180256`*^9}, 3.7177796991837573`*^9, {3.7177797543717794`*^9, 
   3.717779755418665*^9}, 3.7178962678457108`*^9, {3.717896768412965*^9, 
   3.7178967882100286`*^9}, {3.7178968697951803`*^9, 
   3.7178969036548944`*^9}, {3.7178970073554735`*^9, 3.71789703321511*^9}, {
   3.717897064418515*^9, 3.7178970691998243`*^9}, {3.7178971001532416`*^9, 
   3.7178971338254256`*^9}, {3.7178971707945385`*^9, 
   3.7178971756539493`*^9}, {3.7178972382014174`*^9, 3.71789723923269*^9}, {
   3.7178973119208837`*^9, 3.717897372171452*^9}, {3.7178974205156507`*^9, 
   3.717897423812555*^9}, {3.71790472773991*^9, 3.7179047508963833`*^9}, {
   3.717904783552928*^9, 3.717904858928644*^9}, {3.7179049045853405`*^9, 
   3.7179049050072083`*^9}, {3.717905297436214*^9, 3.7179052990299683`*^9}, {
   3.717905525001321*^9, 3.7179056128458967`*^9}, {3.7179056449243402`*^9, 
   3.7179056476743526`*^9}, 3.717905701081107*^9, {3.7179058005976934`*^9, 
   3.717905805378972*^9}, {3.7179137204420176`*^9, 3.717913745426631*^9}, {
   3.7179138384587636`*^9, 3.717913839052518*^9}, {3.7180515516371937`*^9, 
   3.7180515594497766`*^9}, {3.718051664091316*^9, 3.7180516643725796`*^9}, {
   3.718051724935582*^9, 3.718051839324789*^9}, {3.7180518833720493`*^9, 
   3.718051914403572*^9}, {3.7180520174513454`*^9, 3.718052058045434*^9}, {
   3.718052098327052*^9, 3.718052115077199*^9}, 3.718052728097419*^9, {
   3.7180527605820775`*^9, 3.7180528206294937`*^9}, {3.7180528555047812`*^9, 
   3.718052877270613*^9}, 3.7180547152574787`*^9, {3.718054776973626*^9, 
   3.718054781099023*^9}, {3.718054811712331*^9, 3.718054830050431*^9}, {
   3.7180549484599514`*^9, 3.718054969239645*^9}, 3.7180550771745105`*^9, {
   3.718055135154278*^9, 3.718055173344751*^9}, {3.718056490265394*^9, 
   3.7180564950532165`*^9}, {3.718056651215748*^9, 3.71805675471688*^9}, {
   3.718056801826311*^9, 3.7180568177926626`*^9}, {3.7180568996151485`*^9, 
   3.7180569039493594`*^9}, {3.718064482406929*^9, 3.7180644909603505`*^9}, {
   3.7180645844205875`*^9, 3.718064686475847*^9}, {3.718064720101024*^9, 
   3.718064724616028*^9}, {3.718064836485913*^9, 3.7180648444480085`*^9}, 
   3.7180669265734825`*^9, 3.7180739540728893`*^9, 3.718074008448425*^9, {
   3.718317301236906*^9, 3.718317343268572*^9}, 3.7183223681394525`*^9, {
   3.718322957919803*^9, 3.718323004981247*^9}, {3.718323206498864*^9, 
   3.7183232083738823`*^9}, {3.718323239747834*^9, 3.7183232532479677`*^9}, {
   3.7183234644026256`*^9, 3.718323495465432*^9}, {3.718323560309823*^9, 
   3.7183235666223855`*^9}, {3.7183236462244377`*^9, 3.718323647177574*^9}, {
   3.7183237116938453`*^9, 3.7183237165063844`*^9}, {3.7183238347575517`*^9, 
   3.718324031915752*^9}, {3.71832423352712*^9, 3.718324236730276*^9}, {
   3.7183243164498143`*^9, 3.718324340715679*^9}, {3.718374139719947*^9, 
   3.7183741991424246`*^9}, {3.7183742335646353`*^9, 3.718374243267844*^9}, {
   3.7183742762369227`*^9, 3.7183742945496025`*^9}, {3.718374683490947*^9, 
   3.718374690553518*^9}, {3.718386469159142*^9, 3.7183864857374244`*^9}, {
   3.7184045472199736`*^9, 3.718404567110798*^9}, {3.718405346165387*^9, 
   3.7184053476497765`*^9}, {3.7184153136615915`*^9, 
   3.7184153946155167`*^9}, {3.7184154321315084`*^9, 3.718415519398*^9}, {
   3.7184155656328325`*^9, 3.7184155717422633`*^9}, {3.718415611805146*^9, 
   3.7184156244927864`*^9}, {3.7184160258092556`*^9, 
   3.7184160853879685`*^9}, {3.7184161402635107`*^9, 
   3.7184161408260183`*^9}, {3.7184164332032366`*^9, 3.718416498938245*^9}, {
   3.718416543501186*^9, 3.7184165532981577`*^9}, {3.7184167227220664`*^9, 
   3.718416782584244*^9}, {3.718416878710209*^9, 3.7184168898978047`*^9}, {
   3.7184172080571995`*^9, 3.718417226713649*^9}, {3.7184172694328203`*^9, 
   3.7184172794797807`*^9}, {3.7185374762787724`*^9, 3.718537521576077*^9}, {
   3.71853758710795*^9, 3.7185375951549034`*^9}, 3.718624563491619*^9, {
   3.7186246340704412`*^9, 3.7186246491643395`*^9}, 3.7186284682550325`*^9, {
   3.7186691237761183`*^9, 3.718669124322999*^9}, {3.718669168354685*^9, 
   3.7186692560743017`*^9}, {3.7186693126842356`*^9, 3.718669313137382*^9}, {
   3.7186722246893883`*^9, 3.718672226705018*^9}, {3.7186731062848215`*^9, 
   3.7186731210037*^9}, {3.718673206863937*^9, 3.718673217989034*^9}, {
   3.718673338396476*^9, 3.7186733489434705`*^9}, 3.718673534132784*^9, {
   3.7186740189220314`*^9, 3.718674019922041*^9}, 3.7187099371525993`*^9, {
   3.718709987512474*^9, 3.7187100311066537`*^9}, {3.7187105644556837`*^9, 
   3.718710605206077*^9}, 3.7187296226732135`*^9, {3.718832721134544*^9, 
   3.718832722384556*^9}, {3.718832882433012*^9, 3.7188329537774677`*^9}, {
   3.7189045399149623`*^9, 3.718904540274337*^9}, {3.718905072388958*^9, 
   3.718905072717099*^9}, {3.7189057049523063`*^9, 3.71890571957745*^9}, 
   3.7189058221565886`*^9, {3.7190748597280674`*^9, 3.719074879556387*^9}, {
   3.7190804018886786`*^9, 3.719080402935565*^9}, 3.7190804957333555`*^9, {
   3.719080729360677*^9, 3.719080775876762*^9}, {3.719327894133988*^9, 
   3.7193279396968565`*^9}},ExpressionUUID->"3e2c055b-4882-4770-96da-\
57b848e06291"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IME", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nqf", ",", " ", "nqfb", ",", " ", "fosim", ",", " ", "xdot"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "set", " ", "up", " ", "lengths", " ", "of", " ", "the", " ", 
        "different", " ", "constraints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nqf", " ", "=", " ", 
        RowBox[{"nq", " ", "+", " ", "nf"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nqfb", " ", "=", " ", 
        RowBox[{"nqf", " ", "+", " ", "1"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"solves", " ", "for", " ", "qdd"}], ",", " ", "f", ",", " ", 
         "u"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Ab", " ", "=", " ", "ZAb"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"formulate", " ", 
           RowBox[{"M", ".", "qdd"}]}], " ", "+", " ", "uJ"}], " ", "=", " ", 
         RowBox[{
          RowBox[{"B", ".", "uff"}], " ", "+", " ", "u", " ", "+", " ", 
          RowBox[{
           RowBox[{"J", "\[Transpose]"}], ".", "f"}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Ab", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "nq"}], ",", " ", 
          RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}], " ", "=", 
        " ", "M"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Ab", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "nq"}], ",", " ", "nqfb"}], 
         "\[RightDoubleBracket]"}], " ", "=", " ", 
        RowBox[{"M", ".", "qd"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"nf", " ", ">", "0"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"1", ";;", "nq"}], ",", " ", 
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqf"}]}], 
            "\[RightDoubleBracket]"}], " ", "=", " ", 
           RowBox[{"-", 
            RowBox[{
             RowBox[{
             "J", "\[LeftDoubleBracket]", "pcons", "\[RightDoubleBracket]"}], 
             "\[Transpose]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nq", "+", "1"}], ";;", "nqf"}], ",", " ", 
             RowBox[{"1", ";;", "nq"}]}], "\[RightDoubleBracket]"}], " ", "=",
            " ", 
           RowBox[{
           "J", "\[LeftDoubleBracket]", "pcons", "\[RightDoubleBracket]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"nv", " ", ">", " ", "0"}], " ", "&&", " ", 
             RowBox[{"nv", " ", "\[Equal]", " ", "nf"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"for", " ", "implementing", " ", "non"}], "-", 
               RowBox[{"plastic", " ", "collisions"}]}], ",", " ", 
              RowBox[{"could", " ", "also", " ", "add", " ", 
               RowBox[{
               "\[Phi]", "\[LeftDoubleBracket]", "vcons", 
                "\[RightDoubleBracket]"}]}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Ab", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                 RowBox[{"nq", "+", "1"}], ";;", "nqf"}], ",", " ", "nqfb"}], 
               "\[RightDoubleBracket]"}], " ", "=", " ", 
              RowBox[{"-", 
               RowBox[{
                RowBox[{
                "J", "\[LeftDoubleBracket]", "vcons", 
                 "\[RightDoubleBracket]"}], ".", "qd"}]}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"H", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"nqf", ",", " ", "nqfb", ",", " ", "fosim", ",", " ", "xpost"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "set", " ", "up", " ", "lengths", " ", "of", " ", "the", " ", 
       "different", " ", "constraints"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nqf", " ", "=", " ", 
       RowBox[{"nq", " ", "+", " ", "nf"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nqfb", " ", "=", " ", 
       RowBox[{"nqf", " ", "+", " ", "1"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fosim", " ", "=", " ", 
       RowBox[{"LinearSolve", "[", 
        RowBox[{
         RowBox[{"Ab", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nqf"}], ",", " ", 
           RowBox[{"1", ";;", "nqf"}]}], "\[RightDoubleBracket]"}], ",", " ", 
         RowBox[{"Ab", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nqf"}], ",", " ", "nqfb"}], 
          "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"xpost", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{"q", ",", " ", 
         RowBox[{"fosim", "\[LeftDoubleBracket]", 
          RowBox[{"1", ";;", "nq"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "xpost", "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
   ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7172398215470114`*^9, 3.717240129456421*^9}, {
   3.717248687925106*^9, 3.717248691987637*^9}, {3.7172498137296762`*^9, 
   3.717249813932785*^9}, {3.718904274849842*^9, 3.7189042758029776`*^9}, {
   3.7189043423817434`*^9, 3.718904369069509*^9}, {3.7189044252107043`*^9, 
   3.718904465773589*^9}, {3.718904562024539*^9, 3.718904603649952*^9}, {
   3.718905230093643*^9, 3.718905252984494*^9}, {3.71890536646999*^9, 
   3.7189054593561277`*^9}, {3.7189055013877945`*^9, 
   3.7189055283255587`*^9}, {3.7189055660290575`*^9, 3.71890567204573*^9}, {
   3.718905794031312*^9, 3.718905811453357*^9}, {3.718905848188095*^9, 
   3.718905933767066*^9}, {3.718906158003657*^9, 3.718906160644308*^9}, {
   3.7189063213646593`*^9, 3.718906360302532*^9}, {3.7189063996310463`*^9, 
   3.718906420053122*^9}, {3.719085457693745*^9, 3.7190854582250013`*^9}, 
   3.71932695770164*^9, 3.7201519748890305`*^9, {3.7201520521866236`*^9, 
   3.720152053108507*^9}, {3.720152261407378*^9, 3.7201523243610845`*^9}, {
   3.720152365173989*^9, 3.720152371564659*^9}, 3.720152672442534*^9, {
   3.7201579387076283`*^9, 
   3.7201579706923175`*^9}},ExpressionUUID->"e4be5585-fa18-41fa-881b-\
d3fc09f99f83"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Virtual and Physical Constraints", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.591667897763588*^9, 3.591667900579752*^9}, {3.603136879308838*^9, 
  3.6031368796018543`*^9}, {3.7172091726889515`*^9, 3.71720918131404*^9}, {
  3.7172139197827697`*^9, 3.717213931689128*^9}, {3.7186289681349735`*^9, 
  3.7186289811819773`*^9}, {3.7189042185367694`*^9, 3.718904225380604*^9}, {
  3.7193684049828825`*^9, 
  3.7193684098579283`*^9}},ExpressionUUID->"71ae3798-fde0-4f91-9df9-\
6fa81c7e9add"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"\[Eta]MbJ", " ", "=", " ", 
    RowBox[{"<|", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "\"\<\[Eta]\>\""}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", 
        RowBox[{
        "MbJQtys", ",", " ", "V", ",", " ", "X0", ",", " ", "rs0", ",", " ", 
         "JOSIM"}], "}"}]}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<lcls\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", 
        RowBox[{
        "q", ",", " ", "qd", ",", " ", "qdd", ",", " ", "u", ",", " ", "uJ", 
         ",", " ", "ag", ",", " ", "\[Phi]", ",", " ", "s", ",", " ", "sdot", 
         ",", " ", "v", ",", " ", "a", ",", " ", "f", ",", " ", "r", ",", " ",
          "rdot", ",", " ", "sj", ",", " ", "ro", ",", " ", "sjdot", ",", " ",
          "rodot", ",", " ", "posXco", ",", " ", "M", ",", " ", 
         "\[DoubleStruckCapitalI]", ",", " ", "XL", ",", " ", "Tcb", ",", " ",
          "XL0", ",", " ", "X0L", ",", " ", "RL0", ",", " ", "R0L", ",", " ", 
         "sj", ",", " ", "sjdot", ",", " ", "ro", ",", " ", "rodot", ",", " ",
          "Xo0", ",", " ", "J", ",", " ", "\[Phi]", ",", " ", "\[Eta]", ",", 
         " ", "K", ",", " ", "Ab", ",", " ", "b", ",", " ", "o", ",", " ", 
         "nq", ",", " ", "nx", ",", " ", "nf", ",", " ", "nv", ",", " ", 
         "nu"}], "}"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<v\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[DoubleStruckX]", ",", " ", "_Real", ",", " ", "1"}], 
          "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"\[DoubleStruckC]", ",", " ", "_Real", ",", " ", "1"}], 
          "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"ufun", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"agfun", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"\[Phi]fun", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",",
          " ", 
         RowBox[{"{", 
          RowBox[{"sfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"sdotfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"rfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"rdotfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"Jfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"\[Eta]fun", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",",
          " ", 
         RowBox[{"{", 
          RowBox[{"Kfun", ",", " ", "_Real", ",", " ", "3"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
          "\[DoubleStruckCapitalI]fun", ",", " ", "_Real", ",", " ", "3"}], 
          "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"XLfun", ",", " ", "_Real", ",", " ", "3"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"Tcbfun", ",", " ", "_Real", ",", " ", "3"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"z3", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"z6", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"zq", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"zpos", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"zspat", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"Z3", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"ZM", ",", " ", "_Real", ",", " ", "2"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"ZAb", ",", " ", "_Real", ",", " ", "2"}], "}"}]}], "}"}]}],
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<d\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"parent", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",",
          " ", 
         RowBox[{"{", 
          RowBox[{"bx", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"bs", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"bo", ",", " ", "_Integer", ",", " ", "2"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"ba", ",", " ", "_Integer", ",", " ", "3"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"pcons", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"vcons", ",", " ", "_Integer", ",", " ", "1"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"ucons", ",", " ", "_Integer", ",", " ", "1"}], "}"}]}], 
        "}"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<I\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mxv", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"m", ",", " ", "_Real", ",", " ", "nm"}], "}"}], ",", 
             " ", 
             RowBox[{"{", 
              RowBox[{"v", ",", " ", "_Real", ",", " ", "nm"}], "}"}]}], 
            "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"mxstarf", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"m", ",", " ", "_Real", ",", " ", "nm"}], "}"}], ",", 
             " ", 
             RowBox[{"{", 
              RowBox[{"v", ",", " ", "_Real", ",", " ", "nm"}], "}"}]}], 
            "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"posX", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"X", ",", " ", "_Real", ",", " ", 
               RowBox[{"{", 
                RowBox[{"nm", ",", " ", "nm"}], "}"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"Y", ",", " ", "_Real", ",", " ", 
               RowBox[{"{", 
                RowBox[{"nm", ",", " ", "nm"}], "}"}]}], "}"}]}], "}"}]}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"mxX", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"m", ",", " ", "_Real", ",", " ", "nm"}], "}"}], ",", 
             " ", 
             RowBox[{"{", 
              RowBox[{"X", ",", " ", "_Real", ",", " ", 
               RowBox[{"{", 
                RowBox[{"nm", ",", " ", "nm"}], "}"}]}], "}"}]}], "}"}]}], 
          "}"}]}], "\[IndentingNewLine]", "}"}]}], ",", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"\"\<O\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mxv", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"mxstarf", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", 
         " ", 
         RowBox[{"{", 
          RowBox[{"posX", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"mxX", ",", " ", "_Real", ",", " ", "2"}], "}"}]}], "}"}]}],
       ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\"\<C\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "|>"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Eta", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Flatten", "[", 
      RowBox[{"{", "\[Eta]", "}"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.7177383178363934`*^9, {3.717738373352556*^9, 3.7177383736963143`*^9}, {
   3.7177384100560193`*^9, 3.717738410712291*^9}, {3.7177386500895653`*^9, 
   3.7177386678240924`*^9}, {3.7177393589250126`*^9, 3.717739417706832*^9}, {
   3.7177394743792353`*^9, 3.7177395180046496`*^9}, {3.7177395489580803`*^9, 
   3.717739569395774*^9}, {3.717739600833576*^9, 3.7177396026304636`*^9}, {
   3.7177396774905505`*^9, 3.71773973433484*^9}, {3.7177397647570047`*^9, 
   3.7177397656945143`*^9}, {3.717739938977398*^9, 3.7177399659776664`*^9}, {
   3.717740170182732*^9, 3.7177402314958024`*^9}, 3.7177402758868628`*^9, {
   3.7177593914813924`*^9, 3.717759394262679*^9}, {3.717759792110198*^9, 
   3.7177597921570826`*^9}, {3.717759947721069*^9, 3.7177599771900997`*^9}, {
   3.7177613285459566`*^9, 3.7177613640619087`*^9}, {3.717761503422619*^9, 
   3.717761550360565*^9}, {3.717761625439392*^9, 3.717761707737047*^9}, {
   3.717764318342185*^9, 3.717764319342179*^9}, {3.7177671251006174`*^9, 
   3.7177671580227966`*^9}, {3.71777010376954*^9, 3.7177701349260864`*^9}, {
   3.7177701658795156`*^9, 3.7177701660513797`*^9}, {3.717770243786495*^9, 
   3.7177702479271574`*^9}, {3.717772462291969*^9, 3.7177724788077364`*^9}, {
   3.717772512964321*^9, 3.7177725498240366`*^9}, {3.7177725934182186`*^9, 
   3.717772603730796*^9}, {3.7177727299351196`*^9, 3.71777274315401*^9}, {
   3.7177728103577757`*^9, 3.717772826811057*^9}, {3.7177728596082287`*^9, 
   3.7177730875166435`*^9}, 3.7177737987109146`*^9, {3.7177750332695103`*^9, 
   3.717775034191395*^9}, 3.7177766765351267`*^9, {3.7177768464586153`*^9, 
   3.7177768498180256`*^9}, 3.7177796991837573`*^9, {3.7177797543717794`*^9, 
   3.717779755418665*^9}, 3.7178962678457108`*^9, {3.717896768412965*^9, 
   3.7178967882100286`*^9}, {3.7178968697951803`*^9, 
   3.7178969036548944`*^9}, {3.7178970073554735`*^9, 3.71789703321511*^9}, {
   3.717897064418515*^9, 3.7178970691998243`*^9}, {3.7178971001532416`*^9, 
   3.7178971338254256`*^9}, {3.7178971707945385`*^9, 
   3.7178971756539493`*^9}, {3.7178972382014174`*^9, 3.71789723923269*^9}, {
   3.7178973119208837`*^9, 3.717897372171452*^9}, {3.7178974205156507`*^9, 
   3.717897423812555*^9}, {3.71790472773991*^9, 3.7179047508963833`*^9}, {
   3.717904783552928*^9, 3.717904858928644*^9}, {3.7179049045853405`*^9, 
   3.7179049050072083`*^9}, {3.717905297436214*^9, 3.7179052990299683`*^9}, {
   3.717905525001321*^9, 3.7179056128458967`*^9}, {3.7179056449243402`*^9, 
   3.7179056476743526`*^9}, 3.717905701081107*^9, {3.7179058005976934`*^9, 
   3.717905805378972*^9}, {3.7179137204420176`*^9, 3.717913745426631*^9}, {
   3.7179138384587636`*^9, 3.717913839052518*^9}, {3.7180515516371937`*^9, 
   3.7180515594497766`*^9}, {3.718051664091316*^9, 3.7180516643725796`*^9}, {
   3.718051724935582*^9, 3.718051839324789*^9}, {3.7180518833720493`*^9, 
   3.718051914403572*^9}, {3.7180520174513454`*^9, 3.718052058045434*^9}, {
   3.718052098327052*^9, 3.718052115077199*^9}, 3.718052728097419*^9, {
   3.7180527605820775`*^9, 3.7180528206294937`*^9}, {3.7180528555047812`*^9, 
   3.718052877270613*^9}, 3.7180547152574787`*^9, {3.718054776973626*^9, 
   3.718054781099023*^9}, {3.718054811712331*^9, 3.718054830050431*^9}, {
   3.7180549484599514`*^9, 3.718054969239645*^9}, 3.7180550771745105`*^9, {
   3.718055135154278*^9, 3.718055173344751*^9}, {3.718056490265394*^9, 
   3.7180564950532165`*^9}, {3.718056651215748*^9, 3.71805675471688*^9}, {
   3.718056801826311*^9, 3.7180568177926626`*^9}, {3.7180568996151485`*^9, 
   3.7180569039493594`*^9}, {3.718064482406929*^9, 3.7180644909603505`*^9}, {
   3.7180645844205875`*^9, 3.718064686475847*^9}, {3.718064720101024*^9, 
   3.718064724616028*^9}, {3.718064836485913*^9, 3.7180648444480085`*^9}, 
   3.7180669265734825`*^9, 3.7180739540728893`*^9, 3.718074008448425*^9, {
   3.718317301236906*^9, 3.718317343268572*^9}, 3.7183223681394525`*^9, {
   3.718322957919803*^9, 3.718323004981247*^9}, {3.718323206498864*^9, 
   3.7183232083738823`*^9}, {3.718323239747834*^9, 3.7183232532479677`*^9}, {
   3.7183234644026256`*^9, 3.718323495465432*^9}, {3.718323560309823*^9, 
   3.7183235666223855`*^9}, {3.7183236462244377`*^9, 3.718323647177574*^9}, {
   3.7183237116938453`*^9, 3.7183237165063844`*^9}, {3.7183238347575517`*^9, 
   3.718324031915752*^9}, {3.71832423352712*^9, 3.718324236730276*^9}, {
   3.7183243164498143`*^9, 3.718324340715679*^9}, {3.718374139719947*^9, 
   3.7183741991424246`*^9}, {3.7183742335646353`*^9, 3.718374243267844*^9}, {
   3.7183742762369227`*^9, 3.7183742945496025`*^9}, {3.718374683490947*^9, 
   3.718374690553518*^9}, {3.718386469159142*^9, 3.7183864857374244`*^9}, {
   3.7184045472199736`*^9, 3.718404567110798*^9}, {3.718405346165387*^9, 
   3.7184053476497765`*^9}, {3.7184153136615915`*^9, 
   3.7184153946155167`*^9}, {3.7184154321315084`*^9, 3.718415519398*^9}, {
   3.7184155656328325`*^9, 3.7184155717422633`*^9}, {3.718415611805146*^9, 
   3.7184156244927864`*^9}, {3.7184160258092556`*^9, 
   3.7184160853879685`*^9}, {3.7184161402635107`*^9, 
   3.7184161408260183`*^9}, {3.7184164332032366`*^9, 3.718416498938245*^9}, {
   3.718416543501186*^9, 3.7184165532981577`*^9}, {3.7184167227220664`*^9, 
   3.718416782584244*^9}, {3.718416878710209*^9, 3.7184168898978047`*^9}, {
   3.7184172080571995`*^9, 3.718417226713649*^9}, {3.7184172694328203`*^9, 
   3.7184172794797807`*^9}, {3.7185374762787724`*^9, 3.718537521576077*^9}, {
   3.71853758710795*^9, 3.7185375951549034`*^9}, 3.718624563491619*^9, {
   3.7186246340704412`*^9, 3.7186246491643395`*^9}, 3.7186284682550325`*^9, {
   3.7186691237761183`*^9, 3.718669124322999*^9}, {3.718669168354685*^9, 
   3.7186692560743017`*^9}, {3.7186693126842356`*^9, 3.718669313137382*^9}, {
   3.7186722246893883`*^9, 3.718672226705018*^9}, {3.7186731062848215`*^9, 
   3.7186731210037*^9}, {3.718673206863937*^9, 3.718673217989034*^9}, {
   3.718673338396476*^9, 3.7186733489434705`*^9}, 3.718673534132784*^9, {
   3.7186740189220314`*^9, 3.718674019922041*^9}, 3.7187099371525993`*^9, {
   3.718709987512474*^9, 3.7187100311066537`*^9}, {3.7187105644556837`*^9, 
   3.718710605206077*^9}, 3.7187296226732135`*^9, {3.718832721134544*^9, 
   3.718832722384556*^9}, {3.718832882433012*^9, 3.7188329537774677`*^9}, {
   3.7189045399149623`*^9, 3.718904540274337*^9}, {3.718905072388958*^9, 
   3.718905072717099*^9}, {3.71907466881993*^9, 3.719074671023077*^9}, {
   3.7190747156016407`*^9, 3.7190747424300423`*^9}, {3.719080317012839*^9, 
   3.719080370591507*^9}, 3.71908049571773*^9, {3.7190806532817907`*^9, 
   3.7190807086417093`*^9}, {3.7190962164166813`*^9, 3.7190962164948063`*^9}, 
   3.7191072592210827`*^9, {3.7191073303467855`*^9, 3.719107399222478*^9}, {
   3.7191081882069135`*^9, 3.719108194300729*^9}, 3.719108337942757*^9, 
   3.71932695770164*^9, 3.7193270801714125`*^9, {3.719327835742881*^9, 
   3.7193278763682175`*^9}, {3.7193279531813617`*^9, 3.719327953509473*^9}, {
   3.719368432436241*^9, 3.7193684468426113`*^9}, 3.7193684793897595`*^9, {
   3.719368626698633*^9, 3.7193686273861384`*^9}, {3.7193687559340897`*^9, 
   3.7193688133720703`*^9}, {3.7193688468410993`*^9, 3.71936884738798*^9}, 
   3.719368982107872*^9, {3.7238447676022334`*^9, 3.7238447786239557`*^9}, 
   3.777507512007895*^9, {3.7775079461568317`*^9, 3.777507946346354*^9}, 
   3.77750806879956*^9},ExpressionUUID->"94250285-4e2a-4ad4-811f-\
ff37dc4b6cd5"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",ExpressionUUID->"bd416742-0fca-4abf-9e40-9469cd9c9781"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.59227983916838*^9, 3.592279842929595*^9}, {
  3.5922799781203375`*^9, 
  3.5922799926971717`*^9}},ExpressionUUID->"7428c663-54a3-4c9a-9c81-\
d2aa40d23b12"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{800, 845},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 2703, 55, 340, "Code",ExpressionUUID->"96f1530e-e5b4-45ee-9451-2118fe68c73c",
 InitializationCell->True],
Cell[3263, 77, 202, 4, 68, "Section",ExpressionUUID->"b4a75db0-48b0-4e30-a12c-b22baf44dd9e"],
Cell[CellGroupData[{
Cell[3490, 85, 160, 3, 54, "Section",ExpressionUUID->"09f8a0d7-89c9-43a0-8b39-721e60c15083"],
Cell[3653, 90, 1831, 28, 71, "Input",ExpressionUUID->"751af5ad-8043-4517-b9ef-40132f72aa50",
 InitializationCell->True],
Cell[5487, 120, 4639, 109, 508, "Input",ExpressionUUID->"240b9f6a-7a87-4a7c-88dd-c612419e7448",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[10163, 234, 226, 4, 68, "Section",ExpressionUUID->"2c5005e6-7196-4595-a709-0608eedea9a4"],
Cell[10392, 240, 15529, 316, 945, "Input",ExpressionUUID->"08e5aa60-2d1b-4b05-ae60-874b05f90a54",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[25958, 561, 449, 6, 68, "Section",ExpressionUUID->"cdfa3874-2044-4a4e-a2a8-b18153c8459c"],
Cell[26410, 569, 15032, 274, 830, "Input",ExpressionUUID->"b0034c89-3b4a-4125-9258-1b2f348bb876",
 InitializationCell->True],
Cell[41445, 845, 8219, 129, 646, "Input",ExpressionUUID->"37c0a7a2-1e89-4a59-8302-20023054e4fe",
 InitializationCell->True],
Cell[49667, 976, 21494, 422, 1544, "Input",ExpressionUUID->"bbf7a297-3cb4-418c-95bf-035bb62a778b",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[71198, 1403, 497, 7, 68, "Section",ExpressionUUID->"65496614-618e-4d77-9624-38a7aa71d685"],
Cell[71698, 1412, 7269, 106, 71, "Input",ExpressionUUID->"3e2c055b-4882-4770-96da-57b848e06291",
 InitializationCell->True],
Cell[78970, 1520, 7187, 162, 738, "Input",ExpressionUUID->"e4be5585-fa18-41fa-881b-d3fc09f99f83",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[86194, 1687, 531, 8, 68, "Section",ExpressionUUID->"71ae3798-fde0-4f91-9df9-6fa81c7e9add"],
Cell[86728, 1697, 15743, 293, 899, "Input",ExpressionUUID->"94250285-4e2a-4ad4-811f-ff37dc4b6cd5",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[102508, 1995, 85, 0, 68, "Section",ExpressionUUID->"bd416742-0fca-4abf-9e40-9469cd9c9781"],
Cell[102596, 1997, 335, 8, 71, "Input",ExpressionUUID->"7428c663-54a3-4c9a-9c81-d2aa40d23b12",
 InitializationCell->True]
}, Open  ]]
}
]
*)

