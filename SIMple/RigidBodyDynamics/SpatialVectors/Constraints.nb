(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    219551,       4176]
NotebookOptionsPosition[    214594,       4076]
NotebookOutlinePosition[    214961,       4092]
CellTagsIndexPosition[    214918,       4089]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"RigidBodySystem", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{"High", "-", 
      RowBox[{
      "level", " ", "functions", " ", "used", " ", "to", " ", "define", " ", 
       "a", " ", "rigid", " ", 
       RowBox[{"body", ".", "\n", "Copyright"}], " ", 
       RowBox[{"(", "C", ")"}], " ", "2014", " ", "Nelson", " ", "Rosa", " ", 
       RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", 
       " ", "free", " ", "software"}]}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 3.6103712325731497`*^9}, {
  3.610371305900334*^9, 3.610371331708816*^9}, {3.610371368620943*^9, 
  3.61037139802861*^9}, {3.6103714917959795`*^9, 
  3.6103715279410496`*^9}},ExpressionUUID->"65f9c771-df43-425b-a1fe-\
b2a9a25ea22e"],

Cell[CellGroupData[{

Cell["TODO", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.717690705642907*^9, 
  3.717690706033526*^9}},ExpressionUUID->"15249854-6eab-479c-8879-\
6080f9c5e9a2"],

Cell["\<\
place all variables in expand constraint into \[DoubleStruckX] vars...maybe \
can\[CloseCurlyQuote]t reverse operation\
\>", "Text",
 CellChangeTimes->{{3.7178041287989674`*^9, 3.7178042037840633`*^9}, {
  3.7181241487874136`*^9, 3.7181241589125137`*^9}, {3.718124192334719*^9, 
  3.718124204178588*^9}, {3.718453878856457*^9, 
  3.718453879106498*^9}},ExpressionUUID->"5ff51d30-114a-407a-835d-\
58d90a7c28af"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Notes", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.717690705642907*^9, 3.717690706033526*^9}, {3.718125444550232*^9, 
  3.7181254449408517`*^9}},ExpressionUUID->"e00fced7-32d1-4f3e-822f-\
0bb741fe8e90"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"cons", ":", " ", "q"}], ",", " ", "v", ",", " ", "a", ",", " ", 
   RowBox[{"b", ";", " ", 
    RowBox[{"types", ":", " ", "p"}]}], ",", " ", "v", ",", " ", "u"}], " ", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.718456529698838*^9, 3.7184565511677885`*^9}, {
  3.7184567724355288`*^9, 3.71845677748244*^9}, {3.7184568309985895`*^9, 
  3.718456851420643*^9}, {3.718456912296237*^9, 3.718456933249545*^9}, {
  3.718457167142409*^9, 3.7184571787675033`*^9}, {3.7184586798935413`*^9, 
  3.718458690831128*^9}, {3.718459609191879*^9, 3.718459609629385*^9}, {
  3.7184603391129303`*^9, 3.718460339894199*^9}, {3.7189844852817497`*^9, 
  3.7189844860942574`*^9}},ExpressionUUID->"0a2ee722-6a49-43a0-913c-\
6e9fe7ced324"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"constraints", " ", "are", " ", "of", " ", "the", " ", "form", " ", 
    RowBox[{
     RowBox[{"r", "[", 
      RowBox[{"o", ",", " ", "o"}], "]"}], ".", 
     RowBox[{"R", "[", 
      RowBox[{"o", ",", " ", "c"}], "]"}], ".", 
     RowBox[{"X", "[", 
      RowBox[{"c", ",", " ", "b"}], "]"}], ".", 
     RowBox[{"X", "[", 
      RowBox[{"b", ",", " ", "j"}], "]"}], ".", 
     RowBox[{"s", "[", 
      RowBox[{"j", ",", " ", "j"}], "]"}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "where", " ", "o", " ", "is", " ", "the", " ", "frame", " ", "the", " ", 
    "constraint", " ", "is", " ", "taken", " ", "from"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"c", " ", "is", " ", "a", " ", 
     RowBox[{"frame", "/", "point"}], " ", "on", " ", "b"}], ",", " ", 
    RowBox[{
    "where", " ", "the", " ", "constraint", " ", "is", " ", "being", " ", 
     "applied"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "j", " ", "are", " ", "joints", " ", "that", " ", "are", " ", "part", " ",
      "of", " ", "the", " ", "constraint"}], ",", " ", 
    RowBox[{"the", " ", "ancestors", " ", "of", " ", 
     RowBox[{"b", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "we", " ", "break", " ", "it", " ", "down", " ", "further", " ", "with", 
     " ", 
     RowBox[{"R", "[", 
      RowBox[{"o", ",", " ", "c"}], "]"}]}], " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"R", "[", 
       RowBox[{"o", ",", " ", "b"}], "]"}], ".", 
      RowBox[{"R", "[", 
       RowBox[{"b", ",", " ", "c"}], "]"}]}], " ", "and"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"X", "[", 
      RowBox[{"b", ",", " ", "j"}], "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"X", "[", 
       RowBox[{"b", ",", " ", "0"}], "]"}], ".", 
      RowBox[{"X", "[", 
       RowBox[{"0", ",", " ", "j"}], "]"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{"where", " ", "0"}], " ", "=", " ", "Root"}], ",", " ", 
    RowBox[{
     RowBox[{"i", ".", "e", ".", " ", "the"}], " ", "inertial", " ", 
     "world"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"frame", ".", "  ", "This"}], " ", "simplifies", " ", 
    "constraints", " ", "down", " ", "to"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"r", "[", 
      RowBox[{"o", ",", " ", "o"}], "]"}], ".", 
     RowBox[{"R", "[", 
      RowBox[{"o", ",", " ", "b"}], "]"}], ".", 
     RowBox[{"T", "[", 
      RowBox[{"c", ",", " ", "b"}], "]"}], ".", 
     RowBox[{"X", "[", 
      RowBox[{"b", ",", " ", "j"}], "]"}], ".", 
     RowBox[{"s", "[", 
      RowBox[{"j", ",", " ", "j"}], "]"}]}], ",", " ", 
    RowBox[{"where", " ", 
     RowBox[{"T", "[", 
      RowBox[{"c", ",", " ", "b"}], "]"}], " ", "is", " ", "a"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "translation", " ", "to", " ", "the", " ", "point", " ", "c", " ", "in", 
    " ", 
    RowBox[{"b", "'"}], "s", " ", "frame", " ", "from", " ", 
    RowBox[{"b", "'"}], "s", " ", 
    RowBox[{"origin", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "this", " ", "also", " ", "has", " ", "the", " ", "benefit", " ", "that", 
    " ", "computing", " ", 
    RowBox[{"d", "/", "dt"}], " ", "X", " ", "is", " ", "simpler", " ", 
    "as"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"d", "/", "dt"}], " ", 
      RowBox[{"X", "[", 
       RowBox[{"o", ",", " ", "0"}], "]"}]}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"v", "[", 
          RowBox[{"o", ",", " ", "0"}], "]"}], " ", "-", " ", 
         RowBox[{"v", "[", 
          RowBox[{"o", ",", " ", "o"}], "]"}]}], ")"}], " ", "x", " ", 
       RowBox[{"X", "[", 
        RowBox[{"o", ",", " ", "0"}], "]"}]}], " ", "=", " ", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"v", "[", 
         RowBox[{"o", ",", " ", "o"}], "]"}]}], " ", "x", " ", 
       RowBox[{"X", "[", 
        RowBox[{"o", ",", " ", "0"}], "]"}]}]}]}], ","}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"where", " ", 
     RowBox[{"v", "[", 
      RowBox[{"o", ",", " ", "o"}], "]"}], " ", "is", " ", "the", " ", 
     "spatial", " ", "velocity", " ", "of", " ", "o", " ", "in", " ", 
     RowBox[{"o", "'"}], "s", " ", "frame"}], ";"}], " ", "*)"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "we", " ", "can", " ", "get", " ", "v", " ", "from", " ", "a", " ", 
    "prior", " ", "call", " ", "to", " ", "the", " ", "RNEA", " ", 
    RowBox[{"function", "."}]}], " ", "*)"}]}]], "Input",ExpressionUUID->\
"e51befbb-5c2d-43e2-b7b3-749182c89b7b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"7516a8a1-d217-4d6c-82b3-\
acb35d3ebe89"],

Cell[BoxData[{
 RowBox[{"BeginPackage", "[", 
  RowBox[{
  "\"\<RigidBodyDynamics`\>\"", ",", " ", "\"\<GlobalVariables`\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"con", " ", "=", " ", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Epsilon]", " ", "=", " ", "1"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.592241768075292*^9, 3.5922417692471714`*^9}, {3.592242084931059*^9, 
   3.5922420876966925`*^9}, 3.5922421309311514`*^9, {3.592255703284815*^9, 
   3.592255706497998*^9}, {3.59225574155902*^9, 3.592255745349224*^9}, {
   3.5922557821253295`*^9, 3.592255815751254*^9}, {3.5922559034172745`*^9, 
   3.5922559113667307`*^9}, {3.5922800860555387`*^9, 3.592280103747531*^9}, {
   3.59275716675933*^9, 3.5927571696474915`*^9}, 3.5927838101231008`*^9, {
   3.5933676479376955`*^9, 3.5933676483126965`*^9}, 3.602872256432743*^9, 
   3.717382253366112*^9, {3.7173827494150186`*^9, 3.7173827546025553`*^9}, {
   3.717442801783741*^9, 3.717442805221261*^9}, {3.7174722341604595`*^9, 
   3.7174722568638177`*^9}, {3.7175454253975453`*^9, 
   3.7175454592885065`*^9}, {3.717545554930112*^9, 3.717545592618001*^9}, {
   3.7175456399310026`*^9, 3.7175456557280383`*^9}, {3.7175457098535795`*^9, 
   3.717545710103593*^9}, {3.717548584283066*^9, 3.7175485924862766`*^9}, {
   3.7175492710506916`*^9, 3.7175492716288233`*^9}, {3.7175496950179434`*^9, 
   3.717549695174185*^9}, {3.7175513618018894`*^9, 3.7175513637862787`*^9}, {
   3.71755208348601*^9, 3.717552087954804*^9}, 3.717552149221059*^9, {
   3.717553025598319*^9, 3.7175530324890137`*^9}, {3.718126030619731*^9, 
   3.718126030697858*^9}, {3.718126174964923*^9, 3.7181261754805374`*^9}, {
   3.7181972466822605`*^9, 3.7181972469166374`*^9}, {3.718197406505226*^9, 
   3.7181974080521173`*^9}, {3.718199320956687*^9, 3.7181993215348177`*^9}, 
   3.7188961895749197`*^9, {3.7190147829330997`*^9, 3.719014820994791*^9}, {
   3.7190156363309746`*^9, 3.7190156423310337`*^9}, {3.761496154233818*^9, 
   3.7614961765134516`*^9}, {3.7614964604441385`*^9, 
   3.7614964925980797`*^9}, {3.761496611277068*^9, 3.761496612433236*^9}, {
   3.7615038055076904`*^9, 
   3.761503805663913*^9}},ExpressionUUID->"cb256213-bcb2-42c0-8d1d-\
2892cc110a24"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Settling Time in Constraint Stabilization Feedback Law", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
   3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
   3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
   3.7176352462522964`*^9, 3.7176352467679434`*^9}, {3.71846005299941*^9, 
   3.7184600563431916`*^9}, {3.718460175658253*^9, 3.718460177830159*^9}, 
   3.718485331492579*^9, {3.7190135132486773`*^9, 3.7190135154674377`*^9}, {
   3.71901566017496*^9, 3.7190156618937283`*^9}, {3.7190822226179338`*^9, 
   3.719082283665413*^9}},ExpressionUUID->"fd6c1ce6-3826-4153-a408-\
a56cbec4fe15"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RBDSetEpsilon", "[", 
    RowBox[{"e_:", "1"}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{"\[Epsilon]", " ", "=", " ", "e"}], ")"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7190135202331157`*^9, 3.7190135507802963`*^9}, {
  3.7190136354686337`*^9, 3.7190136398436775`*^9}, {3.719013686406637*^9, 
  3.7190136897972803`*^9}, {3.719013726969538*^9, 3.7190137278914194`*^9}, {
  3.719013920455826*^9, 3.7190139626124916`*^9}, {3.719013997081582*^9, 
  3.719014050238358*^9}, {3.719014098848197*^9, 3.719014170942676*^9}, {
  3.7190142042242393`*^9, 3.719014219443155*^9}, {3.719014257396639*^9, 
  3.719014309444044*^9}, {3.719014341084982*^9, 3.7190143506632023`*^9}, {
  3.719014457008003*^9, 3.719014575806052*^9}, {3.719014642806714*^9, 
  3.7190147768705225`*^9}, {3.7190149113706846`*^9, 3.719014925839577*^9}, {
  3.719014956339879*^9, 3.7190149805119925`*^9}, {3.719015610643221*^9, 
  3.719015619080804*^9}, {3.7190158742009315`*^9, 3.7190158744978085`*^9}, {
  3.7191186864258814`*^9, 
  3.7191186881758986`*^9}},ExpressionUUID->"fec6873b-213d-4c16-ab48-\
67178ee0ed99"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Get List of Constraints Added", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
  3.7176352462522964`*^9, 3.7176352467679434`*^9}, {3.7184657324366074`*^9, 
  3.7184657340616355`*^9}, {3.718639847110571*^9, 3.7186398499699593`*^9}, {
  3.7186574985636997`*^9, 
  3.718657508095043*^9}},ExpressionUUID->"18199f87-8139-4d53-83a3-\
9d0dfc8fa73d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RBDListConstraints", "[", 
    RowBox[{"form_:", 
     RowBox[{"{", "___", "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Cases", "[", 
    RowBox[{"con", ",", " ", "form"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7176010859771924`*^9, 3.7176010999617014`*^9}, 
   3.717601152540325*^9, {3.717601186993785*^9, 3.7176012132261868`*^9}, {
   3.7176012450077553`*^9, 3.7176012716017423`*^9}, {3.7176013379773893`*^9, 
   3.7176013764464874`*^9}, {3.717601423290701*^9, 3.717601441525231*^9}, {
   3.717602212566283*^9, 3.7176022146756797`*^9}, {3.717605388155593*^9, 
   3.7176053938275347`*^9}, {3.7176059139262166`*^9, 3.71760591473874*^9}, {
   3.717606217507225*^9, 3.7176062297104664`*^9}, {3.7176063339458313`*^9, 
   3.717606348430361*^9}, {3.7176063901182528`*^9, 3.7176064075559063`*^9}, {
   3.717606459493917*^9, 3.7176065608073797`*^9}, 3.7176065934951763`*^9, 
   3.7176066757147055`*^9, {3.7176068355912237`*^9, 3.717606858685194*^9}, {
   3.7176068943261576`*^9, 3.7176069298421335`*^9}, {3.7176069601080494`*^9, 
   3.7176069989677925`*^9}, {3.717607255798355*^9, 3.7176072742985353`*^9}, {
   3.7176073090176105`*^9, 3.7176073190645833`*^9}, {3.7176074407063723`*^9, 
   3.717607460503415*^9}, {3.717607537597913*^9, 3.7176075789108*^9}, {
   3.7176076237705913`*^9, 3.717607640176997*^9}, {3.717607683724303*^9, 
   3.717607710255803*^9}, {3.7176078509290147`*^9, 3.7176079670082283`*^9}, {
   3.7176080376495223`*^9, 3.7176081836821623`*^9}, {3.717608228135725*^9, 
   3.7176082723392544`*^9}, {3.7176083780902576`*^9, 3.717608388934111*^9}, {
   3.7176084500451975`*^9, 3.717608452154604*^9}, 3.717608488858066*^9, {
   3.7176085412960815`*^9, 3.717608553327428*^9}, {3.7176085856402526`*^9, 
   3.717608617531176*^9}, {3.7176086735004454`*^9, 3.717608678812996*^9}, {
   3.717608745782385*^9, 3.717608768095112*^9}, {3.717608815251792*^9, 
   3.7176088303144374`*^9}, {3.7176088813149366`*^9, 3.717609023816291*^9}, {
   3.7176090661916943`*^9, 3.717609068441698*^9}, {3.717609125223488*^9, 
   3.7176091579737988`*^9}, {3.7176092038179913`*^9, 
   3.7176092107243004`*^9}, {3.717609249724684*^9, 3.7176092628966722`*^9}, {
   3.717609326303541*^9, 3.717609485258177*^9}, {3.7176096399315214`*^9, 
   3.717609667197391*^9}, {3.717609716854124*^9, 3.7176097172291155`*^9}, {
   3.717617277738517*^9, 3.7176172919261684`*^9}, {3.71762576068955*^9, 
   3.7176259037690315`*^9}, {3.7176259354099565`*^9, 3.717625935941216*^9}, {
   3.717625971160285*^9, 3.7176260782394276`*^9}, {3.717626225459588*^9, 
   3.7176262621942997`*^9}, {3.7176265652028885`*^9, 3.7176265942031775`*^9}, 
   3.7176267546265783`*^9, {3.717630112761875*^9, 3.71763016913741*^9}, {
   3.717630318623208*^9, 3.717630320138846*^9}, {3.7176303588423553`*^9, 
   3.717630414889763*^9}, 3.717635216877018*^9, {3.717645443056962*^9, 
   3.717645453994548*^9}, {3.7176455443704233`*^9, 3.71764555279239*^9}, {
   3.7181176829915924`*^9, 3.7181178046725264`*^9}, {3.7181178527980013`*^9, 
   3.7181178684544077`*^9}, {3.7181180194402757`*^9, 3.718118020299658*^9}, {
   3.7181180550343924`*^9, 3.718118087987825*^9}, {3.7181181259100876`*^9, 
   3.7181181771605835`*^9}, {3.718118696423169*^9, 3.718118734923566*^9}, {
   3.718118774548958*^9, 3.718118909597168*^9}, {3.718119280116439*^9, 
   3.718119302288533*^9}, {3.7181194624619913`*^9, 3.7181194733058476`*^9}, {
   3.718119520665706*^9, 3.7181195214469495`*^9}, {3.718119723620838*^9, 
   3.7181197350897017`*^9}, {3.718119765589986*^9, 3.7181197978403177`*^9}, {
   3.7181198753567123`*^9, 3.7181202264851665`*^9}, {3.7181203095797367`*^9, 
   3.718120337720641*^9}, {3.718120791897006*^9, 3.718120794600156*^9}, {
   3.7181210554152365`*^9, 3.718121059509042*^9}, {3.718121187244663*^9, 
   3.7181212540109653`*^9}, {3.7181213489493866`*^9, 3.718121359011986*^9}, {
   3.718121431678259*^9, 3.718121433162648*^9}, {3.718121521179159*^9, 
   3.7181215925548477`*^9}, {3.7181216242739124`*^9, 
   3.7181216279614487`*^9}, {3.7181216621649127`*^9, 
   3.7181216698212376`*^9}, {3.7181217569314737`*^9, 3.718121818541458*^9}, {
   3.718122059950094*^9, 3.7181220645595136`*^9}, {3.718122104450532*^9, 
   3.7181221047317867`*^9}, {3.718122404242995*^9, 3.7181224578997755`*^9}, {
   3.718122510869051*^9, 3.7181225686977453`*^9}, {3.7181226457610087`*^9, 
   3.7181226954802485`*^9}, 3.7181227973718824`*^9, {3.7181228605600047`*^9, 
   3.718122881966467*^9}, {3.718122963217271*^9, 3.718122963326648*^9}, {
   3.7181229982488656`*^9, 3.718123052171276*^9}, {3.718123348951384*^9, 
   3.718123349607639*^9}, {3.718123449296128*^9, 3.718123464671276*^9}, {
   3.718126283887859*^9, 3.718126283981609*^9}, {3.718126574031349*^9, 
   3.718126655516532*^9}, {3.71863985528251*^9, 3.718639885126571*^9}, {
   3.718657510610695*^9, 3.718657520423292*^9}, {3.71949459967076*^9, 
   3.7194946112333717`*^9}},ExpressionUUID->"628765c1-0832-4806-b028-\
99598cfa0c84"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Remove Constraints", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
  3.7176352361584506`*^9, 
  3.7176352368303328`*^9}},ExpressionUUID->"bf121257-7a2f-44ef-a345-\
ac879a9cee30"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RBDRemoveConstraint", "[", 
    RowBox[{"form_:", 
     RowBox[{"{", "___", "}"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{"con", " ", "=", " ", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{"con", ",", " ", "form"}], "]"}]}], ")"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7176010859771924`*^9, 3.7176010999617014`*^9}, 
   3.717601152540325*^9, {3.717601186993785*^9, 3.7176012132261868`*^9}, {
   3.7176012450077553`*^9, 3.7176012716017423`*^9}, {3.7176013379773893`*^9, 
   3.7176013764464874`*^9}, {3.717601423290701*^9, 3.717601441525231*^9}, {
   3.717602212566283*^9, 3.7176022146756797`*^9}, {3.717605388155593*^9, 
   3.7176053938275347`*^9}, {3.7176059139262166`*^9, 3.71760591473874*^9}, {
   3.717606217507225*^9, 3.7176062297104664`*^9}, {3.7176063339458313`*^9, 
   3.717606348430361*^9}, {3.7176063901182528`*^9, 3.7176064075559063`*^9}, {
   3.717606459493917*^9, 3.7176065608073797`*^9}, 3.7176065934951763`*^9, 
   3.7176066757147055`*^9, {3.7176068355912237`*^9, 3.717606858685194*^9}, {
   3.7176068943261576`*^9, 3.7176069298421335`*^9}, {3.7176069601080494`*^9, 
   3.7176069989677925`*^9}, {3.717607255798355*^9, 3.7176072742985353`*^9}, {
   3.7176073090176105`*^9, 3.7176073190645833`*^9}, {3.7176074407063723`*^9, 
   3.717607460503415*^9}, {3.717607537597913*^9, 3.7176075789108*^9}, {
   3.7176076237705913`*^9, 3.717607640176997*^9}, {3.717607683724303*^9, 
   3.717607710255803*^9}, {3.7176078509290147`*^9, 3.7176079670082283`*^9}, {
   3.7176080376495223`*^9, 3.7176081836821623`*^9}, {3.717608228135725*^9, 
   3.7176082723392544`*^9}, {3.7176083780902576`*^9, 3.717608388934111*^9}, {
   3.7176084500451975`*^9, 3.717608452154604*^9}, 3.717608488858066*^9, {
   3.7176085412960815`*^9, 3.717608553327428*^9}, {3.7176085856402526`*^9, 
   3.717608617531176*^9}, {3.7176086735004454`*^9, 3.717608678812996*^9}, {
   3.717608745782385*^9, 3.717608768095112*^9}, {3.717608815251792*^9, 
   3.7176088303144374`*^9}, {3.7176088813149366`*^9, 3.717609023816291*^9}, {
   3.7176090661916943`*^9, 3.717609068441698*^9}, {3.717609125223488*^9, 
   3.7176091579737988`*^9}, {3.7176092038179913`*^9, 
   3.7176092107243004`*^9}, {3.717609249724684*^9, 3.7176092628966722`*^9}, {
   3.717609326303541*^9, 3.717609485258177*^9}, {3.7176096399315214`*^9, 
   3.717609667197391*^9}, {3.717609716854124*^9, 3.7176097172291155`*^9}, {
   3.717617277738517*^9, 3.7176172919261684`*^9}, {3.71762576068955*^9, 
   3.7176259037690315`*^9}, {3.7176259354099565`*^9, 3.717625935941216*^9}, {
   3.717625971160285*^9, 3.7176260782394276`*^9}, {3.717626225459588*^9, 
   3.7176262621942997`*^9}, {3.7176265652028885`*^9, 3.7176265942031775`*^9}, 
   3.7176267546265783`*^9, {3.717630112761875*^9, 3.71763016913741*^9}, {
   3.717630318623208*^9, 3.717630320138846*^9}, {3.7176303588423553`*^9, 
   3.717630414889763*^9}, 3.717635216877018*^9, {3.717645443056962*^9, 
   3.717645453994548*^9}, {3.7176455443704233`*^9, 3.71764555279239*^9}, {
   3.7181176829915924`*^9, 3.7181178046725264`*^9}, {3.7181178527980013`*^9, 
   3.7181178684544077`*^9}, {3.7181180194402757`*^9, 3.718118020299658*^9}, {
   3.7181180550343924`*^9, 3.718118087987825*^9}, {3.7181181259100876`*^9, 
   3.7181181771605835`*^9}, {3.718118696423169*^9, 3.718118734923566*^9}, {
   3.718118774548958*^9, 3.718118909597168*^9}, {3.718119280116439*^9, 
   3.718119302288533*^9}, {3.7181194624619913`*^9, 3.7181194733058476`*^9}, {
   3.718119520665706*^9, 3.7181195214469495`*^9}, {3.718119723620838*^9, 
   3.7181197350897017`*^9}, {3.718119765589986*^9, 3.7181197978403177`*^9}, {
   3.7181198753567123`*^9, 3.7181202264851665`*^9}, {3.7181203095797367`*^9, 
   3.718120337720641*^9}, {3.718120791897006*^9, 3.718120794600156*^9}, {
   3.7181210554152365`*^9, 3.718121059509042*^9}, {3.718121187244663*^9, 
   3.7181212540109653`*^9}, {3.7181213489493866`*^9, 3.718121359011986*^9}, {
   3.718121431678259*^9, 3.718121433162648*^9}, {3.718121521179159*^9, 
   3.7181215925548477`*^9}, {3.7181216242739124`*^9, 
   3.7181216279614487`*^9}, {3.7181216621649127`*^9, 
   3.7181216698212376`*^9}, {3.7181217569314737`*^9, 3.718121818541458*^9}, {
   3.718122059950094*^9, 3.7181220645595136`*^9}, {3.718122104450532*^9, 
   3.7181221047317867`*^9}, {3.718122404242995*^9, 3.7181224578997755`*^9}, {
   3.718122510869051*^9, 3.7181225686977453`*^9}, {3.7181226457610087`*^9, 
   3.7181226954802485`*^9}, 3.7181227973718824`*^9, {3.7181228605600047`*^9, 
   3.718122881966467*^9}, {3.718122963217271*^9, 3.718122963326648*^9}, {
   3.7181229982488656`*^9, 3.718123052171276*^9}, {3.718123348951384*^9, 
   3.718123349607639*^9}, {3.718123449296128*^9, 3.718123464671276*^9}, {
   3.718126283887859*^9, 3.718126283981609*^9}, {3.718126574031349*^9, 
   3.718126655516532*^9}},ExpressionUUID->"a5288890-7b4b-42b5-ba73-\
8b61bdb141ee"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Add List of Constraints", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
  3.7176352462522964`*^9, 3.7176352467679434`*^9}, {3.7184657324366074`*^9, 
  3.7184657340616355`*^9}, {3.718639847110571*^9, 
  3.7186398499699593`*^9}},ExpressionUUID->"ad2ece75-3425-47d1-94ab-\
d74eb25ec293"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RBDAddConstraints", "[", "c_", "]"}], " ", ":=", " ", 
   RowBox[{"con", " ", "=", " ", "c"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7176010859771924`*^9, 3.7176010999617014`*^9}, 
   3.717601152540325*^9, {3.717601186993785*^9, 3.7176012132261868`*^9}, {
   3.7176012450077553`*^9, 3.7176012716017423`*^9}, {3.7176013379773893`*^9, 
   3.7176013764464874`*^9}, {3.717601423290701*^9, 3.717601441525231*^9}, {
   3.717602212566283*^9, 3.7176022146756797`*^9}, {3.717605388155593*^9, 
   3.7176053938275347`*^9}, {3.7176059139262166`*^9, 3.71760591473874*^9}, {
   3.717606217507225*^9, 3.7176062297104664`*^9}, {3.7176063339458313`*^9, 
   3.717606348430361*^9}, {3.7176063901182528`*^9, 3.7176064075559063`*^9}, {
   3.717606459493917*^9, 3.7176065608073797`*^9}, 3.7176065934951763`*^9, 
   3.7176066757147055`*^9, {3.7176068355912237`*^9, 3.717606858685194*^9}, {
   3.7176068943261576`*^9, 3.7176069298421335`*^9}, {3.7176069601080494`*^9, 
   3.7176069989677925`*^9}, {3.717607255798355*^9, 3.7176072742985353`*^9}, {
   3.7176073090176105`*^9, 3.7176073190645833`*^9}, {3.7176074407063723`*^9, 
   3.717607460503415*^9}, {3.717607537597913*^9, 3.7176075789108*^9}, {
   3.7176076237705913`*^9, 3.717607640176997*^9}, {3.717607683724303*^9, 
   3.717607710255803*^9}, {3.7176078509290147`*^9, 3.7176079670082283`*^9}, {
   3.7176080376495223`*^9, 3.7176081836821623`*^9}, {3.717608228135725*^9, 
   3.7176082723392544`*^9}, {3.7176083780902576`*^9, 3.717608388934111*^9}, {
   3.7176084500451975`*^9, 3.717608452154604*^9}, 3.717608488858066*^9, {
   3.7176085412960815`*^9, 3.717608553327428*^9}, {3.7176085856402526`*^9, 
   3.717608617531176*^9}, {3.7176086735004454`*^9, 3.717608678812996*^9}, {
   3.717608745782385*^9, 3.717608768095112*^9}, {3.717608815251792*^9, 
   3.7176088303144374`*^9}, {3.7176088813149366`*^9, 3.717609023816291*^9}, {
   3.7176090661916943`*^9, 3.717609068441698*^9}, {3.717609125223488*^9, 
   3.7176091579737988`*^9}, {3.7176092038179913`*^9, 
   3.7176092107243004`*^9}, {3.717609249724684*^9, 3.7176092628966722`*^9}, {
   3.717609326303541*^9, 3.717609485258177*^9}, {3.7176096399315214`*^9, 
   3.717609667197391*^9}, {3.717609716854124*^9, 3.7176097172291155`*^9}, {
   3.717617277738517*^9, 3.7176172919261684`*^9}, {3.71762576068955*^9, 
   3.7176259037690315`*^9}, {3.7176259354099565`*^9, 3.717625935941216*^9}, {
   3.717625971160285*^9, 3.7176260782394276`*^9}, {3.717626225459588*^9, 
   3.7176262621942997`*^9}, {3.7176265652028885`*^9, 3.7176265942031775`*^9}, 
   3.7176267546265783`*^9, {3.717630112761875*^9, 3.71763016913741*^9}, {
   3.717630318623208*^9, 3.717630320138846*^9}, {3.7176303588423553`*^9, 
   3.717630414889763*^9}, 3.717635216877018*^9, {3.717645443056962*^9, 
   3.717645453994548*^9}, {3.7176455443704233`*^9, 3.71764555279239*^9}, {
   3.7181176829915924`*^9, 3.7181178046725264`*^9}, {3.7181178527980013`*^9, 
   3.7181178684544077`*^9}, {3.7181180194402757`*^9, 3.718118020299658*^9}, {
   3.7181180550343924`*^9, 3.718118087987825*^9}, {3.7181181259100876`*^9, 
   3.7181181771605835`*^9}, {3.718118696423169*^9, 3.718118734923566*^9}, {
   3.718118774548958*^9, 3.718118909597168*^9}, {3.718119280116439*^9, 
   3.718119302288533*^9}, {3.7181194624619913`*^9, 3.7181194733058476`*^9}, {
   3.718119520665706*^9, 3.7181195214469495`*^9}, {3.718119723620838*^9, 
   3.7181197350897017`*^9}, {3.718119765589986*^9, 3.7181197978403177`*^9}, {
   3.7181198753567123`*^9, 3.7181202264851665`*^9}, {3.7181203095797367`*^9, 
   3.718120337720641*^9}, {3.718120791897006*^9, 3.718120794600156*^9}, {
   3.7181210554152365`*^9, 3.718121059509042*^9}, {3.718121187244663*^9, 
   3.7181212540109653`*^9}, {3.7181213489493866`*^9, 3.718121359011986*^9}, {
   3.718121431678259*^9, 3.718121433162648*^9}, {3.718121521179159*^9, 
   3.7181215925548477`*^9}, {3.7181216242739124`*^9, 
   3.7181216279614487`*^9}, {3.7181216621649127`*^9, 
   3.7181216698212376`*^9}, {3.7181217569314737`*^9, 3.718121818541458*^9}, {
   3.718122059950094*^9, 3.7181220645595136`*^9}, {3.718122104450532*^9, 
   3.7181221047317867`*^9}, {3.718122404242995*^9, 3.7181224578997755`*^9}, {
   3.718122510869051*^9, 3.7181225686977453`*^9}, {3.7181226457610087`*^9, 
   3.7181226954802485`*^9}, 3.7181227973718824`*^9, {3.7181228605600047`*^9, 
   3.718122881966467*^9}, {3.718122963217271*^9, 3.718122963326648*^9}, {
   3.7181229982488656`*^9, 3.718123052171276*^9}, {3.718123348951384*^9, 
   3.718123349607639*^9}, {3.718123449296128*^9, 3.718123464671276*^9}, {
   3.718126283887859*^9, 3.718126283981609*^9}, {3.718126574031349*^9, 
   3.718126655516532*^9}, {3.71863985528251*^9, 
   3.718639885126571*^9}},ExpressionUUID->"d7677ec8-1c86-47f3-98fc-\
cfd33f781e7a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Add Physical Constraints", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
  3.7176352462522964`*^9, 3.7176352467679434`*^9}, {3.7184657324366074`*^9, 
  3.7184657340616355`*^9}},ExpressionUUID->"20630fbd-3de5-498e-a036-\
e5ee492ef2d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "RBDConQ", "]"}], " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
    RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "True"}], ",", " ", 
    RowBox[{"Expand", " ", "\[Rule]", " ", "True"}], ",", " ", 
    RowBox[{"\"\<Kp\>\"", " ", "\[Rule]", " ", "1"}], ",", " ", 
    RowBox[{"\"\<Kv\>\"", " ", "\[Rule]", " ", "1"}]}], "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.718485550885275*^9, {3.7184856154952636`*^9, 3.718485615823402*^9}, {
   3.7189845137820315`*^9, 3.718984543079194*^9}, {3.7189944713340597`*^9, 
   3.718994479865394*^9}, {3.7189949226978803`*^9, 3.7189949487137785`*^9}, 
   3.718995008948732*^9, {3.719015199482907*^9, 
   3.7190152161236963`*^9}},ExpressionUUID->"efdaeb4b-2724-488c-b3ef-\
2f94d60035f1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"addcon", "[", 
    RowBox[{"c_", ",", " ", "n_", ",", " ", "e_", ",", " ", "t_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}], "]"}], ":=", " ", 
   RowBox[{"AppendTo", "[", 
    RowBox[{"con", ",", " ", 
     RowBox[{"{", 
      RowBox[{"c", ",", " ", "n", ",", " ", "e", ",", " ", "t", ",", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Phi]\>\"", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "\"\<Kp\>\"", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "\"\<Kv\>\"", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "Expand", "]"}], ",", " ", 
       RowBox[{"OptionValue", "[", "\"\<n\>\"", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.718994655976509*^9, 3.71899476243067*^9}, {
  3.7189948137124434`*^9, 3.7189948145874357`*^9}, {3.718994848103409*^9, 
  3.718994943541852*^9}, {3.7189952523261533`*^9, 3.7189952676075554`*^9}, {
  3.7190153595157385`*^9, 3.7190153693595862`*^9}, {3.719015449000998*^9, 
  3.7190154534072742`*^9}},ExpressionUUID->"468c07ce-4e6e-46b7-a7e8-\
77e7bd41f016"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"RBDConQ", ",", " ", "RBDConV", ",", " ", "RBDConA"}], "}"}], 
     ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDConQ", "[", 
     RowBox[{"name_", ",", " ", "expr_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"addcon", "[", 
     RowBox[{
     "\"\<q\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", "\"\<p\>\"", 
      ",", " ", "opts"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDConV", "[", 
     RowBox[{"name_", ",", " ", "expr_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}]}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"addcon", "[", 
     RowBox[{
     "\"\<v\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", "\"\<p\>\"", 
      ",", " ", 
      RowBox[{"\"\<Kp\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", "opts"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDConA", "[", 
    RowBox[{"name_", ",", " ", "expr_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}]}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"addcon", "[", 
    RowBox[{
    "\"\<a\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", "\"\<p\>\"", 
     ",", " ", 
     RowBox[{"\"\<Kp\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", 
     RowBox[{"\"\<Kv\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", "opts"}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717472149362713*^9, 3.7174721583159313`*^9}, {
   3.7174721977069592`*^9, 3.71747222511349*^9}, {3.717472271145213*^9, 
   3.7174724546002207`*^9}, {3.7174724853661623`*^9, 
   3.7174725734608154`*^9}, {3.717472642758419*^9, 3.717472658930459*^9}, {
   3.717472697180868*^9, 3.7174726981183615`*^9}, {3.7174727534157877`*^9, 
   3.7174728499480467`*^9}, {3.717472891745345*^9, 3.717472970230515*^9}, {
   3.7174730149965997`*^9, 3.717473030262396*^9}, {3.717473063700223*^9, 
   3.7174730640752273`*^9}, {3.717473163044992*^9, 3.7174732523896604`*^9}, {
   3.717473334093624*^9, 3.7174733536563253`*^9}, {3.717473696878597*^9, 
   3.717473716113169*^9}, {3.7174737930983334`*^9, 3.717473802317178*^9}, {
   3.717473913740198*^9, 3.7174739163496*^9}, {3.717474151492654*^9, 
   3.7174742357903767`*^9}, {3.7174743182287226`*^9, 3.717474375901202*^9}, {
   3.717474445730034*^9, 3.717474512886984*^9}, {3.717504276626111*^9, 
   3.7175043158765135`*^9}, {3.7175043561894274`*^9, 
   3.7175043828772025`*^9}, {3.7175045060815907`*^9, 3.717504541628831*^9}, {
   3.717504622114032*^9, 3.7175046224734087`*^9}, {3.7175046673176203`*^9, 
   3.71750467058328*^9}, 3.717505908322397*^9, {3.7175140832278*^9, 
   3.7175141010561*^9}, {3.717535710903341*^9, 3.7175357143877525`*^9}, {
   3.71753579715501*^9, 3.71753581420205*^9}, {3.717535855874362*^9, 
   3.717535881468365*^9}, {3.717535941640857*^9, 3.717535947594043*^9}, {
   3.7175359855944448`*^9, 3.717536058579558*^9}, {3.717536110033209*^9, 
   3.71753611300199*^9}, {3.717536189551571*^9, 3.717536335287441*^9}, {
   3.717536422417557*^9, 3.7175364778556256`*^9}, {3.717536794577626*^9, 
   3.7175367961245165`*^9}, {3.717536833187399*^9, 3.717536833624918*^9}, {
   3.7175369103600664`*^9, 3.7175369105475683`*^9}, {3.717537048627108*^9, 
   3.7175370951275845`*^9}, {3.7175372079725103`*^9, 3.7175374714126987`*^9}, 
   3.717543494397913*^9, {3.7175439569804244`*^9, 3.717544101841286*^9}, {
   3.7175441334509687`*^9, 3.7175441780451775`*^9}, {3.717544229217579*^9, 
   3.717544232576988*^9}, {3.717544400594336*^9, 3.7175444072506576`*^9}, {
   3.717544584768103*^9, 3.717544602893289*^9}, {3.7175447225507812`*^9, 
   3.7175448585521736`*^9}, {3.71754514528948*^9, 3.7175451501020308`*^9}, {
   3.7175452413529773`*^9, 3.7175452476967974`*^9}, {3.7175452811189985`*^9, 
   3.717545320619404*^9}, {3.7175453630885906`*^9, 3.717545370291805*^9}, {
   3.71754600084094*^9, 3.717546128342261*^9}, {3.7175462214057198`*^9, 
   3.717546306562826*^9}, {3.7175464796202755`*^9, 3.7175465066205645`*^9}, {
   3.7175467407635803`*^9, 3.717546767013854*^9}, {3.717547873978903*^9, 
   3.7175479129793024`*^9}, {3.7175479477921605`*^9, 
   3.7175479553078637`*^9}, {3.7175496707051916`*^9, 
   3.7175496900803814`*^9}, {3.717553100145957*^9, 3.7175531556934032`*^9}, {
   3.7175531887562413`*^9, 3.717553340539051*^9}, {3.71755337789882*^9, 
   3.717553485384288*^9}, {3.717553516337741*^9, 3.7175535410098643`*^9}, 
   3.7175535980885687`*^9, 3.717554038968094*^9, 3.7175542660016737`*^9, 
   3.7175545958019485`*^9, {3.717554847257656*^9, 3.7175550239625797`*^9}, {
   3.717555069916176*^9, 3.717555086885098*^9}, {3.717555136526245*^9, 
   3.7175551955268383`*^9}, {3.7175552957193103`*^9, 3.71755533221968*^9}, {
   3.717555365735649*^9, 3.7175554386270227`*^9}, {3.7175554870181313`*^9, 
   3.7175555056276984`*^9}, {3.717555809208938*^9, 3.717555851834386*^9}, {
   3.717556014054808*^9, 3.717556038945673*^9}, {3.717594733530661*^9, 
   3.7175947444838905`*^9}, {3.7175957033126717`*^9, 
   3.7175962951008596`*^9}, {3.717596329444932*^9, 3.71759633978878*^9}, {
   3.717596399758087*^9, 3.717596485290163*^9}, {3.7175965193842244`*^9, 
   3.7175966561355405`*^9}, {3.7175967560583477`*^9, 
   3.7175968462467084`*^9}, {3.717596921091169*^9, 3.7175969772479506`*^9}, {
   3.717597032060988*^9, 3.717597048561145*^9}, {3.7175971044522867`*^9, 
   3.7175971358744583`*^9}, {3.717597227890974*^9, 3.717597305547963*^9}, {
   3.7175973695173197`*^9, 3.7175973695954466`*^9}, {3.7175974234553328`*^9, 
   3.717597452783736*^9}, {3.717597488221558*^9, 3.7175975022685833`*^9}, {
   3.717597671098297*^9, 3.7175977492084117`*^9}, {3.7175978072558503`*^9, 
   3.71759781141214*^9}, {3.717598202728364*^9, 3.717598246322523*^9}, {
   3.7175982993230143`*^9, 3.717598310620014*^9}, {3.7176005406282597`*^9, 
   3.7176005474876833`*^9}, {3.7176005775817184`*^9, 
   3.7176005825817876`*^9}, {3.717600643957368*^9, 3.7176006726294994`*^9}, {
   3.7176008203965435`*^9, 3.7176008976472626`*^9}, {3.717600927835065*^9, 
   3.71760103724235*^9}, {3.71760999287236*^9, 3.7176099984505534`*^9}, {
   3.717610223035534*^9, 3.717610226379331*^9}, {3.717616968579345*^9, 
   3.717616972532509*^9}, {3.717617003064044*^9, 3.7176170284549*^9}, {
   3.7176170611271*^9, 3.717617079846024*^9}, {3.717617172456279*^9, 
   3.7176171759719424`*^9}, {3.717617220112982*^9, 3.7176172407538033`*^9}, {
   3.7176172739103684`*^9, 3.717617275035366*^9}, {3.7176174224292364`*^9, 
   3.7176174264917755`*^9}, {3.717617469242177*^9, 3.7176174751328473`*^9}, {
   3.717617587149534*^9, 3.7176176233373957`*^9}, {3.717617668306572*^9, 
   3.7176176865567293`*^9}, {3.717617723635219*^9, 3.7176177299165163`*^9}, {
   3.717617801620323*^9, 3.7176178201517663`*^9}, {3.717620757392192*^9, 
   3.7176208016894736`*^9}, {3.7176208985810175`*^9, 
   3.7176208991279097`*^9}, {3.717620955769061*^9, 3.717620958722226*^9}, {
   3.717621023394706*^9, 3.717621050785601*^9}, {3.7176211928338256`*^9, 
   3.7176211950994596`*^9}, {3.717621230990426*^9, 3.7176212323342056`*^9}, {
   3.7176212693657904`*^9, 3.717621356991624*^9}, {3.717621491961673*^9, 
   3.7176214937741737`*^9}, {3.717621534055806*^9, 3.7176215465403137`*^9}, {
   3.7176215899469624`*^9, 3.717621622244157*^9}, {3.71762165279131*^9, 
   3.7176216529631867`*^9}, {3.717622655691467*^9, 3.7176228190834703`*^9}, {
   3.7176228509118958`*^9, 3.7176228831153297`*^9}, {3.7176229436159*^9, 
   3.717623006225874*^9}, {3.7176230392261724`*^9, 3.7176231305239305`*^9}, {
   3.7176234812147465`*^9, 3.7176235929501963`*^9}, {3.7176236379662485`*^9, 
   3.717623673029072*^9}, {3.717623716388873*^9, 3.7176237308577557`*^9}, {
   3.7176238754216347`*^9, 3.7176239015156174`*^9}, {3.7176239419066243`*^9, 
   3.717623996063406*^9}, {3.717624029735597*^9, 3.7176240481732593`*^9}, {
   3.717624092720557*^9, 3.717624099079995*^9}, {3.717624268706605*^9, 
   3.71762430741011*^9}, {3.7176244055829077`*^9, 3.7176244121298556`*^9}, {
   3.717624567975087*^9, 3.7176245916003003`*^9}, {3.7176246859762125`*^9, 
   3.7176247099920607`*^9}, {3.71762474725803*^9, 3.7176248740873585`*^9}, {
   3.717624912806476*^9, 3.717624916165884*^9}, {3.71762499157285*^9, 
   3.7176250123230486`*^9}, {3.717625102011416*^9, 3.7176252103874297`*^9}, {
   3.7176252832006216`*^9, 3.717625330716714*^9}, {3.71762549329637*^9, 
   3.717625510296529*^9}, {3.7176270030976763`*^9, 3.7176270159415483`*^9}, {
   3.7176271070205555`*^9, 3.717627140067727*^9}, {3.7176271848337946`*^9, 
   3.7176273135381265`*^9}, {3.717628304172557*^9, 3.717628378329495*^9}, 
   3.7176284305175033`*^9, 3.717628479252329*^9, {3.71762859217529*^9, 
   3.7176286490976934`*^9}, {3.7176286824417768`*^9, 3.717628716863963*^9}, {
   3.7176288461464577`*^9, 3.7176288464901953`*^9}, {3.717628987304034*^9, 
   3.717628987444659*^9}, {3.717629020416864*^9, 3.7176291390586014`*^9}, {
   3.717629197293528*^9, 3.717629203402979*^9}, 3.717629268684845*^9, {
   3.717629327904146*^9, 3.7176294380614595`*^9}, {3.717629488796315*^9, 
   3.717629491936955*^9}, {3.7176295388905425`*^9, 3.71762956467202*^9}, {
   3.7176296190787888`*^9, 3.7176296349695644`*^9}, {3.717629776299048*^9, 
   3.7176297774240417`*^9}, {3.7176306930799055`*^9, 3.717630708142535*^9}, {
   3.717631139427885*^9, 3.7176311704281893`*^9}, {3.717634236082784*^9, 
   3.7176343142710123`*^9}, {3.717634424910694*^9, 3.7176344386295867`*^9}, 
   3.7176352586742907`*^9, {3.7176403886149616`*^9, 3.717640395708765*^9}, {
   3.717643808819336*^9, 3.717643831569539*^9}, {3.71764486720772*^9, 
   3.7176448811453657`*^9}, {3.71773784690654*^9, 3.717737848312792*^9}, {
   3.718114891516962*^9, 3.718114892251345*^9}, {3.7181149259235697`*^9, 
   3.718115013330679*^9}, {3.718115207474392*^9, 3.7181152354903107`*^9}, {
   3.7181152806782413`*^9, 3.718115387523046*^9}, {3.7181154917980595`*^9, 
   3.718115509016982*^9}, {3.7181156169867992`*^9, 3.718115685112472*^9}, {
   3.7181157248941135`*^9, 3.7181157646913815`*^9}, {3.7181158798487716`*^9, 
   3.718115908739698*^9}, {3.718116318134352*^9, 3.718116437948037*^9}, 
   3.718116713747654*^9, {3.7181170790793743`*^9, 3.71811708028251*^9}, 
   3.718117116626619*^9, {3.718117187221084*^9, 3.7181172615030684`*^9}, {
   3.718117296644025*^9, 3.7181173256911864`*^9}, {3.718117439207932*^9, 
   3.718117446911137*^9}, {3.71811748100522*^9, 3.718117482208357*^9}, {
   3.7181260399948225`*^9, 3.7181260883546767`*^9}, {3.718454371246194*^9, 
   3.7184543734024515`*^9}, {3.7184544384324064`*^9, 
   3.7184544894328885`*^9}, {3.71845606847375*^9, 3.7184560902395782`*^9}, {
   3.718456165000229*^9, 3.718456253547943*^9}, 3.718456376596004*^9, 
   3.7184564449091363`*^9, {3.7184565128080506`*^9, 3.718456516917466*^9}, 
   3.718456594011963*^9, {3.7184567521228237`*^9, 3.71845682624853*^9}, {
   3.7184568631395054`*^9, 3.718456873327113*^9}, {3.7184569405464892`*^9, 
   3.718456946499688*^9}, {3.718457199517718*^9, 3.7184572038927426`*^9}, {
   3.7184586062834663`*^9, 3.718458622736748*^9}, {3.7184586566120534`*^9, 
   3.7184587857070484`*^9}, {3.718459522691057*^9, 3.7184595358161983`*^9}, 
   3.7184596043480997`*^9, {3.7184600383117704`*^9, 3.7184600446399665`*^9}, 
   3.718460128218873*^9, {3.7184639742174516`*^9, 3.718463974576826*^9}, {
   3.718465807296694*^9, 3.7184658268750167`*^9}, {3.718475691725799*^9, 
   3.7184757025384016`*^9}, {3.7184758251801777`*^9, 
   3.7184758705243573`*^9}, {3.7184759252123785`*^9, 3.718475939493765*^9}, {
   3.718475986056705*^9, 3.7184759865098467`*^9}, 3.7184841376835246`*^9, {
   3.7184841714963474`*^9, 3.718484175152633*^9}, {3.7184842059498005`*^9, 
   3.7184842132467556`*^9}, 3.718484445498952*^9, {3.718484658485349*^9, 
   3.718484681766837*^9}, {3.7184847419392796`*^9, 3.7184847526112566`*^9}, {
   3.7184848388151875`*^9, 3.718484840299579*^9}, {3.7184849719883413`*^9, 
   3.7184849883009853`*^9}, {3.7184850596922874`*^9, 
   3.7184851576002874`*^9}, {3.71848555479156*^9, 3.718485559135351*^9}, {
   3.7189946056010113`*^9, 3.718994616194866*^9}, {3.718995064714925*^9, 
   3.7189950825432253`*^9}, {3.7189951175435715`*^9, 3.718995176622267*^9}, {
   3.7189952300759335`*^9, 3.718995273513863*^9}, {3.71901539375046*^9, 
   3.719015423641372*^9}, {3.7190155114547405`*^9, 
   3.7190155117516193`*^9}},ExpressionUUID->"8dc79c9a-5863-496f-b703-\
a41dbfb43609"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Add Virtual Constraints", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
  3.7176352462522964`*^9, 3.7176352467679434`*^9}, {3.7184657324366074`*^9, 
  3.7184657442960973`*^9}},ExpressionUUID->"8d08de62-5bc5-4bca-a42a-\
4133ad164b73"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"RBDVirtQ", ",", " ", "RBDVirtV", ",", " ", "RBDVirtA"}], "}"}],
      ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDVirtQ", "[", 
     RowBox[{"name_", ",", " ", "expr_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}]}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"addcon", "[", 
     RowBox[{
     "\"\<q\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", "\"\<v\>\"", 
      ",", " ", "opts"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDVirtV", "[", 
     RowBox[{"name_", ",", " ", "expr_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}]}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"addcon", "[", 
     RowBox[{
     "\"\<v\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", "\"\<v\>\"", 
      ",", " ", 
      RowBox[{"\"\<Kp\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", "opts"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDVirtA", "[", 
    RowBox[{"name_", ",", " ", "expr_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}]}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"addcon", "[", 
    RowBox[{
    "\"\<a\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", "\"\<v\>\"", 
     ",", " ", 
     RowBox[{"\"\<Kp\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", 
     RowBox[{"\"\<Kv\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", "opts"}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717472149362713*^9, 3.7174721583159313`*^9}, {
   3.7174721977069592`*^9, 3.71747222511349*^9}, {3.717472271145213*^9, 
   3.7174724546002207`*^9}, {3.7174724853661623`*^9, 
   3.7174725734608154`*^9}, {3.717472642758419*^9, 3.717472658930459*^9}, {
   3.717472697180868*^9, 3.7174726981183615`*^9}, {3.7174727534157877`*^9, 
   3.7174728499480467`*^9}, {3.717472891745345*^9, 3.717472970230515*^9}, {
   3.7174730149965997`*^9, 3.717473030262396*^9}, {3.717473063700223*^9, 
   3.7174730640752273`*^9}, {3.717473163044992*^9, 3.7174732523896604`*^9}, {
   3.717473334093624*^9, 3.7174733536563253`*^9}, {3.717473696878597*^9, 
   3.717473716113169*^9}, {3.7174737930983334`*^9, 3.717473802317178*^9}, {
   3.717473913740198*^9, 3.7174739163496*^9}, {3.717474151492654*^9, 
   3.7174742357903767`*^9}, {3.7174743182287226`*^9, 3.717474375901202*^9}, {
   3.717474445730034*^9, 3.717474512886984*^9}, {3.717504276626111*^9, 
   3.7175043158765135`*^9}, {3.7175043561894274`*^9, 
   3.7175043828772025`*^9}, {3.7175045060815907`*^9, 3.717504541628831*^9}, {
   3.717504622114032*^9, 3.7175046224734087`*^9}, {3.7175046673176203`*^9, 
   3.71750467058328*^9}, 3.717505908322397*^9, {3.7175140832278*^9, 
   3.7175141010561*^9}, {3.717535710903341*^9, 3.7175357143877525`*^9}, {
   3.71753579715501*^9, 3.71753581420205*^9}, {3.717535855874362*^9, 
   3.717535881468365*^9}, {3.717535941640857*^9, 3.717535947594043*^9}, {
   3.7175359855944448`*^9, 3.717536058579558*^9}, {3.717536110033209*^9, 
   3.71753611300199*^9}, {3.717536189551571*^9, 3.717536335287441*^9}, {
   3.717536422417557*^9, 3.7175364778556256`*^9}, {3.717536794577626*^9, 
   3.7175367961245165`*^9}, {3.717536833187399*^9, 3.717536833624918*^9}, {
   3.7175369103600664`*^9, 3.7175369105475683`*^9}, {3.717537048627108*^9, 
   3.7175370951275845`*^9}, {3.7175372079725103`*^9, 3.7175374714126987`*^9}, 
   3.717543494397913*^9, {3.7175439569804244`*^9, 3.717544101841286*^9}, {
   3.7175441334509687`*^9, 3.7175441780451775`*^9}, {3.717544229217579*^9, 
   3.717544232576988*^9}, {3.717544400594336*^9, 3.7175444072506576`*^9}, {
   3.717544584768103*^9, 3.717544602893289*^9}, {3.7175447225507812`*^9, 
   3.7175448585521736`*^9}, {3.71754514528948*^9, 3.7175451501020308`*^9}, {
   3.7175452413529773`*^9, 3.7175452476967974`*^9}, {3.7175452811189985`*^9, 
   3.717545320619404*^9}, {3.7175453630885906`*^9, 3.717545370291805*^9}, {
   3.71754600084094*^9, 3.717546128342261*^9}, {3.7175462214057198`*^9, 
   3.717546306562826*^9}, {3.7175464796202755`*^9, 3.7175465066205645`*^9}, {
   3.7175467407635803`*^9, 3.717546767013854*^9}, {3.717547873978903*^9, 
   3.7175479129793024`*^9}, {3.7175479477921605`*^9, 
   3.7175479553078637`*^9}, {3.7175496707051916`*^9, 
   3.7175496900803814`*^9}, {3.717553100145957*^9, 3.7175531556934032`*^9}, {
   3.7175531887562413`*^9, 3.717553340539051*^9}, {3.71755337789882*^9, 
   3.717553485384288*^9}, {3.717553516337741*^9, 3.7175535410098643`*^9}, 
   3.7175535980885687`*^9, 3.717554038968094*^9, 3.7175542660016737`*^9, 
   3.7175545958019485`*^9, {3.717554847257656*^9, 3.7175550239625797`*^9}, {
   3.717555069916176*^9, 3.717555086885098*^9}, {3.717555136526245*^9, 
   3.7175551955268383`*^9}, {3.7175552957193103`*^9, 3.71755533221968*^9}, {
   3.717555365735649*^9, 3.7175554386270227`*^9}, {3.7175554870181313`*^9, 
   3.7175555056276984`*^9}, {3.717555809208938*^9, 3.717555851834386*^9}, {
   3.717556014054808*^9, 3.717556038945673*^9}, {3.717594733530661*^9, 
   3.7175947444838905`*^9}, {3.7175957033126717`*^9, 
   3.7175962951008596`*^9}, {3.717596329444932*^9, 3.71759633978878*^9}, {
   3.717596399758087*^9, 3.717596485290163*^9}, {3.7175965193842244`*^9, 
   3.7175966561355405`*^9}, {3.7175967560583477`*^9, 
   3.7175968462467084`*^9}, {3.717596921091169*^9, 3.7175969772479506`*^9}, {
   3.717597032060988*^9, 3.717597048561145*^9}, {3.7175971044522867`*^9, 
   3.7175971358744583`*^9}, {3.717597227890974*^9, 3.717597305547963*^9}, {
   3.7175973695173197`*^9, 3.7175973695954466`*^9}, {3.7175974234553328`*^9, 
   3.717597452783736*^9}, {3.717597488221558*^9, 3.7175975022685833`*^9}, {
   3.717597671098297*^9, 3.7175977492084117`*^9}, {3.7175978072558503`*^9, 
   3.71759781141214*^9}, {3.717598202728364*^9, 3.717598246322523*^9}, {
   3.7175982993230143`*^9, 3.717598310620014*^9}, {3.7176005406282597`*^9, 
   3.7176005474876833`*^9}, {3.7176005775817184`*^9, 
   3.7176005825817876`*^9}, {3.717600643957368*^9, 3.7176006726294994`*^9}, {
   3.7176008203965435`*^9, 3.7176008976472626`*^9}, {3.717600927835065*^9, 
   3.71760103724235*^9}, {3.71760999287236*^9, 3.7176099984505534`*^9}, {
   3.717610223035534*^9, 3.717610226379331*^9}, {3.717616968579345*^9, 
   3.717616972532509*^9}, {3.717617003064044*^9, 3.7176170284549*^9}, {
   3.7176170611271*^9, 3.717617079846024*^9}, {3.717617172456279*^9, 
   3.7176171759719424`*^9}, {3.717617220112982*^9, 3.7176172407538033`*^9}, {
   3.7176172739103684`*^9, 3.717617275035366*^9}, {3.7176174224292364`*^9, 
   3.7176174264917755`*^9}, {3.717617469242177*^9, 3.7176174751328473`*^9}, {
   3.717617587149534*^9, 3.7176176233373957`*^9}, {3.717617668306572*^9, 
   3.7176176865567293`*^9}, {3.717617723635219*^9, 3.7176177299165163`*^9}, {
   3.717617801620323*^9, 3.7176178201517663`*^9}, {3.717620757392192*^9, 
   3.7176208016894736`*^9}, {3.7176208985810175`*^9, 
   3.7176208991279097`*^9}, {3.717620955769061*^9, 3.717620958722226*^9}, {
   3.717621023394706*^9, 3.717621050785601*^9}, {3.7176211928338256`*^9, 
   3.7176211950994596`*^9}, {3.717621230990426*^9, 3.7176212323342056`*^9}, {
   3.7176212693657904`*^9, 3.717621356991624*^9}, {3.717621491961673*^9, 
   3.7176214937741737`*^9}, {3.717621534055806*^9, 3.7176215465403137`*^9}, {
   3.7176215899469624`*^9, 3.717621622244157*^9}, {3.71762165279131*^9, 
   3.7176216529631867`*^9}, {3.717622655691467*^9, 3.7176228190834703`*^9}, {
   3.7176228509118958`*^9, 3.7176228831153297`*^9}, {3.7176229436159*^9, 
   3.717623006225874*^9}, {3.7176230392261724`*^9, 3.7176231305239305`*^9}, {
   3.7176234812147465`*^9, 3.7176235929501963`*^9}, {3.7176236379662485`*^9, 
   3.717623673029072*^9}, {3.717623716388873*^9, 3.7176237308577557`*^9}, {
   3.7176238754216347`*^9, 3.7176239015156174`*^9}, {3.7176239419066243`*^9, 
   3.717623996063406*^9}, {3.717624029735597*^9, 3.7176240481732593`*^9}, {
   3.717624092720557*^9, 3.717624099079995*^9}, {3.717624268706605*^9, 
   3.71762430741011*^9}, {3.7176244055829077`*^9, 3.7176244121298556`*^9}, {
   3.717624567975087*^9, 3.7176245916003003`*^9}, {3.7176246859762125`*^9, 
   3.7176247099920607`*^9}, {3.71762474725803*^9, 3.7176248740873585`*^9}, {
   3.717624912806476*^9, 3.717624916165884*^9}, {3.71762499157285*^9, 
   3.7176250123230486`*^9}, {3.717625102011416*^9, 3.7176252103874297`*^9}, {
   3.7176252832006216`*^9, 3.717625330716714*^9}, {3.71762549329637*^9, 
   3.717625510296529*^9}, {3.7176270030976763`*^9, 3.7176270159415483`*^9}, {
   3.7176271070205555`*^9, 3.717627140067727*^9}, {3.7176271848337946`*^9, 
   3.7176273135381265`*^9}, {3.717628304172557*^9, 3.717628378329495*^9}, 
   3.7176284305175033`*^9, 3.717628479252329*^9, {3.71762859217529*^9, 
   3.7176286490976934`*^9}, {3.7176286824417768`*^9, 3.717628716863963*^9}, {
   3.7176288461464577`*^9, 3.7176288464901953`*^9}, {3.717628987304034*^9, 
   3.717628987444659*^9}, {3.717629020416864*^9, 3.7176291390586014`*^9}, {
   3.717629197293528*^9, 3.717629203402979*^9}, 3.717629268684845*^9, {
   3.717629327904146*^9, 3.7176294380614595`*^9}, {3.717629488796315*^9, 
   3.717629491936955*^9}, {3.7176295388905425`*^9, 3.71762956467202*^9}, {
   3.7176296190787888`*^9, 3.7176296349695644`*^9}, {3.717629776299048*^9, 
   3.7176297774240417`*^9}, {3.7176306930799055`*^9, 3.717630708142535*^9}, {
   3.717631139427885*^9, 3.7176311704281893`*^9}, {3.717634236082784*^9, 
   3.7176343142710123`*^9}, {3.717634424910694*^9, 3.7176344386295867`*^9}, 
   3.7176352586742907`*^9, {3.7176403886149616`*^9, 3.717640395708765*^9}, {
   3.717643808819336*^9, 3.717643831569539*^9}, {3.71764486720772*^9, 
   3.7176448811453657`*^9}, {3.71773784690654*^9, 3.717737848312792*^9}, {
   3.718114891516962*^9, 3.718114892251345*^9}, {3.7181149259235697`*^9, 
   3.718115013330679*^9}, {3.718115207474392*^9, 3.7181152354903107`*^9}, {
   3.7181152806782413`*^9, 3.718115387523046*^9}, {3.7181154917980595`*^9, 
   3.718115509016982*^9}, {3.7181156169867992`*^9, 3.718115685112472*^9}, {
   3.7181157248941135`*^9, 3.7181157646913815`*^9}, {3.7181158798487716`*^9, 
   3.718115908739698*^9}, {3.718116318134352*^9, 3.718116437948037*^9}, 
   3.718116713747654*^9, {3.7181170790793743`*^9, 3.71811708028251*^9}, 
   3.718117116626619*^9, {3.718117187221084*^9, 3.7181172615030684`*^9}, {
   3.718117296644025*^9, 3.7181173256911864`*^9}, {3.718117439207932*^9, 
   3.718117446911137*^9}, {3.71811748100522*^9, 3.718117482208357*^9}, {
   3.7181260399948225`*^9, 3.7181260883546767`*^9}, {3.718454371246194*^9, 
   3.7184543734024515`*^9}, {3.7184544384324064`*^9, 
   3.7184544894328885`*^9}, {3.71845606847375*^9, 3.7184560902395782`*^9}, {
   3.718456165000229*^9, 3.718456253547943*^9}, 3.718456376596004*^9, 
   3.7184564449091363`*^9, {3.7184565128080506`*^9, 3.718456516917466*^9}, 
   3.718456594011963*^9, {3.7184567521228237`*^9, 3.71845682624853*^9}, {
   3.7184568631395054`*^9, 3.718456873327113*^9}, {3.7184569405464892`*^9, 
   3.718456946499688*^9}, {3.718457199517718*^9, 3.7184572038927426`*^9}, {
   3.7184586062834663`*^9, 3.718458622736748*^9}, {3.7184586566120534`*^9, 
   3.7184587857070484`*^9}, {3.718459522691057*^9, 3.7184595358161983`*^9}, 
   3.7184596043480997`*^9, {3.7184600383117704`*^9, 3.7184600446399665`*^9}, 
   3.718460128218873*^9, {3.7184639742174516`*^9, 3.718463974576826*^9}, {
   3.718465747874254*^9, 3.718465760999379*^9}, {3.718465863547228*^9, 
   3.7184658883287153`*^9}, {3.7184851938037543`*^9, 3.718485242147966*^9}, {
   3.718485566041679*^9, 3.7184855735729885`*^9}, {3.7189952864514904`*^9, 
   3.7189953008422594`*^9}, {3.718995358061573*^9, 3.718995395905681*^9}, {
   3.7190154937826757`*^9, 
   3.719015509579707*^9}},ExpressionUUID->"99289ee5-bd6f-4565-939f-\
83c36a6a59b8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Add Transmission Matrix", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
   3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
   3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
   3.7176352462522964`*^9, 3.7176352467679434`*^9}, {3.71846005299941*^9, 
   3.7184600563431916`*^9}, {3.718460175658253*^9, 3.718460177830159*^9}, 
   3.718485331492579*^9},ExpressionUUID->"b6977626-b220-442d-81b9-\
72297bdff902"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"P", " ", "=", " ", 
     RowBox[{
      RowBox[{"qdot", "\[Transpose]"}], ".", "B", ".", "u"}]}], ",", " ", 
    RowBox[{
     RowBox[{
     "using", " ", "Con", " ", "we", " ", "can", " ", "determine", " ", "B", 
      " ", "from", " ", "expr"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"B", "\[Transpose]"}], ".", "qdot"}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"RBDTranV", ",", " ", "Listable"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RBDTranV", "::", "expr"}], " ", "=", " ", 
     "\"\<Expression should either be T.\[DoubleStruckV] or \
\[DoubleStruckB]'[...], where T is a matrix.  Resulting expression will \
result in zero force transmission.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RBDTranV", "[", 
      RowBox[{"name_", ",", " ", "expr_", ",", " ", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "RBDConQ", "]"}]}]}], "]"}], " ", ":=",
      " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"should", " ", "provide", " ", 
         RowBox[{
          RowBox[{"\[DoubleStruckB]", "'"}], "[", "...", "]"}], " ", "and", 
         " ", 
         RowBox[{"\[DoubleStruckV]", "[", "...", "]"}], " ", "expressions", 
         " ", "here", " ", "only"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"expr", ",", " ", 
            RowBox[{"\[DoubleStruckV]", "|", 
             RowBox[{
              RowBox[{"Derivative", "[", "1", "]"}], "[", "\[DoubleStruckB]", 
              "]"}]}]}], "]"}], ",", " ", 
          RowBox[{"Message", "[", 
           RowBox[{"RBDTranV", "::", "expr"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"addcon", "[", 
         RowBox[{
         "\"\<v\>\"", ",", " ", "name", ",", " ", "expr", ",", " ", 
          "\"\<u\>\"", ",", " ", 
          RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "False"}], ",", " ", 
          RowBox[{"\"\<Kp\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", 
          RowBox[{"\"\<Kv\>\"", " ", "\[Rule]", " ", "0"}], ",", " ", 
          "opts"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717472149362713*^9, 3.7174721583159313`*^9}, {
   3.7174721977069592`*^9, 3.71747222511349*^9}, {3.717472271145213*^9, 
   3.7174724546002207`*^9}, {3.7174724853661623`*^9, 
   3.7174725734608154`*^9}, {3.717472642758419*^9, 3.717472658930459*^9}, {
   3.717472697180868*^9, 3.7174726981183615`*^9}, {3.7174727534157877`*^9, 
   3.7174728499480467`*^9}, {3.717472891745345*^9, 3.717472970230515*^9}, {
   3.7174730149965997`*^9, 3.717473030262396*^9}, {3.717473063700223*^9, 
   3.7174730640752273`*^9}, {3.717473163044992*^9, 3.7174732523896604`*^9}, {
   3.717473334093624*^9, 3.7174733536563253`*^9}, {3.717473696878597*^9, 
   3.717473716113169*^9}, {3.7174737930983334`*^9, 3.717473802317178*^9}, {
   3.717473913740198*^9, 3.7174739163496*^9}, {3.717474151492654*^9, 
   3.7174742357903767`*^9}, {3.7174743182287226`*^9, 3.717474375901202*^9}, {
   3.717474445730034*^9, 3.717474512886984*^9}, {3.717504276626111*^9, 
   3.7175043158765135`*^9}, {3.7175043561894274`*^9, 
   3.7175043828772025`*^9}, {3.7175045060815907`*^9, 3.717504541628831*^9}, {
   3.717504622114032*^9, 3.7175046224734087`*^9}, {3.7175046673176203`*^9, 
   3.71750467058328*^9}, 3.717505908322397*^9, {3.7175140832278*^9, 
   3.7175141010561*^9}, {3.717535710903341*^9, 3.7175357143877525`*^9}, {
   3.71753579715501*^9, 3.71753581420205*^9}, {3.717535855874362*^9, 
   3.717535881468365*^9}, {3.717535941640857*^9, 3.717535947594043*^9}, {
   3.7175359855944448`*^9, 3.717536058579558*^9}, {3.717536110033209*^9, 
   3.71753611300199*^9}, {3.717536189551571*^9, 3.717536335287441*^9}, {
   3.717536422417557*^9, 3.7175364778556256`*^9}, {3.717536794577626*^9, 
   3.7175367961245165`*^9}, {3.717536833187399*^9, 3.717536833624918*^9}, {
   3.7175369103600664`*^9, 3.7175369105475683`*^9}, {3.717537048627108*^9, 
   3.7175370951275845`*^9}, {3.7175372079725103`*^9, 3.7175374714126987`*^9}, 
   3.717543494397913*^9, {3.7175439569804244`*^9, 3.717544101841286*^9}, {
   3.7175441334509687`*^9, 3.7175441780451775`*^9}, {3.717544229217579*^9, 
   3.717544232576988*^9}, {3.717544400594336*^9, 3.7175444072506576`*^9}, {
   3.717544584768103*^9, 3.717544602893289*^9}, {3.7175447225507812`*^9, 
   3.7175448585521736`*^9}, {3.71754514528948*^9, 3.7175451501020308`*^9}, {
   3.7175452413529773`*^9, 3.7175452476967974`*^9}, {3.7175452811189985`*^9, 
   3.717545320619404*^9}, {3.7175453630885906`*^9, 3.717545370291805*^9}, {
   3.71754600084094*^9, 3.717546128342261*^9}, {3.7175462214057198`*^9, 
   3.717546306562826*^9}, {3.7175464796202755`*^9, 3.7175465066205645`*^9}, {
   3.7175467407635803`*^9, 3.717546767013854*^9}, {3.717547873978903*^9, 
   3.7175479129793024`*^9}, {3.7175479477921605`*^9, 
   3.7175479553078637`*^9}, {3.7175496707051916`*^9, 
   3.7175496900803814`*^9}, {3.717553100145957*^9, 3.7175531556934032`*^9}, {
   3.7175531887562413`*^9, 3.717553340539051*^9}, {3.71755337789882*^9, 
   3.717553485384288*^9}, {3.717553516337741*^9, 3.7175535410098643`*^9}, 
   3.7175535980885687`*^9, 3.717554038968094*^9, 3.7175542660016737`*^9, 
   3.7175545958019485`*^9, {3.717554847257656*^9, 3.7175550239625797`*^9}, {
   3.717555069916176*^9, 3.717555086885098*^9}, {3.717555136526245*^9, 
   3.7175551955268383`*^9}, {3.7175552957193103`*^9, 3.71755533221968*^9}, {
   3.717555365735649*^9, 3.7175554386270227`*^9}, {3.7175554870181313`*^9, 
   3.7175555056276984`*^9}, {3.717555809208938*^9, 3.717555851834386*^9}, {
   3.717556014054808*^9, 3.717556038945673*^9}, {3.717594733530661*^9, 
   3.7175947444838905`*^9}, {3.7175957033126717`*^9, 
   3.7175962951008596`*^9}, {3.717596329444932*^9, 3.71759633978878*^9}, {
   3.717596399758087*^9, 3.717596485290163*^9}, {3.7175965193842244`*^9, 
   3.7175966561355405`*^9}, {3.7175967560583477`*^9, 
   3.7175968462467084`*^9}, {3.717596921091169*^9, 3.7175969772479506`*^9}, {
   3.717597032060988*^9, 3.717597048561145*^9}, {3.7175971044522867`*^9, 
   3.7175971358744583`*^9}, {3.717597227890974*^9, 3.717597305547963*^9}, {
   3.7175973695173197`*^9, 3.7175973695954466`*^9}, {3.7175974234553328`*^9, 
   3.717597452783736*^9}, {3.717597488221558*^9, 3.7175975022685833`*^9}, {
   3.717597671098297*^9, 3.7175977492084117`*^9}, {3.7175978072558503`*^9, 
   3.71759781141214*^9}, {3.717598202728364*^9, 3.717598246322523*^9}, {
   3.7175982993230143`*^9, 3.717598310620014*^9}, {3.7176005406282597`*^9, 
   3.7176005474876833`*^9}, {3.7176005775817184`*^9, 
   3.7176005825817876`*^9}, {3.717600643957368*^9, 3.7176006726294994`*^9}, {
   3.7176008203965435`*^9, 3.7176008976472626`*^9}, {3.717600927835065*^9, 
   3.71760103724235*^9}, {3.71760999287236*^9, 3.7176099984505534`*^9}, {
   3.717610223035534*^9, 3.717610226379331*^9}, {3.717616968579345*^9, 
   3.717616972532509*^9}, {3.717617003064044*^9, 3.7176170284549*^9}, {
   3.7176170611271*^9, 3.717617079846024*^9}, {3.717617172456279*^9, 
   3.7176171759719424`*^9}, {3.717617220112982*^9, 3.7176172407538033`*^9}, {
   3.7176172739103684`*^9, 3.717617275035366*^9}, {3.7176174224292364`*^9, 
   3.7176174264917755`*^9}, {3.717617469242177*^9, 3.7176174751328473`*^9}, {
   3.717617587149534*^9, 3.7176176233373957`*^9}, {3.717617668306572*^9, 
   3.7176176865567293`*^9}, {3.717617723635219*^9, 3.7176177299165163`*^9}, {
   3.717617801620323*^9, 3.7176178201517663`*^9}, {3.717620757392192*^9, 
   3.7176208016894736`*^9}, {3.7176208985810175`*^9, 
   3.7176208991279097`*^9}, {3.717620955769061*^9, 3.717620958722226*^9}, {
   3.717621023394706*^9, 3.717621050785601*^9}, {3.7176211928338256`*^9, 
   3.7176211950994596`*^9}, {3.717621230990426*^9, 3.7176212323342056`*^9}, {
   3.7176212693657904`*^9, 3.717621356991624*^9}, {3.717621491961673*^9, 
   3.7176214937741737`*^9}, {3.717621534055806*^9, 3.7176215465403137`*^9}, {
   3.7176215899469624`*^9, 3.717621622244157*^9}, {3.71762165279131*^9, 
   3.7176216529631867`*^9}, {3.717622655691467*^9, 3.7176228190834703`*^9}, {
   3.7176228509118958`*^9, 3.7176228831153297`*^9}, {3.7176229436159*^9, 
   3.717623006225874*^9}, {3.7176230392261724`*^9, 3.7176231305239305`*^9}, {
   3.7176234812147465`*^9, 3.7176235929501963`*^9}, {3.7176236379662485`*^9, 
   3.717623673029072*^9}, {3.717623716388873*^9, 3.7176237308577557`*^9}, {
   3.7176238754216347`*^9, 3.7176239015156174`*^9}, {3.7176239419066243`*^9, 
   3.717623996063406*^9}, {3.717624029735597*^9, 3.7176240481732593`*^9}, {
   3.717624092720557*^9, 3.717624099079995*^9}, {3.717624268706605*^9, 
   3.71762430741011*^9}, {3.7176244055829077`*^9, 3.7176244121298556`*^9}, {
   3.717624567975087*^9, 3.7176245916003003`*^9}, {3.7176246859762125`*^9, 
   3.7176247099920607`*^9}, {3.71762474725803*^9, 3.7176248740873585`*^9}, {
   3.717624912806476*^9, 3.717624916165884*^9}, {3.71762499157285*^9, 
   3.7176250123230486`*^9}, {3.717625102011416*^9, 3.7176252103874297`*^9}, {
   3.7176252832006216`*^9, 3.717625330716714*^9}, {3.71762549329637*^9, 
   3.717625510296529*^9}, {3.7176270030976763`*^9, 3.7176270159415483`*^9}, {
   3.7176271070205555`*^9, 3.717627140067727*^9}, {3.7176271848337946`*^9, 
   3.7176273135381265`*^9}, {3.717628304172557*^9, 3.717628378329495*^9}, 
   3.7176284305175033`*^9, 3.717628479252329*^9, {3.71762859217529*^9, 
   3.7176286490976934`*^9}, {3.7176286824417768`*^9, 3.717628716863963*^9}, {
   3.7176288461464577`*^9, 3.7176288464901953`*^9}, {3.717628987304034*^9, 
   3.717628987444659*^9}, {3.717629020416864*^9, 3.7176291390586014`*^9}, {
   3.717629197293528*^9, 3.717629203402979*^9}, 3.717629268684845*^9, {
   3.717629327904146*^9, 3.7176294380614595`*^9}, {3.717629488796315*^9, 
   3.717629491936955*^9}, {3.7176295388905425`*^9, 3.71762956467202*^9}, {
   3.7176296190787888`*^9, 3.7176296349695644`*^9}, {3.717629776299048*^9, 
   3.7176297774240417`*^9}, {3.7176306930799055`*^9, 3.717630708142535*^9}, {
   3.717631139427885*^9, 3.7176311704281893`*^9}, {3.717634236082784*^9, 
   3.7176343142710123`*^9}, {3.717634424910694*^9, 3.7176344386295867`*^9}, 
   3.7176352586742907`*^9, {3.7176403886149616`*^9, 3.717640395708765*^9}, {
   3.717643808819336*^9, 3.717643831569539*^9}, {3.71764486720772*^9, 
   3.7176448811453657`*^9}, {3.71773784690654*^9, 3.717737848312792*^9}, {
   3.718114891516962*^9, 3.718114892251345*^9}, {3.7181149259235697`*^9, 
   3.718115013330679*^9}, {3.718115207474392*^9, 3.7181152354903107`*^9}, {
   3.7181152806782413`*^9, 3.718115387523046*^9}, {3.7181154917980595`*^9, 
   3.718115509016982*^9}, {3.7181156169867992`*^9, 3.718115685112472*^9}, {
   3.7181157248941135`*^9, 3.7181157646913815`*^9}, {3.7181158798487716`*^9, 
   3.718115908739698*^9}, {3.718116318134352*^9, 3.718116437948037*^9}, 
   3.718116713747654*^9, {3.7181170790793743`*^9, 3.71811708028251*^9}, 
   3.718117116626619*^9, {3.718117187221084*^9, 3.7181172615030684`*^9}, {
   3.718117296644025*^9, 3.7181173256911864`*^9}, {3.718117439207932*^9, 
   3.718117446911137*^9}, {3.71811748100522*^9, 3.718117482208357*^9}, {
   3.7181260399948225`*^9, 3.7181260883546767`*^9}, {3.718454371246194*^9, 
   3.7184543734024515`*^9}, {3.7184544384324064`*^9, 
   3.7184544894328885`*^9}, {3.71845606847375*^9, 3.7184560902395782`*^9}, {
   3.718456165000229*^9, 3.718456253547943*^9}, 3.718456376596004*^9, 
   3.7184564449091363`*^9, {3.7184565128080506`*^9, 3.718456516917466*^9}, 
   3.718456594011963*^9, {3.7184567521228237`*^9, 3.71845682624853*^9}, {
   3.7184568631395054`*^9, 3.718456873327113*^9}, {3.7184569405464892`*^9, 
   3.718456946499688*^9}, {3.718457199517718*^9, 3.7184572038927426`*^9}, {
   3.7184586062834663`*^9, 3.718458622736748*^9}, {3.7184586566120534`*^9, 
   3.7184587857070484`*^9}, {3.718459522691057*^9, 3.7184595358161983`*^9}, 
   3.7184596043480997`*^9, {3.7184600383117704`*^9, 3.718460063905774*^9}, {
   3.7184600996092267`*^9, 3.7184601417346287`*^9}, {3.7184602361744685`*^9, 
   3.718460331519108*^9}, {3.718461488707194*^9, 3.718461638989873*^9}, {
   3.718466141596759*^9, 3.718466197066025*^9}, {3.7184663266141386`*^9, 
   3.71846637500523*^9}, {3.7184666467734394`*^9, 3.7184666503203316`*^9}, {
   3.718485297726619*^9, 3.718485312633011*^9}, {3.7184853675241566`*^9, 
   3.7184853720867004`*^9}, {3.7184854264153395`*^9, 
   3.7184854302591267`*^9}, {3.7184855761667757`*^9, 
   3.7184855783230357`*^9}, {3.718489363270005*^9, 3.71848937319199*^9}, {
   3.718995415749638*^9, 3.7189954487343283`*^9}, {3.718995487078473*^9, 
   3.718995488844101*^9}, {3.7189955865169563`*^9, 3.718995628767374*^9}, {
   3.718995756503011*^9, 3.7189957571905184`*^9}, {3.718995884738654*^9, 
   3.718995884848013*^9}, 3.718996704427911*^9, {3.719015526626749*^9, 
   3.719015540845639*^9}, {3.7190155740491085`*^9, 
   3.7190155820960464`*^9}},ExpressionUUID->"fb76affe-ee80-4220-a136-\
2a7555174e5d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Expand Constraints", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580371148892*^9, 3.686580372370743*^9}, {
  3.7176352402991323`*^9, 
  3.7176352411272616`*^9}},ExpressionUUID->"21d42b96-236c-48fa-bc02-\
7e5ed1804c9c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RBDExpandExpression", "]"}], " ", "=", " ", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Assumptions", " ", "\[Rule]", " ", 
         RowBox[{"Element", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
            "_\[DoubleStruckQ]", "|", "_\[DoubleStruckV]", "|", 
             "_\[DoubleStruckX]", "|", "_\[DoubleStruckC]", "|", 
             "_\[DoubleStruckB]"}], ")"}], ",", " ", "Reals"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Trig", " ", "\[Rule]", " ", "False"}], ",", " ", 
        RowBox[{"TransformationFunctions", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Automatic", ",", " ", "TrigReduce"}], "}"}]}]}], "}"}], 
      ",", " ", 
      RowBox[{"Options", "[", "Simplify", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDExpandExpression", "[", 
    RowBox[{"expr_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"e", ",", " ", "r"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"expr", " ", "/.", " ", 
        RowBox[{"b_\[DoubleStruckB]", " ", "\[RuleDelayed]", " ", 
         RowBox[{"RBDSpatialPosition", "[", "b", "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", "Derivative", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "1", "]"}], "[", "\[DoubleStruckQ]", 
             "]"}], "[", "x__", "]"}], " ", ":=", " ", 
           RowBox[{"\[DoubleStruckV]", "[", "x", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "2", "]"}], "[", "\[DoubleStruckQ]", 
             "]"}], "[", "x__", "]"}], " ", ":=", " ", 
           RowBox[{"\[DoubleStruckA]", "[", "x", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "1", "]"}], "[", "\[DoubleStruckV]", 
             "]"}], "[", "x__", "]"}], " ", ":=", " ", 
           RowBox[{"\[DoubleStruckA]", "[", "x", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"memoize", " ", "expanded", " ", 
            RowBox[{"\[DoubleStruckB]", "'"}], "s"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "1", "]"}], "[", "\[DoubleStruckB]", 
             "]"}], "[", "x__", "]"}], " ", ":=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Derivative", "[", "1", "]"}], "[", "\[DoubleStruckB]", 
              "]"}], "[", "x", "]"}], " ", "=", " ", 
            RowBox[{"Con", "[", 
             RowBox[{
              RowBox[{"RBDSpatialPosition", "@", 
               RowBox[{"\[DoubleStruckB]", "[", "x", "]"}]}], ",", " ", 
              "\[DoubleStruckQ]", ",", " ", "\[DoubleStruckV]"}], "]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", "2", "]"}], "[", "\[DoubleStruckB]", 
             "]"}], "[", "x__", "]"}], " ", ":=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Derivative", "[", "2", "]"}], "[", "\[DoubleStruckB]", 
              "]"}], "[", "x", "]"}], " ", "=", " ", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"b", " ", "=", " ", 
                RowBox[{
                 RowBox[{"\[DoubleStruckB]", "'"}], "[", "x", "]"}]}], "}"}], 
              ",", " ", 
              RowBox[{
               RowBox[{"Con", "[", 
                RowBox[{
                "b", ",", " ", "\[DoubleStruckV]", ",", " ", 
                 "\[DoubleStruckA]"}], "]"}], "+", 
               RowBox[{"Con", "[", 
                RowBox[{
                "b", ",", " ", "\[DoubleStruckQ]", ",", " ", 
                 "\[DoubleStruckV]"}], "]"}]}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Derivative", "[", 
              RowBox[{"n_", "?", "Positive"}], "]"}], "[", "\[DoubleStruckC]",
              "]"}], "[", "x__", "]"}], " ", ":=", " ", "0"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "e"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"1.", " ", "\[Rule]", " ", "1"}], ",", " ", 
         RowBox[{
          RowBox[{"-", "1."}], " ", "\[Rule]", " ", 
          RowBox[{"-", "1"}]}], ",", " ", 
         RowBox[{"0.", " ", "\[Rule]", "  ", "0"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"e", " ", "/.", " ", "r"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Chop", "[", 
        RowBox[{"TrigReduce", "@", 
         RowBox[{"Simplify", "[", 
          RowBox[{"e", ",", " ", "opts"}], "]"}]}], "]"}], " ", "/.", " ", 
       "r"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7176010859771924`*^9, 3.7176010999617014`*^9}, 
   3.717601152540325*^9, {3.717601186993785*^9, 3.7176012132261868`*^9}, {
   3.7176012450077553`*^9, 3.7176012716017423`*^9}, {3.7176013379773893`*^9, 
   3.7176013764464874`*^9}, {3.717601423290701*^9, 3.717601441525231*^9}, {
   3.717602212566283*^9, 3.7176022146756797`*^9}, {3.717605388155593*^9, 
   3.7176053938275347`*^9}, {3.7176059139262166`*^9, 3.71760591473874*^9}, {
   3.717606217507225*^9, 3.7176062297104664`*^9}, {3.7176063339458313`*^9, 
   3.717606348430361*^9}, {3.7176063901182528`*^9, 3.7176064075559063`*^9}, {
   3.717606459493917*^9, 3.7176065608073797`*^9}, 3.7176065934951763`*^9, 
   3.7176066757147055`*^9, {3.7176068355912237`*^9, 3.717606858685194*^9}, {
   3.7176068943261576`*^9, 3.7176069298421335`*^9}, {3.7176069601080494`*^9, 
   3.7176069989677925`*^9}, {3.717607255798355*^9, 3.7176072742985353`*^9}, {
   3.7176073090176105`*^9, 3.7176073190645833`*^9}, {3.7176074407063723`*^9, 
   3.717607460503415*^9}, {3.717607537597913*^9, 3.7176075789108*^9}, {
   3.7176076237705913`*^9, 3.717607640176997*^9}, {3.717607683724303*^9, 
   3.717607710255803*^9}, {3.7176078509290147`*^9, 3.7176079670082283`*^9}, {
   3.7176080376495223`*^9, 3.7176081836821623`*^9}, {3.717608228135725*^9, 
   3.7176082723392544`*^9}, {3.7176083780902576`*^9, 3.717608388934111*^9}, {
   3.7176084500451975`*^9, 3.717608452154604*^9}, 3.717608488858066*^9, {
   3.7176085412960815`*^9, 3.717608553327428*^9}, {3.7176085856402526`*^9, 
   3.717608617531176*^9}, {3.7176086735004454`*^9, 3.717608678812996*^9}, {
   3.717608745782385*^9, 3.717608768095112*^9}, {3.717608815251792*^9, 
   3.7176088303144374`*^9}, {3.7176088813149366`*^9, 3.717609023816291*^9}, {
   3.7176090661916943`*^9, 3.717609068441698*^9}, {3.717609125223488*^9, 
   3.7176091579737988`*^9}, {3.7176092038179913`*^9, 
   3.7176092107243004`*^9}, {3.717609249724684*^9, 3.7176092628966722`*^9}, {
   3.717609326303541*^9, 3.717609485258177*^9}, {3.7176096399315214`*^9, 
   3.717609667197391*^9}, {3.717609716854124*^9, 3.7176097172291155`*^9}, {
   3.717617277738517*^9, 3.7176172919261684`*^9}, {3.71762576068955*^9, 
   3.7176259037690315`*^9}, {3.7176259354099565`*^9, 3.717625935941216*^9}, {
   3.717625971160285*^9, 3.7176260782394276`*^9}, {3.717626225459588*^9, 
   3.7176262621942997`*^9}, {3.7176265652028885`*^9, 3.7176265942031775`*^9}, 
   3.7176267546265783`*^9, {3.717630112761875*^9, 3.71763016913741*^9}, {
   3.717630318623208*^9, 3.717630320138846*^9}, {3.7176303588423553`*^9, 
   3.717630414889763*^9}, 3.717635216877018*^9, {3.7176397848123446`*^9, 
   3.717639819953306*^9}, {3.7176399195167384`*^9, 3.7176399242824063`*^9}, {
   3.7176859205007734`*^9, 3.7176859268133335`*^9}, {3.717686392394744*^9, 
   3.7176863952072563`*^9}, {3.7176873056221733`*^9, 
   3.7176874027949715`*^9}, {3.717687698154623*^9, 3.717687719967332*^9}, {
   3.7177033101087666`*^9, 3.717703349031025*^9}, {3.7178053615756063`*^9, 
   3.7178053632318916`*^9}, {3.718112636619864*^9, 3.718112683745345*^9}, {
   3.7181128184654126`*^9, 3.718112831387415*^9}, {3.718123631094798*^9, 
   3.718123636313614*^9}, {3.718123794299535*^9, 3.718123794893292*^9}, {
   3.718209722637319*^9, 3.718209729231145*^9}, {3.7182108442437754`*^9, 
   3.718210845040658*^9}, {3.7182109227914248`*^9, 3.718210985432686*^9}, {
   3.718211018417387*^9, 3.718211028073717*^9}, {3.718211084543023*^9, 
   3.718211084933653*^9}, {3.7188919505566483`*^9, 3.718891955072317*^9}, 
   3.742589267348644*^9},ExpressionUUID->"d25bd395-589a-4cb5-9b3d-\
401221544cbc"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Constraint Functions", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717361836037048*^9, 3.717361836927682*^9}, {3.717469190519846*^9, 
  3.7174692100981727`*^9}, {3.7175063780990095`*^9, 3.717506415786895*^9}, {
  3.7176464777718306`*^9, 
  3.717646479287466*^9}},ExpressionUUID->"e49d07f6-189b-4019-8f47-\
266922a4ae61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"rfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<r\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"rdotfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<rdot\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Tcbfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<Tcb\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Jfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<J\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Phi]fun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<\[Phi]\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Eta]fun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<\[Eta]\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Kfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateConstraintFunction", "[", 
     RowBox[{"\"\<K\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EvaluateConstraintFunction", "[", 
    RowBox[{"t_", ",", " ", 
     RowBox[{"x_:", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\[Lambda]_:", 
      RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", " ", "b"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"\[DoubleStruckX]", ",", " ", "nx"}], "]"}], ",", " ", 
         "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"\[Lambda]", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"\[DoubleStruckC]", ",", " ", "nc"}], "]"}], ",", " ", 
         "\[Lambda]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rb", "[", 
        RowBox[{"C", ",", " ", "t"}], "]"}], "[", 
       RowBox[{"a", ",", " ", "b"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717803381922194*^9, 3.7178034652198563`*^9}, {
  3.717803525236041*^9, 3.7178035332986164`*^9}, {3.7178035891063385`*^9, 
  3.7178035904969783`*^9}, {3.717803942375337*^9, 3.7178039472035093`*^9}, {
  3.717803991375787*^9, 3.717804002313407*^9}, {3.7178043626137066`*^9, 
  3.7178044454113517`*^9}, {3.7178044875992537`*^9, 3.7178045230214815`*^9}, {
  3.717804922184993*^9, 3.717804922653753*^9}, {3.7178051345422*^9, 
  3.717805143448536*^9}, {3.7178451271722383`*^9, 3.7178451318910294`*^9}, {
  3.7181959531585073`*^9, 3.7181959965026875`*^9}, {3.7188919276979756`*^9, 
  3.718891930354269*^9}, {3.7190749052597666`*^9, 
  3.7190749166036263`*^9}},ExpressionUUID->"c287c901-62f7-4046-b56c-\
a5a930b28fd2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDConstraintFunctions", "::", "a"}], " ", "=", " ", 
    "\"\<`1` is not an nca of `2`.  Replacing `1` with `3`.  Update \
constraint if this is not desired behavior.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDConstraintFunctions", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"j", ",", " ", "t", ",", " ", "b"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"j", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<J\>\"", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "}"}], "&"}], ")"}]}], ",", " ", 
          RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "}"}], "&"}], ")"}]}], ",", " ", 
          RowBox[{"\"\<\[Eta]\>\"", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "}"}], "&"}], ")"}]}], ",", " ", 
          RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"{", "}"}], "&"}], ")"}]}], ",", " ", 
          RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
           RowBox[{"<|", "|>"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<p\>\"", " ", "\[Rule]", " ", 
           RowBox[{"{", "}"}]}], ",", " ", 
          RowBox[{"\"\<v\>\"", " ", "\[Rule]", " ", 
           RowBox[{"{", "}"}]}], ",", " ", 
          RowBox[{"\"\<u\>\"", " ", "\[Rule]", " ", 
           RowBox[{"{", "}"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"ConBFunctions", "[", "False", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SetConstraintData", "[", 
        RowBox[{"j", ",", " ", "t", ",", " ", "b"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDConstraintFunctions", "[", "None", "]"}], " ", ":=", " ", 
    RowBox[{"RBDConstraintFunctions", "[", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDConstraintFunctions", "[", "All", "]"}], " ", ":=", " ", 
    RowBox[{"RBDConstraintFunctions", "@", 
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{"con", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}], "]"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDConstraintFunctions", "[", "name_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "c", ",", " ", "J", ",", " ", "\[Phi]", ",", " ", "\[Eta]", ",", " ", 
       "K", ",", " ", "brX", ",", " ", "n", ",", " ", "t"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"adds", " ", "desired", " ", "constraints", " ", "to", " ", 
        RowBox[{"rb", "[", "C", "]"}]}], ";", " ", 
       RowBox[{
       "returns", " ", "an", " ", "intermediate", " ", "representation"}]}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"of", " ", "final", " ", "constraints"}], ";", " ", 
       RowBox[{
       "rest", " ", "of", " ", "code", " ", "places", " ", "in", " ", "final",
         " ", "representation"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"PreprocessConstraints", "[", "name", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"c", " ", "===", " ", 
          RowBox[{"{", "}"}]}], " ", "||", " ", 
         RowBox[{"KeyFreeQ", "[", 
          RowBox[{"rb", ",", " ", "C"}], "]"}]}], ",", " ", 
        RowBox[{"Return", "[", 
         RowBox[{"RBDConstraintFunctions", "[", "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "extract", " ", "data", " ", "from", " ", "intermediate", " ", 
        "representation", " ", "in", " ", 
        RowBox[{"rb", "[", "C", "]"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"J", ",", " ", "\[Phi]"}], "}"}], " ", "=", " ", 
       RowBox[{"ConvertToXLFunction", " ", "/@", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<J\>\""}], "]"}], ",", " ", 
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<\[Phi]\>\""}], "]"}]}], "}"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"brX", " ", "=", " ", 
       RowBox[{"ConBFunctions", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"partition", " ", "row", " ", "type"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"t", " ", "=", " ", 
       RowBox[{"rb", "[", 
        RowBox[{"C", ",", " ", "\"\<t\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", " ", "=", " ", 
       RowBox[{"GroupBy", "[", 
        RowBox[{
         RowBox[{"Range", "@", 
          RowBox[{"Length", "@", "t"}]}], ",", " ", 
         RowBox[{
          RowBox[{"t", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}],
           "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"t", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<p\>\"", " ", "\[Rule]", " ", 
            RowBox[{"{", "}"}]}], ",", " ", 
           RowBox[{"\"\<v\>\"", " ", "\[Rule]", " ", 
            RowBox[{"{", "}"}]}], ",", " ", 
           RowBox[{"\"\<u\>\"", " ", "\[Rule]", " ", 
            RowBox[{"{", "}"}]}]}], "|>"}], ",", " ", "t"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "define", " ", "feedback", " ", "error", " ", "for", " ", "constraint",
         " ", "stabilization"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Eta]", " ", "=", " ", 
       RowBox[{"ConvertToXLFunction", "@", 
        RowBox[{"Transpose", "@", 
         RowBox[{"rb", "[", 
          RowBox[{"C", ",", " ", "\"\<\[Eta]\>\""}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"K", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", 
             RowBox[{"\[Epsilon]", "^", "2"}]}], ",", " ", 
            RowBox[{"1", "/", "\[Epsilon]"}]}], "}"}], "#"}], "&"}], " ", "/@",
         " ", 
        RowBox[{"rb", "[", 
         RowBox[{"C", ",", " ", "\"\<K\>\""}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"K", " ", "=", " ", 
       RowBox[{"DiagonalMatrix", " ", "/@", " ", 
        RowBox[{"Transpose", "[", "K", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"K", " ", "=", " ", 
       RowBox[{"ConvertToXLFunction", "@", "K"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"<|", 
        RowBox[{
         RowBox[{"\"\<J\>\"", " ", "\[Rule]", " ", "J"}], ",", " ", 
         RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "\[Phi]"}], ",", " ", 
         RowBox[{"\"\<\[Eta]\>\"", " ", "\[Rule]", " ", "\[Eta]"}], ",", " ", 
         RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", "K"}], ",", " ", 
         RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<n\>\""}], "]"}]}]}], "|>"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SetConstraintData", "[", 
       RowBox[{"n", ",", " ", "t", ",", " ", "brX"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7176465717102194`*^9, 3.7176466229138317`*^9}, {
   3.717647789206169*^9, 3.717647804346924*^9}, {3.717647976551696*^9, 
   3.7176480235424967`*^9}, 3.7176480864649663`*^9, {3.7176491699930573`*^9, 
   3.7176491811962924`*^9}, {3.7176492349780507`*^9, 
   3.7176492483844404`*^9}, {3.717649378760683*^9, 3.7176493993858805`*^9}, {
   3.7176495738875217`*^9, 3.7176495840595107`*^9}, 3.7176496218879776`*^9, {
   3.7176497834051504`*^9, 3.7176499372972374`*^9}, {3.7176501256584024`*^9, 
   3.7176501638931284`*^9}, {3.717650340700179*^9, 3.7176504338885765`*^9}, {
   3.717650652247842*^9, 3.717650683670015*^9}, {3.717650751795658*^9, 
   3.7176507522331514`*^9}, {3.71765092966481*^9, 3.717650998708003*^9}, {
   3.7176510579117064`*^9, 3.7176511976786594`*^9}, {3.7176512365696526`*^9, 
   3.717651243991586*^9}, {3.717651683261382*^9, 3.7176517141054287`*^9}, {
   3.717651783887352*^9, 3.7176518140907516`*^9}, {3.717651856513033*^9, 
   3.7176518959040422`*^9}, {3.7176519444357405`*^9, 
   3.7176519972331333`*^9}, {3.71765207109321*^9, 3.717652175203575*^9}, {
   3.717652239782296*^9, 3.7176522931294985`*^9}, {3.717652325848574*^9, 
   3.7176523628020372`*^9}, {3.71765244733409*^9, 3.7176525981011457`*^9}, {
   3.717652643429717*^9, 3.71765266649242*^9}, {3.7176528027749662`*^9, 
   3.717652934229352*^9}, {3.717652994964292*^9, 3.717652996198695*^9}, {
   3.717653111699793*^9, 3.7176533144829655`*^9}, {3.7176533548114643`*^9, 
   3.7176533716241226`*^9}, 3.7176534343122168`*^9, 3.717653493047151*^9, {
   3.7176536194233513`*^9, 3.7176537103304796`*^9}, {3.7176538442536125`*^9, 
   3.7176538826914916`*^9}, 3.7176539353951054`*^9, {3.7176540168021455`*^9, 
   3.717654017020892*^9}, {3.7176540723807983`*^9, 3.7176541432252073`*^9}, {
   3.7176541736473703`*^9, 3.7176542242416115`*^9}, {3.71765436875861*^9, 
   3.7176544953066874`*^9}, {3.7176545741355658`*^9, 3.717654636761145*^9}, {
   3.7176547224338512`*^9, 3.7176547329808254`*^9}, {3.717654897388623*^9, 
   3.7176549282795405`*^9}, {3.7176551420628386`*^9, 3.717655189797666*^9}, {
   3.717655223840895*^9, 3.717655242059804*^9}, {3.717655299325971*^9, 
   3.717655306810429*^9}, 3.7176555000310163`*^9, {3.7176557367051444`*^9, 
   3.71765575734595*^9}, {3.717679477014019*^9, 3.7176795422958727`*^9}, {
   3.717681364078827*^9, 3.7176814038448305`*^9}, {3.7176819298654375`*^9, 
   3.7176819298810635`*^9}, {3.7176838136541233`*^9, 
   3.7176839017799587`*^9}, {3.71768394873353*^9, 3.7176839573117495`*^9}, {
   3.717684122453931*^9, 3.7176842227361507`*^9}, {3.7176842815648355`*^9, 
   3.717684328346513*^9}, {3.717684475144782*^9, 3.7176845247077537`*^9}, {
   3.7176845946771855`*^9, 3.717684617818015*^9}, {3.7176846546777387`*^9, 
   3.7176848018822756`*^9}, {3.717684848554598*^9, 3.717684930258499*^9}, {
   3.7176849641494293`*^9, 3.7176850152124147`*^9}, {3.717685052587787*^9, 
   3.717685061197228*^9}, {3.717685092244399*^9, 3.7176851100102034`*^9}, {
   3.717685152916872*^9, 3.717685382419029*^9}, {3.717687884187642*^9, 
   3.7176878852657757`*^9}, {3.71768798248545*^9, 3.717687985141742*^9}, {
   3.7176880454860487`*^9, 3.717688056298651*^9}, {3.717688400458189*^9, 
   3.717688406301978*^9}, {3.717688499755993*^9, 3.7176886217727757`*^9}, {
   3.7176886779608216`*^9, 3.7176886807264776`*^9}, {3.7176887301175723`*^9, 
   3.7176887528834133`*^9}, {3.7176887828993225`*^9, 3.717688785805584*^9}, {
   3.7176896560235443`*^9, 3.7176896700393057`*^9}, {3.717689718946019*^9, 
   3.717689746321277*^9}, {3.7176897793528423`*^9, 3.7176898845100937`*^9}, {
   3.717689923916717*^9, 3.7176899271042447`*^9}, {3.717689999808078*^9, 
   3.717690002136211*^9}, {3.7176900685587144`*^9, 3.717690081293223*^9}, {
   3.7176901330593276`*^9, 3.717690152778265*^9}, {3.717690241232233*^9, 
   3.717690247669792*^9}, {3.7176902837638874`*^9, 3.7176902874357953`*^9}, {
   3.717690324264282*^9, 3.7176904219214473`*^9}, {3.7176904662031355`*^9, 
   3.717690491797128*^9}, {3.7176905649853077`*^9, 3.717690594923109*^9}, {
   3.717690636751627*^9, 3.717690636923503*^9}, {3.717694591303094*^9, 
   3.71769463422538*^9}, 3.717781910720704*^9, {3.7177825719301105`*^9, 
   3.7177826724779544`*^9}, {3.7177839458181715`*^9, 
   3.7177839472088184`*^9}, {3.7177840054124994`*^9, 
   3.7177840058343797`*^9}, {3.7177844562761445`*^9, 3.717784622965245*^9}, {
   3.7177847005753565`*^9, 3.7177847014191103`*^9}, {3.7177847341381607`*^9, 
   3.7177847349038086`*^9}, {3.7177847702322536`*^9, 
   3.7177847708416495`*^9}, {3.717784840529812*^9, 3.717784881014556*^9}, 
   3.7177856122871447`*^9, {3.7177856894909887`*^9, 3.717785797929535*^9}, {
   3.717785839289286*^9, 3.71778594314966*^9}, {3.7177860185566316`*^9, 
   3.7177860771509247`*^9}, {3.7177861140106597`*^9, 3.71778611557318*^9}, {
   3.717786170292449*^9, 3.7177861790893908`*^9}, {3.7177862342774315`*^9, 
   3.71778639968524*^9}, {3.7177864369824667`*^9, 3.7177864448887944`*^9}, 
   3.717786541280334*^9, {3.7177866734222307`*^9, 3.717786673765967*^9}, {
   3.7177867987827816`*^9, 3.717786821642374*^9}, {3.717786854783312*^9, 
   3.7177868665021763`*^9}, {3.7177869438474355`*^9, 3.717786950503732*^9}, {
   3.7177869823009253`*^9, 3.7177870660360966`*^9}, {3.717787154005681*^9, 
   3.7177871559431953`*^9}, {3.717789571313012*^9, 3.71778959956328*^9}, {
   3.7177899094881*^9, 3.7177901198025937`*^9}, {3.7177902225223255`*^9, 
   3.7177903396015453`*^9}, {3.71779042611801*^9, 3.7177904303836756`*^9}, {
   3.717790497853063*^9, 3.7177905261970863`*^9}, {3.717790562603665*^9, 
   3.7177905929320908`*^9}, {3.717790626797288*^9, 3.717790892768566*^9}, {
   3.7177909430971847`*^9, 3.717791015847875*^9}, {3.7177910738327847`*^9, 
   3.7177911461459894`*^9}, {3.717791345962943*^9, 3.7177913548536544`*^9}, {
   3.717791408947903*^9, 3.717791466807826*^9}, {3.7177914992339315`*^9, 
   3.7177916450634584`*^9}, {3.7177916790325165`*^9, 3.717791707407797*^9}, {
   3.7177917558301325`*^9, 3.717791769080247*^9}, {3.7177918004555607`*^9, 
   3.717791828846455*^9}, {3.717791970894679*^9, 3.717792048489167*^9}, {
   3.717792079161333*^9, 3.717792096083353*^9}, {3.717796325896889*^9, 
   3.717796353444038*^9}, {3.717796393241295*^9, 3.717796443929273*^9}, {
   3.7177965270081916`*^9, 3.7177965475396214`*^9}, {3.717796698525442*^9, 
   3.717796701087967*^9}, {3.7177967858700275`*^9, 3.7177968362611303`*^9}, {
   3.7177968758083653`*^9, 3.717797016512845*^9}, {3.7177970647789235`*^9, 
   3.717797126826393*^9}, {3.7177980500175123`*^9, 3.717798060173875*^9}, {
   3.717798758951662*^9, 3.71779875918604*^9}, {3.717798904703064*^9, 
   3.717798928031412*^9}, {3.7178036573570056`*^9, 3.7178036717633753`*^9}, {
   3.7178116161889486`*^9, 3.7178116925646577`*^9}, {3.717811771299794*^9, 
   3.717811777706109*^9}, {3.717811824128422*^9, 3.717812039146089*^9}, {
   3.71781208086524*^9, 3.717812117990593*^9}, {3.717812191100662*^9, 
   3.7178122895547085`*^9}, {3.7178123513053102`*^9, 3.7178124860253363`*^9}, 
   3.7178127848406663`*^9, {3.717813688380517*^9, 3.71781382236615*^9}, {
   3.7178141164783297`*^9, 3.7178142517140026`*^9}, {3.717843529469555*^9, 
   3.717843531266432*^9}, {3.7178435690324144`*^9, 3.7178440462088237`*^9}, {
   3.7178440864123306`*^9, 3.717844310758229*^9}, {3.717844343789793*^9, 
   3.7178443469773064`*^9}, {3.71784446932222*^9, 3.717844471869136*^9}, {
   3.7178445053850627`*^9, 3.7178445767451286`*^9}, {3.717844634386306*^9, 
   3.7178446350425572`*^9}, {3.717844696199394*^9, 3.717844711121393*^9}, 
   3.71784495749874*^9, {3.7178449986553764`*^9, 3.7178450483277225`*^9}, 
   3.717869651902047*^9, {3.7181236708608274`*^9, 3.7181236718295736`*^9}, {
   3.718124080849243*^9, 3.718124081458624*^9}, {3.718125432737604*^9, 
   3.7181254338938637`*^9}, {3.7181256217901497`*^9, 3.718125629852743*^9}, {
   3.7181257325099936`*^9, 3.7181257332756257`*^9}, {3.718141867163021*^9, 
   3.71814189653831*^9}, {3.7181419898361087`*^9, 3.718141991461125*^9}, {
   3.718142024914581*^9, 3.718142056477403*^9}, {3.718142147478307*^9, 
   3.718142227572831*^9}, {3.718142265120079*^9, 3.7181422672294736`*^9}, {
   3.71814361467265*^9, 3.718143706736057*^9}, {3.7181437691116753`*^9, 
   3.7181438171902733`*^9}, {3.7181440396725597`*^9, 3.71814409942315*^9}, {
   3.7181441675956993`*^9, 3.7181441986741314`*^9}, {3.7181442552372055`*^9, 
   3.7181443061908197`*^9}, {3.71814434823811*^9, 3.718144366597666*^9}, 
   3.718144398191728*^9, {3.7181444768331313`*^9, 3.7181444799894123`*^9}, {
   3.7181445614589663`*^9, 3.7181445933811593`*^9}, {3.718144959315639*^9, 
   3.7181449697376175`*^9}, {3.7181956553743153`*^9, 
   3.7181956564055758`*^9}, {3.718195708202963*^9, 3.7181957086717157`*^9}, {
   3.7181959214238353`*^9, 3.7181959217363234`*^9}, {3.7182002553878117`*^9, 
   3.7182003474668493`*^9}, {3.718200448920963*^9, 3.718200601328723*^9}, {
   3.718200772560587*^9, 3.7182008186860523`*^9}, {3.7182049300744205`*^9, 
   3.718204996559452*^9}, 3.71820515508539*^9, 3.718205196803382*^9, {
   3.718205316601455*^9, 3.718205340195424*^9}, {3.718205510931488*^9, 
   3.7182055413224134`*^9}, 3.718205729833356*^9, 3.7182057636774406`*^9, {
   3.718205834395361*^9, 3.718205834567239*^9}, {3.718205913099271*^9, 
   3.718205913411767*^9}, {3.718205944599575*^9, 3.718205996709467*^9}, {
   3.718206028147277*^9, 3.718206030069172*^9}, {3.718206079382159*^9, 
   3.718206083960329*^9}, {3.7182061290389004`*^9, 3.718206148804719*^9}, {
   3.718206184851951*^9, 3.71820628385293*^9}, {3.718206325415839*^9, 
   3.718206369635028*^9}, {3.718206480151745*^9, 3.7182065262928267`*^9}, {
   3.718206591184103*^9, 3.7182065921216*^9}, {3.718206661919178*^9, 
   3.718206725904174*^9}, {3.718207869674014*^9, 3.7182078797366033`*^9}, 
   3.7182082422164373`*^9, {3.718208284544995*^9, 3.7182082996701303`*^9}, {
   3.7182115165918465`*^9, 3.7182115169824758`*^9}, {3.718211559889149*^9, 
   3.7182115817956142`*^9}, {3.7182135411700907`*^9, 3.718213615686451*^9}, {
   3.7182137896725454`*^9, 3.7182138114696364`*^9}, {3.718213886314125*^9, 
   3.718213893751698*^9}, {3.7182139394552765`*^9, 3.7182139811744385`*^9}, {
   3.7182143645219746`*^9, 3.7182144434602566`*^9}, {3.7182144918826113`*^9, 
   3.7182146927752247`*^9}, {3.7182147245567846`*^9, 3.718214749963286*^9}, {
   3.718214862401908*^9, 3.7182148793708134`*^9}, {3.7182154625797033`*^9, 
   3.7182154774861016`*^9}, 3.71821605734778*^9, {3.7182161226140485`*^9, 
   3.7182161335360327`*^9}, 3.7182161751614428`*^9, {3.718216219177516*^9, 
   3.718216269631127*^9}, {3.718216361819538*^9, 3.7182164012574267`*^9}, {
   3.7182165427119675`*^9, 3.7182165437744775`*^9}, {3.7182167180886846`*^9, 
   3.7182167580109563`*^9}, {3.718216825277255*^9, 3.7182168258710003`*^9}, {
   3.718216924137597*^9, 3.718216963669235*^9}, {3.718218209634677*^9, 
   3.7182182211972914`*^9}, {3.718218400824066*^9, 3.7182184039178467`*^9}, 
   3.7182184421838617`*^9, {3.7182217104456515`*^9, 3.71822172747707*^9}, {
   3.7182217644149337`*^9, 3.7182217788057146`*^9}, {3.718491852290882*^9, 
   3.718491890369357*^9}, {3.7184919893077993`*^9, 3.718492020698721*^9}, {
   3.7184920853243365`*^9, 3.718492137824834*^9}, {3.7184921856065574`*^9, 
   3.718492188481566*^9}, {3.7184922390133076`*^9, 3.718492268560468*^9}, {
   3.7184923732645707`*^9, 3.7184924049367642`*^9}, {3.7184924422496195`*^9, 
   3.7184925207772613`*^9}, {3.7184925904498034`*^9, 
   3.7184926892944927`*^9}, {3.718661580899767*^9, 3.7186615810716295`*^9}, {
   3.718661668556884*^9, 3.7186617370262938`*^9}, {3.7186617838705072`*^9, 
   3.7186618221208844`*^9}, {3.718661852824312*^9, 3.7186618565274925`*^9}, {
   3.718661886965276*^9, 3.718661924465659*^9}, {3.7186620399217176`*^9, 
   3.718662059343783*^9}, {3.7186621070786414`*^9, 3.7186621489227953`*^9}, 
   3.718662555629939*^9, {3.718722700680736*^9, 3.718722724852837*^9}, {
   3.7188340481518764`*^9, 3.718834065355155*^9}, {3.7188342270911293`*^9, 
   3.7188342909511366`*^9}, {3.718834493231468*^9, 3.718834498559658*^9}, {
   3.7188350280180044`*^9, 3.7188350506588535`*^9}, {3.718835105534397*^9, 
   3.718835156550544*^9}, {3.7190728317236466`*^9, 3.7190728347705545`*^9}, {
   3.7190732101805143`*^9, 3.7190733584788694`*^9}, {3.7190734490266223`*^9, 
   3.7190734505578895`*^9}, {3.7190735318399568`*^9, 3.719073532168069*^9}, {
   3.71907395923479*^9, 3.719073986031932*^9}, {3.719074057095133*^9, 
   3.7190740952986374`*^9}, {3.719074146611642*^9, 3.7190741535492287`*^9}, {
   3.7190742018465643`*^9, 3.719074204393465*^9}, {3.7190742593158817`*^9, 
   3.7190742773160753`*^9}, {3.7190820622332125`*^9, 3.719082087999104*^9}, {
   3.719082162586094*^9, 3.7190821643830013`*^9}, {3.71909589411662*^9, 
   3.7190959515703135`*^9}, {3.719523932774563*^9, 3.7195239337901917`*^9}, {
   3.7306555562199774`*^9, 3.730655562970028*^9}, {3.7306557125472107`*^9, 
   3.7306557157816153`*^9}, {3.7306557904092493`*^9, 
   3.7306557989248805`*^9}, {3.7306558610485916`*^9, 3.730655861408007*^9}, 
   3.7614919385482144`*^9, {3.777431125425125*^9, 3.7774311390704327`*^9}, {
   3.7774311902348537`*^9, 3.777431192804387*^9}, 
   3.77743131456009*^9},ExpressionUUID->"99048470-c283-4721-bc25-\
207b40c529db"],

Cell[CellGroupData[{

Cell["Helper Functions", "Subsection",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717361836037048*^9, 3.717361836927682*^9}, {3.717469190519846*^9, 
  3.7174692100981727`*^9}, {3.7175063780990095`*^9, 3.717506415786895*^9}, {
  3.7176464777718306`*^9, 3.717646479287466*^9}, {3.7181241005525618`*^9, 
  3.718124104130723*^9}},ExpressionUUID->"03970afd-0e6f-4aa6-8a61-\
740e7c849c7c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SetConstraintData", "::", "u"}], " ", "=", " ", 
    "\"\<There are `1` actuators and `2` virtual constraints.  There may not \
be enough actuators to solve for these constraints.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetConstraintData", "[", 
   RowBox[{"J_", ",", " ", "T_", ",", " ", "B_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"nf", ",", " ", "nv", ",", " ", "nu"}], "}"}], " ", "=", " ", 
      RowBox[{"Length", " ", "/@", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"T", "\[LeftDoubleBracket]", 
         RowBox[{"{", 
          RowBox[{"\"\<p\>\"", ",", " ", "\"\<v\>\"", ",", " ", "\"\<u\>\""}],
           "}"}], "\[RightDoubleBracket]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"nu", " ", "<", " ", "nv"}], ",", " ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"SetConstraintData", "::", "u"}], ",", " ", "nu", ",", " ", 
         "nv"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"zpos", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{"z1", ",", " ", 
        RowBox[{"Length", "@", 
         RowBox[{"B", "[", "\"\<bo\>\"", "]"}]}]}], 
       RowBox[{"(*", 
        RowBox[{"nf", " ", "+", " ", "nv", " ", "+", " ", "nu"}], "*)"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ZAb", " ", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{"z1", ",", " ", 
        RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nv"}], ",", " ", 
        RowBox[{
        "nq", " ", "+", " ", "nf", " ", "+", " ", "nu", " ", "+", " ", 
         "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"rb", "[", "C", "]"}], " ", "=", " ", 
      RowBox[{"Join", "[", 
       RowBox[{"J", ",", " ", "T", ",", " ", "B"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7188349128606176`*^9, 3.7188350065490417`*^9}, {
  3.7188350710496955`*^9, 3.718835073752831*^9}, {3.719108044142979*^9, 
  3.719108060283779*^9}, {3.7191080943622255`*^9, 3.719108100456051*^9}, {
  3.719523941133992*^9, 3.719523960962283*^9}, {3.7220817636031046`*^9, 
  3.7220817894939804`*^9}, {3.791131992967279*^9, 3.7911320142860737`*^9}, {
  3.7911320647722397`*^9, 
  3.791132067380934*^9}},ExpressionUUID->"0a2aa8cb-796d-427a-b9e3-\
2463e6398b7f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PreprocessConstraints", "::", "name"}], " ", "=", " ", 
   "\"\<No valid constraints found under ``.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PreprocessConstraints", "[", "names_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c", ",", " ", "t", ",", " ", "f"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"remove", " ", "C"}], ";", " ", 
        RowBox[{
        "it", " ", "has", " ", "Function", " ", "as", " ", "head", " ", "not",
          " ", "List"}]}], ",", " ", 
       RowBox[{"which", " ", "AddCon", " ", "needs"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"KeyDropFrom", "[", 
       RowBox[{"rb", ",", " ", "C"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"t", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "\"\<q\>\"", ",", " ", "\"\<v\>\"", ",", " ", "\"\<a\>\"", ",", " ", 
         "\"\<b\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "ConQ", ",", " ", "ConV", ",", " ", "ConA", ",", " ", "ConB"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{"con", ",", " ", 
         RowBox[{"{", 
          RowBox[{"_", ",", " ", 
           RowBox[{"Alternatives", "@@", "names"}], ",", " ", "__"}], "}"}]}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"c", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{"c", ",", " ", 
         RowBox[{
          RowBox[{"StringMatchQ", "[", 
           RowBox[{
            RowBox[{"First", "@", "#"}], ",", " ", "t"}], "]"}], "&"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"c", " ", "===", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"PreprocessConstraints", "::", "name"}], ",", " ", 
           "names"}], "]"}], ";", " ", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "}"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"expand", " ", 
        RowBox[{"constraints", "?"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], " ", "=", 
       " ", 
       RowBox[{"MapThread", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"#1", ",", " ", "#2", ",", " ", "\"\<b\>\""}], " ", "]"}], 
          "&"}], ",", " ", 
         RowBox[{
          RowBox[{"c", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", 
            RowBox[{"{", 
             RowBox[{"8", ",", " ", "1"}], "}"}]}], "\[RightDoubleBracket]"}],
           "\[Transpose]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"replace", " ", "with", " ", "con", " ", "type"}], " ", "*)"}],
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], " ", "=", 
       " ", 
       RowBox[{
        RowBox[{"c", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "1"}], "\[RightDoubleBracket]"}], " ", "/.",
         " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"t", " ", "\[Rule]", " ", "f"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"drop", " ", "expand", " ", "column"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"Drop", "[", 
        RowBox[{"c", ",", " ", "None", ",", " ", 
         RowBox[{"{", "8", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "adds", " ", "constraints", " ", "to", " ", "rb", " ", "and", " ", 
         "returns", " ", "the", " ", "results", " ", "from", " ", "ConQ"}], 
        ",", " ", 
        RowBox[{"etc", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "@@", 
         RowBox[{"#", "\[LeftDoubleBracket]", 
          RowBox[{"2", ";;"}], "\[RightDoubleBracket]"}]}], "&"}], " ", "/@", 
       " ", "c"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"return", " ", "intermediate", " ", "format"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"rb", "[", "C", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7176465717102194`*^9, 3.7176466229138317`*^9}, {
   3.717647789206169*^9, 3.717647804346924*^9}, {3.717647976551696*^9, 
   3.7176480235424967`*^9}, 3.7176480864649663`*^9, {3.7176491699930573`*^9, 
   3.7176491811962924`*^9}, {3.7176492349780507`*^9, 
   3.7176492483844404`*^9}, {3.717649378760683*^9, 3.7176493993858805`*^9}, {
   3.7176495738875217`*^9, 3.7176495840595107`*^9}, 3.7176496218879776`*^9, {
   3.7176497834051504`*^9, 3.7176499372972374`*^9}, {3.7176501256584024`*^9, 
   3.7176501638931284`*^9}, {3.717650340700179*^9, 3.7176504338885765`*^9}, {
   3.717650652247842*^9, 3.717650683670015*^9}, {3.717650751795658*^9, 
   3.7176507522331514`*^9}, {3.71765092966481*^9, 3.717650998708003*^9}, {
   3.7176510579117064`*^9, 3.7176511976786594`*^9}, {3.7176512365696526`*^9, 
   3.717651243991586*^9}, {3.717651683261382*^9, 3.7176517141054287`*^9}, {
   3.717651783887352*^9, 3.7176518140907516`*^9}, {3.717651856513033*^9, 
   3.7176518959040422`*^9}, {3.7176519444357405`*^9, 
   3.7176519972331333`*^9}, {3.71765207109321*^9, 3.717652175203575*^9}, {
   3.717652239782296*^9, 3.7176522931294985`*^9}, {3.717652325848574*^9, 
   3.7176523628020372`*^9}, {3.71765244733409*^9, 3.7176525981011457`*^9}, {
   3.717652643429717*^9, 3.71765266649242*^9}, {3.7176528027749662`*^9, 
   3.717652934229352*^9}, {3.717652994964292*^9, 3.717652996198695*^9}, {
   3.717653111699793*^9, 3.7176533144829655`*^9}, {3.7176533548114643`*^9, 
   3.7176533716241226`*^9}, 3.7176534343122168`*^9, 3.717653493047151*^9, {
   3.7176536194233513`*^9, 3.7176537103304796`*^9}, {3.7176538442536125`*^9, 
   3.7176538826914916`*^9}, 3.7176539353951054`*^9, {3.7176540168021455`*^9, 
   3.717654017020892*^9}, {3.7176540723807983`*^9, 3.7176541432252073`*^9}, {
   3.7176541736473703`*^9, 3.7176542242416115`*^9}, {3.71765436875861*^9, 
   3.7176544953066874`*^9}, {3.7176545741355658`*^9, 3.717654636761145*^9}, {
   3.7176547224338512`*^9, 3.7176547329808254`*^9}, {3.717654897388623*^9, 
   3.7176549282795405`*^9}, {3.7176551420628386`*^9, 3.717655189797666*^9}, {
   3.717655223840895*^9, 3.717655242059804*^9}, {3.717655299325971*^9, 
   3.717655306810429*^9}, 3.7176555000310163`*^9, {3.7176557367051444`*^9, 
   3.71765575734595*^9}, {3.717679477014019*^9, 3.7176795422958727`*^9}, {
   3.717681364078827*^9, 3.7176814038448305`*^9}, {3.7176819298654375`*^9, 
   3.7176819298810635`*^9}, {3.7176838136541233`*^9, 
   3.7176839017799587`*^9}, {3.71768394873353*^9, 3.7176839573117495`*^9}, {
   3.717684122453931*^9, 3.7176842227361507`*^9}, {3.7176842815648355`*^9, 
   3.717684328346513*^9}, {3.717684475144782*^9, 3.7176845247077537`*^9}, {
   3.7176845946771855`*^9, 3.717684617818015*^9}, {3.7176846546777387`*^9, 
   3.7176848018822756`*^9}, {3.717684848554598*^9, 3.717684930258499*^9}, {
   3.7176849641494293`*^9, 3.7176850152124147`*^9}, {3.717685052587787*^9, 
   3.717685061197228*^9}, {3.717685092244399*^9, 3.7176851100102034`*^9}, {
   3.717685152916872*^9, 3.717685382419029*^9}, {3.717687884187642*^9, 
   3.7176878852657757`*^9}, {3.71768798248545*^9, 3.717687985141742*^9}, {
   3.7176880454860487`*^9, 3.717688056298651*^9}, {3.717688400458189*^9, 
   3.717688406301978*^9}, {3.717688499755993*^9, 3.7176886217727757`*^9}, {
   3.7176886779608216`*^9, 3.7176886807264776`*^9}, {3.7176887301175723`*^9, 
   3.7176887528834133`*^9}, {3.7176887828993225`*^9, 3.717688785805584*^9}, {
   3.7176896560235443`*^9, 3.7176896700393057`*^9}, {3.717689718946019*^9, 
   3.717689746321277*^9}, {3.7176897793528423`*^9, 3.7176898845100937`*^9}, {
   3.717689923916717*^9, 3.7176899271042447`*^9}, {3.717689999808078*^9, 
   3.717690002136211*^9}, {3.7176900685587144`*^9, 3.717690081293223*^9}, {
   3.7176901330593276`*^9, 3.717690152778265*^9}, {3.717690241232233*^9, 
   3.717690247669792*^9}, {3.7176902837638874`*^9, 3.7176902874357953`*^9}, {
   3.717690324264282*^9, 3.7176904219214473`*^9}, {3.7176904662031355`*^9, 
   3.717690491797128*^9}, {3.7176905649853077`*^9, 3.717690594923109*^9}, {
   3.717690636751627*^9, 3.717690636923503*^9}, {3.717694591303094*^9, 
   3.71769463422538*^9}, 3.717781910720704*^9, {3.7177825719301105`*^9, 
   3.7177826724779544`*^9}, {3.7177839458181715`*^9, 
   3.7177839472088184`*^9}, {3.7177840054124994`*^9, 
   3.7177840058343797`*^9}, {3.7177844562761445`*^9, 3.717784622965245*^9}, {
   3.7177847005753565`*^9, 3.7177847014191103`*^9}, {3.7177847341381607`*^9, 
   3.7177847349038086`*^9}, {3.7177847702322536`*^9, 
   3.7177847708416495`*^9}, {3.717784840529812*^9, 3.717784881014556*^9}, 
   3.7177856122871447`*^9, {3.7177856894909887`*^9, 3.717785797929535*^9}, {
   3.717785839289286*^9, 3.71778594314966*^9}, {3.7177860185566316`*^9, 
   3.7177860771509247`*^9}, {3.7177861140106597`*^9, 3.71778611557318*^9}, {
   3.717786170292449*^9, 3.7177861790893908`*^9}, {3.7177862342774315`*^9, 
   3.71778639968524*^9}, {3.7177864369824667`*^9, 3.7177864448887944`*^9}, 
   3.717786541280334*^9, {3.7177866734222307`*^9, 3.717786673765967*^9}, {
   3.7177867987827816`*^9, 3.717786821642374*^9}, {3.717786854783312*^9, 
   3.7177868665021763`*^9}, {3.7177869438474355`*^9, 3.717786950503732*^9}, {
   3.7177869823009253`*^9, 3.7177870660360966`*^9}, {3.717787154005681*^9, 
   3.7177871559431953`*^9}, {3.717789571313012*^9, 3.71778959956328*^9}, {
   3.7177899094881*^9, 3.7177901198025937`*^9}, {3.7177902225223255`*^9, 
   3.7177903396015453`*^9}, {3.71779042611801*^9, 3.7177904303836756`*^9}, {
   3.717790497853063*^9, 3.7177905261970863`*^9}, {3.717790562603665*^9, 
   3.7177905929320908`*^9}, {3.717790626797288*^9, 3.717790892768566*^9}, {
   3.7177909430971847`*^9, 3.717791015847875*^9}, {3.7177910738327847`*^9, 
   3.7177911461459894`*^9}, {3.717791345962943*^9, 3.7177913548536544`*^9}, {
   3.717791408947903*^9, 3.717791466807826*^9}, {3.7177914992339315`*^9, 
   3.7177916450634584`*^9}, {3.7177916790325165`*^9, 3.717791707407797*^9}, {
   3.7177917558301325`*^9, 3.717791769080247*^9}, {3.7177918004555607`*^9, 
   3.717791828846455*^9}, {3.717791970894679*^9, 3.717792048489167*^9}, {
   3.717792079161333*^9, 3.717792096083353*^9}, {3.717796325896889*^9, 
   3.717796353444038*^9}, {3.717796393241295*^9, 3.717796443929273*^9}, {
   3.7177965270081916`*^9, 3.7177965475396214`*^9}, {3.717796698525442*^9, 
   3.717796701087967*^9}, {3.7177967858700275`*^9, 3.7177968362611303`*^9}, {
   3.7177968758083653`*^9, 3.717797016512845*^9}, {3.7177970647789235`*^9, 
   3.717797126826393*^9}, {3.7177980500175123`*^9, 3.717798060173875*^9}, {
   3.717798758951662*^9, 3.71779875918604*^9}, {3.717798904703064*^9, 
   3.717798928031412*^9}, {3.7178036573570056`*^9, 3.7178036717633753`*^9}, {
   3.7178116161889486`*^9, 3.7178116925646577`*^9}, {3.717811771299794*^9, 
   3.717811777706109*^9}, {3.717811824128422*^9, 3.717812039146089*^9}, {
   3.71781208086524*^9, 3.717812117990593*^9}, {3.717812191100662*^9, 
   3.7178122895547085`*^9}, {3.7178123513053102`*^9, 3.7178124860253363`*^9}, 
   3.7178127848406663`*^9, {3.717813688380517*^9, 3.71781382236615*^9}, {
   3.7178141164783297`*^9, 3.7178142517140026`*^9}, {3.717843529469555*^9, 
   3.717843531266432*^9}, {3.7178435690324144`*^9, 3.7178440462088237`*^9}, {
   3.7178440864123306`*^9, 3.717844310758229*^9}, {3.717844343789793*^9, 
   3.7178443469773064`*^9}, {3.71784446932222*^9, 3.717844471869136*^9}, {
   3.7178445053850627`*^9, 3.7178445767451286`*^9}, {3.717844634386306*^9, 
   3.7178446350425572`*^9}, {3.717844696199394*^9, 3.717844711121393*^9}, 
   3.71784495749874*^9, {3.7178449986553764`*^9, 3.7178450483277225`*^9}, 
   3.717869651902047*^9, {3.7181236708608274`*^9, 3.7181236718295736`*^9}, {
   3.718124080849243*^9, 3.718124081458624*^9}, {3.718125432737604*^9, 
   3.7181254338938637`*^9}, {3.7181256217901497`*^9, 3.718125629852743*^9}, {
   3.7181257325099936`*^9, 3.7181257332756257`*^9}, {3.718141867163021*^9, 
   3.71814189653831*^9}, {3.7181419898361087`*^9, 3.718141991461125*^9}, {
   3.718142024914581*^9, 3.718142056477403*^9}, {3.718142147478307*^9, 
   3.718142227572831*^9}, {3.718142265120079*^9, 3.7181422672294736`*^9}, {
   3.71814361467265*^9, 3.718143706736057*^9}, {3.7181437691116753`*^9, 
   3.7181438171902733`*^9}, {3.7181440396725597`*^9, 3.71814409942315*^9}, {
   3.7181441675956993`*^9, 3.7181441986741314`*^9}, {3.7181442552372055`*^9, 
   3.7181443061908197`*^9}, {3.71814434823811*^9, 3.718144366597666*^9}, 
   3.718144398191728*^9, {3.7181444768331313`*^9, 3.7181444799894123`*^9}, {
   3.7181445614589663`*^9, 3.7181445933811593`*^9}, {3.718144959315639*^9, 
   3.7181449697376175`*^9}, {3.7181956553743153`*^9, 
   3.7181956564055758`*^9}, {3.718195708202963*^9, 3.7181957086717157`*^9}, {
   3.7181959214238353`*^9, 3.7181959217363234`*^9}, {3.7182002553878117`*^9, 
   3.7182003474668493`*^9}, {3.718200448920963*^9, 3.718200601328723*^9}, {
   3.718200772560587*^9, 3.7182008186860523`*^9}, {3.7182049300744205`*^9, 
   3.718204996559452*^9}, 3.71820515508539*^9, 3.718205196803382*^9, {
   3.718205316601455*^9, 3.718205340195424*^9}, {3.718205510931488*^9, 
   3.7182055413224134`*^9}, 3.718205729833356*^9, 3.7182057636774406`*^9, {
   3.718205834395361*^9, 3.718205834567239*^9}, {3.718205913099271*^9, 
   3.718205913411767*^9}, {3.718205944599575*^9, 3.718205996709467*^9}, {
   3.718206028147277*^9, 3.718206030069172*^9}, {3.718206079382159*^9, 
   3.718206083960329*^9}, {3.7182061290389004`*^9, 3.718206148804719*^9}, {
   3.718206184851951*^9, 3.71820628385293*^9}, {3.718206325415839*^9, 
   3.718206369635028*^9}, {3.718206480151745*^9, 3.7182065262928267`*^9}, {
   3.718206591184103*^9, 3.7182065921216*^9}, {3.718206661919178*^9, 
   3.718206725904174*^9}, {3.718207869674014*^9, 3.7182078797366033`*^9}, 
   3.7182082422164373`*^9, {3.718208284544995*^9, 3.7182082996701303`*^9}, {
   3.7182115165918465`*^9, 3.7182115169824758`*^9}, {3.718211559889149*^9, 
   3.7182115817956142`*^9}, {3.7182135411700907`*^9, 3.718213615686451*^9}, {
   3.7182137896725454`*^9, 3.7182138114696364`*^9}, {3.718213886314125*^9, 
   3.718213893751698*^9}, {3.7182139394552765`*^9, 3.7182139811744385`*^9}, {
   3.7182143645219746`*^9, 3.7182144434602566`*^9}, {3.7182144918826113`*^9, 
   3.7182146927752247`*^9}, {3.7182147245567846`*^9, 3.718214749963286*^9}, {
   3.718214862401908*^9, 3.7182148793708134`*^9}, {3.7182154625797033`*^9, 
   3.7182154774861016`*^9}, 3.71821605734778*^9, {3.7182162734592905`*^9, 
   3.718216312006547*^9}, {3.718218055039397*^9, 3.7182180585394335`*^9}, {
   3.718218262932078*^9, 3.7182182693071413`*^9}, {3.718461205923271*^9, 
   3.718461241095481*^9}, {3.718489440083251*^9, 3.718489446239542*^9}, {
   3.718490825176182*^9, 3.7184908499263997`*^9}, {3.7190195791044607`*^9, 
   3.719019579291963*^9}, {3.7190196162152214`*^9, 3.71901975015407*^9}, {
   3.7190197809668665`*^9, 3.719019787748184*^9}, {3.71901985106131*^9, 
   3.7190198650301895`*^9}, {3.7190199393121815`*^9, 3.719019983968873*^9}, 
   3.719062554580576*^9, {3.7398945485003543`*^9, 3.7398945523858995`*^9}, 
   3.7398950554831448`*^9, {3.7614982208694396`*^9, 3.7614982371807485`*^9}, {
   3.761498346469788*^9, 3.761498414386776*^9}, {3.761498445915757*^9, 
   3.7614984538370576`*^9}, {3.761501162475574*^9, 3.76150116963131*^9}, {
   3.7615012171477423`*^9, 3.7615012243815966`*^9}, {3.76150175020017*^9, 
   3.7615017739484625`*^9}, {3.7615019143914967`*^9, 
   3.7615019513888397`*^9}, {3.777431414962215*^9, 3.777431421325829*^9}, {
   3.777431512595517*^9, 3.77743151303082*^9}, {3.777431550670698*^9, 
   3.777431565196681*^9}, 
   3.777431655531617*^9},ExpressionUUID->"3e04e3ce-d0e4-4c4b-a549-\
6e8951b99ac6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Con", "[", 
     RowBox[{"expr_", ",", " ", "c_", ",", " ", "dc_", ",", " ", 
      RowBox[{"z_:", "z1"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"e", ",", " ", "a", ",", " ", "b"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"RBDExpandExpression", "[", "expr", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "try", " ", "to", " ", "figure", " ", "out", " ", "vars", " ", "to", 
          " ", "take", " ", "derivates", " ", 
          RowBox[{"w", "/"}]}], ",", " ", 
         RowBox[{"if", " ", "not", " ", "specified"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"a", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"VectorQ", "[", "c", "]"}], ",", " ", "c", ",", " ", 
          RowBox[{"SortBy", "[", 
           RowBox[{
            RowBox[{"DeleteDuplicates", "[", 
             RowBox[{"Cases", "[", 
              RowBox[{"e", ",", " ", "_c", ",", " ", 
               RowBox[{"{", 
                RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}], ",", " ", 
            "RBDGetIndex"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"TensorQ", "[", "dc", "]"}], ",", "dc", ",", " ", 
          RowBox[{"a", " ", "/.", " ", 
           RowBox[{"Thread", "[", 
            RowBox[{"c", " ", "\[Rule]", " ", "dc"}], "]"}]}]}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"a", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", "z", ",", " ", 
         RowBox[{
          RowBox[{"D", "[", 
           RowBox[{"e", ",", " ", 
            RowBox[{"{", "a", "}"}]}], "]"}], ".", "b"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"convert", " ", "from", " ", "string", " ", "to", " ", "number"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"StandardizeCon", "[", "expr_", "]"}], " ", ":=", " ", 
    RowBox[{"expr", " ", "/.", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"f_", "[", 
        RowBox[{"x_", ",", " ", "y_String"}], "]"}], " ", "/;", " ", 
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\[DoubleStruckQ]", ",", " ", "\[DoubleStruckV]", ",", " ", 
           "\[DoubleStruckA]"}], "}"}], ",", " ", "f"}], "]"}]}], " ", 
      "\[RuleDelayed]", " ", 
      RowBox[{"RBDGetDOF", "[", 
       RowBox[{"f", "[", 
        RowBox[{"x", ",", " ", "y"}], "]"}], "]"}]}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ValidCon", "::", "expr"}], " ", "=", " ", 
    "\"\<Ignoring constraint `2` in `1`.  The expression can only be a \
function of `3`.  Modify source expression.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ValidCon", "[", 
    RowBox[{"name_", ",", " ", "expr_", ",", " ", 
     RowBox[{"excl_:", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"Jexcl_:", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"h_:", 
      RowBox[{"{", 
       RowBox[{
       "\[DoubleStruckQ]", ",", " ", "\[DoubleStruckV]", ",", " ", 
        "\[DoubleStruckA]"}], "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"v", ",", " ", "J", ",", " ", "a"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"J", " ", "=", " ", "Jexcl"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"J", " ", "=!=", " ", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "is", " ", "constraint", " ", "linear", " ", "in", " ", "variables", 
          " ", "in", " ", 
          RowBox[{"Jexcl", "?", " ", "compute"}], " ", "Jacobian"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"v", " ", "=", " ", 
          RowBox[{"Alternatives", "@@", 
           RowBox[{"(", 
            RowBox[{"Blank", " ", "/@", " ", "J"}], ")"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"a", " ", "=", " ", 
          RowBox[{"Flatten", "@", 
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Cases", "[", 
             RowBox[{"expr", ",", " ", "v", ",", " ", 
              RowBox[{"{", 
               RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"a", " ", "===", " ", 
             RowBox[{"{", "}"}]}], ",", " ", "z1", ",", " ", 
            RowBox[{"D", "[", 
             RowBox[{"expr", ",", " ", 
              RowBox[{"{", "a", "}"}]}], "]"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"Alternatives", "@@", 
        RowBox[{"(", 
         RowBox[{"Blank", " ", "/@", " ", "excl"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"is", " ", "constraint", " ", 
        RowBox[{"valid", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"v", " ", "=", " ", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{"J", ",", " ", "v"}], "]"}], " ", "&&", " ", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"expr", ",", " ", "a"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"if", " ", "invalid"}], ",", " ", 
        RowBox[{"print", " ", "error", " ", "message"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", "v"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"J", " ", "=", " ", 
          RowBox[{
           RowBox[{"Switch", "[", 
            RowBox[{
             RowBox[{"Length", "@", "#"}], ",", " ", "0", ",", " ", 
             "\"\<\>\"", ",", " ", "1", ",", " ", 
             RowBox[{
             "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
              " ", "2", ",", " ", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              " ", "<>", " ", "\"\< and \>\"", " ", "<>", " ", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
             ",", " ", "3", ",", " ", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              " ", "<>", " ", "\"\<, \>\"", " ", "<>", " ", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              " ", "<>", " ", "\"\<, and \>\"", " ", "<>", " ", 
              RowBox[{
              "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}],
             "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"a", " ", "=", " ", 
          RowBox[{"J", "[", 
           RowBox[{"ToString", " ", "/@", " ", 
            RowBox[{"Complement", "[", 
             RowBox[{"h", ",", " ", "excl"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"J", "[", 
           RowBox[{"ToString", " ", "/@", " ", "Jexcl"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "@", "J"}], " ", ">", " ", "0"}], ",", 
           " ", 
           RowBox[{
            RowBox[{"a", " ", "=", " ", 
             RowBox[{
             "a", " ", "<>", " ", "\"\<; and must be linear in \>\"", " ", "<>",
               " ", "J"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"J", " ", "=", " ", 
          RowBox[{"ToString", "[", 
           RowBox[{"expr", ",", " ", "InputForm"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "@", "J"}], " ", ">", " ", "200"}], ",", 
           " ", 
           RowBox[{"J", " ", "=", " ", 
            RowBox[{
             RowBox[{"StringTake", "[", 
              RowBox[{"J", ",", " ", "200"}], "]"}], " ", "<>", " ", 
             "\"\<...\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"ValidCon", "::", "expr"}], ",", " ", "name", ",", " ", 
           "J", ",", " ", "a"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";",
       "\[IndentingNewLine]", "v"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717472149362713*^9, 3.7174721583159313`*^9}, {
   3.7174721977069592`*^9, 3.71747222511349*^9}, {3.717472271145213*^9, 
   3.7174724546002207`*^9}, {3.7174724853661623`*^9, 
   3.7174725734608154`*^9}, {3.717472642758419*^9, 3.717472658930459*^9}, {
   3.717472697180868*^9, 3.7174726981183615`*^9}, {3.7174727534157877`*^9, 
   3.7174728499480467`*^9}, {3.717472891745345*^9, 3.717472970230515*^9}, {
   3.7174730149965997`*^9, 3.717473030262396*^9}, {3.717473063700223*^9, 
   3.7174730640752273`*^9}, {3.717473163044992*^9, 3.7174732523896604`*^9}, {
   3.717473334093624*^9, 3.7174733536563253`*^9}, {3.717473696878597*^9, 
   3.717473716113169*^9}, {3.7174737930983334`*^9, 3.717473802317178*^9}, {
   3.717473913740198*^9, 3.7174739163496*^9}, {3.717474151492654*^9, 
   3.7174742357903767`*^9}, {3.7174743182287226`*^9, 3.717474375901202*^9}, {
   3.717474445730034*^9, 3.717474512886984*^9}, {3.717504276626111*^9, 
   3.7175043158765135`*^9}, {3.7175043561894274`*^9, 
   3.7175043828772025`*^9}, {3.7175045060815907`*^9, 3.717504541628831*^9}, {
   3.717504622114032*^9, 3.7175046224734087`*^9}, {3.7175046673176203`*^9, 
   3.71750467058328*^9}, 3.717505908322397*^9, {3.7175140832278*^9, 
   3.7175141010561*^9}, {3.717535710903341*^9, 3.7175357143877525`*^9}, {
   3.71753579715501*^9, 3.71753581420205*^9}, {3.717535855874362*^9, 
   3.717535881468365*^9}, {3.717535941640857*^9, 3.717535947594043*^9}, {
   3.7175359855944448`*^9, 3.717536058579558*^9}, {3.717536110033209*^9, 
   3.71753611300199*^9}, {3.717536189551571*^9, 3.717536335287441*^9}, {
   3.717536422417557*^9, 3.7175364778556256`*^9}, {3.717536794577626*^9, 
   3.7175367961245165`*^9}, {3.717536833187399*^9, 3.717536833624918*^9}, {
   3.7175369103600664`*^9, 3.7175369105475683`*^9}, {3.717537048627108*^9, 
   3.7175370951275845`*^9}, {3.7175372079725103`*^9, 3.7175374714126987`*^9}, 
   3.717543494397913*^9, {3.7175439569804244`*^9, 3.717544101841286*^9}, {
   3.7175441334509687`*^9, 3.7175441780451775`*^9}, {3.717544229217579*^9, 
   3.717544232576988*^9}, {3.717544400594336*^9, 3.7175444072506576`*^9}, {
   3.717544584768103*^9, 3.717544602893289*^9}, {3.7175447225507812`*^9, 
   3.7175448585521736`*^9}, {3.71754514528948*^9, 3.7175451501020308`*^9}, {
   3.7175452413529773`*^9, 3.7175452476967974`*^9}, {3.7175452811189985`*^9, 
   3.717545320619404*^9}, {3.7175453630885906`*^9, 3.717545370291805*^9}, {
   3.71754600084094*^9, 3.717546128342261*^9}, {3.7175462214057198`*^9, 
   3.717546306562826*^9}, {3.7175464796202755`*^9, 3.7175465066205645`*^9}, {
   3.7175467407635803`*^9, 3.717546767013854*^9}, {3.717547873978903*^9, 
   3.7175479129793024`*^9}, {3.7175479477921605`*^9, 
   3.7175479553078637`*^9}, {3.7175496707051916`*^9, 
   3.7175496900803814`*^9}, {3.717553100145957*^9, 3.7175531556934032`*^9}, {
   3.7175531887562413`*^9, 3.717553340539051*^9}, {3.71755337789882*^9, 
   3.717553485384288*^9}, {3.717553516337741*^9, 3.7175535410098643`*^9}, 
   3.7175535980885687`*^9, 3.717554038968094*^9, 3.7175542660016737`*^9, 
   3.7175545958019485`*^9, {3.717554847257656*^9, 3.7175550239625797`*^9}, {
   3.717555069916176*^9, 3.717555086885098*^9}, {3.717555136526245*^9, 
   3.7175551955268383`*^9}, {3.7175552957193103`*^9, 3.71755533221968*^9}, {
   3.717555365735649*^9, 3.7175554386270227`*^9}, {3.7175554870181313`*^9, 
   3.7175555056276984`*^9}, {3.717555809208938*^9, 3.717555851834386*^9}, {
   3.717556014054808*^9, 3.717556038945673*^9}, {3.717594733530661*^9, 
   3.7175947444838905`*^9}, {3.7175957033126717`*^9, 
   3.7175962951008596`*^9}, {3.717596329444932*^9, 3.71759633978878*^9}, {
   3.717596399758087*^9, 3.717596485290163*^9}, {3.7175965193842244`*^9, 
   3.7175966561355405`*^9}, {3.7175967560583477`*^9, 
   3.7175968462467084`*^9}, {3.717596921091169*^9, 3.7175969772479506`*^9}, {
   3.717597032060988*^9, 3.717597048561145*^9}, {3.7175971044522867`*^9, 
   3.7175971358744583`*^9}, {3.717597227890974*^9, 3.717597305547963*^9}, {
   3.7175973695173197`*^9, 3.7175973695954466`*^9}, {3.7175974234553328`*^9, 
   3.717597452783736*^9}, {3.717597488221558*^9, 3.7175975022685833`*^9}, {
   3.717597671098297*^9, 3.7175977492084117`*^9}, {3.7175978072558503`*^9, 
   3.71759781141214*^9}, {3.717598202728364*^9, 3.717598246322523*^9}, {
   3.7175982993230143`*^9, 3.717598310620014*^9}, {3.7176005406282597`*^9, 
   3.7176005474876833`*^9}, {3.7176005775817184`*^9, 
   3.7176005825817876`*^9}, {3.717600643957368*^9, 3.7176006726294994`*^9}, {
   3.7176008203965435`*^9, 3.7176008976472626`*^9}, {3.717600927835065*^9, 
   3.71760103724235*^9}, {3.71760999287236*^9, 3.7176099984505534`*^9}, {
   3.717610223035534*^9, 3.717610226379331*^9}, {3.717616968579345*^9, 
   3.717616972532509*^9}, {3.717617003064044*^9, 3.7176170284549*^9}, {
   3.7176170611271*^9, 3.717617079846024*^9}, {3.717617172456279*^9, 
   3.7176171759719424`*^9}, {3.717617220112982*^9, 3.7176172407538033`*^9}, {
   3.7176172739103684`*^9, 3.717617275035366*^9}, {3.7176174224292364`*^9, 
   3.7176174264917755`*^9}, {3.717617469242177*^9, 3.7176174751328473`*^9}, {
   3.717617587149534*^9, 3.7176176233373957`*^9}, {3.717617668306572*^9, 
   3.7176176865567293`*^9}, {3.717617723635219*^9, 3.7176177299165163`*^9}, {
   3.717617801620323*^9, 3.7176178201517663`*^9}, {3.717620757392192*^9, 
   3.7176208016894736`*^9}, {3.7176208985810175`*^9, 
   3.7176208991279097`*^9}, {3.717620955769061*^9, 3.717620958722226*^9}, {
   3.717621023394706*^9, 3.717621050785601*^9}, {3.7176211928338256`*^9, 
   3.7176211950994596`*^9}, {3.717621230990426*^9, 3.7176212323342056`*^9}, {
   3.7176212693657904`*^9, 3.717621356991624*^9}, {3.717621491961673*^9, 
   3.7176214937741737`*^9}, {3.717621534055806*^9, 3.7176215465403137`*^9}, {
   3.7176215899469624`*^9, 3.717621622244157*^9}, {3.71762165279131*^9, 
   3.7176216529631867`*^9}, {3.717622655691467*^9, 3.7176228190834703`*^9}, {
   3.7176228509118958`*^9, 3.7176228831153297`*^9}, {3.7176229436159*^9, 
   3.717623006225874*^9}, {3.7176230392261724`*^9, 3.7176231305239305`*^9}, {
   3.7176234812147465`*^9, 3.7176235929501963`*^9}, {3.7176236379662485`*^9, 
   3.717623673029072*^9}, {3.717623716388873*^9, 3.7176237308577557`*^9}, {
   3.7176238754216347`*^9, 3.7176239015156174`*^9}, {3.7176239419066243`*^9, 
   3.717623996063406*^9}, {3.717624029735597*^9, 3.7176240481732593`*^9}, {
   3.717624092720557*^9, 3.717624099079995*^9}, {3.717624268706605*^9, 
   3.71762430741011*^9}, {3.7176244055829077`*^9, 3.7176244121298556`*^9}, {
   3.717624567975087*^9, 3.7176245916003003`*^9}, {3.7176246859762125`*^9, 
   3.7176247099920607`*^9}, {3.71762474725803*^9, 3.7176248740873585`*^9}, {
   3.717624912806476*^9, 3.717624916165884*^9}, {3.71762499157285*^9, 
   3.7176250123230486`*^9}, {3.717625102011416*^9, 3.7176252103874297`*^9}, {
   3.7176252832006216`*^9, 3.717625330716714*^9}, {3.71762549329637*^9, 
   3.717625510296529*^9}, {3.7176270030976763`*^9, 3.7176270159415483`*^9}, {
   3.7176271070205555`*^9, 3.717627140067727*^9}, {3.7176271848337946`*^9, 
   3.7176273135381265`*^9}, {3.717628304172557*^9, 3.717628378329495*^9}, 
   3.7176284305175033`*^9, 3.717628479252329*^9, {3.71762859217529*^9, 
   3.7176286490976934`*^9}, {3.7176286824417768`*^9, 3.717628716863963*^9}, {
   3.7176288461464577`*^9, 3.7176288464901953`*^9}, {3.717628987304034*^9, 
   3.717628987444659*^9}, {3.717629020416864*^9, 3.7176291390586014`*^9}, {
   3.717629197293528*^9, 3.717629203402979*^9}, 3.717629268684845*^9, {
   3.717629327904146*^9, 3.7176294380614595`*^9}, {3.717629488796315*^9, 
   3.717629491936955*^9}, {3.7176295388905425`*^9, 3.71762956467202*^9}, {
   3.7176296190787888`*^9, 3.7176296349695644`*^9}, {3.717629776299048*^9, 
   3.7176297774240417`*^9}, {3.7176306930799055`*^9, 3.717630708142535*^9}, {
   3.717631139427885*^9, 3.7176311704281893`*^9}, {3.717634236082784*^9, 
   3.7176343142710123`*^9}, {3.717634424910694*^9, 3.7176344386295867`*^9}, 
   3.7176352586742907`*^9, {3.7176403886149616`*^9, 3.717640395708765*^9}, {
   3.717643808819336*^9, 3.717643831569539*^9}, {3.71764486720772*^9, 
   3.7176448811453657`*^9}, {3.71773784690654*^9, 3.717737848312792*^9}, {
   3.7181148610479136`*^9, 3.7181148691729918`*^9}, {3.7181237454709277`*^9, 
   3.7181237826119184`*^9}, {3.7181238211747994`*^9, 
   3.7181238407531185`*^9}, {3.7181238994099646`*^9, 3.7181239199414015`*^9}, 
   3.718123970910658*^9, {3.7181435129372683`*^9, 3.7181435331093416`*^9}, {
   3.719065849959985*^9, 3.71906588753848*^9}, {3.719065934960825*^9, 
   3.7190660215554314`*^9}, {3.719066325589699*^9, 3.7190663305897346`*^9}, {
   3.7190688882056446`*^9, 3.719068889658783*^9}, {3.7190692012087383`*^9, 
   3.719069270865688*^9}, {3.719069306491045*^9, 3.719069333100665*^9}, {
   3.719069461086323*^9, 3.7190695406183434`*^9}, {3.719069586306295*^9, 
   3.7190695944782495`*^9}, {3.719069647744402*^9, 3.719069715557583*^9}, {
   3.719069774261276*^9, 3.719069857777728*^9}, {3.719070079154915*^9, 
   3.7190701083583403`*^9}, {3.7190701390773935`*^9, 
   3.7190701470149727`*^9}, {3.7190701775308886`*^9, 
   3.7190702548441677`*^9}, {3.7190703008289814`*^9, 
   3.7190707423333445`*^9}, {3.719070785443145*^9, 3.719070845818743*^9}, {
   3.719070908334984*^9, 3.7190709470385046`*^9}, {3.719071001289028*^9, 
   3.7190710521489086`*^9}, {3.7190710966337204`*^9, 3.71907115225927*^9}, 
   3.7190711883533773`*^9, {3.719071238978879*^9, 3.719071275557372*^9}, {
   3.719071447309063*^9, 3.7190714537778764`*^9}, 3.719071563669586*^9, 
   3.7190717505308094`*^9, {3.7190717981719055`*^9, 3.7190718196721287`*^9}, 
   3.7190718656981087`*^9, {3.719071907917279*^9, 3.719071977636732*^9}, {
   3.7190720665594716`*^9, 3.719072075184557*^9}, {3.7190721507790666`*^9, 
   3.7190721525290694`*^9}, {3.7190970771776886`*^9, 3.719097079443337*^9}, {
   3.719097128115695*^9, 3.719097128303197*^9}, {3.7190973030549245`*^9, 
   3.7190973079612365`*^9}, 3.7190973479459915`*^9, {3.7425898607158365`*^9, 
   3.7425898670747375`*^9}, {3.7425900400571876`*^9, 3.74259005110326*^9}, {
   3.7425900904753156`*^9, 3.7425901461587152`*^9}, {3.742590223231125*^9, 
   3.742590292382233*^9}, 3.7425903644550314`*^9, {3.7425903959995527`*^9, 
   3.7425904037489805`*^9}},ExpressionUUID->"bc8c41a0-f4de-4ff1-b977-\
ced7e49b5986"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ConQ", ",", " ", "ConV", ",", " ", "ConA", ",", " ", "ConB"}], 
      "}"}], ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConQ", "[", 
     RowBox[{
     "name_", ",", " ", "expr_", ",", " ", "t_", ",", " ", "\[Phi]_", ",", 
      " ", "Kp_", ",", " ", "Kv_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "e", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"RBDExpandExpression", "[", "expr", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ValidCon", "[", 
          RowBox[{"name", ",", " ", "e", ",", " ", 
           RowBox[{"{", 
            RowBox[{"\[DoubleStruckV]", ",", " ", "\[DoubleStruckA]"}], 
            "}"}]}], "]"}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{"ConV", "[", 
          RowBox[{"name", ",", " ", 
           RowBox[{"Con", "[", 
            RowBox[{
            "e", ",", " ", "\[DoubleStruckQ]", ",", " ", "\[DoubleStruckV]"}],
             "]"}], ",", " ", "t", ",", " ", "\[Phi]", ",", " ", "Kp", ",", 
           " ", "Kv", ",", " ", "n", ",", " ", "e"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConV", "[", 
     RowBox[{
     "name_", ",", " ", "expr_", ",", " ", "t_", ",", " ", "\[Phi]_", ",", 
      " ", "Kp_", ",", " ", "Kv_", ",", " ", "n_", ",", " ", 
      RowBox[{"h_:", "z1"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"e", ",", " ", "Ja", ",", " ", "Jv"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"RBDExpandExpression", "[", "expr", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"ValidCon", "[", 
          RowBox[{"name", ",", " ", "e", ",", " ", 
           RowBox[{"{", "\[DoubleStruckA]", "}"}], ",", " ", 
           RowBox[{"{", "\[DoubleStruckV]", "}"}]}], "]"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"ConA", "[", 
          RowBox[{"name", ",", " ", 
           RowBox[{
            RowBox[{"Con", "[", 
             RowBox[{
             "e", ",", " ", "\[DoubleStruckV]", ",", " ", 
              "\[DoubleStruckA]"}], "]"}], " ", "+", " ", 
            RowBox[{"Con", "[", 
             RowBox[{
             "e", ",", " ", "\[DoubleStruckQ]", ",", " ", 
              "\[DoubleStruckV]"}], "]"}]}], ",", " ", "t", ",", " ", 
           "\[Phi]", ",", " ", "Kp", ",", " ", "Kv", ",", " ", "n", ",", " ", 
           "h", ",", " ", "e"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConA", "[", 
     RowBox[{
     "name_", ",", " ", "expr_", ",", " ", "t_", ",", " ", "\[Phi]bool_", ",",
       " ", "Kp_", ",", " ", "Kv_", ",", " ", "n_", ",", " ", 
      RowBox[{"h_:", "z1"}], ",", " ", 
      RowBox[{"hdot_:", "z1"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "e", ",", " ", "a", ",", " ", "J", ",", " ", "\[Phi]", ",", " ", "m", 
        ",", " ", "\[Eta]"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"compute", " ", "Jacobian"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"StandardizeCon", "@", 
         RowBox[{"RBDExpandExpression", "[", "expr", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "convert", " ", "to", " ", "numbered", " ", "indexing", " ", "if", 
          " ", "string"}], "-", 
         RowBox[{"based", " ", "indexing", " ", "is", " ", "used"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"a", " ", "=", " ", 
        RowBox[{"StandardizeCon", "@", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Cases", "[", 
           RowBox[{"e", ",", " ", "_\[DoubleStruckA]", ",", " ", 
            RowBox[{"{", 
             RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"J", " ", "=", " ", 
        RowBox[{"Con", "[", 
         RowBox[{"e", ",", " ", "a", ",", " ", 
          RowBox[{"D", "[", 
           RowBox[{"a", ",", " ", 
            RowBox[{"{", 
             RowBox[{"RBDGetValue", "[", 
              RowBox[{
               RowBox[{"nx", "+", "1"}], ",", " ", 
               RowBox[{"3", "nq"}], ",", " ", 
               RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "False"}]}], "]"}], 
             "}"}]}], "]"}], ",", " ", "zq"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Eta]", " ", "=", " ", 
        RowBox[{"RBDExpandExpression", "[", 
         RowBox[{"{", 
          RowBox[{"h", ",", " ", "hdot"}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "is", " ", "expr", " ", "linear", " ", "in", " ", "\[DoubleStruckA]", 
         " ", "with", " ", "\[Eta]", " ", "only", " ", "a", " ", "function", 
         " ", "of", " ", "\[DoubleStruckQ]", " ", "and", " ", 
         RowBox[{"\[DoubleStruckV]", "?"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{
         RowBox[{"ValidCon", "[", 
          RowBox[{"name", ",", " ", "J", ",", " ", 
           RowBox[{"{", "\[DoubleStruckA]", "}"}]}], "]"}], " ", "&&", " ", 
         RowBox[{"ValidCon", "[", 
          RowBox[{"name", ",", " ", 
           RowBox[{
           "\[Eta]", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"\[DoubleStruckV]", ",", " ", "\[DoubleStruckA]"}], 
            "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"m", " ", "&&", " ", 
         RowBox[{"ValidCon", "[", 
          RowBox[{"name", ",", " ", 
           RowBox[{
           "\[Eta]", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{"{", "\[DoubleStruckA]", "}"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"m", ",", " ", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"compute", " ", 
           RowBox[{"\[Phi]", "[", 
            RowBox[{"q", ",", " ", "v"}], "]"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\[Phi]", " ", "=", " ", 
           RowBox[{"RBDExpandExpression", "@", 
            RowBox[{"If", "[", 
             RowBox[{"\[Phi]bool", ",", " ", 
              RowBox[{"e", " ", "/.", " ", 
               RowBox[{"Thread", "[", 
                RowBox[{"a", " ", "\[Rule]", " ", "0"}], "]"}]}], ",", " ", 
              "z1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"AddCon", "[", 
           RowBox[{"name", ",", " ", "t", ",", " ", "n", ",", " ", 
            RowBox[{"\"\<J\>\"", " ", "\[Rule]", " ", "J"}], ",", " ", 
            RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "\[Phi]"}], ",", 
            " ", 
            RowBox[{"\"\<\[Eta]\>\"", " ", "\[Rule]", " ", "\[Eta]"}], ",", 
            " ", 
            RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"Kp", ",", " ", "Kv"}], "}"}]}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConB", "[", 
     RowBox[{"name_", ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"Derivative", "[", "1", "]"}], "[", "\[DoubleStruckB]", "]"}],
        "[", "x__", "]"}], ",", " ", "t_", ",", " ", "rdot_", ",", "  ", 
      "Kp_", ",", " ", "Kv_", ",", " ", "n_", ",", " ", 
      RowBox[{"v_:", "1"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"ConB", "[", 
     RowBox[{"name", ",", " ", 
      RowBox[{"\[DoubleStruckB]", "[", "x", "]"}], ",", " ", "t", ",", " ", 
      "rdot", ",", "  ", "Kp", ",", " ", "Kv", ",", " ", "n", ",", " ", "v"}],
      "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConB", "[", 
    RowBox[{
    "name_", ",", " ", "expr_\[DoubleStruckB]", ",", " ", "t_", ",", " ", 
     "rdot_", ",", " ", "Kp_", ",", " ", "Kv_", ",", " ", "n_", ",", " ", 
     RowBox[{"v_:", "0"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"b", ",", " ", "r", ",", " ", "Xcb", ",", " ", "o"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"b", ",", " ", "r", ",", " ", "Xcb", ",", " ", "o"}], "}"}], 
       " ", "=", " ", 
       RowBox[{"expr", " ", "/.", " ", 
        RowBox[{
         RowBox[{"\[DoubleStruckB]", "[", 
          RowBox[{"b_", ",", " ", "r_", ",", " ", "Xcb_", ",", " ", "o___"}], 
          "]"}], " ", "\[RuleDelayed]", " ", 
         RowBox[{"{", 
          RowBox[{"b", ",", " ", "r", ",", " ", "Xcb", ",", " ", 
           RowBox[{"{", "o", "}"}]}], "}"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{"OptionValue", "[", 
        RowBox[{"\[DoubleStruckB]", ",", " ", "o", ",", " ", 
         RowBox[{"{", 
          RowBox[{"\"\<a\>\"", ",", " ", "\"\<o\>\""}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"RBDGetPositionIndex", "@", 
        RowBox[{"Prepend", "[", 
         RowBox[{"o", ",", " ", "b"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"Append", "[", 
        RowBox[{"b", ",", " ", "v"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IntegerQ", "[", "r", "]"}], ",", " ", 
         RowBox[{
          RowBox[{"Sign", "[", "r", "]"}], 
          RowBox[{"I6", "\[LeftDoubleBracket]", 
           RowBox[{"Abs", "@", "r"}], "\[RightDoubleBracket]"}]}], ",", " ", 
         "r"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Xcb", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"VectorQ", "[", "Xcb", "]"}], ",", " ", 
         RowBox[{"Xba", "[", 
          RowBox[{"PadLeft", "[", 
           RowBox[{"Xcb", ",", " ", "nm"}], "]"}], "]"}], ",", " ", "Xcb"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"RBDExpandExpression", "[", "r", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Xcb", " ", "=", " ", 
       RowBox[{"RBDExpandExpression", "[", "Xcb", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AddCon", "[", 
       RowBox[{"name", ",", " ", "t", ",", " ", "n", ",", " ", 
        RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", "b"}], ",", " ", 
        RowBox[{"\"\<r\>\"", " ", "\[Rule]", " ", "r"}], ",", " ", 
        RowBox[{"\"\<X\>\"", " ", "\[Rule]", " ", "Xcb"}], ",", " ", 
        RowBox[{"\"\<rdot\>\"", " ", "\[Rule]", " ", "rdot"}], ",", " ", 
        RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"Kp", ",", " ", "Kv"}], "}"}]}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717472149362713*^9, 3.7174721583159313`*^9}, {
   3.7174721977069592`*^9, 3.71747222511349*^9}, {3.717472271145213*^9, 
   3.7174724546002207`*^9}, {3.7174724853661623`*^9, 
   3.7174725734608154`*^9}, {3.717472642758419*^9, 3.717472658930459*^9}, {
   3.717472697180868*^9, 3.7174726981183615`*^9}, {3.7174727534157877`*^9, 
   3.7174728499480467`*^9}, {3.717472891745345*^9, 3.717472970230515*^9}, {
   3.7174730149965997`*^9, 3.717473030262396*^9}, {3.717473063700223*^9, 
   3.7174730640752273`*^9}, {3.717473163044992*^9, 3.7174732523896604`*^9}, {
   3.717473334093624*^9, 3.7174733536563253`*^9}, {3.717473696878597*^9, 
   3.717473716113169*^9}, {3.7174737930983334`*^9, 3.717473802317178*^9}, {
   3.717473913740198*^9, 3.7174739163496*^9}, {3.717474151492654*^9, 
   3.7174742357903767`*^9}, {3.7174743182287226`*^9, 3.717474375901202*^9}, {
   3.717474445730034*^9, 3.717474512886984*^9}, {3.717504276626111*^9, 
   3.7175043158765135`*^9}, {3.7175043561894274`*^9, 
   3.7175043828772025`*^9}, {3.7175045060815907`*^9, 3.717504541628831*^9}, {
   3.717504622114032*^9, 3.7175046224734087`*^9}, {3.7175046673176203`*^9, 
   3.71750467058328*^9}, 3.717505908322397*^9, {3.7175140832278*^9, 
   3.7175141010561*^9}, {3.717535710903341*^9, 3.7175357143877525`*^9}, {
   3.71753579715501*^9, 3.71753581420205*^9}, {3.717535855874362*^9, 
   3.717535881468365*^9}, {3.717535941640857*^9, 3.717535947594043*^9}, {
   3.7175359855944448`*^9, 3.717536058579558*^9}, {3.717536110033209*^9, 
   3.71753611300199*^9}, {3.717536189551571*^9, 3.717536335287441*^9}, {
   3.717536422417557*^9, 3.7175364778556256`*^9}, {3.717536794577626*^9, 
   3.7175367961245165`*^9}, {3.717536833187399*^9, 3.717536833624918*^9}, {
   3.7175369103600664`*^9, 3.7175369105475683`*^9}, {3.717537048627108*^9, 
   3.7175370951275845`*^9}, {3.7175372079725103`*^9, 3.7175374714126987`*^9}, 
   3.717543494397913*^9, {3.7175439569804244`*^9, 3.717544101841286*^9}, {
   3.7175441334509687`*^9, 3.7175441780451775`*^9}, {3.717544229217579*^9, 
   3.717544232576988*^9}, {3.717544400594336*^9, 3.7175444072506576`*^9}, {
   3.717544584768103*^9, 3.717544602893289*^9}, {3.7175447225507812`*^9, 
   3.7175448585521736`*^9}, {3.71754514528948*^9, 3.7175451501020308`*^9}, {
   3.7175452413529773`*^9, 3.7175452476967974`*^9}, {3.7175452811189985`*^9, 
   3.717545320619404*^9}, {3.7175453630885906`*^9, 3.717545370291805*^9}, {
   3.71754600084094*^9, 3.717546128342261*^9}, {3.7175462214057198`*^9, 
   3.717546306562826*^9}, {3.7175464796202755`*^9, 3.7175465066205645`*^9}, {
   3.7175467407635803`*^9, 3.717546767013854*^9}, {3.717547873978903*^9, 
   3.7175479129793024`*^9}, {3.7175479477921605`*^9, 
   3.7175479553078637`*^9}, {3.7175496707051916`*^9, 
   3.7175496900803814`*^9}, {3.717553100145957*^9, 3.7175531556934032`*^9}, {
   3.7175531887562413`*^9, 3.717553340539051*^9}, {3.71755337789882*^9, 
   3.717553485384288*^9}, {3.717553516337741*^9, 3.7175535410098643`*^9}, 
   3.7175535980885687`*^9, 3.717554038968094*^9, 3.7175542660016737`*^9, 
   3.7175545958019485`*^9, {3.717554847257656*^9, 3.7175550239625797`*^9}, {
   3.717555069916176*^9, 3.717555086885098*^9}, {3.717555136526245*^9, 
   3.7175551955268383`*^9}, {3.7175552957193103`*^9, 3.71755533221968*^9}, {
   3.717555365735649*^9, 3.7175554386270227`*^9}, {3.7175554870181313`*^9, 
   3.7175555056276984`*^9}, {3.717555809208938*^9, 3.717555851834386*^9}, {
   3.717556014054808*^9, 3.717556038945673*^9}, {3.717594733530661*^9, 
   3.7175947444838905`*^9}, {3.7175957033126717`*^9, 
   3.7175962951008596`*^9}, {3.717596329444932*^9, 3.71759633978878*^9}, {
   3.717596399758087*^9, 3.717596485290163*^9}, {3.7175965193842244`*^9, 
   3.7175966561355405`*^9}, {3.7175967560583477`*^9, 
   3.7175968462467084`*^9}, {3.717596921091169*^9, 3.7175969772479506`*^9}, {
   3.717597032060988*^9, 3.717597048561145*^9}, {3.7175971044522867`*^9, 
   3.7175971358744583`*^9}, {3.717597227890974*^9, 3.717597305547963*^9}, {
   3.7175973695173197`*^9, 3.7175973695954466`*^9}, {3.7175974234553328`*^9, 
   3.717597452783736*^9}, {3.717597488221558*^9, 3.7175975022685833`*^9}, {
   3.717597671098297*^9, 3.7175977492084117`*^9}, {3.7175978072558503`*^9, 
   3.71759781141214*^9}, {3.717598202728364*^9, 3.717598246322523*^9}, {
   3.7175982993230143`*^9, 3.717598310620014*^9}, {3.7176005406282597`*^9, 
   3.7176005474876833`*^9}, {3.7176005775817184`*^9, 
   3.7176005825817876`*^9}, {3.717600643957368*^9, 3.7176006726294994`*^9}, {
   3.7176008203965435`*^9, 3.7176008976472626`*^9}, {3.717600927835065*^9, 
   3.71760103724235*^9}, {3.71760999287236*^9, 3.7176099984505534`*^9}, {
   3.717610223035534*^9, 3.717610226379331*^9}, {3.717616968579345*^9, 
   3.717616972532509*^9}, {3.717617003064044*^9, 3.7176170284549*^9}, {
   3.7176170611271*^9, 3.717617079846024*^9}, {3.717617172456279*^9, 
   3.7176171759719424`*^9}, {3.717617220112982*^9, 3.7176172407538033`*^9}, {
   3.7176172739103684`*^9, 3.717617275035366*^9}, {3.7176174224292364`*^9, 
   3.7176174264917755`*^9}, {3.717617469242177*^9, 3.7176174751328473`*^9}, {
   3.717617587149534*^9, 3.7176176233373957`*^9}, {3.717617668306572*^9, 
   3.7176176865567293`*^9}, {3.717617723635219*^9, 3.7176177299165163`*^9}, {
   3.717617801620323*^9, 3.7176178201517663`*^9}, {3.717620757392192*^9, 
   3.7176208016894736`*^9}, {3.7176208985810175`*^9, 
   3.7176208991279097`*^9}, {3.717620955769061*^9, 3.717620958722226*^9}, {
   3.717621023394706*^9, 3.717621050785601*^9}, {3.7176211928338256`*^9, 
   3.7176211950994596`*^9}, {3.717621230990426*^9, 3.7176212323342056`*^9}, {
   3.7176212693657904`*^9, 3.717621356991624*^9}, {3.717621491961673*^9, 
   3.7176214937741737`*^9}, {3.717621534055806*^9, 3.7176215465403137`*^9}, {
   3.7176215899469624`*^9, 3.717621622244157*^9}, {3.71762165279131*^9, 
   3.7176216529631867`*^9}, {3.717622655691467*^9, 3.7176228190834703`*^9}, {
   3.7176228509118958`*^9, 3.7176228831153297`*^9}, {3.7176229436159*^9, 
   3.717623006225874*^9}, {3.7176230392261724`*^9, 3.7176231305239305`*^9}, {
   3.7176234812147465`*^9, 3.7176235929501963`*^9}, {3.7176236379662485`*^9, 
   3.717623673029072*^9}, {3.717623716388873*^9, 3.7176237308577557`*^9}, {
   3.7176238754216347`*^9, 3.7176239015156174`*^9}, {3.7176239419066243`*^9, 
   3.717623996063406*^9}, {3.717624029735597*^9, 3.7176240481732593`*^9}, {
   3.717624092720557*^9, 3.717624099079995*^9}, {3.717624268706605*^9, 
   3.71762430741011*^9}, {3.7176244055829077`*^9, 3.7176244121298556`*^9}, {
   3.717624567975087*^9, 3.7176245916003003`*^9}, {3.7176246859762125`*^9, 
   3.7176247099920607`*^9}, {3.71762474725803*^9, 3.7176248740873585`*^9}, {
   3.717624912806476*^9, 3.717624916165884*^9}, {3.71762499157285*^9, 
   3.7176250123230486`*^9}, {3.717625102011416*^9, 3.7176252103874297`*^9}, {
   3.7176252832006216`*^9, 3.717625330716714*^9}, {3.71762549329637*^9, 
   3.717625510296529*^9}, {3.7176270030976763`*^9, 3.7176270159415483`*^9}, {
   3.7176271070205555`*^9, 3.717627140067727*^9}, {3.7176271848337946`*^9, 
   3.7176273135381265`*^9}, {3.717628304172557*^9, 3.717628378329495*^9}, 
   3.7176284305175033`*^9, 3.717628479252329*^9, {3.71762859217529*^9, 
   3.7176286490976934`*^9}, {3.7176286824417768`*^9, 3.717628716863963*^9}, {
   3.7176288461464577`*^9, 3.7176288464901953`*^9}, {3.717628987304034*^9, 
   3.717628987444659*^9}, {3.717629020416864*^9, 3.7176291390586014`*^9}, {
   3.717629197293528*^9, 3.717629203402979*^9}, 3.717629268684845*^9, {
   3.717629327904146*^9, 3.7176294380614595`*^9}, {3.717629488796315*^9, 
   3.717629491936955*^9}, {3.7176295388905425`*^9, 3.71762956467202*^9}, {
   3.7176296190787888`*^9, 3.7176296349695644`*^9}, {3.717629776299048*^9, 
   3.7176297774240417`*^9}, {3.7176306930799055`*^9, 3.717630708142535*^9}, {
   3.717631139427885*^9, 3.7176311704281893`*^9}, {3.717634236082784*^9, 
   3.7176343142710123`*^9}, {3.717634424910694*^9, 3.7176344386295867`*^9}, 
   3.7176352586742907`*^9, {3.7176403886149616`*^9, 3.717640395708765*^9}, {
   3.717643808819336*^9, 3.717643831569539*^9}, {3.71764486720772*^9, 
   3.7176448811453657`*^9}, {3.71773784690654*^9, 3.717737848312792*^9}, {
   3.7181148610479136`*^9, 3.7181148691729918`*^9}, {3.7181237454709277`*^9, 
   3.7181237826119184`*^9}, {3.7181238211747994`*^9, 
   3.7181238407531185`*^9}, {3.7181238994099646`*^9, 3.7181239199414015`*^9}, 
   3.718123970910658*^9, {3.7181423046986113`*^9, 3.7181425406540527`*^9}, {
   3.718142816323112*^9, 3.7181428639017076`*^9}, {3.7181428960270395`*^9, 
   3.718142905448991*^9}, {3.7181432450283813`*^9, 3.718143294606985*^9}, {
   3.7181440246411595`*^9, 3.7181440248755507`*^9}, {3.7181974472556314`*^9, 
   3.7181974689746065`*^9}, {3.7181979621620197`*^9, 
   3.7181980469284725`*^9}, {3.7181980890695133`*^9, 
   3.7181983817911563`*^9}, {3.718198544230262*^9, 3.718198578746228*^9}, {
   3.7181990276412897`*^9, 3.718199052266548*^9}, {3.7181990917044234`*^9, 
   3.718199097485747*^9}, {3.7181995255837264`*^9, 3.7181995275681224`*^9}, {
   3.718199905571843*^9, 3.718199949556662*^9}, {3.718200008260355*^9, 
   3.7182000169948163`*^9}, {3.718200056354583*^9, 3.7182000597296305`*^9}, {
   3.7182001259802704`*^9, 3.7182002074185743`*^9}, {3.7182086402672462`*^9, 
   3.7182086782988725`*^9}, {3.7182091911164503`*^9, 3.718209191632077*^9}, {
   3.718209556166923*^9, 3.718209556745053*^9}, {3.718221858118987*^9, 
   3.7182218796504555`*^9}, {3.7182219152445498`*^9, 3.718221935807254*^9}, {
   3.71845552910925*^9, 3.718455634860238*^9}, {3.7184557017358904`*^9, 
   3.718455739033105*^9}, {3.7184604637755933`*^9, 3.718460472197548*^9}, {
   3.718467570287654*^9, 3.71846758653781*^9}, {3.718483962603753*^9, 
   3.718483988103979*^9}, {3.718484027073098*^9, 3.718484027479353*^9}, {
   3.718485401868232*^9, 3.718485416587122*^9}, {3.718485522572506*^9, 
   3.718485523603776*^9}, {3.71848585309127*^9, 3.7184858603257284`*^9}, {
   3.7184858958260508`*^9, 3.71848593731082*^9}, {3.7184859937176065`*^9, 
   3.718486124671976*^9}, {3.7184881297848587`*^9, 3.718488150831934*^9}, {
   3.7184881832541027`*^9, 3.718488203879308*^9}, {3.7184882449578133`*^9, 
   3.718488263317379*^9}, 3.7184883115209455`*^9, {3.7184884175219646`*^9, 
   3.718488455772318*^9}, {3.718488503085267*^9, 3.7184885201791773`*^9}, {
   3.718488559663928*^9, 3.718488653149191*^9}, {3.718488697852743*^9, 
   3.718488722227974*^9}, {3.718488767165902*^9, 3.7184887993849726`*^9}, {
   3.7184888835888815`*^9, 3.7184888854951515`*^9}, {3.7184889581567783`*^9, 
   3.7184889606724277`*^9}, {3.7184890254855604`*^9, 3.718489080392317*^9}, {
   3.7184891239864807`*^9, 3.718489130736557*^9}, {3.718489167596285*^9, 
   3.7184891719713125`*^9}, {3.7189846514083915`*^9, 
   3.7189846633928843`*^9}, {3.7189847193153114`*^9, 3.718984719862193*^9}, {
   3.7189968331479487`*^9, 3.718996856898183*^9}, {3.718996912711235*^9, 
   3.7189969575085535`*^9}, {3.7189971014162245`*^9, 3.718997102056856*^9}, {
   3.719008751636114*^9, 3.7190087516829915`*^9}, {3.7190132035737405`*^9, 
   3.719013203870618*^9}, {3.7190180761087008`*^9, 3.7190181018745794`*^9}, {
   3.7190189327855883`*^9, 3.7190189906767855`*^9}, {3.719019068568165*^9, 
   3.719019083037074*^9}, {3.719019194678807*^9, 3.7190191995382247`*^9}, {
   3.719019259007547*^9, 3.719019274195212*^9}, {3.7190193401958647`*^9, 
   3.719019382055638*^9}, {3.7190200761572866`*^9, 3.7190201437048273`*^9}, {
   3.7190202387370167`*^9, 3.7190202396745253`*^9}, {3.719020333800455*^9, 
   3.7190203665820293`*^9}, {3.719020454754777*^9, 3.719020462082959*^9}, {
   3.719062045653654*^9, 3.7190620653257246`*^9}, {3.7190628745212345`*^9, 
   3.7190629759597263`*^9}, {3.719063266071967*^9, 3.719063316244337*^9}, {
   3.7190633539947124`*^9, 3.719063416026573*^9}, {3.719063451792553*^9, 
   3.719063453058202*^9}, {3.7190635773719206`*^9, 3.7190636292786818`*^9}, {
   3.719063671404114*^9, 3.719063731498454*^9}, {3.719064028767005*^9, 
   3.719064107908414*^9}, {3.719064190877982*^9, 3.7190641910342455`*^9}, {
   3.719064296019659*^9, 3.719064314504221*^9}, {3.7190643502233067`*^9, 
   3.7190644015207047`*^9}, {3.7190645028654537`*^9, 3.719064504146703*^9}, {
   3.71906458258498*^9, 3.719064750120989*^9}, {3.7190647982308397`*^9, 
   3.7190648283873878`*^9}, {3.7190649219977045`*^9, 
   3.7190649612637177`*^9}, {3.7190649987640715`*^9, 
   3.7190650301237564`*^9}, {3.719065081561767*^9, 3.7190650936400223`*^9}, {
   3.7190651341560373`*^9, 3.719065181031497*^9}, {3.719065286313805*^9, 
   3.719065340408086*^9}, 3.7190654484716406`*^9, {3.7190656187701993`*^9, 
   3.719065622285859*^9}, {3.719065784990594*^9, 3.719065798600102*^9}, 
   3.719066207838522*^9, {3.7190663511368265`*^9, 3.7190663553399925`*^9}, {
   3.71906665121484*^9, 3.7190668101226606`*^9}, {3.7190668480605354`*^9, 
   3.719066848326163*^9}, {3.719066913248678*^9, 3.719066984561895*^9}, {
   3.719067031952978*^9, 3.7190671548292027`*^9}, {3.7190671849701138`*^9, 
   3.7190673593155875`*^9}, {3.7190674045347843`*^9, 3.719067489332509*^9}, {
   3.7190675653801394`*^9, 3.7190676538653727`*^9}, {3.7190676847406774`*^9, 
   3.719067728600499*^9}, {3.7190677852572985`*^9, 3.71906779860118*^9}, {
   3.719067830398368*^9, 3.7190678308358727`*^9}, {3.719067863164316*^9, 
   3.719067944383871*^9}, {3.719068017431468*^9, 3.719068026665934*^9}, {
   3.719068235342207*^9, 3.719068277108246*^9}, {3.7190683281399984`*^9, 
   3.719068345546422*^9}, 3.71906844146926*^9, {3.719068478750863*^9, 
   3.7190684868134575`*^9}, {3.7190685223450546`*^9, 
   3.7190685270638385`*^9}, {3.7190685840956554`*^9, 3.719068628111729*^9}, {
   3.719068664096444*^9, 3.7190686861435385`*^9}, {3.7190688608928747`*^9, 
   3.719068870846099*^9}, {3.7190689024401608`*^9, 3.7190689124558954`*^9}, {
   3.719068969362695*^9, 3.719068974597122*^9}, {3.719069801120929*^9, 
   3.719069801855299*^9}, {3.7190698862311487`*^9, 3.7190698904030495`*^9}, {
   3.7190699227315063`*^9, 3.719069934981632*^9}, {3.7190699820133305`*^9, 
   3.7190700251231427`*^9}, {3.719071649420437*^9, 3.7190716674049873`*^9}, {
   3.719072206295226*^9, 3.719072210904648*^9}, {3.7190722612332706`*^9, 
   3.719072291421068*^9}, {3.7190723320933466`*^9, 3.7190723686878214`*^9}, {
   3.7190724663919115`*^9, 3.7190724869390025`*^9}, {3.71907388990598*^9, 
   3.7190738949841733`*^9}, {3.7190971392876782`*^9, 3.71909722653854*^9}, {
   3.719110145059924*^9, 3.7191101663650417`*^9}, {3.719110330319776*^9, 
   3.7191103308666553`*^9}, 3.719110452978269*^9, {3.7191106399801188`*^9, 
   3.719110647105191*^9}, {3.730653022838426*^9, 3.7306530268384657`*^9}, {
   3.742577773244915*^9, 3.7425778042269936`*^9}, {3.7425778562230935`*^9, 
   3.7425778907830763`*^9}, {3.7425784053913493`*^9, 3.7425784470913663`*^9}, 
   3.74257851489884*^9, {3.742578626218709*^9, 3.742578643170581*^9}, {
   3.742578720649212*^9, 3.7425787224459543`*^9}, {3.7425787645209427`*^9, 
   3.742578797940357*^9}, {3.742589154193714*^9, 3.7425891629430704`*^9}, {
   3.7425892152587414`*^9, 3.7425892167742996`*^9}, {3.742590415544978*^9, 
   3.7425904342779636`*^9}, {3.7425905123971567`*^9, 3.742590542129344*^9}, {
   3.7615035890232296`*^9, 3.7615036459879026`*^9}, {3.761503712295621*^9, 
   3.761503729341288*^9}, {3.7615037599015865`*^9, 3.7615037912899623`*^9}, {
   3.7615038252562685`*^9, 
   3.7615038257562356`*^9}},ExpressionUUID->"002d863b-3d90-462a-b516-\
5ae22d725596"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "AddCon", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<J\>\"", " ", "\[RuleDelayed]", " ", "zq"}], ",", " ", 
      RowBox[{"\"\<\[Phi]\>\"", " ", "\[Rule]", " ", "z1"}], ",", " ", 
      RowBox[{"\"\<b\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<r\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<X\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<rdot\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<\[Eta]\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"z1", ",", " ", "z1"}], "}"}]}], ",", " ", 
      RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"z1", ",", " ", "z1"}], "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddCon", "::", "t"}], " ", "=", " ", 
    "\"\<A constraint in `1` corresponding to row `2` in J is not of type \
`3`.  It has type `4`.  Row `2` in J will stay type `3`.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddCon", "::", "K"}], " ", "=", " ", 
    "\"\<Encountered different gain values, (Kp, Kv) = `4`, in constraint `1` \
corresponding to row `2` in \[Eta].  The gains will remain (Kp, Kv) = \
`3`.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AddCon", "[", 
    RowBox[{"name_", ",", " ", "t_", ",", " ", "n_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "m", ",", " ", "J", ",", " ", "\[Phi]", ",", " ", "\[Eta]", ",", " ", 
       "J\[Phi]\[Eta]", ",", " ", "b", ",", " ", "r", ",", " ", "X", ",", " ",
        "rdot", ",", " ", "brX", ",", " ", "K"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"J\[Phi]\[Eta]", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "\"\<J\>\"", ",", " ", "\"\<\[Phi]\>\"", ",", " ", "\"\<\[Eta]\>\""}],
         "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"J", ",", " ", "\[Phi]", ",", "\[Eta]"}], "}"}], " ", "=", 
       " ", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "#", "]"}], "&"}], " ", "/@", " ", 
        "J\[Phi]\[Eta]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"J\[Phi]\[Eta]", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"J\[Phi]\[Eta]", ",", " ", 
         RowBox[{"{", 
          RowBox[{"J", ",", " ", "\[Phi]", ",", " ", "\[Eta]"}], "}"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"brX", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
        "\"\<b\>\"", ",", " ", "\"\<r\>\"", ",", " ", "\"\<X\>\"", ",", " ", 
         "\"\<rdot\>\""}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}], " ", "===", " ", 
         RowBox[{"{", "}"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"b", ",", " ", "r", ",", " ", "X", ",", " ", "rdot"}], 
           "}"}], " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}], ",", " ", 
            RowBox[{"{", "}"}]}], "}"}]}], ";"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"b", ",", " ", "r", ",", " ", "X", ",", " ", "rdot"}], 
           "}"}], " ", "=", "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"OptionValue", "[", "#", "]"}], "}"}], "&"}], " ", "/@", 
           " ", "brX"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"brX", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"brX", ",", " ", 
         RowBox[{"{", 
          RowBox[{"b", ",", " ", "r", ",", " ", "X", ",", " ", "rdot"}], 
          "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"K", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<K\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"add", "/", "update"}], " ", "constraint", " ", "entry"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"MissingQ", "[", 
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<n\>\"", ",", " ", "n"}], "]"}], 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "append", " ", "to", " ", "old", " ", "constraint", " ", "entry"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"m", " ", "=", " ", 
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<n\>\"", ",", " ", "n"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"rb", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"Key", "@", "C"}], ",", " ", "#1", ",", " ", "m"}], 
                "\[RightDoubleBracket]"}], " ", "+=", " ", "#2"}], ";"}], 
             ")"}], "&"}], ",", " ", "J\[Phi]\[Eta]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"rb", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"Key", "@", "C"}], ",", " ", "#1", ",", " ", "m"}], 
                "\[RightDoubleBracket]"}], " ", "=", " ", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"rb", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{"Key", "@", "C"}], ",", " ", "#1", ",", " ", "m"}],
                   "\[RightDoubleBracket]"}], ",", " ", "#2"}], "]"}]}], 
              ";"}], ")"}], "&"}], ",", " ", "brX"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"are", " ", "constraints", " ", "the", " ", "same", " ", 
           RowBox[{"type", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"b", " ", "=", " ", 
          RowBox[{"rb", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"Key", "@", "C"}], ",", " ", "\"\<t\>\"", ",", " ", "m"}],
            "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"b", " ", "\[NotEqual]", " ", "t"}], ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"AddCon", "::", "t"}], ",", " ", "name", ",", " ", "m", 
             ",", " ", "b", ",", " ", "t"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"are", " ", "gains", " ", "the", " ", 
           RowBox[{"same", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"b", " ", "=", " ", 
          RowBox[{"rb", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"Key", "@", "C"}], ",", " ", "\"\<K\>\"", ",", " ", "m"}],
            "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"b", " ", "=!=", " ", "K"}], ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"AddCon", "::", "K"}], ",", " ", "name", ",", " ", "m", 
             ",", " ", "b", ",", " ", "K"}], "]"}]}], "]"}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"!", 
         RowBox[{"MissingQ", "[", 
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<n\>\""}], "]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "new", " ", "entry", " ", "to", " ", "constraint"}], " ",
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"rb", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"Key", "@", "C"}], ",", " ", "#1"}], 
                "\[RightDoubleBracket]"}], " ", "=", " ", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"rb", "[", 
                  RowBox[{"C", ",", " ", "#1"}], "]"}], ",", " ", 
                 RowBox[{"{", "#2", "}"}]}], "]"}]}], ";"}], ")"}], "&"}], 
           ",", " ", "J\[Phi]\[Eta]"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<t\>\""}], "]"}], " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"rb", "[", 
             RowBox[{"C", ",", " ", "\"\<t\>\""}], "]"}], ",", " ", 
            RowBox[{"{", "t", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"rb", "[", 
           RowBox[{"C", ",", " ", "\"\<K\>\""}], "]"}], " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"rb", "[", 
             RowBox[{"C", ",", " ", "\"\<K\>\""}], "]"}], ",", " ", 
            RowBox[{"{", "K", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"m", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"Keys", "@", 
               RowBox[{"rb", "[", 
                RowBox[{"C", ",", " ", "\"\<n\>\""}], "]"}]}], "]"}], "+", 
             "1"}], ",", " ", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "map", " ", "n", " ", "to", " ", "actual", " ", "index", " ", "in", 
           " ", "J"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"m", " ", "=", " ", 
          RowBox[{
           RowBox[{"rb", "[", 
            RowBox[{"C", ",", " ", "\"\<n\>\"", ",", " ", "m"}], "]"}], " ", 
           "=", " ", 
           RowBox[{"Length", "@", 
            RowBox[{"rb", "[", 
             RowBox[{"C", ",", " ", "\"\<J\>\""}], "]"}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"MapThread", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"rb", "[", 
                RowBox[{"C", ",", " ", "#1", ",", " ", "m"}], "]"}], " ", "=",
                " ", "#2"}], ";"}], ")"}], "&"}], ",", " ", "brX"}], "]"}], 
         ";"}], ",", "\[IndentingNewLine]", "True", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"add", " ", "brand", " ", "new", " ", "constraint"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"m", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", "1", ",", 
            " ", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"rb", "[", "C", "]"}], " ", "=", " ", 
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", 
             RowBox[{"<|", 
              RowBox[{"m", " ", "\[Rule]", " ", "1"}], "|>"}]}], ",", " ", 
            RowBox[{"\"\<t\>\"", " ", "\[Rule]", " ", 
             RowBox[{"{", "t", "}"}]}], ",", " ", 
            RowBox[{"\"\<K\>\"", " ", "\[Rule]", " ", 
             RowBox[{"{", "K", "}"}]}]}], "|>"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AssociateTo", "[", 
          RowBox[{
           RowBox[{"rb", "[", "C", "]"}], ",", " ", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", " ", "\[Rule]", " ", 
               RowBox[{"{", "#2", "}"}]}], "&"}], ",", " ", "J\[Phi]\[Eta]"}],
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AssociateTo", "[", 
          RowBox[{
           RowBox[{"rb", "[", "C", "]"}], ",", " ", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", " ", "\[Rule]", " ", 
               RowBox[{"<|", 
                RowBox[{"1", " ", "\[Rule]", " ", "#2"}], "|>"}]}], "&"}], 
             ",", "  ", "brX"}], "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717641590751381*^9, 3.71764172273701*^9}, {
   3.7176417992064753`*^9, 3.7176418099722023`*^9}, {3.717641842003769*^9, 
   3.717641990302058*^9}, {3.717642020521081*^9, 3.7176420269117804`*^9}, {
   3.717642109475065*^9, 3.717642130178387*^9}, {3.7176422352731357`*^9, 
   3.7176422458982325`*^9}, {3.7176422779141617`*^9, 
   3.7176424252436743`*^9}, {3.7176425234633584`*^9, 
   3.7176425557761774`*^9}, {3.7176426648240767`*^9, 
   3.7176427124339056`*^9}, {3.7176427496530247`*^9, 
   3.7176427534499187`*^9}, {3.717642792762804*^9, 3.7176428544196453`*^9}, {
   3.7176428994044313`*^9, 3.717643029733796*^9}, {3.7176431194533973`*^9, 
   3.7176431221096883`*^9}, {3.7176431548287506`*^9, 3.71764323204823*^9}, {
   3.7176432622203803`*^9, 3.7176432663141694`*^9}, {3.7176433177990313`*^9, 
   3.7176433773620973`*^9}, {3.7176434134093285`*^9, 
   3.7176435605982156`*^9}, {3.717643610208073*^9, 3.7176436819431353`*^9}, {
   3.7176437138965626`*^9, 3.717643716709076*^9}, {3.7176437537719407`*^9, 
   3.7176437558500834`*^9}, {3.7176441230098104`*^9, 
   3.7176441498850765`*^9}, {3.717644213245059*^9, 3.717644283386349*^9}, {
   3.717644464780628*^9, 3.717644466483785*^9}, {3.7176445058747673`*^9, 
   3.717644507468535*^9}, {3.7176446071101213`*^9, 3.717644709220462*^9}, {
   3.71764475775216*^9, 3.717644776580468*^9}, 3.7176459127801566`*^9, {
   3.717647023355141*^9, 3.7176470313552012`*^9}, {3.7176470656992893`*^9, 
   3.7176471669815016`*^9}, {3.7176472253101816`*^9, 
   3.7176472261539288`*^9}, {3.7176554999685044`*^9, 
   3.7176555000153913`*^9}, {3.7176799143619213`*^9, 3.717679990878275*^9}, {
   3.7176800659571*^9, 3.7176801385984163`*^9}, {3.7176801775675344`*^9, 
   3.7176803192251487`*^9}, {3.7176803875851727`*^9, 3.717680404554069*^9}, {
   3.7176804368981237`*^9, 3.717680469929706*^9}, {3.7176805104925756`*^9, 
   3.7176806393531904`*^9}, {3.7176806732284946`*^9, 
   3.7176807737294674`*^9}, {3.717680824308056*^9, 3.7176809249652796`*^9}, {
   3.7176810784979897`*^9, 3.717681080451131*^9}, {3.7177873065540066`*^9, 
   3.717787316007206*^9}, {3.717787347038751*^9, 3.71778734816376*^9}, {
   3.7177874458053293`*^9, 3.7177874462584596`*^9}, {3.71778940440516*^9, 
   3.717789425827238*^9}, {3.717789531859511*^9, 3.7177895612191615`*^9}, {
   3.718144661241203*^9, 3.718144667460016*^9}, {3.718144755585884*^9, 
   3.7181448410176077`*^9}, {3.7181957861256065`*^9, 3.718195786938114*^9}, {
   3.718195819954067*^9, 3.7181958511731267`*^9}, {3.7182083780771656`*^9, 
   3.7182083890929003`*^9}, {3.7184654391056957`*^9, 3.718465441011963*^9}, {
   3.718484072917284*^9, 3.718484107323861*^9}, {3.7184892059247603`*^9, 
   3.7184892312218757`*^9}, {3.71848984525896*^9, 3.7184898715404606`*^9}, {
   3.7184901710276957`*^9, 3.71849031470092*^9}, {3.71849035490444*^9, 
   3.7184904532195177`*^9}, {3.7184904952042923`*^9, 3.718490616486683*^9}, {
   3.7184906673152885`*^9, 3.7184907085656824`*^9}, {3.7184910857567663`*^9, 
   3.7184911003194056`*^9}, {3.71849115303867*^9, 3.7184911599293575`*^9}, {
   3.718491195242182*^9, 3.7184911953359327`*^9}, 3.71898471533091*^9, {
   3.719060249410833*^9, 3.7190602510045853`*^9}, {3.719060724868642*^9, 
   3.719060916526785*^9}, {3.7190610291528997`*^9, 3.719061069918926*^9}, {
   3.7190611078411927`*^9, 3.719061109981822*^9}, {3.7190611624042325`*^9, 
   3.7190611634979763`*^9}, {3.719061269358398*^9, 3.719061319921398*^9}, {
   3.7190613568436394`*^9, 3.719061405750369*^9}, {3.7190616034149084`*^9, 
   3.7190618111826043`*^9}, {3.7190620054032564`*^9, 
   3.7190620156221085`*^9}, {3.7190621754674397`*^9, 
   3.7190622111709166`*^9}, {3.719062272843401*^9, 3.719062294953006*^9}, {
   3.7190623344533834`*^9, 3.7190623409534492`*^9}, 3.7190624025634317`*^9, {
   3.7190624381419106`*^9, 3.7190624869080153`*^9}, 3.719062582893341*^9, {
   3.7190626323469543`*^9, 3.719062634440725*^9}, {3.7190737625140963`*^9, 
   3.719073825983487*^9}, {3.7191110185463715`*^9, 3.7191110198432465`*^9}, {
   3.7615028723521028`*^9, 3.7615028878978457`*^9}, {3.7615029355194235`*^9, 
   3.761502939456658*^9}, {3.7615029833597364`*^9, 3.761503014513748*^9}, {
   3.761503692484562*^9, 3.761503693250115*^9}, {3.791131580899967*^9, 
   3.791131590252603*^9}, {3.791131715149044*^9, 3.791131744424041*^9}, {
   3.791131889887559*^9, 
   3.791131890631639*^9}},ExpressionUUID->"47bf5bdb-1b44-4beb-a980-\
436b213be2f3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MakeSparse", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "d", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "pad", " ", "ragged", " ", "arrays", " ", "to", " ", "full", " ", 
        "array", " ", "for", " ", "use", " ", "in", " ", "Compile"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"Map", "[", 
         RowBox[{"Dimensions", ",", " ", "x", ",", " ", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"MapThread", "[", 
           RowBox[{"Max", ",", " ", "d"}], "]"}], ",", " ", 
          RowBox[{"Length", "@", "d"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"PadRight", "[", 
         RowBox[{"x", ",", " ", "d"}], "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConBFunctions", "[", 
    RowBox[{"B_:", "True"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "b", ",", " ", "r", ",", " ", "X", ",", " ", "dot", ",", " ", "rdot", 
       ",", " ", "Xdot", ",", " ", "bo", ",", " ", "ba", ",", " ", "bs", ",", 
       " ", "bx", ",", " ", "f"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"rb", "[", 
          RowBox[{"C", ",", " ", "\"\<b\>\""}], "]"}], ",", " ", 
         RowBox[{
          RowBox[{"#", " ", "=!=", " ", 
           RowBox[{"{", "}"}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"B", " ", "&&", " ", 
         RowBox[{"AssociationQ", "[", "b", "]"}], " ", "&&", " ", 
         RowBox[{
          RowBox[{"Length", "@", "b"}], " ", ">", " ", "0"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"r", " ", "=", " ", 
          RowBox[{"Values", "@", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"rb", "[", 
              RowBox[{"C", ",", " ", "\"\<r\>\""}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"#", " ", "=!=", " ", 
               RowBox[{"{", "}"}]}], "&"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"X", " ", "=", " ", 
          RowBox[{"Values", "@", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"rb", "[", 
              RowBox[{"C", ",", " ", "\"\<X\>\""}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"#", " ", "=!=", " ", 
               RowBox[{"{", "}"}]}], "&"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dot", " ", "=", " ", 
          RowBox[{"Values", "@", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"rb", "[", 
              RowBox[{"C", ",", " ", "\"\<rdot\>\""}], "]"}], ",", " ", 
             RowBox[{
              RowBox[{"#", " ", "=!=", " ", 
               RowBox[{"{", "}"}]}], "&"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "make", " ", "X", " ", "into", " ", "translation", " ", "matrix"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"X", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", " ", "j", ",", " ", 
              RowBox[{"1", ";;", "3"}], ",", 
              RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "=",
             " ", 
            RowBox[{
             RowBox[{"X", "\[LeftDoubleBracket]", 
              RowBox[{"i", ",", " ", "j", ",", " ", 
               RowBox[{"4", ";;", "6"}], ",", 
               RowBox[{"4", ";;", "6"}]}], "\[RightDoubleBracket]"}], " ", 
             "=", " ", "I3"}]}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i", ",", " ", 
             RowBox[{"Length", "@", "X"}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"j", ",", " ", 
             RowBox[{"Length", "@", 
              RowBox[{
              "X", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}],
             "}"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "create", " ", "dots", " ", "based", " ", "on", " ", "Jdot", " ", 
           "options"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"f", " ", "=", " ", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"dot", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", " ", "j"}], "\[RightDoubleBracket]"}], ",", 
               " ", 
               RowBox[{"#1", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", " ", "j"}], "\[RightDoubleBracket]"}], ",", 
               " ", "#2"}], "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"i", ",", " ", 
               RowBox[{"Length", "@", "b"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"j", ",", " ", 
               RowBox[{"Length", "@", 
                RowBox[{
                "b", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}]}]}], "}"}]}], "]"}], "&"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"rdot", " ", "=", " ", 
          RowBox[{"f", "[", 
           RowBox[{"r", ",", " ", "z6"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Xdot", " ", "=", " ", 
          RowBox[{"f", "[", 
           RowBox[{"X", ",", " ", "Z6"}], "]"}]}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "collapse", " ", "ragged", " ", "list", " ", "into", " ", "one", 
           " ", "big", " ", "linear", " ", "array"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"b", "[", "i", "]"}], " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"b", " ", "=", " ", 
              RowBox[{"body", " ", "#"}]}], ",", " ", 
             RowBox[{"a", " ", "=", " ", 
              RowBox[{"stopping", " ", "#"}]}], ",", " ", 
             RowBox[{"o", " ", "=", " ", 
              RowBox[{"o", " ", "frame"}]}], ",", " ", 
             RowBox[{"v", " ", "=", " ", 
              RowBox[{"velocity", " ", "constraint", " ", "if", " ", "0"}]}], 
             ",", " ", 
             RowBox[{"i", " ", "=", " ", 
              RowBox[{"con", " ", "#", " ", "in", " ", "J"}]}]}], "}"}]}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"b", " ", "=", " ", 
          RowBox[{"Join", "@@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{"e", ",", " ", 
               RowBox[{"{", "k", "}"}]}], "]"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"k", ",", " ", 
               RowBox[{"Keys", "@", "b"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"e", ",", " ", 
               RowBox[{"b", "[", "k", "]"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"X", " ", "=", " ", 
          RowBox[{"Join", "@@", "X"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"r", " ", "=", " ", 
          RowBox[{"Join", "@@", "r"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"rdot", " ", "=", " ", 
          RowBox[{"Join", "@@", "rdot"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Xdot", " ", "=", " ", 
          RowBox[{"Join", "@@", "Xdot"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"make", " ", "functions"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"r", ",", " ", "X"}], "}"}], " ", "=", " ", 
          RowBox[{"ConvertToXLFunction", " ", "/@", " ", 
           RowBox[{"{", 
            RowBox[{"r", ",", " ", "X"}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"rdot", ",", " ", "Xdot"}], "}"}], " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ConvertToXLFunction", "[", 
              RowBox[{"#", ",", " ", 
               RowBox[{"\"\<dot\>\"", " ", "\[Rule]", " ", "True"}]}], "]"}], 
             "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "&"}], 
           " ", "/@", " ", 
           RowBox[{"{", 
            RowBox[{"rdot", ",", " ", "Xdot"}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"process", " ", "data"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "no", " ", "point", " ", "in", " ", "having", " ", "body", " ", "a",
            " ", "in", " ", "a", " ", "different", " ", "branch", " ", "or", 
           " ", "a", " ", "child", " ", "of", " ", "b"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"f", " ", "=", " ", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#1", " ", ">", " ", "0"}], " ", "&&", " ", 
              RowBox[{"#2", " ", ">", " ", "0"}], " ", "&&", " ", 
              RowBox[{
               RowBox[{"nca", "\[LeftDoubleBracket]", 
                RowBox[{"#1", ",", " ", "#2"}], "\[RightDoubleBracket]"}], 
               " ", "\[NotEqual]", " ", "#2"}]}], ",", 
             RowBox[{
              RowBox[{"Message", "[", 
               RowBox[{
                RowBox[{"RBDConstraintFunctions", "::", "a"}], ",", " ", 
                RowBox[{"RBDGetValue", "[", "#2", "]"}], ",", " ", 
                RowBox[{"RBDGetValue", "[", "#1", "]"}], ",", " ", "Root"}], 
               "]"}], ";", " ", "0"}], ",", " ", 
             RowBox[{"(*", " ", "else", " ", "*)"}], " ", "#2"}], "]"}], 
           "&"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "project", " ", "a", " ", "to", " ", "root", " ", "if", " ", "a", 
           " ", "is", " ", "not", " ", "a", " ", "nearest", " ", "common", 
           " ", "ancestor", " ", 
           RowBox[{"(", "nca", ")"}], " ", "of", " ", "b"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"b", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}], " ", 
          "=", " ", 
          RowBox[{"MapThread", "[", 
           RowBox[{"f", ",", " ", 
            RowBox[{
             RowBox[{"b", "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", " ", 
               RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}], 
             "\[Transpose]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "save", " ", "computation", " ", "on", " ", "matrices", " ", "used",
            " ", "in", " ", "world", " ", "to", " ", "body", " ", 
           "transforms", " ", "XL0"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"include", " ", "b"}], " ", "&"}], " ", "o", " ", 
            "frames", " ", "in", " ", "bx"}], ",", " ", 
           RowBox[{"ignore", " ", "all", " ", "other", " ", "frames"}]}], " ",
           "*)"}], "\[IndentingNewLine]", 
         RowBox[{"f", " ", "=", " ", 
          RowBox[{"DeleteDuplicates", " ", "/@", " ", 
           RowBox[{"Transpose", "@", 
            RowBox[{"b", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", " ", "3"}], "}"}]}], 
             "\[RightDoubleBracket]"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"f", " ", "=", 
          RowBox[{"GetPath", "@", "f"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bs", " ", "=", " ", 
          RowBox[{"Sort", "@", 
           RowBox[{"DeleteDuplicates", "@", 
            RowBox[{"Flatten", "@", 
             RowBox[{
             "f", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"bs", " ", "=!=", " ", 
            RowBox[{"{", "}"}]}], ",", " ", 
           RowBox[{
            RowBox[{"bs", " ", "=", " ", 
             RowBox[{"Rest", "@", "bs"}]}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bx", " ", "=", " ", 
          RowBox[{"Sort", "@", 
           RowBox[{"DeleteDuplicates", "@", 
            RowBox[{"Flatten", "@", "f"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"bx", " ", "=!=", " ", 
            RowBox[{"{", "}"}]}], ",", " ", 
           RowBox[{
            RowBox[{"bx", " ", "=", " ", 
             RowBox[{"Rest", "@", "bx"}]}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"w", "/", " ", "b"}], " ", "and", " ", "o", " ", "can", 
           " ", "move", " ", "r", " ", "to", " ", "final", " ", 
           "coordinate"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"bo", " ", "=", " ", 
          RowBox[{"b", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", " ", 
            RowBox[{"{", 
             RowBox[{"1", ",", " ", "3"}], "}"}]}], 
           "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"w", "/", " ", "b"}], " ", "and", " ", "a", " ", 
           RowBox[{"(", 
            RowBox[{"and", " ", "i", " ", "and", " ", "k"}], ")"}], " ", 
           "can", " ", "compute", " ", "Jacobian", " ", 
           RowBox[{"w", ".", "r", ".", "t"}], " ", "to", " ", "#", " ", "of", 
           " ", 
           RowBox[{"b", "'"}], "s"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"i", ".", "e", "."}], ",", " ", 
           RowBox[{
           "take", " ", "fewer", " ", "trips", " ", "up", " ", "the", " ", 
            "chain"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ba", " ", "=", " ", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Join", "[", "##", "]"}], "&"}], ",", " ", 
            RowBox[{"b", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", " ", 
              RowBox[{"{", 
               RowBox[{"1", ",", " ", "2", ",", " ", "4", ",", " ", "5"}], 
               "}"}]}], "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"ba", "[", "i", "]"}], " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"b", " ", "=", " ", 
              RowBox[{"body", " ", "#"}]}], ",", " ", 
             RowBox[{"a", " ", "=", " ", 
              RowBox[{"stopping", " ", "#"}]}], ",", " ", 
             RowBox[{"v", " ", "=", " ", 
              RowBox[{"velocity", " ", "constraint", " ", "if", " ", "0"}]}], 
             ",", " ", 
             RowBox[{"i", " ", "=", " ", 
              RowBox[{"con", " ", "#", " ", "in", " ", "J"}]}], ",", " ", 
             RowBox[{"k", " ", "=", " ", 
              RowBox[{"flattened", " ", "constraint", " ", "position"}]}]}], 
            "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "convert", " ", "ragged", " ", "lists", " ", "into", " ", "proper", 
           " ", "tensors"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ba", " ", "=", " ", 
          RowBox[{"Normal", "@", 
           RowBox[{"MakeSparse", "@", 
            RowBox[{"GatherBy", "[", 
             RowBox[{"ba", ",", " ", 
              RowBox[{
               RowBox[{"#", "\[LeftDoubleBracket]", 
                RowBox[{"1", ";;", "2"}], "\[RightDoubleBracket]"}], "&"}]}], 
             "]"}]}]}]}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"r", " ", "=", " ", 
          RowBox[{"X", "=", " ", 
           RowBox[{"rdot", " ", "=", " ", 
            RowBox[{"Xdot", " ", "=", " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"{", "}"}], "&"}], ")"}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bo", " ", "=", " ", 
          RowBox[{"ba", " ", "=", " ", 
           RowBox[{"bs", " ", "=", " ", 
            RowBox[{"bx", " ", "=", " ", 
             RowBox[{"{", "}"}]}]}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<r\>\"", " ", "\[Rule]", " ", "r"}], ",", " ", 
        RowBox[{"\"\<Tcb\>\"", " ", "\[Rule]", " ", "X"}], ",", " ", 
        RowBox[{"\"\<rdot\>\"", " ", "\[Rule]", " ", "rdot"}], ",", " ", 
        RowBox[{"\"\<Tcbdot\>\"", " ", "\[Rule]", " ", "Xdot"}], ",", " ", 
        RowBox[{"\"\<bo\>\"", " ", "\[Rule]", " ", "bo"}], ",", " ", 
        RowBox[{"\"\<ba\>\"", " ", "\[Rule]", " ", "ba"}], ",", " ", 
        RowBox[{"\"\<bs\>\"", " ", "\[Rule]", " ", "bs"}], ",", " ", 
        RowBox[{"\"\<bx\>\"", " ", "\[Rule]", " ", "bx"}]}], "|>"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7182152299211535`*^9, 3.7182152665933924`*^9}, {
   3.718215309109438*^9, 3.718215359688074*^9}, {3.7182153991884637`*^9, 
   3.718215411376072*^9}, 3.7182159928784037`*^9, {3.718216853183769*^9, 
   3.718216891418538*^9}, {3.7182183315733824`*^9, 3.718218335604683*^9}, {
   3.718218372480035*^9, 3.7182183728237877`*^9}, {3.718218562013159*^9, 
   3.718218568247596*^9}, {3.7182215693817577`*^9, 3.7182216388824434`*^9}, {
   3.7182221406530275`*^9, 3.718222141153034*^9}, {3.718489484833659*^9, 
   3.7184894855524273`*^9}, {3.7190182273289437`*^9, 
   3.7190182374852943`*^9}, {3.742643823752689*^9, 3.7426438459853706`*^9}, {
   3.7426451668281183`*^9, 3.742645167156247*^9}, {3.7614928705718975`*^9, 
   3.7614928746184835`*^9}, {3.7614929145834694`*^9, 
   3.7614929148647003`*^9}, {3.7614938070271263`*^9, 
   3.7614938119642873`*^9}, {3.7614938542737303`*^9, 
   3.7614938612888527`*^9}, {3.761494175063323*^9, 3.7614942810773787`*^9}, {
   3.761494311309563*^9, 3.7614943259179215`*^9}, {3.7614944205253286`*^9, 
   3.7614944273373394`*^9}, {3.7614944617781696`*^9, 
   3.7614944739491673`*^9}, {3.7614945281944675`*^9, 
   3.7614945491304746`*^9}, {3.761494601354272*^9, 3.761494606166436*^9}, 
   3.761495819407637*^9, {3.761495911027684*^9, 3.7614959506967235`*^9}, {
   3.7614960455955276`*^9, 3.761496083282366*^9}, {3.76149621119847*^9, 
   3.761496215557551*^9}, {3.761497133808729*^9, 3.761497149319192*^9}, {
   3.76149783441283*^9, 3.761497839349975*^9}, {3.761502009306553*^9, 
   3.761502021680663*^9}, {3.761502114985031*^9, 3.7615021178910737`*^9}, {
   3.761503931561134*^9, 3.761503969464645*^9}, {3.7615040558803434`*^9, 
   3.761504056208412*^9}, {3.7615045897350006`*^9, 3.7615045930004063`*^9}, {
   3.7615056008522964`*^9, 3.7615056011960063`*^9}, {3.7615056378084974`*^9, 
   3.7615056381209593`*^9}, {3.76152191926608*^9, 3.761521919594165*^9}, {
   3.7615274052217445`*^9, 3.7615274116823854`*^9}, {3.761528387568201*^9, 
   3.7615283920184355`*^9}, {3.7615284625705132`*^9, 3.761528497444064*^9}, 
   3.7615285693502283`*^9, {3.7615286333799305`*^9, 3.761528635513261*^9}, {
   3.761529643251308*^9, 3.761529662621544*^9}, 3.7615297732651224`*^9, {
   3.761529831613733*^9, 3.7615298329486685`*^9}, {3.761530811107297*^9, 
   3.761530822261037*^9}, {3.7615308780170193`*^9, 3.7615309308137817`*^9}, {
   3.761531031530096*^9, 3.761531050546427*^9}, {3.7615311106673193`*^9, 
   3.761531114077078*^9}, {3.7615311973901076`*^9, 3.7615311977534018`*^9}, {
   3.761531270598216*^9, 3.7615312778180275`*^9}, {3.7615314712491546`*^9, 
   3.76153148485606*^9}, {3.7615320055203667`*^9, 3.761532031670163*^9}, {
   3.7615322184416027`*^9, 3.7615322578273025`*^9}, {3.761534085267973*^9, 
   3.7615340856899853`*^9}},ExpressionUUID->"ca812002-45c6-4972-bb86-\
c062db6aea58"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",ExpressionUUID->"cd25305d-89ca-4874-b469-b84effc784b0"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.591486801989799*^9, 
  3.5914868026208353`*^9}},ExpressionUUID->"aa2c11f7-81d1-4181-9320-\
98bfd137bd0f"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1509},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2879, 58, 547, "Code",ExpressionUUID->"65f9c771-df43-425b-a1fe-b2a9a25ea22e",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3462, 82, 200, 4, 95, "Section",ExpressionUUID->"15249854-6eab-479c-8879-6080f9c5e9a2"],
Cell[3665, 88, 420, 8, 52, "Text",ExpressionUUID->"5ff51d30-114a-407a-835d-58d90a7c28af"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4122, 101, 249, 4, 95, "Section",ExpressionUUID->"e00fced7-32d1-4f3e-822f-0bb741fe8e90"],
Cell[4374, 107, 771, 14, 45, "Input",ExpressionUUID->"0a2ee722-6a49-43a0-913c-6e9fe7ced324"],
Cell[5148, 123, 5007, 135, 526, "Input",ExpressionUUID->"e51befbb-5c2d-43e2-b7b3-749182c89b7b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10192, 263, 160, 3, 95, "Section",ExpressionUUID->"7516a8a1-d217-4d6c-82b3-acb35d3ebe89"],
Cell[10355, 268, 3331, 52, 182, "Input",ExpressionUUID->"cb256213-bcb2-42c0-8d1d-2892cc110a24",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[13723, 325, 680, 9, 95, "Section",ExpressionUUID->"fd6c1ce6-3826-4153-a408-a56cbec4fe15"],
Cell[14406, 336, 1163, 21, 61, "Input",ExpressionUUID->"fec6873b-213d-4c16-ab48-67178ee0ed99",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[15606, 362, 531, 8, 95, "Section",ExpressionUUID->"18199f87-8139-4d53-83a3-9d0dfc8fa73d"],
Cell[16140, 372, 4973, 72, 61, "Input",ExpressionUUID->"628765c1-0832-4806-b028-99598cfa0c84",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[21150, 449, 368, 6, 95, "Section",ExpressionUUID->"bf121257-7a2f-44ef-a345-ac879a9cee30"],
Cell[21521, 457, 4899, 72, 61, "Input",ExpressionUUID->"a5288890-7b4b-42b5-ba73-8b61bdb141ee",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[26457, 534, 474, 7, 95, "Section",ExpressionUUID->"ad2ece75-3425-47d1-94ab-d74eb25ec293"],
Cell[26934, 543, 4791, 68, 61, "Input",ExpressionUUID->"d7677ec8-1c86-47f3-98fc-cfd33f781e7a",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[31762, 616, 424, 6, 95, "Section",ExpressionUUID->"20630fbd-3de5-498e-a036-e5ee492ef2d1"],
Cell[32189, 624, 868, 17, 102, "Input",ExpressionUUID->"efdaeb4b-2724-488c-b3ef-2f94d60035f1",
 InitializationCell->True],
Cell[33060, 643, 1134, 22, 142, "Input",ExpressionUUID->"468c07ce-4e6e-46b7-a7e8-77e7bd41f016",
 InitializationCell->True],
Cell[34197, 667, 12651, 198, 422, "Input",ExpressionUUID->"8dc79c9a-5863-496f-b703-a41dbfb43609",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[46885, 870, 423, 6, 95, "Section",ExpressionUUID->"8d08de62-5bc5-4bca-a42a-4133ad164b73"],
Cell[47311, 878, 12009, 190, 422, "Input",ExpressionUUID->"99289ee5-bd6f-4565-939f-83c36a6a59b8",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[59357, 1073, 496, 7, 95, "Section",ExpressionUUID->"b6977626-b220-442d-81b9-72297bdff902"],
Cell[59856, 1082, 13276, 211, 505, "Input",ExpressionUUID->"fb76affe-ee80-4220-a136-2a7555174e5d",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[73169, 1298, 368, 6, 95, "Section",ExpressionUUID->"21d42b96-236c-48fa-bc02-7e5ed1804c9c"],
Cell[73540, 1306, 9261, 189, 1025, "Input",ExpressionUUID->"d25bd395-589a-4cb5-9b3d-401221544cbc",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[82838, 1500, 518, 8, 95, "Section",ExpressionUUID->"e49d07f6-189b-4019-8f47-266922a4ae61"],
Cell[83359, 1510, 4869, 130, 782, "Input",ExpressionUUID->"c287c901-62f7-4046-b56c-a5a930b28fd2",
 InitializationCell->True],
Cell[88231, 1642, 21260, 374, 1662, "Input",ExpressionUUID->"99048470-c283-4721-bc25-207b40c529db",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[109516, 2020, 565, 8, 74, "Subsection",ExpressionUUID->"03970afd-0e6f-4aa6-8a61-740e7c849c7c"],
Cell[110084, 2030, 2591, 59, 462, "Input",ExpressionUUID->"0a2aa8cb-796d-427a-b9e3-2463e6398b7f",
 InitializationCell->True],
Cell[112678, 2091, 16473, 280, 862, "Input",ExpressionUUID->"3e04e3ce-d0e4-4c4b-a549-6e8951b99ac6",
 InitializationCell->True],
Cell[129154, 2373, 19476, 368, 1902, "Input",ExpressionUUID->"bc8c41a0-f4de-4ff1-b977-ced7e49b5986",
 InitializationCell->True],
Cell[148633, 2743, 27176, 488, 2022, "Input",ExpressionUUID->"002d863b-3d90-462a-b516-5ae22d725596",
 InitializationCell->True],
Cell[175812, 3233, 17520, 376, 2302, "Input",ExpressionUUID->"47bf5bdb-1b44-4beb-a980-436b213be2f3",
 InitializationCell->True],
Cell[193335, 3611, 20839, 448, 2982, "Input",ExpressionUUID->"ca812002-45c6-4972-bb86-c062db6aea58",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[214223, 4065, 85, 0, 95, "Section",ExpressionUUID->"cd25305d-89ca-4874-b469-b84effc784b0"],
Cell[214311, 4067, 267, 6, 102, "Input",ExpressionUUID->"aa2c11f7-81d1-4181-9320-98bfd137bd0f",
 InitializationCell->True]
}, Open  ]]
}
]
*)

