(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    120598,       2470]
NotebookOptionsPosition[    117621,       2405]
NotebookOutlinePosition[    117987,       2421]
CellTagsIndexPosition[    117944,       2418]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"SpatialVectors", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{
     "A", " ", "spatial", " ", "vector", " ", "algebra", " ", "package", " ", 
      "based", " ", "\n", "on", " ", 
      RowBox[{"Featherstone", "'"}], "s", " ", "Spatial_v2", " ", "software", 
      " ", "\n", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"http", ":"}], "//", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"royfeatherstone", ".", "org"}], "/", "spatial"}], "/", 
           "v2"}], "/", 
          RowBox[{"index", ".", "html"}]}]}], ")"}], ".", "\n", "Copyright"}],
       " ", 
      RowBox[{"(", "C", ")"}], " ", "2014", " ", "Nelson", " ", "Rosa", " ", 
      RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", " ",
       "free", " ", "software"}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 3.6103712325731497`*^9}, {
  3.610371305900334*^9, 3.610371331708816*^9}, {3.610371368620943*^9, 
  3.61037139802861*^9}},ExpressionUUID->"461d5058-d610-4530-b7f5-\
3d724742dada"],

Cell[CellGroupData[{

Cell["TODO:", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.717381720704397*^9, 
  3.7173817218606577`*^9}},ExpressionUUID->"69668757-b033-46b9-a675-\
17b9d6cec5e0"],

Cell["\<\
fix GetJointLocations and MechanicalQuantities functions Xip and \
InitSpatialQtys will change.

fix RBDSpatialPosition[\[DoubleStruckB][....]], need to use option \
\[OpenCurlyDoubleQuote]a\[CloseCurlyDoubleQuote] in computing spatial position

Add derivatives of I and X w.r.t. to a velocity vector to compute dI/dt and \
dX/dt, see Featherstone\[CloseCurlyQuote]s book & code in OperationalSpace\
\>", "Text",
 CellChangeTimes->{{3.717381723485675*^9, 3.717381758970414*^9}, 
   3.7175053985103703`*^9, {3.72005897933724*^9, 3.7200590023999753`*^9}, {
   3.733390732383506*^9, 
   3.733390782028244*^9}},ExpressionUUID->"d3bbb3df-6e2c-484a-916e-\
bcd6b62f355f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"3bfc55e3-73c4-45d1-a335-\
3bcd53004cab"],

Cell[BoxData[{
 RowBox[{"BeginPackage", "[", 
  RowBox[{
  "\"\<RigidBodyDynamics`\>\"", ",", " ", "\"\<GlobalVariables`\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.592239943509227*^9, 3.5922399820561876`*^9}, {3.5922472305833893`*^9, 
   3.592247244802156*^9}, {3.5922512353880877`*^9, 3.5922512705444045`*^9}, {
   3.5922513050913467`*^9, 3.5922514372009954`*^9}, {3.59225146788854*^9, 
   3.592251700685872*^9}, 3.592254598707162*^9, {3.5922546582385283`*^9, 
   3.5922546594416585`*^9}, {3.5922548578326693`*^9, 3.592254859379553*^9}, 
   3.592255489566574*^9, {3.5922791418954496`*^9, 3.5922791426874943`*^9}, {
   3.5922792189568634`*^9, 3.5922792372149057`*^9}, 3.5922798737793617`*^9, {
   3.593367644000187*^9, 3.593367644125187*^9}, {3.7173731386376357`*^9, 
   3.7173732122798*^9}, {3.7173744013367443`*^9, 3.7173744372746143`*^9}, 
   3.7173803413152504`*^9, {3.717381370028921*^9, 3.717381377950879*^9}, {
   3.7175146667348566`*^9, 3.717514680234995*^9}, {3.717517914596258*^9, 
   3.7175179184400606`*^9}, {3.717522040257573*^9, 3.7175220420544677`*^9}, {
   3.71755025350804*^9, 3.7175502537267923`*^9}, {3.7175522457471304`*^9, 
   3.717552247059642*^9}, {3.7176462236287746`*^9, 3.7176462281132197`*^9}, {
   3.7176463026295247`*^9, 3.717646314067134*^9}, 
   3.7188961955280924`*^9},ExpressionUUID->"d1260a39-ddc9-47f9-882e-\
0aa6ac61158e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spatial Vector Cross Product", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.5916678523159876`*^9, 3.591667856467229*^9}, {3.592247237630267*^9, 
  3.592247238880283*^9}, {3.5933101246677265`*^9, 3.5933101251364794`*^9}, {
  3.717373826677498*^9, 
  3.717373856521553*^9}},ExpressionUUID->"e544ea0c-b8b8-4fd4-b17b-\
a28c9c1ad119"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"rotate", " ", "the", " ", "frame", " ", "\"\<foward\>\""}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"rot3", "[", 
      RowBox[{"q_", ",", " ", "a_"}], "]"}], " ", ":=", " ", 
     RowBox[{"RotationMatrix", "[", 
      RowBox[{
       RowBox[{"-", "q"}], ",", " ", "a"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "take", " ", "3", "x3", " ", "matrices", " ", "and", " ", "make", " ", 
     "a", " ", "6", "x6", " ", "matrix"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Mat6", "[", 
     RowBox[{"M11_", ",", " ", "M12_", ",", " ", "M21_", ",", " ", "M22_"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"ArrayFlatten", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"M11", ",", " ", "M12"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"M21", ",", " ", "M22"}], "}"}]}], "}"}], 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5888576814573565`*^9, 3.5888576965042715`*^9}, {
   3.588882259980151*^9, 3.58888229287833*^9}, {3.5922491181495695`*^9, 
   3.592249124899598*^9}, {3.5922492310872936`*^9, 3.592249248462327*^9}, {
   3.5922492794311357`*^9, 3.592249453212725*^9}, {3.5922501133858905`*^9, 
   3.592250146870332*^9}, 3.592250183182903*^9, {3.5922549616453753`*^9, 
   3.5922549620360003`*^9}, {3.5922556328927836`*^9, 3.5922556466355705`*^9}, 
   3.592279896759678*^9, {3.592350215340423*^9, 3.5923502350315485`*^9}, {
   3.5923503302490015`*^9, 3.592350333387202*^9}, {3.592350713756966*^9, 
   3.5923507212063923`*^9}},ExpressionUUID->"064fc558-b33c-47ca-a5bb-\
1a1f98091141"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"cross", " ", "products"}], ",", " ", 
    RowBox[{
    "useful", " ", "for", " ", "coordinate", " ", "transforms", " ", "of", 
     " ", "spatial", " ", "velocities", " ", "and", " ", "forces"}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"skew", "[", "x_", "]"}], " ", ":=", 
     RowBox[{"(", "\[NoBreak]", GridBox[{
        {"0", 
         RowBox[{"-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
         RowBox[{"x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]},
        {
         RowBox[{"x", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "0", 
         RowBox[{"-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]},
        {
         RowBox[{"-", 
          RowBox[{
          "x", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         RowBox[{"x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "0"}
       }], "\[NoBreak]", ")"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"deskew", "[", "S_", "]"}], " ", ":=", 
     RowBox[{
      RowBox[{"1", "/", "2"}], 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"3", ",", "2"}], "\[RightDoubleBracket]"}], "-", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", "3"}], "\[RightDoubleBracket]"}]}], ",", " ", 
        RowBox[{
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], "-", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", " ", 
        RowBox[{
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], " ", "-", " ", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}]}], "}"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mx", "[", "m_", "]"}], " ", ":=", " ", 
     RowBox[{"Mat6", "[", 
      RowBox[{
       RowBox[{"skew", "@", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}]}], ",", " ", 
       "Z3", ",", " ", 
       RowBox[{"skew", "@", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}]}], ",", " ", 
       RowBox[{"skew", "@", 
        RowBox[{"m", "\[LeftDoubleBracket]", 
         RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}]}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mxstar", "[", "m_", "]"}], " ", ":=", " ", 
     RowBox[{"-", 
      RowBox[{
       RowBox[{"mx", "[", "m", "]"}], "\[Transpose]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "primarily", " ", "used", " ", "to", " ", "get", " ", "compilable", " ", 
     "code"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mxv", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"mx", "[", "#1", "]"}], ".", "#2"}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mxX", " ", "=", " ", "mxv"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mxstarf", " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"mxstar", "[", "#1", "]"}], ".", "#2"}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mxstarIv", " ", "=", " ", 
     RowBox[{
      RowBox[{"mxstarf", "[", 
       RowBox[{"#1", ",", " ", 
        RowBox[{"#2", ".", "#3"}]}], "]"}], "&"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.588847733607463*^9, 3.588847759828424*^9}, {
   3.5888477905747843`*^9, 3.588847828252576*^9}, {3.588847862884996*^9, 
   3.5888478941729517`*^9}, {3.58884798336229*^9, 3.5888480472794127`*^9}, {
   3.588848279822406*^9, 3.5888482893396187`*^9}, {3.5888484022789187`*^9, 
   3.5888484565628166`*^9}, {3.5888484919353137`*^9, 
   3.5888484962748775`*^9}, {3.5888485974837265`*^9, 
   3.5888486048706846`*^9}, {3.588848656820795*^9, 3.5888486569867973`*^9}, {
   3.5888488524644227`*^9, 3.5888489626124253`*^9}, {3.588856113551424*^9, 
   3.588856114062484*^9}, {3.5888569283999715`*^9, 3.588856962461301*^9}, {
   3.5888569952564683`*^9, 3.5888570036745567`*^9}, {3.5888570631720963`*^9, 
   3.5888570632381086`*^9}, {3.588857704035243*^9, 3.588857704446299*^9}, {
   3.588858189277627*^9, 3.588858192446048*^9}, {3.5888582809341908`*^9, 
   3.5888582946159487`*^9}, {3.5915731377032204`*^9, 3.591573140343835*^9}, 
   3.5922403990101166`*^9, 3.5922405267916145`*^9, {3.5922433610116796`*^9, 
   3.5922433641991863`*^9}, {3.592247110895647*^9, 3.5922471167862806`*^9}, {
   3.5922472124270935`*^9, 3.5922472140677214`*^9}, {3.592250936075*^9, 
   3.592251014997032*^9}, {3.68081695671631*^9, 3.6808169592918587`*^9}, {
   3.690136721722206*^9, 3.69013678882613*^9}, {3.6901368559926643`*^9, 
   3.6901368743916135`*^9}, {3.6901370365015717`*^9, 
   3.6901370651641407`*^9}, {3.6901370959700856`*^9, 3.69013710433219*^9}, {
   3.6901372485836153`*^9, 3.6901372684996905`*^9}, {3.690137358078661*^9, 
   3.690137358531847*^9}, {3.690138214636558*^9, 3.690138344760847*^9}, {
   3.690138377792133*^9, 3.6901383882789774`*^9}, {3.69013842736042*^9, 
   3.690138445202034*^9}, {3.6901400482887545`*^9, 3.690140122488608*^9}, {
   3.690157963457614*^9, 3.6901580054727144`*^9}, {3.6901582045414906`*^9, 
   3.6901582205081053`*^9}, {3.690180153615607*^9, 3.6901801557875013`*^9}, {
   3.6902263030501003`*^9, 3.690226343873376*^9}, {3.7173737634112387`*^9, 
   3.717373775911352*^9}, {3.717373879724929*^9, 3.717373900709506*^9}, {
   3.717843186286771*^9, 3.7178431890836897`*^9}, {3.7178432254121532`*^9, 
   3.7178432639281335`*^9}},ExpressionUUID->"b755f28b-46b4-4db2-86b4-\
d0f54f934321"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plucker Coordinate Transformations", "Section",
 CellChangeTimes->{{3.7173738010209846`*^9, 
  3.71737380975546*^9}},ExpressionUUID->"432d5fb2-a277-41e9-b07b-\
8fbd301e7c20"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"transX", "[", "x_", "]"}], " ", ":=", 
   RowBox[{"Mat6", "[", 
    RowBox[{"I3", ",", " ", "Z3", ",", "  ", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"skew", "@", 
        RowBox[{
        "I3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], " ",
       "x"}], ",", " ", "I3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transY", "[", "y_", "]"}], " ", ":=", 
   RowBox[{"Mat6", "[", 
    RowBox[{"I3", ",", " ", "Z3", ",", "  ", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"skew", "@", 
        RowBox[{
        "I3", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], " ",
       "y"}], ",", " ", "I3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transZ", "[", "z_", "]"}], " ", ":=", 
   RowBox[{"Mat6", "[", 
    RowBox[{"I3", ",", " ", "Z3", ",", "  ", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"skew", "@", 
        RowBox[{
        "I3", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}]}], " ",
       "z"}], ",", " ", "I3"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"trans", "[", "r_", "]"}], " ", ":=", 
    RowBox[{
     RowBox[{"transZ", "[", 
      RowBox[{"r", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
      "]"}], ".", 
     RowBox[{"transY", "[", 
      RowBox[{"r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
      "]"}], ".", 
     RowBox[{"transX", "[", 
      RowBox[{"r", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "]"}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rotX", "[", "\[CurlyPhi]_", "]"}], " ", ":=", " ", 
   RowBox[{"Mat6", "[", 
    RowBox[{
     RowBox[{"rot3", "[", 
      RowBox[{"\[CurlyPhi]", ",", " ", 
       RowBox[{"I3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
       "]"}], ",", " ", "Z3", ",", " ", "Z3", ",", " ", 
     RowBox[{"rot3", "[", 
      RowBox[{"\[CurlyPhi]", ",", " ", 
       RowBox[{"I3", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
       "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rotY", "[", "\[Theta]_", "]"}], " ", ":=", " ", 
   RowBox[{"Mat6", "[", 
    RowBox[{
     RowBox[{"rot3", "[", 
      RowBox[{"\[Theta]", ",", " ", 
       RowBox[{"I3", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
       "]"}], ",", " ", "Z3", ",", " ", "Z3", ",", " ", 
     RowBox[{"rot3", "[", 
      RowBox[{"\[Theta]", ",", " ", 
       RowBox[{"I3", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
       "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rotZ", "[", "\[Psi]_", "]"}], " ", ":=", " ", 
   RowBox[{"Mat6", "[", 
    RowBox[{
     RowBox[{"rot3", "[", 
      RowBox[{"\[Psi]", ",", " ", 
       RowBox[{"I3", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}],
       "]"}], ",", " ", "Z3", ",", " ", "Z3", ",", " ", 
     RowBox[{"rot3", "[", 
      RowBox[{"\[Psi]", ",", " ", 
       RowBox[{"I3", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}],
       "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"rot", "[", "q_", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"rotZ", "[", 
      RowBox[{"q", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
      "]"}], ".", 
     RowBox[{"rotY", "[", 
      RowBox[{"q", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
      "]"}], ".", 
     RowBox[{"rotX", "[", 
      RowBox[{"q", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "]"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "transform", " ", "from", " ", "a", " ", "to", " ", "b", " ", 
    "coordinates"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Xba", "[", "x_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"rot", "[", 
     RowBox[{"x", "\[LeftDoubleBracket]", 
      RowBox[{"1", ";;", "3"}], "\[RightDoubleBracket]"}], "]"}], ".", 
    RowBox[{"trans", "[", 
     RowBox[{"x", "\[LeftDoubleBracket]", 
      RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Xstarba", "[", "x_", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"Inverse", "@", 
      RowBox[{"Xba", "[", "x", "]"}]}], "\[Transpose]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InvXba", "[", 
    RowBox[{"xba_", "?", "VectorQ"}], "]"}], " ", ":=", " ", 
   RowBox[{"InvXba", "[", 
    RowBox[{"Xba", "[", "xba", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InvXba", "[", "Xba_", "]"}], " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"X", ",", " ", "R", ",", " ", "p"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"X", " ", "=", " ", "Xba"}], ";", "\[IndentingNewLine]", 
      RowBox[{"R", " ", "=", " ", 
       RowBox[{
        RowBox[{"X", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], 
        "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"-", 
        RowBox[{"X", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"4", ";;", "6"}], ",", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"X", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", "3"}], ",", 
         RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "=", " ",
        "R"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"X", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"4", ";;", "6"}], ",", 
         RowBox[{"4", ";;", "6"}]}], "\[RightDoubleBracket]"}], " ", "=", " ",
        "R"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"X", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"4", ";;", "6"}], ",", 
         RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "=", " ", 
       RowBox[{"R", ".", "p", ".", "R"}]}], ";", "\[IndentingNewLine]", 
      "X"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5883680626736507`*^9, 3.5883681143362107`*^9}, {
   3.5883682419934025`*^9, 3.588368284735835*^9}, {3.588368380658026*^9, 
   3.588368423193433*^9}, {3.588368475327829*^9, 3.588368546857668*^9}, {
   3.588368595975931*^9, 3.588368596300953*^9}, {3.588369090868146*^9, 
   3.5883691136090345`*^9}, {3.588369205784746*^9, 3.5883692197225175`*^9}, {
   3.588369266813512*^9, 3.588369371765544*^9}, {3.588369407717795*^9, 
   3.5883694952092605`*^9}, {3.588369545997448*^9, 3.588369553163358*^9}, {
   3.5883696039293337`*^9, 3.588369606561659*^9}, {3.588369683777155*^9, 
   3.5883696908660717`*^9}, {3.588369774724355*^9, 3.5883698415087204`*^9}, {
   3.5883698953355613`*^9, 3.5883699325762568`*^9}, {3.5883699786548586`*^9, 
   3.5883699788058777`*^9}, {3.588370034738986*^9, 3.5883701184452534`*^9}, {
   3.5883701607107553`*^9, 3.588370163186053*^9}, {3.5883702770377665`*^9, 
   3.5883703695715156`*^9}, {3.588370402145919*^9, 3.58837040223193*^9}, {
   3.5883705166322165`*^9, 3.5883705423064837`*^9}, {3.5883705807383637`*^9, 
   3.5883706676898165`*^9}, {3.588370700046929*^9, 3.5883708000246363`*^9}, {
   3.5883708518594575`*^9, 3.5883708650221305`*^9}, {3.588370895914056*^9, 
   3.5883709294949284`*^9}, {3.5883710098921447`*^9, 3.588371015808897*^9}, {
   3.5883710855107574`*^9, 3.588371219120737*^9}, {3.5883712635052185`*^9, 
   3.5883713466527863`*^9}, {3.5883713938811073`*^9, 3.588371397482565*^9}, {
   3.588371430981823*^9, 3.5883714315389047`*^9}, {3.5883714709599037`*^9, 
   3.5883715566387973`*^9}, {3.588371625410557*^9, 3.5883716256115613`*^9}, {
   3.5883716564344997`*^9, 3.588371678999352*^9}, {3.5883718223285637`*^9, 
   3.5883718226596255`*^9}, {3.588371899312368*^9, 3.5883719346798444`*^9}, {
   3.5883721065496883`*^9, 3.5883721367865314`*^9}, {3.5883721699897523`*^9, 
   3.5883721951099434`*^9}, {3.588372236232172*^9, 3.5883722423299446`*^9}, {
   3.5883723496965914`*^9, 3.5883723707682877`*^9}, {3.5883724747953606`*^9, 
   3.5883725442066402`*^9}, {3.5883726026810713`*^9, 3.588372703934963*^9}, {
   3.588372734290309*^9, 3.588372734823393*^9}, {3.5883728288863316`*^9, 
   3.5883728292193923`*^9}, {3.5883731311981635`*^9, 
   3.5883731373089404`*^9}, {3.588373190706727*^9, 3.5883732155088954`*^9}, {
   3.5883733203762074`*^9, 3.5883734370666227`*^9}, {3.588374387376834*^9, 
   3.5883743997534094`*^9}, 3.588376127164132*^9, {3.58837619826116*^9, 
   3.588376300234121*^9}, 3.5883771643741174`*^9, {3.5885019440497904`*^9, 
   3.5885019451106215`*^9}, {3.5885022197203474`*^9, 3.588502221810779*^9}, {
   3.588847690393952*^9, 3.5888477180614815`*^9}, {3.588847917951976*^9, 
   3.588847947997794*^9}, {3.5888480928672247`*^9, 3.588848120934806*^9}, {
   3.5888570995067177`*^9, 3.588857132309902*^9}, {3.5888571683324656`*^9, 
   3.5888571854316397`*^9}, {3.588857255695913*^9, 3.588857305054199*^9}, {
   3.588857369915962*^9, 3.588857391193657*^9}, 3.5888574423079824`*^9, {
   3.588857496454846*^9, 3.5888574980750494`*^9}, {3.5888575310222588`*^9, 
   3.588857531487299*^9}, {3.5888576712890615`*^9, 3.5888576722131815`*^9}, {
   3.5888577612303767`*^9, 3.5888577612884026`*^9}, {3.5888581422372007`*^9, 
   3.588858143795399*^9}, {3.588858251476533*^9, 3.5888582615977335`*^9}, {
   3.5888583179959016`*^9, 3.588858323153573*^9}, {3.588858366309039*^9, 
   3.588858366735096*^9}, {3.588858753489617*^9, 3.5888587686955495`*^9}, {
   3.588858813643262*^9, 3.58885881821986*^9}, {3.5888827458164062`*^9, 
   3.5888827542294784`*^9}, {3.5922436151059265`*^9, 3.592243653012251*^9}, {
   3.5922436856685643`*^9, 3.5922437073561068`*^9}, {3.5922447134690824`*^9, 
   3.592244720937848*^9}, {3.5922452877983294`*^9, 3.592245311267125*^9}, {
   3.592246179893828*^9, 3.5922462054251237`*^9}, {3.592246268800248*^9, 
   3.5922462901909328`*^9}, {3.5922478370689583`*^9, 
   3.5922478446314545`*^9}, {3.59224830647611*^9, 3.5922483836012583`*^9}, {
   3.5922484549607725`*^9, 3.5922485309140472`*^9}, {3.5922497934008913`*^9, 
   3.592249951291827*^9}, {3.5922500014950495`*^9, 3.592250025573221*^9}, {
   3.5922500565264072`*^9, 3.592250059729539*^9}, {3.592250177151639*^9, 
   3.592250226854863*^9}, {3.5923505293884087`*^9, 3.592350553375779*^9}, {
   3.592787044096955*^9, 3.592787044662984*^9}, {3.602519741383647*^9, 
   3.6025197975712566`*^9}, {3.6025198334619493`*^9, 
   3.6025198475244765`*^9}, {3.6025199087589903`*^9, 3.602519951743431*^9}, {
   3.6025428688950777`*^9, 3.6025429198389854`*^9}, {3.6025429616583805`*^9, 
   3.602542962475433*^9}, {3.6824795511309276`*^9, 3.682479684054914*^9}, {
   3.682479848265745*^9, 3.6824799949306173`*^9}, {3.682480248076683*^9, 
   3.6824802530215116`*^9}, {3.682480378365342*^9, 3.682480384373881*^9}, {
   3.7173738116929684`*^9, 3.7173738356150875`*^9}, {3.7173741495841494`*^9, 
   3.7173741611936564`*^9}, {3.733928168956236*^9, 
   3.7339282027846355`*^9}},ExpressionUUID->"79ede1b0-1809-4f5d-beca-\
aef5142e34f7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spatial Inertia Functions", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.5916678523159876`*^9, 3.591667856467229*^9}, {3.592247237630267*^9, 
  3.592247238880283*^9}, {3.5933101246677265`*^9, 3.5933101251364794`*^9}, {
  3.717373826677498*^9, 
  3.717373841802651*^9}},ExpressionUUID->"b833f929-65fc-4cc3-a703-\
50599ddeef14"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"inertia", " ", "coordinate", " ", "transformation"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Io", "[", 
      RowBox[{"m_", ",", " ", "x_", ",", " ", "Ic_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "I", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "I", " ", "is", " ", "about", " ", "com", " ", "of", " ", "link"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"I", " ", "=", " ", 
         RowBox[{
          RowBox[{"KroneckerProduct", "[", 
           RowBox[{
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {"1", "0"},
               {"0", "0"}
              }], "\[NoBreak]", ")"}], ",", " ", "Ic"}], "]"}], " ", "+", " ", 
          RowBox[{"KroneckerProduct", "[", 
           RowBox[{
            RowBox[{"(", "\[NoBreak]", GridBox[{
               {"0", "0"},
               {"0", "1"}
              }], "\[NoBreak]", ")"}], ",", " ", 
            RowBox[{"m", " ", "I3"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Xba", "[", "x", "]"}], "\[Transpose]"}], ".", "I", ".", 
         RowBox[{"Xba", "[", "x", "]"}]}]}]}], " ", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"formula", " ", "from", " ", 
         RowBox[{"Springer", "'"}], "s", " ", "HoR"}], ",", " ", 
        RowBox[{"(", "3.32", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mcI", "[", "Io_", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", " ", "c", ",", " ", "I"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m", " ", "=", " ", 
         RowBox[{"Io", "\[LeftDoubleBracket]", 
          RowBox[{"4", ",", "4"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"I", " ", "=", " ", 
         RowBox[{"Io", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "3"}], ",", " ", 
           RowBox[{"4", ";;", "6"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", " ", "\[NotEqual]", " ", "0"}], ",", " ", 
          RowBox[{
           RowBox[{"I", " ", "/=", " ", "m"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"based", " ", "on", " ", "expanding", " ", "Io"}], ",", " ", 
          RowBox[{
          "rotations", " ", "always", " ", "cancel", " ", "out", " ", "of", 
           " ", "equation"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Join", "[", 
          RowBox[{"z3", ",", " ", 
           RowBox[{"deskew", "[", "I", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"I", " ", "=", " ", 
         RowBox[{
          RowBox[{"Io", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", "3"}], ",", " ", 
            RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "-", 
          " ", 
          RowBox[{"I", ".", 
           RowBox[{"Io", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{"4", ";;", "6"}], ",", " ", 
             RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{"m", ",", " ", "c", ",", " ", "I"}], "}"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Itot", "[", "\[DoubleStruckCapitalI]c__", "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", " ", "Icom", ",", " ", "pos", ",", " ", "I"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"I", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"VectorQ", "[", "#", "]"}], ",", " ", "#", ",", " ", 
             RowBox[{"Sequence", "@@", "#"}]}], "]"}], "&"}], " ", "/@", " ", 
          RowBox[{"{", "\[DoubleStruckCapitalI]c", "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "the", " ", "spatial", " ", "inertias", " ", "assuming", 
          " ", "same", " ", "origin", " ", "O"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Plus", "@@", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"m", " ", "=", " ", 
             RowBox[{
             "si", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"pos", " ", "=", " ", 
             RowBox[{"si", "\[LeftDoubleBracket]", 
              RowBox[{"2", ";;", "7"}], "\[RightDoubleBracket]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "si", "]"}], " ", "\[Equal]", " ", 
               "10"}], ",", " ", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Icom", " ", "=", " ", 
                RowBox[{"DiagonalMatrix", "[", 
                 RowBox[{"si", "\[LeftDoubleBracket]", 
                  RowBox[{"8", ";;", "10"}], "\[RightDoubleBracket]"}], 
                 "]"}]}], ";"}], ",", " ", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Icom", " ", "=", " ", 
                RowBox[{"Partition", "[", 
                 RowBox[{
                  RowBox[{"si", "\[LeftDoubleBracket]", 
                   RowBox[{"8", ";;", "16"}], "\[RightDoubleBracket]"}], ",", 
                  " ", "3"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Io", "[", 
             RowBox[{"m", ",", " ", "pos", ",", " ", "Icom"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"si", ",", " ", "I"}], "}"}]}], "\[IndentingNewLine]", 
          "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5883680626736507`*^9, 3.5883681143362107`*^9}, {
   3.5883682419934025`*^9, 3.588368284735835*^9}, {3.588368380658026*^9, 
   3.588368423193433*^9}, {3.588368475327829*^9, 3.588368546857668*^9}, {
   3.588368595975931*^9, 3.588368596300953*^9}, {3.588369090868146*^9, 
   3.5883691136090345`*^9}, {3.588369205784746*^9, 3.5883692197225175`*^9}, {
   3.588369266813512*^9, 3.588369371765544*^9}, {3.588369407717795*^9, 
   3.5883694952092605`*^9}, {3.588369545997448*^9, 3.588369553163358*^9}, {
   3.5883696039293337`*^9, 3.588369606561659*^9}, {3.588369683777155*^9, 
   3.5883696908660717`*^9}, {3.588369774724355*^9, 3.5883698415087204`*^9}, {
   3.5883698953355613`*^9, 3.5883699325762568`*^9}, {3.5883699786548586`*^9, 
   3.5883699788058777`*^9}, {3.588370034738986*^9, 3.5883701184452534`*^9}, {
   3.5883701607107553`*^9, 3.588370163186053*^9}, {3.5883702770377665`*^9, 
   3.5883703695715156`*^9}, {3.588370402145919*^9, 3.58837040223193*^9}, {
   3.5883705166322165`*^9, 3.5883705423064837`*^9}, {3.5883705807383637`*^9, 
   3.5883706676898165`*^9}, {3.588370700046929*^9, 3.5883708000246363`*^9}, {
   3.5883708518594575`*^9, 3.5883708650221305`*^9}, {3.588370895914056*^9, 
   3.5883709294949284`*^9}, {3.5883710098921447`*^9, 3.588371015808897*^9}, {
   3.5883710855107574`*^9, 3.588371219120737*^9}, {3.5883712635052185`*^9, 
   3.5883713466527863`*^9}, {3.5883713938811073`*^9, 3.588371397482565*^9}, {
   3.588371430981823*^9, 3.5883714315389047`*^9}, {3.5883714709599037`*^9, 
   3.5883715566387973`*^9}, {3.588371625410557*^9, 3.5883716256115613`*^9}, {
   3.5883716564344997`*^9, 3.588371678999352*^9}, {3.5883718223285637`*^9, 
   3.5883718226596255`*^9}, {3.588371899312368*^9, 3.5883719346798444`*^9}, {
   3.5883721065496883`*^9, 3.5883721367865314`*^9}, {3.5883721699897523`*^9, 
   3.5883721951099434`*^9}, {3.588372236232172*^9, 3.5883722423299446`*^9}, {
   3.5883723496965914`*^9, 3.5883723707682877`*^9}, {3.5883724747953606`*^9, 
   3.5883725442066402`*^9}, {3.5883726026810713`*^9, 3.588372703934963*^9}, {
   3.588372734290309*^9, 3.588372734823393*^9}, {3.5883728288863316`*^9, 
   3.5883728292193923`*^9}, {3.5883731311981635`*^9, 
   3.5883731373089404`*^9}, {3.588373190706727*^9, 3.5883732155088954`*^9}, {
   3.5883733203762074`*^9, 3.5883734370666227`*^9}, {3.588374387376834*^9, 
   3.5883743997534094`*^9}, 3.588376127164132*^9, {3.58837619826116*^9, 
   3.588376300234121*^9}, 3.5883771643741174`*^9, {3.5885019440497904`*^9, 
   3.5885019451106215`*^9}, {3.5885022197203474`*^9, 3.588502221810779*^9}, {
   3.588847690393952*^9, 3.5888477180614815`*^9}, {3.588847917951976*^9, 
   3.588847947997794*^9}, {3.5888480928672247`*^9, 3.588848120934806*^9}, {
   3.5888570995067177`*^9, 3.588857132309902*^9}, {3.5888571683324656`*^9, 
   3.5888571854316397`*^9}, {3.588857255695913*^9, 3.588857305054199*^9}, {
   3.588857369915962*^9, 3.588857391193657*^9}, 3.5888574423079824`*^9, {
   3.588857496454846*^9, 3.5888574980750494`*^9}, {3.5888575310222588`*^9, 
   3.588857531487299*^9}, {3.5888576712890615`*^9, 3.5888576722131815`*^9}, {
   3.5888577612303767`*^9, 3.5888577612884026`*^9}, {3.5888581422372007`*^9, 
   3.588858143795399*^9}, {3.588858251476533*^9, 3.5888582615977335`*^9}, {
   3.5888583179959016`*^9, 3.588858323153573*^9}, {3.588858366309039*^9, 
   3.588858366735096*^9}, {3.588858753489617*^9, 3.5888587686955495`*^9}, {
   3.588858813643262*^9, 3.58885881821986*^9}, {3.5888827458164062`*^9, 
   3.5888827542294784`*^9}, {3.5922436151059265`*^9, 3.592243653012251*^9}, {
   3.5922436856685643`*^9, 3.5922437073561068`*^9}, {3.5922447134690824`*^9, 
   3.592244720937848*^9}, {3.5922452877983294`*^9, 3.592245311267125*^9}, {
   3.592246179893828*^9, 3.5922462054251237`*^9}, {3.592246268800248*^9, 
   3.5922462901909328`*^9}, {3.5922478370689583`*^9, 
   3.5922478446314545`*^9}, {3.59224830647611*^9, 3.5922483836012583`*^9}, {
   3.5922484549607725`*^9, 3.5922485309140472`*^9}, {3.5922497934008913`*^9, 
   3.592249951291827*^9}, {3.5922500014950495`*^9, 3.592250025573221*^9}, {
   3.5922500565264072`*^9, 3.592250059729539*^9}, {3.592250177151639*^9, 
   3.592250226854863*^9}, {3.5923505293884087`*^9, 3.592350553375779*^9}, {
   3.592787044096955*^9, 3.592787044662984*^9}, {3.602519741383647*^9, 
   3.6025197975712566`*^9}, {3.6025198334619493`*^9, 
   3.6025198475244765`*^9}, {3.6025199087589903`*^9, 3.602519951743431*^9}, {
   3.6025428688950777`*^9, 3.6025429198389854`*^9}, {3.6025429616583805`*^9, 
   3.602542962475433*^9}, {3.6824795511309276`*^9, 3.682479684054914*^9}, {
   3.682479848265745*^9, 3.6824799949306173`*^9}, {3.682480248076683*^9, 
   3.6824802530215116`*^9}, {3.682480378365342*^9, 3.682480384373881*^9}, {
   3.7173738116929684`*^9, 3.7173738356150875`*^9}, {3.7173745456626225`*^9, 
   3.7173745698816214`*^9}, {3.7173746145695953`*^9, 3.717374646523032*^9}, {
   3.717374769571169*^9, 3.717374803540269*^9}, {3.7173752197430544`*^9, 
   3.7173752208836784`*^9}, {3.717375252790256*^9, 3.7173752533684034`*^9}, {
   3.717376737607832*^9, 3.7173767541392655`*^9}, {3.717377879197674*^9, 
   3.7173779328857265`*^9}, {3.7173792753069086`*^9, 3.71737934146385*^9}, 
   3.7173793775892205`*^9, {3.717380132578723*^9, 3.717380132828741*^9}, {
   3.7173801949231105`*^9, 3.717380205970101*^9}, {3.7175084942304*^9, 
   3.7175085098555593`*^9}, {3.7175085692468095`*^9, 3.717508569621798*^9}, {
   3.717508741873567*^9, 
   3.7175088228118973`*^9}},ExpressionUUID->"e1f7f68d-8f82-484c-9cba-\
1625951c9237"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spatial Kinematic and Dynamic Functions", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717361836037048*^9, 3.717361836927682*^9}, {3.717469190519846*^9, 
  3.7174692100981727`*^9}, {3.7175063780990095`*^9, 
  3.717506415786895*^9}},ExpressionUUID->"8ce4e066-1ccd-4d44-ab6c-\
d5639d28e959"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"agfun", "::", "g"}], " ", "=", " ", 
    "\"\<Gravity not set.  Default is zero g.  Call RBDGravity[...] to \
change.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"agfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"Lookup", "[", 
      RowBox[{"rb", ",", " ", "\"\<g\>\"", ",", " ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"agfun", "::", "g"}], "]"}], ";", " ", 
        RowBox[{"(", 
         RowBox[{"z6", "&"}], ")"}]}]}], "]"}], "[", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"x", " ", "===", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"Array", "[", 
         RowBox[{"\[DoubleStruckX]", ",", " ", "nx"}], "]"}], ",", " ", "x"}],
        "]"}], ",", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"\[Lambda]", " ", "===", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"Array", "[", 
         RowBox[{"\[DoubleStruckC]", ",", " ", "nc"}], "]"}], ",", " ", 
        "\[Lambda]"}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"XLfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateSpatialFunction", "[", 
     RowBox[{"\"\<XL\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sfun", "[", 
    RowBox[{
     RowBox[{"x_:", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\[Lambda]_:", 
      RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"EvaluateSpatialFunction", "[", 
    RowBox[{"\"\<s\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalI]fun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateSpatialFunction", "[", 
     RowBox[{
     "\"\<\[DoubleStruckCapitalI]\>\"", ",", " ", "x", ",", " ", 
      "\[Lambda]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sdotfun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"EvaluateSpatialFunction", "[", 
     RowBox[{"\"\<sdot\>\"", ",", " ", "x", ",", " ", "\[Lambda]"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"XL0fun", "[", 
     RowBox[{
      RowBox[{"x_:", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\[Lambda]_:", 
       RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bx", " ", "=", " ", "nq"}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{"compute", " ", "all", " ", "XL0"}], " ", "*)"}], "}"}], ",", 
      " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"XL", " ", "=", " ", 
        RowBox[{"XLfun", "[", 
         RowBox[{"x", ",", " ", "\[Lambda]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"X0", "[", "]"}], ";", "\[IndentingNewLine]", "XL0"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EvaluateSpatialFunction", "[", 
    RowBox[{"spat_", ",", " ", 
     RowBox[{"x_:", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\[Lambda]_:", 
      RowBox[{"{", "}"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f", ",", " ", "a", ",", " ", "b"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"\[DoubleStruckX]", ",", " ", "nx"}], "]"}], ",", " ", 
         "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"\[Lambda]", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Array", "[", 
          RowBox[{"\[DoubleStruckC]", ",", " ", "nc"}], "]"}], ",", " ", 
         "\[Lambda]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Values", "@", 
         RowBox[{"RBDGetLinkInfo", "[", 
          RowBox[{"spat", ",", " ", "False"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Through", "[", 
       RowBox[{"f", "[", 
        RowBox[{"a", ",", " ", "b"}], "]"}], "]"}]}]}], "\[IndentingNewLine]",
     "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717514273917246*^9, 3.7175143809808445`*^9}, {
   3.7175144163885374`*^9, 3.717514441607547*^9}, {3.717514478576676*^9, 
   3.717514634047021*^9}, {3.717514764392109*^9, 3.717514773798456*^9}, {
   3.7175192810560637`*^9, 3.717519692732181*^9}, {3.717519727779401*^9, 
   3.717519735779484*^9}, {3.7175198124052687`*^9, 3.7175198552182226`*^9}, {
   3.71751989921866*^9, 3.7175199643755784`*^9}, {3.7175200025947313`*^9, 
   3.71752001079793*^9}, {3.7175200664547663`*^9, 3.71752009148627*^9}, {
   3.7176357951655927`*^9, 3.7176358413222694`*^9}, {3.717636292779684*^9, 
   3.7176363618116074`*^9}, {3.7176368623632245`*^9, 
   3.7176368838790646`*^9}, {3.7176370671620464`*^9, 
   3.7176371418033905`*^9}, {3.717686939931197*^9, 3.7176869463531346`*^9}, {
   3.7176945105367055`*^9, 3.7176945108023186`*^9}, {3.7177018114831476`*^9, 
   3.7177019274061375`*^9}, {3.717733529475613*^9, 3.7177335317568717`*^9}, {
   3.7177337798686185`*^9, 3.717733810134531*^9}, {3.7177592280393496`*^9, 
   3.717759257524006*^9}, {3.7178062784280696`*^9, 3.7178063926322813`*^9}, {
   3.718217382282749*^9, 3.7182174121111684`*^9}, {3.7182174575335035`*^9, 
   3.7182174577834964`*^9}, {3.7186526917580533`*^9, 
   3.7186526929768033`*^9}, {3.718891373265644*^9, 3.7188913950314827`*^9}, {
   3.719161132782914*^9, 3.7191611397204866`*^9}, 
   3.7191620471713753`*^9},ExpressionUUID->"33f25ff6-b701-4d39-9f2e-\
7c7befe3f434"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"RBDSpatialFunctions", ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDSpatialFunctions", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"GetExpandedTree", "[", "]"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"calls", " ", 
         RowBox[{"GetTree", "[", "...", "]"}], " ", "internally"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"get", " ", "link", " ", "names"}], ",", " ", 
         RowBox[{"if", " ", "they", " ", "exist"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"RBDSpatialFunctions", "[", 
        RowBox[{"Keys", "@", 
         RowBox[{"Lookup", "[", 
          RowBox[{"rb", ",", " ", "TreeForm", ",", " ", 
           RowBox[{"{", "}"}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDSpatialFunctions", "[", "b_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "k", ",", " ", "jc", ",", " ", "S", ",", " ", "XT", ",", 
       " ", "sfun", ",", " ", "sdotfun", ",", " ", "Xfun", 
       RowBox[{"(*", 
        RowBox[{",", " ", "Xdotfun"}], "*)"}], ",", " ", "Ifun"}], "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"jc", " ", "=", " ", 
       RowBox[{"rb", "[", 
        RowBox[{"b", ",", " ", "\"\<joint\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"S", " ", "=", " ", 
       RowBox[{"joint", "[", "jc", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Max", "[", 
        RowBox[{"1", ",", " ", 
         RowBox[{"Length", "@", "S"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sfun", " ", "=", " ", 
       RowBox[{"Xfun", " ", "=", " ", 
        RowBox[{"Ifun", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", " ", "n"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "create", " ", "pure", " ", "functions", " ", "for", " ", "s"}], ",", 
        " ", "X", ",", " ", "I"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"VectorQ", "[", 
         RowBox[{"S", ",", " ", "StringQ"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"jc", " ", "=", " ", "S"}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{"save", " ", "names"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "set", " ", "motion", " ", "freedoms", " ", "for", " ", "expanded",
             " ", "links"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "sfun", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
             " ", "=", " ", 
             RowBox[{
              RowBox[{"joint", "[", 
               RowBox[{
               "jc", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
               "]"}], "[", 
              RowBox[{"\[DoubleStruckQ]", "[", 
               RowBox[{"b", ",", "k"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "links", " ", "2", " ", "to", " ", "n", " ", "are", " ", 
              "coincident", " ", "with", " ", "link", " ", "1"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"XT", " ", "=", " ", "I6"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Xfun", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
             " ", "=", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"XJ", "[", 
                RowBox[{
                "jc", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
                "]"}], "[", 
               RowBox[{"\[DoubleStruckQ]", "[", 
                RowBox[{"b", ",", "k"}], "]"}], "]"}], ".", "XT"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "zero", " ", "inertia", " ", "for", " ", "links", " ", "1", " ",
                "to", " ", "n"}], "-", "1"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Ifun", "\[LeftDoubleBracket]", 
              RowBox[{"k", "-", "1"}], "\[RightDoubleBracket]"}], " ", "=", 
             " ", "Z6"}], ";"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"k", ",", " ", "2", ",", " ", "n"}], "}"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"now", " ", "get", " ", "1"}], "-", 
           RowBox[{
           "dof", " ", "code", " ", "of", " ", "first", " ", "expanded", " ", 
            "joint", " ", "of", " ", "i"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"jc", " ", "=", " ", 
          RowBox[{
          "jc", " ", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"S", " ", "=", " ", 
          RowBox[{"joint", "[", "jc", "]"}]}], ";"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "set", " ", "up", " ", "first", " ", "and", " ", "last", " ", 
         "links"}], ";", " ", 
        RowBox[{
         RowBox[{"these", " ", "are", " ", "equal", " ", "for", " ", "1"}], 
         "-", 
         RowBox[{"dof", " ", "links"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sfun", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        " ", "=", " ", 
       RowBox[{"S", "[", 
        RowBox[{"\[DoubleStruckQ]", "[", 
         RowBox[{"b", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"XT", " ", "=", " ", 
       RowBox[{"Xba", "[", 
        RowBox[{"rb", "[", 
         RowBox[{"b", ",", " ", "\"\<frame\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Xfun", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
        " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"XJ", "[", "jc", "]"}], "[", 
         RowBox[{"\[DoubleStruckQ]", "[", 
          RowBox[{"b", ",", "1"}], "]"}], "]"}], ".", "XT"}]}], ";", " ", 
      RowBox[{"(*", " ", 
       RowBox[{"parent", " ", "to", " ", "child", " ", "transform"}], " ", 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Ifun", "\[LeftDoubleBracket]", 
        RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
       RowBox[{"Itot", "[", 
        RowBox[{"rb", "[", 
         RowBox[{"b", ",", " ", "\"\<inertia\>\""}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"make", " ", "pure", " ", "functions"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"S", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"ConvertToXLFunction", "[", 
          RowBox[{"#", ",", " ", 
           RowBox[{"\"\<dot\>\"", " ", "\[Rule]", " ", "True"}]}], "]"}], 
         "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "&"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "sdotfun", 
        RowBox[{"(*", 
         RowBox[{",", " ", "Xdotfun"}], "*)"}], "}"}], " ", "=", " ", 
       RowBox[{"Map", "[", 
        RowBox[{"S", ",", " ", 
         RowBox[{"{", "sfun", 
          RowBox[{"(*", 
           RowBox[{",", " ", "Xfun"}], "*)"}], "}"}], ",", " ", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"sfun", ",", " ", "Xfun", ",", " ", "Ifun"}], "}"}], " ", "=",
        " ", 
       RowBox[{"Map", "[", 
        RowBox[{"ConvertToXLFunction", ",", " ", 
         RowBox[{"{", 
          RowBox[{"sfun", ",", " ", "Xfun", ",", " ", "Ifun"}], "}"}], ",", 
         " ", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"S", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"sfun", ",", " ", "sdotfun", ",", " ", "Xfun", 
         RowBox[{"(*", 
          RowBox[{",", " ", "Xdotfun"}], "*)"}], ",", " ", "Ifun"}], "}"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"S", " ", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<s\>\"", ",", " ", "\"\<sdot\>\"", ",", " ", "\"\<XL\>\"", 
          RowBox[{"(*", 
           RowBox[{",", " ", "\"\<XLdot\>\""}], "*)"}], ",", " ", 
          "\"\<\[DoubleStruckCapitalI]\>\""}], "}"}], " ", "\[Rule]", " ", 
        "S"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AssociateTo", "[", 
       RowBox[{
        RowBox[{"rb", "[", "b", "]"}], ",", " ", 
        RowBox[{"AssociationThread", "[", "S", "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717506515287917*^9, 3.717506515819173*^9}, {
   3.7175065701478558`*^9, 3.7175066810708785`*^9}, {3.7175068311349096`*^9, 
   3.7175068311349096`*^9}, {3.71750699156735*^9, 3.7175070025205865`*^9}, {
   3.717507087365224*^9, 3.7175071733973417`*^9}, 3.7175072268197794`*^9, {
   3.7175073318789234`*^9, 3.7175073640823965`*^9}, {3.717507396785842*^9, 
   3.7175074300986834`*^9}, {3.717507515677702*^9, 3.717507638330988*^9}, {
   3.717507681878312*^9, 3.7175076834408426`*^9}, {3.717507714284895*^9, 
   3.717507752191534*^9}, {3.7175078310829844`*^9, 3.7175078660208416`*^9}, {
   3.71750789838055*^9, 3.7175079291621003`*^9}, {3.717507960646798*^9, 
   3.717508033335044*^9}, {3.7175081002888565`*^9, 3.7175081034607644`*^9}, 
   3.7175081491018577`*^9, {3.717508194399197*^9, 3.717508267790576*^9}, {
   3.7175082992908993`*^9, 3.717508347213266*^9}, {3.7175084202765164`*^9, 
   3.7175084455736485`*^9}, {3.717508657060196*^9, 3.7175086725291033`*^9}, 
   3.717508849202793*^9, {3.7175088823593836`*^9, 3.7175088901094627`*^9}, {
   3.7175090153294973`*^9, 3.7175092646914325`*^9}, {3.7175093113012867`*^9, 
   3.717509442887245*^9}, {3.7175095132160783`*^9, 3.7175096202328157`*^9}, {
   3.717509657530074*^9, 3.717509659608205*^9}, {3.7175096922022896`*^9, 
   3.7175096953741975`*^9}, {3.7175097505310135`*^9, 3.717509792859574*^9}, {
   3.717509825953663*^9, 3.717509830609975*^9}, {3.7175101796291685`*^9, 
   3.7175102341766024`*^9}, {3.7175102651300464`*^9, 3.717510265411298*^9}, {
   3.7175103237556467`*^9, 3.717510345974625*^9}, {3.7175103827093773`*^9, 
   3.7175103832093925`*^9}, {3.7175106013991213`*^9, 3.717510649040236*^9}, {
   3.717510715040913*^9, 3.7175107589944897`*^9}, {3.717511847911916*^9, 
   3.7175118978499274`*^9}, {3.7175119352565613`*^9, 3.717511938569095*^9}, {
   3.717511980241399*^9, 3.717511995632181*^9}, {3.7175120322731967`*^9, 
   3.7175120665079093`*^9}, {3.717512165337063*^9, 3.7175121679777*^9}, 
   3.7175122977602835`*^9, {3.717513682676804*^9, 3.7175137332241983`*^9}, {
   3.71751376944332*^9, 3.717513812975032*^9}, {3.7175192634308844`*^9, 
   3.717519263884013*^9}, {3.7176366504237247`*^9, 3.717636680549012*^9}, {
   3.7176367240494204`*^9, 3.7176367315182295`*^9}, {3.7176819146778097`*^9, 
   3.7176819146778097`*^9}, {3.717685560873868*^9, 3.717685628546368*^9}, {
   3.7176856837656603`*^9, 3.7176856896719513`*^9}, {3.717685792360443*^9, 
   3.7176857974854755`*^9}, {3.717686048486351*^9, 3.717686061798978*^9}, {
   3.7176861559248857`*^9, 3.7176861583155217`*^9}, {3.717686195236615*^9, 
   3.7176862173461895`*^9}, {3.717686448426512*^9, 3.717686485317486*^9}, {
   3.7176865208959613`*^9, 3.7176865416305227`*^9}, {3.717686613693718*^9, 
   3.717686617006236*^9}, {3.717686703710188*^9, 3.7176867308041925`*^9}, {
   3.71768678602347*^9, 3.717686818773779*^9}, {3.7176876604511423`*^9, 
   3.7176876650761995`*^9}, {3.7176941744292827`*^9, 3.717694337212081*^9}, {
   3.7176943795823393`*^9, 3.717694464942524*^9}, {3.7177334145838785`*^9, 
   3.7177334358966002`*^9}, {3.717733490631494*^9, 3.717733506006636*^9}, {
   3.71773383822853*^9, 3.7177338507442827`*^9}, 3.718652203860999*^9, {
   3.7186584556181803`*^9, 3.718658486899751*^9}, {3.7186585298532906`*^9, 
   3.718658589650755*^9}, 3.718658703467288*^9, 3.7186587363113637`*^9, {
   3.718660496132881*^9, 3.718660498664158*^9}, {3.718660856574392*^9, 
   3.718660856886894*^9}, {3.719625222414308*^9, 3.719625253883333*^9}, 
   3.719625285555461*^9},ExpressionUUID->"7f90d05f-2894-4262-96b9-\
2e6b3b4e4811"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spatial Position Functions", "Section",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311097962296*^9}, {
  3.6031988982844105`*^9, 3.6031988992664633`*^9}, {3.717374214350443*^9, 
  3.7173742259755697`*^9}, {3.7173743404298687`*^9, 3.717374355351886*^9}, {
  3.717374467743664*^9, 
  3.7173744707124605`*^9}},ExpressionUUID->"7014d913-9c0c-40f0-aa56-\
4d03f73e1e7a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MovePoint", "[", 
    RowBox[{"X_", ",", " ", "p_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"R", ",", " ", "fr"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"SE", 
       RowBox[{"(", "3", ")"}], " ", "transformation"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"R", " ", "=", " ", 
       RowBox[{"X", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", "3"}], ",", 
         RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fr", " ", "=", " ", 
       RowBox[{
        RowBox[{"R", "\[Transpose]"}], ".", 
        RowBox[{"X", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"4", ";;", "6"}], ",", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fr", " ", "=", " ", 
       RowBox[{"-", 
        RowBox[{"deskew", "[", "fr", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"R", "\[Transpose]"}], ".", "p"}], " ", "+", " ", "fr"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5925800798078823`*^9, 3.592580174479306*^9}, {
   3.592776312837759*^9, 3.5927763407003565`*^9}, {3.593627168155368*^9, 
   3.593627211874185*^9}, {3.593627295671241*^9, 3.5936273048587413`*^9}, {
   3.593627503609131*^9, 3.5936275164372807`*^9}, {3.593627906806323*^9, 
   3.5936279119469423`*^9}, {3.5936280474472046`*^9, 
   3.5936280476503325`*^9}, {3.5936283651040916`*^9, 3.593628365291579*^9}, {
   3.593628399494771*^9, 3.5936284167291794`*^9}, {3.593628449510495*^9, 
   3.5936286138858156`*^9}, {3.5936287337141743`*^9, 
   3.5936288710425706`*^9}, {3.5936291113242874`*^9, 3.59362912383994*^9}, {
   3.593977239640683*^9, 3.5939772400457067`*^9}, {3.5939774736290827`*^9, 
   3.5939774892599773`*^9}, {3.593977529858302*^9, 3.5939775574478827`*^9}, {
   3.5939776276829004`*^9, 3.593977630512067*^9}, {3.5939776716154203`*^9, 
   3.59397767177343*^9}, {3.593979563804775*^9, 3.5939796033810453`*^9}, {
   3.5939796708479075`*^9, 3.593979671595952*^9}, {3.593979707148986*^9, 
   3.5939797158334866`*^9}, {3.5939797723117204`*^9, 
   3.5939798003103237`*^9}, {3.5939800314975624`*^9, 
   3.5939800575030518`*^9}, {3.593980151672445*^9, 3.593980152483491*^9}, {
   3.593980226132709*^9, 3.593980264101882*^9}, {3.5939803358909893`*^9, 
   3.5939803422393584`*^9}, {3.593981852960452*^9, 3.593981873175627*^9}, {
   3.5939819771615677`*^9, 3.593981999737857*^9}, {3.593982128643239*^9, 
   3.5939822369964447`*^9}, {3.593982457029044*^9, 3.5939824621553373`*^9}, {
   3.593982518214548*^9, 3.593982554379616*^9}, {3.5939831159877806`*^9, 
   3.593983135672908*^9}, {3.5939834614415636`*^9, 3.5939834784325323`*^9}, {
   3.593983591802043*^9, 3.593983638667712*^9}, {3.593983679425042*^9, 
   3.5939836804971046`*^9}, {3.593983735234242*^9, 3.593984013060153*^9}, {
   3.593984236317938*^9, 3.593984239229104*^9}, 3.5939842884139214`*^9, {
   3.593984442982768*^9, 3.5939844636829586`*^9}, {3.593984499546014*^9, 
   3.5939844998900323`*^9}, {3.5939877505601826`*^9, 3.593987757332592*^9}, {
   3.5939882319557724`*^9, 3.5939883617431936`*^9}, {3.593988417378372*^9, 
   3.593988475678712*^9}, {3.5939885360671663`*^9, 3.5939885513260427`*^9}, {
   3.5939895256118374`*^9, 3.5939895318511953`*^9}, {3.593990437675069*^9, 
   3.5939904577952204`*^9}, {3.6027645461483793`*^9, 
   3.6027646265429845`*^9}, {3.60276466281406*^9, 3.602764713941988*^9}, {
   3.6027647647398977`*^9, 3.6027647699531965`*^9}, {3.6027648486327066`*^9, 
   3.602764936115711*^9}, {3.602764978749154*^9, 3.602765143323577*^9}, {
   3.6027652619913735`*^9, 3.6027654387924986`*^9}, 3.602765470973341*^9, {
   3.6027655070604076`*^9, 3.602765516082924*^9}, {3.6027656698287363`*^9, 
   3.602765669993738*^9}, {3.602765764259132*^9, 3.602765851653141*^9}, 
   3.6027659006269565`*^9, {3.602765971169986*^9, 3.6027660839214425`*^9}, {
   3.6027661687032967`*^9, 3.6027661808309917`*^9}, {3.602766216544037*^9, 
   3.6027662168040514`*^9}, {3.602766272494241*^9, 3.6027662937004557`*^9}, {
   3.6027663492206345`*^9, 3.6027664075679765`*^9}, {3.6027665001412773`*^9, 
   3.602766554860411*^9}, {3.6027666300297165`*^9, 3.602766655156152*^9}, {
   3.6027668632550716`*^9, 3.602766869528431*^9}, {3.6027669053754835`*^9, 
   3.602766906138528*^9}, {3.6027669379293485`*^9, 3.6027669744264383`*^9}, {
   3.6027670534099617`*^9, 3.602767055068057*^9}, {3.602767163332257*^9, 
   3.602767181319287*^9}, {3.6027672720784845`*^9, 3.6027673242804737`*^9}, {
   3.602767414992668*^9, 3.602767484546651*^9}, {3.602767527843128*^9, 
   3.6027676298989887`*^9}, {3.6027676979998755`*^9, 3.602767708151458*^9}, {
   3.602767949785294*^9, 3.602768003669379*^9}, {3.602768068927117*^9, 
   3.6027680690061207`*^9}, {3.6027684256915474`*^9, 
   3.6027684813187327`*^9}, {3.602768518439859*^9, 3.6027685211060114`*^9}, {
   3.6027688797395487`*^9, 3.6027688835337667`*^9}, 3.6027689279923124`*^9, {
   3.602769073527646*^9, 3.602769080572064*^9}, {3.602769112582883*^9, 
   3.602769115874072*^9}, {3.602769188562235*^9, 3.602769212169586*^9}, {
   3.6027692804965005`*^9, 3.6027692818885784`*^9}, 3.6027693639532776`*^9, {
   3.60294606061063*^9, 3.6029460849231777`*^9}, {3.612892396487505*^9, 
   3.612892430675063*^9}, {3.6128924716907673`*^9, 3.6128924782689056`*^9}, {
   3.6128930834936204`*^9, 3.61289309071239*^9}, {3.6128931616031666`*^9, 
   3.6128932156657543`*^9}, {3.6128932767127485`*^9, 3.612893294634677*^9}, {
   3.61289332572847*^9, 3.6128933694160595`*^9}, 3.612893529150742*^9, {
   3.612893956260954*^9, 3.612893967026599*^9}, {3.612894017870448*^9, 
   3.6128940579486513`*^9}, {3.613352659953907*^9, 3.6133526884485397`*^9}, {
   3.615393709119879*^9, 3.615393709307378*^9}, {3.620750860385141*^9, 
   3.620750863728896*^9}, {3.6207509008695965`*^9, 3.6207509847135115`*^9}, {
   3.620995407728777*^9, 3.6209954333694525`*^9}, {3.621956221226779*^9, 
   3.621956225242431*^9}, {3.6219562561799726`*^9, 3.621956259976856*^9}, {
   3.6282223902355814`*^9, 3.628222393286728*^9}, 3.628222487196066*^9, 
   3.6282225230024204`*^9, {3.6282225629616404`*^9, 3.6282225714043827`*^9}, {
   3.6510876031554813`*^9, 3.6510877364588156`*^9}, {3.6510880331609187`*^9, 
   3.6510880400828524`*^9}, {3.651088320152989*^9, 3.651088332296809*^9}, {
   3.6685536164178224`*^9, 3.6685536166249137`*^9}, {3.67805141688332*^9, 
   3.6780514201645975`*^9}, {3.678051505649757*^9, 3.6780515116185637`*^9}, {
   3.678051632476797*^9, 3.678051637398714*^9}, {3.678108493530072*^9, 
   3.6781085104208508`*^9}, {3.6781087338034554`*^9, 3.678108760410882*^9}, {
   3.67810898857034*^9, 3.6781089901641617`*^9}, {3.67810910836064*^9, 
   3.6781091306108465`*^9}, {3.6781091823146076`*^9, 3.678109182564569*^9}, {
   3.678109215846123*^9, 3.678109282596775*^9}, {3.6781093407526555`*^9, 
   3.6781093457214565`*^9}, 3.6781093944484663`*^9, {3.6781094312299967`*^9, 
   3.678109433448824*^9}, 3.6804438054447613`*^9, 3.6807326951947126`*^9, 
   3.6807329337262516`*^9, 3.6807487052378025`*^9, {3.680816984402652*^9, 
   3.6808169859107122`*^9}, {3.7173709149944973`*^9, 3.7173709193070593`*^9}, 
   3.7173742355069203`*^9, {3.717374364258239*^9, 3.717374373445833*^9}, {
   3.717504869679078*^9, 3.7175049689457235`*^9}, {3.717505003914832*^9, 
   3.7175050507278113`*^9}, 3.7175053299940414`*^9, {3.717505363744403*^9, 
   3.7175053984791207`*^9}, 3.717505441573326*^9, {3.7175054928394628`*^9, 
   3.717505543433732*^9}, {3.7175055821372538`*^9, 3.7175055822778845`*^9}, {
   3.7175056667943892`*^9, 3.7175056891852417`*^9}, {3.717505812883917*^9, 
   3.7175058136964254`*^9}, 3.717506884229203*^9, {3.7175149521127863`*^9, 
   3.717514986613139*^9}, 3.7175150924892263`*^9, {3.7175151426616325`*^9, 
   3.7175151500366917`*^9}, {3.717515975297274*^9, 3.7175160277978125`*^9}, {
   3.7175160754389253`*^9, 3.717516076610812*^9}, {3.7175161103299246`*^9, 
   3.7175161134393177`*^9}, {3.7175164253331423`*^9, 3.717516566631466*^9}, {
   3.7175166841617537`*^9, 3.717516785334667*^9}, {3.717516824835074*^9, 
   3.7175169826179433`*^9}, {3.7175170544936814`*^9, 3.717517106244211*^9}, {
   3.7175171673073397`*^9, 3.717517196776392*^9}, {3.7175172286517267`*^9, 
   3.7175173444497843`*^9}, {3.7175173800126457`*^9, 3.717517425153737*^9}, {
   3.717517504623301*^9, 3.717517751719586*^9}, {3.7175177858136873`*^9, 
   3.71751778615744*^9}, {3.7175178179233894`*^9, 3.717517849517465*^9}, {
   3.7175178897835045`*^9, 3.7175179085493217`*^9}, {3.717518042191905*^9, 
   3.717518079661024*^9}, {3.7175184180707865`*^9, 3.7175185588378706`*^9}, {
   3.7175186493856587`*^9, 3.7175186521669393`*^9}, {3.717518687948556*^9, 
   3.7175186883704357`*^9}, {3.7175189694514456`*^9, 3.717518970185828*^9}, {
   3.7175190398896694`*^9, 3.717519040639676*^9}, {3.717519167333804*^9, 
   3.717519193086412*^9}, {3.7175204616632447`*^9, 3.717520472975875*^9}, {
   3.717520512038763*^9, 3.717520602211576*^9}, {3.717520745681786*^9, 
   3.717520785822824*^9}, {3.7175208354483337`*^9, 3.717520843089034*^9}, {
   3.7175208842144737`*^9, 3.717520887917638*^9}, {3.7175209206835985`*^9, 
   3.7175209214492154`*^9}, {3.7175210162939386`*^9, 
   3.7175210232158856`*^9}, {3.717521063200671*^9, 3.717521066200712*^9}, {
   3.7175211058729944`*^9, 3.7175211073105106`*^9}, {3.7175212212804184`*^9, 
   3.717521248483823*^9}, {3.7175213955478325`*^9, 3.7175214204543524`*^9}, {
   3.717521575518429*^9, 3.717521660831815*^9}, {3.7175216958477893`*^9, 
   3.717521711910454*^9}, {3.717521745863928*^9, 3.717521748082698*^9}, {
   3.717521779723651*^9, 3.7175219046468067`*^9}, {3.7175221470086684`*^9, 
   3.7175221654151087`*^9}, {3.717602776140053*^9, 3.7176027791244555`*^9}, {
   3.7176028415156574`*^9, 3.7176029721887903`*^9}, 3.7176030159235773`*^9, {
   3.717603046939501*^9, 3.7176030643615255`*^9}, {3.717605320983097*^9, 
   3.7176053505927544`*^9}, {3.7176054873909245`*^9, 
   3.7176054874065375`*^9}, {3.7176060062396097`*^9, 3.71760601289592*^9}, {
   3.7176061345533295`*^9, 3.717606195585159*^9}, {3.71763217287488*^9, 
   3.717632194031331*^9}, {3.7176322295941534`*^9, 3.7176322312035418`*^9}, {
   3.7176324791536427`*^9, 3.7176324794973955`*^9}, {3.7176326635147657`*^9, 
   3.717632870813615*^9}, {3.717632968783279*^9, 3.717632983642813*^9}, {
   3.7176330198775153`*^9, 3.717633074503033*^9}, {3.717633119753476*^9, 
   3.717633129972327*^9}, {3.717633357111596*^9, 3.7176333921744137`*^9}, {
   3.7176334974566636`*^9, 3.717633525994855*^9}, {3.7176336617243814`*^9, 
   3.7176336712401114`*^9}, {3.717633706146696*^9, 3.717633820647784*^9}, {
   3.717633866601326*^9, 3.717633867116972*^9}, {3.717633935570733*^9, 
   3.717634013352734*^9}, {3.717634070025135*^9, 3.7176341444602633`*^9}, {
   3.7176344732137175`*^9, 3.717634580777237*^9}, {3.7176346139650393`*^9, 
   3.7176346521060257`*^9}, {3.7176346904813895`*^9, 3.717634695918942*^9}, {
   3.7176347462788124`*^9, 3.717634756200765*^9}, {3.7176348568579893`*^9, 
   3.717634861873644*^9}, 
   3.717635902994731*^9},ExpressionUUID->"25303bc1-9c03-4fa2-ac61-\
84b3d362069d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"position", "[", "X_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "fr", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fr", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"X", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", "3"}], ",", 
            RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], 
          "\[Transpose]"}], ".", 
         RowBox[{"X", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"4", ";;", "6"}], ",", 
           RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"-", 
        RowBox[{"deskew", "[", "fr", "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"angle", "[", "E_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", " ", "y", ",", " ", "z"}], "}"}], ",", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "spatial", " ", "transforms", " ", "E", " ", "rotate", " ", "the", " ", 
        RowBox[{"parent", "'"}], "s", " ", "frame", " ", "\"\<backwards\>\"", 
        " ", "writing", " ", "the", " ", "frame", " ", "in", " ", "the", " ", 
        RowBox[{"child", "'"}], "s", " ", "coordinate", " ", "system"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"E", "\[LeftDoubleBracket]", 
           RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}], " ", 
          "\[Equal]", " ", 
          RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"z", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"y", " ", "=", " ", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "2"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"x", " ", "=", " ", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{"E", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "3"}], "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{"E", "\[LeftDoubleBracket]", 
              RowBox[{"2", ",", "3"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
          ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"E", "\[LeftDoubleBracket]", 
           RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}], " ", 
          "\[Equal]", " ", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"z", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
          RowBox[{"y", " ", "=", " ", 
           RowBox[{"\[Pi]", "/", "2"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"x", " ", "=", " ", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{"E", "\[LeftDoubleBracket]", 
              RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{"E", "\[LeftDoubleBracket]", 
              RowBox[{"2", ",", "3"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
          ";"}], ",", "\[IndentingNewLine]", "True", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"z", " ", "=", " ", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{"E", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{"-", 
              RowBox[{"E", "\[LeftDoubleBracket]", 
               RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"y", " ", "=", " ", 
           RowBox[{"ArcSin", "[", 
            RowBox[{"E", "\[LeftDoubleBracket]", 
             RowBox[{"3", ",", "1"}], "\[RightDoubleBracket]"}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"x", " ", "=", " ", 
           RowBox[{"ArcTan", "[", 
            RowBox[{
             RowBox[{"E", "\[LeftDoubleBracket]", 
              RowBox[{"3", ",", "3"}], "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{"-", 
              RowBox[{"E", "\[LeftDoubleBracket]", 
               RowBox[{"3", ",", "2"}], "\[RightDoubleBracket]"}]}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"x", ",", " ", "y", ",", " ", "z"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Tba", "[", "X_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"E", ",", " ", "r"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "from", " ", "6", "x6", " ", "spatial", " ", "coordinates", " ", "to", 
       " ", "4", "x4", " ", "homogenous", " ", "coordinates"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"E", " ", "=", " ", 
       RowBox[{"X", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", "3"}], ",", " ", 
         RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"position", "[", "X", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"-", 
        RowBox[{"E", ".", "r"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"E", ",", " ", 
           RowBox[{
            RowBox[{"{", "r", "}"}], "\[Transpose]"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "1"}], "}"}]}], "}"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RBDSpatialPosition", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<Ep\>\"", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"\"\<o\>\"", " ", "\[Rule]", " ", "Root"}], ",", " ", 
      RowBox[{"\"\<x\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}], ",", " ", 
      RowBox[{"\"\<\[Lambda]\>\"", " ", "\[Rule]", " ", 
       RowBox[{"{", "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDSpatialPosition", "[", 
     RowBox[{
      RowBox[{"X_", "?", "MatrixQ"}], ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"E", ",", " ", "p"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"X", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", " ", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"position", "[", "X", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<Ep\>\"", "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"E", ",", " ", "p"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"MatrixQ", "[", 
          RowBox[{"E", ",", " ", "NumericQ"}], "]"}], ",", " ", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"EulerAngles", "[", 
            RowBox[{
             RowBox[{"E", "\[Transpose]"}], " ", 
             RowBox[{"(*", " ", 
              RowBox[{"R", " ", "\[Element]", " ", 
               RowBox[{"SO", 
                RowBox[{"(", "3", ")"}]}]}], " ", "*)"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", " ", 
           "p"}], "]"}], ",", "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{"Join", "[", 
          RowBox[{"z3", ",", " ", "p"}], "]"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"bug", " ", "need", " ", "to", " ", "use", " ", 
    RowBox[{"OptionValue", "[", "\"\<a\>\"", "]"}], " ", "as", " ", "well"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDSpatialPosition", "[", 
     RowBox[{"\[DoubleStruckB]", "[", 
      RowBox[{"b_", ",", " ", "r_", ",", " ", "Xcb_", ",", " ", 
       RowBox[{"opts", ":", 
        RowBox[{"OptionsPattern", "[", "\[DoubleStruckB]", "]"}]}]}], "]"}], 
     "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", " ", "x", ",", " ", "o"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"redirect", " ", 
        RowBox[{"\[DoubleStruckB]", "[", 
         RowBox[{"b", ",", " ", "r", ",", " ", "Xcb", ",", " ", "o"}], "]"}], 
        " ", "here"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"o", " ", "=", " ", 
        RowBox[{"OptionValue", "[", 
         RowBox[{"\[DoubleStruckB]", ",", " ", 
          RowBox[{"{", "opts", "}"}], ",", " ", "\"\<o\>\""}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"RBDGetValue", "[", 
         RowBox[{"1", ",", " ", "nx"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"RBDSpatialPosition", "[", 
         RowBox[{"Xcb", ",", " ", "b", ",", " ", 
          RowBox[{"\"\<x\>\"", " ", "\[Rule]", " ", "x"}], ",", " ", 
          RowBox[{"\"\<Ep\>\"", " ", "\[Rule]", " ", "False"}], ",", " ", 
          RowBox[{"\"\<o\>\"", " ", "\[Rule]", " ", "o"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"o", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
          RowBox[{
          "1", " ", "\[LessEqual]", " ", "#", " ", "\[LessEqual]", " ", 
           "nm"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"IntegerQ", "[", "r", "]"}], " ", "||", " ", 
          RowBox[{"VectorQ", "[", 
           RowBox[{"r", ",", " ", "o"}], "]"}]}], ",", " ", 
         RowBox[{
          RowBox[{"Sign", "[", "r", "]"}], 
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"Abs", "[", "r", "]"}], "\[RightDoubleBracket]"}]}], ",", 
         " ", 
         RowBox[{"r", ".", "x"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDSpatialPosition", "[", 
     RowBox[{
      RowBox[{"XL0_", " ", "/;", " ", 
       RowBox[{"MatrixQ", "[", 
        RowBox[{"XL0", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
         "]"}]}], ",", " ", "Xcb_", ",", " ", "b_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", " ", "j", ",", " ", "X"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "when", " ", "animating", " ", "use", " ", "this", " ", "version"}], 
       " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i", " ", "=", " ", 
        RowBox[{"RBDGetPositionIndex", "[", "b", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"j", " ", "=", " ", 
        RowBox[{"RBDGetPositionIndex", "[", 
         RowBox[{"OptionValue", "[", "\"\<o\>\"", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"X", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"VectorQ", "[", "Xcb", "]"}], ",", " ", 
          RowBox[{"Xba", "[", 
           RowBox[{"PadLeft", "[", 
            RowBox[{"Xcb", ",", " ", "nm"}], "]"}], "]"}], ",", " ", "Xcb"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"X", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", " ", "\[Equal]", " ", "0"}], ",", " ", "X", ",", " ", 
          RowBox[{"X", ".", 
           RowBox[{
           "XL0", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"X", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"j", " ", "\[Equal]", " ", "0"}], ",", " ", "X", ",", " ", 
          RowBox[{"X", ".", 
           RowBox[{"InvXba", "[", 
            RowBox[{
            "XL0", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
            "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"RBDSpatialPosition", "[", 
        RowBox[{"X", ",", " ", "opts"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDSpatialPosition", "[", 
    RowBox[{"Xcb_", ",", " ", "b_", ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", " ", "j", ",", " ", "p", ",", " ", "X", ",", " ", "XL", ",", 
       " ", "up"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "in", " ", "general", " ", "this", " ", "is", " ", "fastest", " ", "if",
        " ", "path", " ", "is", " ", "less", " ", "than", " ", "nq", " ", 
       "nodes"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"i", " ", "=", " ", 
       RowBox[{"RBDGetPositionIndex", "[", "b", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"j", " ", "=", " ", 
       RowBox[{"RBDGetPositionIndex", "[", 
        RowBox[{"OptionValue", "[", "\"\<o\>\"", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"GetPath", "[", 
        RowBox[{"i", ",", " ", "j"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"X", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"VectorQ", "[", "Xcb", "]"}], ",", " ", 
         RowBox[{"Xba", "[", 
          RowBox[{"PadLeft", "[", 
           RowBox[{"Xcb", ",", " ", "nm"}], "]"}], "]"}], ",", " ", "Xcb"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"XL", " ", "=", " ", 
       RowBox[{"XLfun", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<x\>\"", "]"}], ",", " ", 
         RowBox[{"OptionValue", "[", "\"\<\[Lambda]\>\"", "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"up", " ", "=", " ", "True"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"j", " ", "\[Equal]", " ", "0"}], ",", " ", 
           RowBox[{
            RowBox[{"up", " ", "=", " ", "False"}], ";"}], ",", 
           "\[IndentingNewLine]", "up", ",", " ", 
           RowBox[{
            RowBox[{"X", " ", "=", " ", 
             RowBox[{"X", ".", 
              RowBox[{
              "XL", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";"}], ",", 
           "\[IndentingNewLine]", "True", ",", " ", 
           RowBox[{
            RowBox[{"X", " ", "=", " ", 
             RowBox[{"X", ".", 
              RowBox[{"InvXba", "[", 
               RowBox[{
               "XL", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], ",", 
        " ", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j", ",", " ", "p"}], "}"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"RBDSpatialPosition", "[", 
       RowBox[{"X", ",", " ", "opts"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5925800798078823`*^9, 3.592580174479306*^9}, {
   3.592776312837759*^9, 3.5927763407003565`*^9}, {3.593627168155368*^9, 
   3.593627211874185*^9}, {3.593627295671241*^9, 3.5936273048587413`*^9}, {
   3.593627503609131*^9, 3.5936275164372807`*^9}, {3.593627906806323*^9, 
   3.5936279119469423`*^9}, {3.5936280474472046`*^9, 
   3.5936280476503325`*^9}, {3.5936283651040916`*^9, 3.593628365291579*^9}, {
   3.593628399494771*^9, 3.5936284167291794`*^9}, {3.593628449510495*^9, 
   3.5936286138858156`*^9}, {3.5936287337141743`*^9, 
   3.5936288710425706`*^9}, {3.5936291113242874`*^9, 3.59362912383994*^9}, {
   3.593977239640683*^9, 3.5939772400457067`*^9}, {3.5939774736290827`*^9, 
   3.5939774892599773`*^9}, {3.593977529858302*^9, 3.5939775574478827`*^9}, {
   3.5939776276829004`*^9, 3.593977630512067*^9}, {3.5939776716154203`*^9, 
   3.59397767177343*^9}, {3.593979563804775*^9, 3.5939796033810453`*^9}, {
   3.5939796708479075`*^9, 3.593979671595952*^9}, {3.593979707148986*^9, 
   3.5939797158334866`*^9}, {3.5939797723117204`*^9, 
   3.5939798003103237`*^9}, {3.5939800314975624`*^9, 
   3.5939800575030518`*^9}, {3.593980151672445*^9, 3.593980152483491*^9}, {
   3.593980226132709*^9, 3.593980264101882*^9}, {3.5939803358909893`*^9, 
   3.5939803422393584`*^9}, {3.593981852960452*^9, 3.593981873175627*^9}, {
   3.5939819771615677`*^9, 3.593981999737857*^9}, {3.593982128643239*^9, 
   3.5939822369964447`*^9}, {3.593982457029044*^9, 3.5939824621553373`*^9}, {
   3.593982518214548*^9, 3.593982554379616*^9}, {3.5939831159877806`*^9, 
   3.593983135672908*^9}, {3.5939834614415636`*^9, 3.5939834784325323`*^9}, {
   3.593983591802043*^9, 3.593983638667712*^9}, {3.593983679425042*^9, 
   3.5939836804971046`*^9}, {3.593983735234242*^9, 3.593984013060153*^9}, {
   3.593984236317938*^9, 3.593984239229104*^9}, 3.5939842884139214`*^9, {
   3.593984442982768*^9, 3.5939844636829586`*^9}, {3.593984499546014*^9, 
   3.5939844998900323`*^9}, {3.5939877505601826`*^9, 3.593987757332592*^9}, {
   3.5939882319557724`*^9, 3.5939883617431936`*^9}, {3.593988417378372*^9, 
   3.593988475678712*^9}, {3.5939885360671663`*^9, 3.5939885513260427`*^9}, {
   3.5939895256118374`*^9, 3.5939895318511953`*^9}, {3.593990437675069*^9, 
   3.5939904577952204`*^9}, {3.6027645461483793`*^9, 
   3.6027646265429845`*^9}, {3.60276466281406*^9, 3.602764713941988*^9}, {
   3.6027647647398977`*^9, 3.6027647699531965`*^9}, {3.6027648486327066`*^9, 
   3.602764936115711*^9}, {3.602764978749154*^9, 3.602765143323577*^9}, {
   3.6027652619913735`*^9, 3.6027654387924986`*^9}, 3.602765470973341*^9, {
   3.6027655070604076`*^9, 3.602765516082924*^9}, {3.6027656698287363`*^9, 
   3.602765669993738*^9}, {3.602765764259132*^9, 3.602765851653141*^9}, 
   3.6027659006269565`*^9, {3.602765971169986*^9, 3.6027660839214425`*^9}, {
   3.6027661687032967`*^9, 3.6027661808309917`*^9}, {3.602766216544037*^9, 
   3.6027662168040514`*^9}, {3.602766272494241*^9, 3.6027662937004557`*^9}, {
   3.6027663492206345`*^9, 3.6027664075679765`*^9}, {3.6027665001412773`*^9, 
   3.602766554860411*^9}, {3.6027666300297165`*^9, 3.602766655156152*^9}, {
   3.6027668632550716`*^9, 3.602766869528431*^9}, {3.6027669053754835`*^9, 
   3.602766906138528*^9}, {3.6027669379293485`*^9, 3.6027669744264383`*^9}, {
   3.6027670534099617`*^9, 3.602767055068057*^9}, {3.602767163332257*^9, 
   3.602767181319287*^9}, {3.6027672720784845`*^9, 3.6027673242804737`*^9}, {
   3.602767414992668*^9, 3.602767484546651*^9}, {3.602767527843128*^9, 
   3.6027676298989887`*^9}, {3.6027676979998755`*^9, 3.602767708151458*^9}, {
   3.602767949785294*^9, 3.602768003669379*^9}, {3.602768068927117*^9, 
   3.6027680690061207`*^9}, {3.6027684256915474`*^9, 
   3.6027684813187327`*^9}, {3.602768518439859*^9, 3.6027685211060114`*^9}, {
   3.6027688797395487`*^9, 3.6027688835337667`*^9}, 3.6027689279923124`*^9, {
   3.602769073527646*^9, 3.602769080572064*^9}, {3.602769112582883*^9, 
   3.602769115874072*^9}, {3.602769188562235*^9, 3.602769212169586*^9}, {
   3.6027692804965005`*^9, 3.6027692818885784`*^9}, 3.6027693639532776`*^9, {
   3.60294606061063*^9, 3.6029460849231777`*^9}, {3.612892396487505*^9, 
   3.612892430675063*^9}, {3.6128924716907673`*^9, 3.6128924782689056`*^9}, {
   3.6128930834936204`*^9, 3.61289309071239*^9}, {3.6128931616031666`*^9, 
   3.6128932156657543`*^9}, {3.6128932767127485`*^9, 3.612893294634677*^9}, {
   3.61289332572847*^9, 3.6128933694160595`*^9}, 3.612893529150742*^9, {
   3.612893956260954*^9, 3.612893967026599*^9}, {3.612894017870448*^9, 
   3.6128940579486513`*^9}, {3.613352659953907*^9, 3.6133526884485397`*^9}, {
   3.615393709119879*^9, 3.615393709307378*^9}, {3.620750860385141*^9, 
   3.620750863728896*^9}, {3.6207509008695965`*^9, 3.6207509847135115`*^9}, {
   3.620995407728777*^9, 3.6209954333694525`*^9}, {3.621956221226779*^9, 
   3.621956225242431*^9}, {3.6219562561799726`*^9, 3.621956259976856*^9}, {
   3.6282223902355814`*^9, 3.628222393286728*^9}, 3.628222487196066*^9, 
   3.6282225230024204`*^9, {3.6282225629616404`*^9, 3.6282225714043827`*^9}, {
   3.6510876031554813`*^9, 3.6510877364588156`*^9}, {3.6510880331609187`*^9, 
   3.6510880400828524`*^9}, {3.651088320152989*^9, 3.651088332296809*^9}, {
   3.6685536164178224`*^9, 3.6685536166249137`*^9}, {3.67805141688332*^9, 
   3.6780514201645975`*^9}, {3.678051505649757*^9, 3.6780515116185637`*^9}, {
   3.678051632476797*^9, 3.678051637398714*^9}, {3.678108493530072*^9, 
   3.6781085104208508`*^9}, {3.6781087338034554`*^9, 3.678108760410882*^9}, {
   3.67810898857034*^9, 3.6781089901641617`*^9}, {3.67810910836064*^9, 
   3.6781091306108465`*^9}, {3.6781091823146076`*^9, 3.678109182564569*^9}, {
   3.678109215846123*^9, 3.678109282596775*^9}, {3.6781093407526555`*^9, 
   3.6781093457214565`*^9}, 3.6781093944484663`*^9, {3.6781094312299967`*^9, 
   3.678109433448824*^9}, 3.6804438054447613`*^9, 3.6807326951947126`*^9, 
   3.6807329337262516`*^9, 3.6807487052378025`*^9, {3.680816984402652*^9, 
   3.6808169859107122`*^9}, {3.7173709149944973`*^9, 3.7173709193070593`*^9}, 
   3.7173742355069203`*^9, {3.717374364258239*^9, 3.717374373445833*^9}, {
   3.717504869679078*^9, 3.7175049689457235`*^9}, {3.717505003914832*^9, 
   3.7175050507278113`*^9}, 3.7175053299940414`*^9, {3.717505363744403*^9, 
   3.7175053984791207`*^9}, 3.717505441573326*^9, {3.7175054928394628`*^9, 
   3.717505543433732*^9}, {3.7175055821372538`*^9, 3.7175055822778845`*^9}, {
   3.7175056667943892`*^9, 3.7175056891852417`*^9}, {3.717505812883917*^9, 
   3.7175058136964254`*^9}, 3.717506884229203*^9, {3.7175149521127863`*^9, 
   3.717514986613139*^9}, 3.7175150924892263`*^9, {3.7175151426616325`*^9, 
   3.7175151500366917`*^9}, {3.717515975297274*^9, 3.7175160277978125`*^9}, {
   3.7175160754389253`*^9, 3.717516076610812*^9}, {3.7175161103299246`*^9, 
   3.7175161134393177`*^9}, {3.7175164253331423`*^9, 3.717516566631466*^9}, {
   3.7175166841617537`*^9, 3.717516785334667*^9}, {3.717516824835074*^9, 
   3.7175169826179433`*^9}, {3.7175170544936814`*^9, 3.717517106244211*^9}, {
   3.7175171673073397`*^9, 3.717517196776392*^9}, {3.7175172286517267`*^9, 
   3.7175173444497843`*^9}, {3.7175173800126457`*^9, 3.717517425153737*^9}, {
   3.717517504623301*^9, 3.717517751719586*^9}, {3.7175177858136873`*^9, 
   3.71751778615744*^9}, {3.7175178179233894`*^9, 3.717517849517465*^9}, {
   3.7175178897835045`*^9, 3.7175179085493217`*^9}, {3.717518042191905*^9, 
   3.717518079661024*^9}, {3.7175184180707865`*^9, 3.7175185588378706`*^9}, {
   3.7175186493856587`*^9, 3.7175186521669393`*^9}, {3.717518687948556*^9, 
   3.7175186883704357`*^9}, {3.7175189694514456`*^9, 3.717518970185828*^9}, {
   3.7175190398896694`*^9, 3.717519040639676*^9}, {3.717519167333804*^9, 
   3.717519193086412*^9}, {3.7175204616632447`*^9, 3.717520472975875*^9}, {
   3.717520512038763*^9, 3.717520602211576*^9}, {3.717520745681786*^9, 
   3.717520785822824*^9}, {3.7175208354483337`*^9, 3.717520843089034*^9}, {
   3.7175208842144737`*^9, 3.717520887917638*^9}, {3.7175209206835985`*^9, 
   3.7175209214492154`*^9}, {3.7175210162939386`*^9, 
   3.7175210232158856`*^9}, {3.717521063200671*^9, 3.717521066200712*^9}, {
   3.7175211058729944`*^9, 3.7175211073105106`*^9}, {3.7175212212804184`*^9, 
   3.717521248483823*^9}, {3.7175213955478325`*^9, 3.7175214204543524`*^9}, {
   3.717521575518429*^9, 3.717521660831815*^9}, {3.7175216958477893`*^9, 
   3.717521711910454*^9}, {3.717521745863928*^9, 3.717521748082698*^9}, {
   3.717521779723651*^9, 3.7175219046468067`*^9}, {3.7175221470086684`*^9, 
   3.7175221654151087`*^9}, {3.717602776140053*^9, 3.7176027791244555`*^9}, {
   3.7176028415156574`*^9, 3.7176029721887903`*^9}, 3.7176030159235773`*^9, {
   3.717603046939501*^9, 3.7176030643615255`*^9}, {3.717605320983097*^9, 
   3.7176053505927544`*^9}, {3.7176054873909245`*^9, 
   3.7176054874065375`*^9}, {3.7176060062396097`*^9, 3.71760601289592*^9}, {
   3.7176061345533295`*^9, 3.717606195585159*^9}, {3.71763217287488*^9, 
   3.717632194031331*^9}, {3.7176322295941534`*^9, 3.7176322312035418`*^9}, {
   3.7176324791536427`*^9, 3.7176324794973955`*^9}, {3.7176326635147657`*^9, 
   3.717632870813615*^9}, {3.717632968783279*^9, 3.717632983642813*^9}, {
   3.7176330198775153`*^9, 3.717633074503033*^9}, {3.717633119753476*^9, 
   3.717633129972327*^9}, {3.717633357111596*^9, 3.7176333921744137`*^9}, {
   3.7176334974566636`*^9, 3.717633525994855*^9}, {3.7176336617243814`*^9, 
   3.7176336712401114`*^9}, {3.717633706146696*^9, 3.717633820647784*^9}, {
   3.717633866601326*^9, 3.717633867116972*^9}, {3.717633935570733*^9, 
   3.717634013352734*^9}, {3.717634070025135*^9, 3.7176341444602633`*^9}, {
   3.7176344732137175`*^9, 3.717634580777237*^9}, {3.7176346139650393`*^9, 
   3.7176346521060257`*^9}, {3.7176346904813895`*^9, 3.717634695918942*^9}, {
   3.7176347462788124`*^9, 3.717634756200765*^9}, {3.7176348568579893`*^9, 
   3.717634861873644*^9}, 3.717635902994731*^9, {3.7181125699785805`*^9, 
   3.718112608947715*^9}, {3.718112710011213*^9, 3.718112741870905*^9}, {
   3.7181967548070564`*^9, 3.7181967852604833`*^9}, {3.718196837151619*^9, 
   3.718196855870555*^9}, {3.7181969555044374`*^9, 3.7181971234622927`*^9}, {
   3.718209828905616*^9, 3.7182098565152617`*^9}, {3.71820990492199*^9, 
   3.7182099053751216`*^9}, {3.7182099442973785`*^9, 
   3.7182099500630627`*^9}, {3.718209985516539*^9, 3.7182099901728334`*^9}, {
   3.718210074642419*^9, 3.718210173002777*^9}, {3.7182102100656333`*^9, 
   3.7182102153938084`*^9}, {3.7182103856142426`*^9, 
   3.7182103918018036`*^9}, {3.718210426270894*^9, 3.7182104337397346`*^9}, {
   3.7182104750526266`*^9, 3.718210510896742*^9}, {3.71821069063288*^9, 
   3.7182107168362665`*^9}, {3.71821118054399*^9, 3.7182111807158513`*^9}, {
   3.7192300297917075`*^9, 3.71923006041696*^9}, {3.7192302008243732`*^9, 
   3.71923024492723*^9}, {3.7196670499128437`*^9, 3.7196671286323123`*^9}, {
   3.7196673758220835`*^9, 3.719667511917059*^9}, {3.719667591167782*^9, 
   3.7196676119335947`*^9}, {3.7196678954674315`*^9, 3.719667895795562*^9}, {
   3.719668012812284*^9, 3.719668073281554*^9}, {3.7200589616808205`*^9, 
   3.7200589747747135`*^9}},ExpressionUUID->"c1fcae6f-43c9-420f-910e-\
2dd139a81c8b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Mechanical Quantities", "Section",
 CellChangeTimes->{{3.5933110701810026`*^9, 3.593311097962296*^9}, {
  3.6031988982844105`*^9, 3.6031988992664633`*^9}, {3.7173742413663397`*^9, 
  3.7173742442569947`*^9}},ExpressionUUID->"57f94afe-0b81-4686-b049-\
68925b8e2c33"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "compute", " ", "the", " ", "kinetic", " ", "and", " ", "potential", " ", 
     "energy"}], ",", " ", 
    RowBox[{"spatial", " ", "momentum"}], ",", " ", 
    RowBox[{"spatial", " ", "inertia"}], ",", " ", "mass", ",", " ", 
    RowBox[{
    "position", " ", "of", " ", "the", " ", "center", " ", "of", " ", 
     "mass"}], ",", " ", 
    RowBox[{
     RowBox[{
     "and", " ", "the", " ", "linear", " ", "velocity", " ", "of", " ", "the",
       " ", "center", " ", "of", " ", "mass", " ", "of", " ", "the", " ", 
      "entire", " ", "system"}], ";", " ", 
     RowBox[{
     "vector", " ", "quantities", " ", "are", " ", "in", " ", "link", " ", 
      "0", " ", 
      RowBox[{"coordinates", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RBDMechanicalQuantities", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "p", ",", " ", "vJ", ",", " ", "v", ",", " ", "hc", ",", " ", "KE", 
        ",", " ", "PE", ",", " ", "htot", ",", " ", "Itot", ",", " ", "m", 
        ",", " ", "mC", ",", " ", "I", ",", " ", "com", ",", " ", "vcom", ",",
         " ", "IC"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"v", " ", "=", " ", "zspat"}], ";", "\[IndentingNewLine]", 
       RowBox[{"hc", " ", "=", " ", "zspat"}], ";", "\[IndentingNewLine]", 
       RowBox[{"KE", " ", "=", " ", "zq"}], ";", "\[IndentingNewLine]", 
       RowBox[{"IC", " ", "=", " ", "\[DoubleStruckCapitalI]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"p", " ", "=", " ", 
           RowBox[{
           "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"vJ", " ", "=", " ", 
           RowBox[{
            RowBox[{
            "s", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
            RowBox[{
            "qd", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"p", " ", "\[Equal]", " ", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "only", " ", "use", " ", "relative", " ", "link", " ", 
              "velocity"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
              "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              " ", "=", " ", "vJ"}], ";"}], ",", " ", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"add", " ", 
              RowBox[{"parent", "'"}], "s", " ", "value"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
              "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
              " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                ".", 
                RowBox[{
                "v", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}]}],
                " ", "+", " ", "vJ"}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "hc", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
           RowBox[{
            RowBox[{
            "IC", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ".", 
            RowBox[{
            "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "KE", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], "=", 
           RowBox[{
            RowBox[{"1", "/", "2"}], " ", 
            RowBox[{
             RowBox[{
             "v", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], ".", 
             RowBox[{
             "hc", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}]}]}]}], ";"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "nq"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Itot", " ", "=", " ", "Z6"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"rotational", " ", "inertia"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"htot", " ", "=", " ", "z6"}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"angular", " ", "and", " ", "linear", " ", "momentum"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"p", " ", "=", " ", 
           RowBox[{
           "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"p", " ", "\[NotEqual]", " ", "0"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
              "IC", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
              " ", "=", " ", 
              RowBox[{
               RowBox[{
               "IC", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
               " ", "+", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[Transpose]"}], ".", 
                RowBox[{
                "IC", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                ".", 
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}]}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "hc", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
              " ", "=", " ", 
              RowBox[{
               RowBox[{
               "hc", "\[LeftDoubleBracket]", "p", "\[RightDoubleBracket]"}], 
               " ", "+", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[Transpose]"}], ".", 
                RowBox[{
                "hc", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}]}]}]}], ";"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Itot", "=", 
              RowBox[{"Itot", "+", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[Transpose]"}], ".", 
                RowBox[{
                "IC", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                ".", 
                RowBox[{
                "XL", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}]}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"htot", "=", 
              RowBox[{"htot", "+", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "XL", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
                  "\[Transpose]"}], ".", 
                RowBox[{
                "hc", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}]}]}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "nq", ",", " ", "1", ",", " ", 
           RowBox[{"-", "1"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Itot", " ", "=", " ", 
        RowBox[{"mcI", "[", "Itot", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{
        "Itot", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";",
        " ", 
       RowBox[{"(*", " ", 
        RowBox[{"total", " ", "mass"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"com", " ", "=", " ", 
        RowBox[{"Itot", "\[LeftDoubleBracket]", 
         RowBox[{"5", ";;", "7"}], "\[RightDoubleBracket]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"center", " ", "of", " ", "mass"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"vcom", " ", "=", " ", 
        RowBox[{
         RowBox[{"htot", "\[LeftDoubleBracket]", 
          RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], "/", "m"}]}], 
       ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"center", " ", "of", " ", "mass", " ", "velocity"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"I", " ", "=", " ", 
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Itot", "\[LeftDoubleBracket]", 
           RowBox[{"8", ";;"}], "\[RightDoubleBracket]"}], ",", " ", "mm"}], 
         "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"rotational", " ", "inertia", " ", "about", " ", "com"}], " ",
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PE", " ", "=", " ", 
        RowBox[{"m", " ", 
         RowBox[{
          RowBox[{"ag", "\[LeftDoubleBracket]", 
           RowBox[{"4", ";;", "6"}], "\[RightDoubleBracket]"}], ".", 
          "com"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"total", " ", "potential", " ", "energy"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"KE", " ", "=", " ", 
        RowBox[{"Total", "[", "KE", "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{"total", " ", "kinetic", " ", "energy"}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
        "KE", ",", " ", "PE", ",", " ", "htot", ",", " ", "m", ",", " ", "I", 
         ",", " ", "com", ",", " ", "vcom"}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5925800798078823`*^9, 3.592580174479306*^9}, {
   3.592776312837759*^9, 3.5927763407003565`*^9}, {3.593627168155368*^9, 
   3.593627211874185*^9}, {3.593627295671241*^9, 3.5936273048587413`*^9}, {
   3.593627503609131*^9, 3.5936275164372807`*^9}, {3.593627906806323*^9, 
   3.5936279119469423`*^9}, {3.5936280474472046`*^9, 
   3.5936280476503325`*^9}, {3.5936283651040916`*^9, 3.593628365291579*^9}, {
   3.593628399494771*^9, 3.5936284167291794`*^9}, {3.593628449510495*^9, 
   3.5936286138858156`*^9}, {3.5936287337141743`*^9, 
   3.5936288710425706`*^9}, {3.5936291113242874`*^9, 3.59362912383994*^9}, {
   3.593977239640683*^9, 3.5939772400457067`*^9}, {3.5939774736290827`*^9, 
   3.5939774892599773`*^9}, {3.593977529858302*^9, 3.5939775574478827`*^9}, {
   3.5939776276829004`*^9, 3.593977630512067*^9}, {3.5939776716154203`*^9, 
   3.59397767177343*^9}, {3.593979563804775*^9, 3.5939796033810453`*^9}, {
   3.5939796708479075`*^9, 3.593979671595952*^9}, {3.593979707148986*^9, 
   3.5939797158334866`*^9}, {3.5939797723117204`*^9, 
   3.5939798003103237`*^9}, {3.5939800314975624`*^9, 
   3.5939800575030518`*^9}, {3.593980151672445*^9, 3.593980152483491*^9}, {
   3.593980226132709*^9, 3.593980264101882*^9}, {3.5939803358909893`*^9, 
   3.5939803422393584`*^9}, {3.593981852960452*^9, 3.593981873175627*^9}, {
   3.5939819771615677`*^9, 3.593981999737857*^9}, {3.593982128643239*^9, 
   3.5939822369964447`*^9}, {3.593982457029044*^9, 3.5939824621553373`*^9}, {
   3.593982518214548*^9, 3.593982554379616*^9}, {3.5939831159877806`*^9, 
   3.593983135672908*^9}, {3.5939834614415636`*^9, 3.5939834784325323`*^9}, {
   3.593983591802043*^9, 3.593983638667712*^9}, {3.593983679425042*^9, 
   3.5939836804971046`*^9}, {3.593983735234242*^9, 3.593984013060153*^9}, {
   3.593984236317938*^9, 3.593984239229104*^9}, 3.5939842884139214`*^9, {
   3.593984442982768*^9, 3.5939844636829586`*^9}, {3.593984499546014*^9, 
   3.5939844998900323`*^9}, {3.5939877505601826`*^9, 3.593987757332592*^9}, {
   3.5939882319557724`*^9, 3.5939883617431936`*^9}, {3.593988417378372*^9, 
   3.593988475678712*^9}, {3.5939885360671663`*^9, 3.5939885513260427`*^9}, {
   3.5939895256118374`*^9, 3.5939895318511953`*^9}, {3.593990437675069*^9, 
   3.5939904577952204`*^9}, {3.6027645461483793`*^9, 
   3.6027646265429845`*^9}, {3.60276466281406*^9, 3.602764713941988*^9}, {
   3.6027647647398977`*^9, 3.6027647699531965`*^9}, {3.6027648486327066`*^9, 
   3.602764936115711*^9}, {3.602764978749154*^9, 3.602765143323577*^9}, {
   3.6027652619913735`*^9, 3.6027654387924986`*^9}, 3.602765470973341*^9, {
   3.6027655070604076`*^9, 3.602765516082924*^9}, {3.6027656698287363`*^9, 
   3.602765669993738*^9}, {3.602765764259132*^9, 3.602765851653141*^9}, 
   3.6027659006269565`*^9, {3.602765971169986*^9, 3.6027660839214425`*^9}, {
   3.6027661687032967`*^9, 3.6027661808309917`*^9}, {3.602766216544037*^9, 
   3.6027662168040514`*^9}, {3.602766272494241*^9, 3.6027662937004557`*^9}, {
   3.6027663492206345`*^9, 3.6027664075679765`*^9}, {3.6027665001412773`*^9, 
   3.602766554860411*^9}, {3.6027666300297165`*^9, 3.602766655156152*^9}, {
   3.6027668632550716`*^9, 3.602766869528431*^9}, {3.6027669053754835`*^9, 
   3.602766906138528*^9}, {3.6027669379293485`*^9, 3.6027669744264383`*^9}, {
   3.6027670534099617`*^9, 3.602767055068057*^9}, {3.602767163332257*^9, 
   3.602767181319287*^9}, {3.6027672720784845`*^9, 3.6027673242804737`*^9}, {
   3.602767414992668*^9, 3.602767484546651*^9}, {3.602767527843128*^9, 
   3.6027676298989887`*^9}, {3.6027676979998755`*^9, 3.602767708151458*^9}, {
   3.602767949785294*^9, 3.602768003669379*^9}, {3.602768068927117*^9, 
   3.6027680690061207`*^9}, {3.6027684256915474`*^9, 
   3.6027684813187327`*^9}, {3.602768518439859*^9, 3.6027685211060114`*^9}, {
   3.6027688797395487`*^9, 3.6027688835337667`*^9}, 3.6027689279923124`*^9, {
   3.602769073527646*^9, 3.602769080572064*^9}, {3.602769112582883*^9, 
   3.602769115874072*^9}, {3.602769188562235*^9, 3.602769212169586*^9}, {
   3.6027692804965005`*^9, 3.6027692818885784`*^9}, 3.6027693639532776`*^9, {
   3.60294606061063*^9, 3.6029460849231777`*^9}, {3.612892396487505*^9, 
   3.612892430675063*^9}, {3.6128924716907673`*^9, 3.6128924782689056`*^9}, {
   3.6128930834936204`*^9, 3.61289309071239*^9}, {3.6128931616031666`*^9, 
   3.6128932156657543`*^9}, {3.6128932767127485`*^9, 3.612893294634677*^9}, {
   3.61289332572847*^9, 3.6128933694160595`*^9}, 3.612893529150742*^9, {
   3.612893956260954*^9, 3.612893967026599*^9}, {3.612894017870448*^9, 
   3.6128940579486513`*^9}, {3.613352659953907*^9, 3.6133526884485397`*^9}, {
   3.615393709119879*^9, 3.615393709307378*^9}, {3.620750860385141*^9, 
   3.620750863728896*^9}, {3.6207509008695965`*^9, 3.6207509847135115`*^9}, {
   3.620995407728777*^9, 3.6209954333694525`*^9}, {3.621956221226779*^9, 
   3.621956225242431*^9}, {3.6219562561799726`*^9, 3.621956259976856*^9}, {
   3.6282223902355814`*^9, 3.628222393286728*^9}, 3.628222487196066*^9, 
   3.6282225230024204`*^9, {3.6282225629616404`*^9, 3.6282225714043827`*^9}, {
   3.6510876031554813`*^9, 3.6510877364588156`*^9}, {3.6510880331609187`*^9, 
   3.6510880400828524`*^9}, {3.651088320152989*^9, 3.651088332296809*^9}, {
   3.6685536164178224`*^9, 3.6685536166249137`*^9}, {3.67805141688332*^9, 
   3.6780514201645975`*^9}, {3.678051505649757*^9, 3.6780515116185637`*^9}, {
   3.678051632476797*^9, 3.678051637398714*^9}, {3.678108493530072*^9, 
   3.6781085104208508`*^9}, {3.6781087338034554`*^9, 3.678108760410882*^9}, {
   3.67810898857034*^9, 3.6781089901641617`*^9}, {3.67810910836064*^9, 
   3.6781091306108465`*^9}, {3.6781091823146076`*^9, 3.678109182564569*^9}, {
   3.678109215846123*^9, 3.678109282596775*^9}, {3.6781093407526555`*^9, 
   3.6781093457214565`*^9}, 3.6781093944484663`*^9, {3.6781094312299967`*^9, 
   3.678109433448824*^9}, 3.6804438054447613`*^9, 3.6807326951947126`*^9, 
   3.6807329337262516`*^9, 3.6807487052378025`*^9, {3.680816984402652*^9, 
   3.6808169859107122`*^9}, {3.7173709149944973`*^9, 3.7173709193070593`*^9}, 
   3.7173742355069203`*^9, {3.7173814532328997`*^9, 3.7173814856863604`*^9}, {
   3.717635914494839*^9, 3.7176360863089724`*^9}, {3.71763687173833*^9, 
   3.7176368782227654`*^9}, 3.720874018901493*^9, 3.7208740680098815`*^9, {
   3.7208741242505693`*^9, 3.7208741330616655`*^9}, {3.7219938369707623`*^9, 
   3.721993837314515*^9}, 3.7219940206631274`*^9, {3.721994158523917*^9, 
   3.721994177149092*^9}, {3.721994450901919*^9, 3.7219946079816556`*^9}, {
   3.7219946628259687`*^9, 3.7219947160452642`*^9}, {3.721994870183926*^9, 
   3.7219949198563232`*^9}, {3.721994954278556*^9, 3.721994959637971*^9}, {
   3.7219950294212065`*^9, 3.7219950301711993`*^9}, {3.7219951448286247`*^9, 
   3.721995147406789*^9}, {3.722082813837129*^9, 3.7220828184621797`*^9}, {
   3.7220860955242863`*^9, 3.7220860957117896`*^9}, {3.722089962480667*^9, 
   3.722089962824421*^9}, {3.7226048119238305`*^9, 
   3.722604834299019*^9}},ExpressionUUID->"1fafaa9b-4bc3-4c29-befe-\
cc019135b184"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",ExpressionUUID->"274f91f7-44aa-4816-8235-9c83a6f3d606"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.591486801989799*^9, 
  3.5914868026208353`*^9}},ExpressionUUID->"bacdc053-e0ee-40d3-8266-\
203bda83585a"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{718, 718},
WindowMargins->{{Automatic, 0}, {Automatic, 60}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 3184, 68, 621, "Code",ExpressionUUID->"461d5058-d610-4530-b7f5-3d724742dada",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3767, 92, 203, 4, 95, "Section",ExpressionUUID->"69668757-b033-46b9-a675-17b9d6cec5e0"],
Cell[3973, 98, 674, 14, 452, "Text",ExpressionUUID->"d3bbb3df-6e2c-484a-916e-bcd6b62f355f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4684, 117, 160, 3, 95, "Section",ExpressionUUID->"3bfc55e3-73c4-45d1-a335-3bcd53004cab"],
Cell[4847, 122, 2458, 37, 66, "Input",ExpressionUUID->"d1260a39-ddc9-47f9-882e-0aa6ac61158e",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[7342, 164, 374, 6, 70, "Section",ExpressionUUID->"e544ea0c-b8b8-4fd4-b17b-a28c9c1ad119"],
Cell[7719, 172, 1751, 40, 123, "Input",ExpressionUUID->"064fc558-b33c-47ca-a5bb-1a1f98091141",
 InitializationCell->True],
Cell[9473, 214, 6104, 134, 352, "Input",ExpressionUUID->"b755f28b-46b4-4db2-86b4-d0f54f934321",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[15614, 353, 180, 3, 70, "Section",ExpressionUUID->"432d5fb2-a277-41e9-b07b-8fbd301e7c20"],
Cell[15797, 358, 11410, 240, 484, "Input",ExpressionUUID->"79ede1b0-1809-4f5d-beca-aef5142e34f7",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[27244, 603, 371, 6, 70, "Section",ExpressionUUID->"b833f929-65fc-4cc3-a703-50599ddeef14"],
Cell[27618, 611, 12099, 233, 673, "Input",ExpressionUUID->"e1f7f68d-8f82-484c-9cba-1625951c9237",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[39754, 849, 486, 7, 70, "Section",ExpressionUUID->"8ce4e066-1ccd-4d44-ab6c-d5639d28e959"],
Cell[40243, 858, 6699, 174, 484, "Input",ExpressionUUID->"33f25ff6-b701-4d39-9f2e-7c7befe3f434",
 InitializationCell->True],
Cell[46945, 1034, 13182, 279, 1016, "Input",ExpressionUUID->"7f90d05f-2894-4262-96b9-2e6b3b4e4811",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[60164, 1318, 376, 6, 70, "Section",ExpressionUUID->"7014d913-9c0c-40f0-aa56-4d03f73e1e7a"],
Cell[60543, 1326, 11299, 171, 161, "Input",ExpressionUUID->"25303bc1-9c03-4fa2-ac61-84b3d362069d",
 InitializationCell->True],
Cell[71845, 1499, 27581, 540, 1776, "Input",ExpressionUUID->"c1fcae6f-43c9-420f-910e-2dd139a81c8b",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[99463, 2044, 271, 4, 70, "Section",ExpressionUUID->"57f94afe-0b81-4686-b049-68925b8e2c33"],
Cell[99737, 2050, 17476, 339, 978, "Input",ExpressionUUID->"1fafaa9b-4bc3-4c29-befe-cc019135b184",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[117250, 2394, 85, 0, 70, "Section",ExpressionUUID->"274f91f7-44aa-4816-8235-9c83a6f3d606"],
Cell[117338, 2396, 267, 6, 66, "Input",ExpressionUUID->"bacdc053-e0ee-40d3-8266-203bda83585a",
 InitializationCell->True]
}, Open  ]]
}
]
*)

