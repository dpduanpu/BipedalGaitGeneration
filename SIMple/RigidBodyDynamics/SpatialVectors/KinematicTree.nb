(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    101528,       1968]
NotebookOptionsPosition[     99437,       1920]
NotebookOutlinePosition[     99804,       1936]
CellTagsIndexPosition[     99761,       1933]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"RigidBodySystem", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{"High", "-", 
      RowBox[{
      "level", " ", "functions", " ", "used", " ", "to", " ", "define", " ", 
       "a", " ", "rigid", " ", 
       RowBox[{"body", ".", "\n", "Copyright"}], " ", 
       RowBox[{"(", "C", ")"}], " ", "2014", " ", "Nelson", " ", "Rosa", " ", 
       RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", 
       " ", "free", " ", "software"}]}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 3.6103712325731497`*^9}, {
  3.610371305900334*^9, 3.610371331708816*^9}, {3.610371368620943*^9, 
  3.61037139802861*^9}, {3.6103714917959795`*^9, 
  3.6103715279410496`*^9}},ExpressionUUID->"c9ace131-5d4c-4ace-bb35-\
b13857154674"],

Cell[CellGroupData[{

Cell["TODO", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.7340118905368567`*^9, 
  3.7340118910212364`*^9}},ExpressionUUID->"f486e300-efa0-4a17-aba6-\
c663751b4bc4"],

Cell["\<\
multi-dof joints only return last index, should fix.
ex:  for Test - AngularMomentum.nb in \
BipedalLocomotion/.../Models/KneedWalker folder
RBDGetPositionIndex[{\[OpenCurlyDoubleQuote]hip\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]left shank\[CloseCurlyDoubleQuote], \
\[OpenCurlyDoubleQuote]right shank\[CloseCurlyDoubleQuote]}]
returns {2, 5, 6} but in this case hip is 1 and 2.  should have option to \
return {1, 2, 5, 6}\
\>", "Text",
 CellChangeTimes->{{3.7340118936931334`*^9, 
  3.7340119922096744`*^9}},ExpressionUUID->"8eee5e81-1527-4fa2-a501-\
5083044af063"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"d826a602-14aa-4b57-a86e-\
f8f86a87ab7e"],

Cell[BoxData[{
 RowBox[{"BeginPackage", "[", 
  RowBox[{
  "\"\<RigidBodyDynamics`\>\"", ",", " ", "\"\<GlobalVariables`\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ni", ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "list", " ", "of", " ", "dof", " ", "of", " ", "each", " ", "joint"}], 
    ";", " ", 
    RowBox[{"nq", " ", "=", " ", 
     RowBox[{"sum", 
      RowBox[{"(", "ni", ")"}]}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nb", ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"#", " ", "of", " ", "rigid", " ", "bodies"}], " ", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"rigid", "-", 
    RowBox[{"body", " ", "connectivity"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"parent", ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"parent", " ", "array"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"map", ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "map", " ", "from", " ", "original", " ", "to", " ", "extended", " ", 
    "body"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nca", ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"nearest", " ", "common", " ", "ancestor", " ", "map"}], " ", 
   "*)"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.592241768075292*^9, 3.5922417692471714`*^9}, {3.592242084931059*^9, 
   3.5922420876966925`*^9}, 3.5922421309311514`*^9, {3.592255703284815*^9, 
   3.592255706497998*^9}, {3.59225574155902*^9, 3.592255745349224*^9}, {
   3.5922557821253295`*^9, 3.592255815751254*^9}, {3.5922559034172745`*^9, 
   3.5922559113667307`*^9}, {3.5922800860555387`*^9, 3.592280103747531*^9}, {
   3.59275716675933*^9, 3.5927571696474915`*^9}, 3.5927838101231008`*^9, {
   3.5933676479376955`*^9, 3.5933676483126965`*^9}, 3.602872256432743*^9, {
   3.7173555689529233`*^9, 3.717355571624839*^9}, {3.7173569105448203`*^9, 
   3.7173569141698613`*^9}, {3.7173723704469366`*^9, 
   3.7173724279162765`*^9}, {3.7173724803230762`*^9, 3.71737248071371*^9}, {
   3.717372587996045*^9, 3.717372588402298*^9}, {3.7173729826407194`*^9, 
   3.717372982890723*^9}, {3.717469364677884*^9, 3.717469369771697*^9}, {
   3.717469477350916*^9, 3.7174695780706983`*^9}, {3.717469654087104*^9, 
   3.7174696794936132`*^9}, {3.717472034299034*^9, 3.71747203834595*^9}, {
   3.7175137378023844`*^9, 3.71751374128678*^9}, {3.717548628283519*^9, 
   3.7175486388617525`*^9}, {3.7175492819101787`*^9, 
   3.7175493001291275`*^9}, {3.717549346223339*^9, 3.7175494011145277`*^9}, {
   3.7175500690998974`*^9, 3.7175500776468706`*^9}, {3.717550250383008*^9, 
   3.71755025060176*^9}, {3.717551385635111*^9, 3.7175513867288694`*^9}, {
   3.7175521329240274`*^9, 3.7175521344396567`*^9}, {3.7175523973736873`*^9, 
   3.717552425342723*^9}, {3.718199348222598*^9, 3.7181993643790045`*^9}, {
   3.7188959103002977`*^9, 3.718895912315942*^9}, {3.718895974082176*^9, 
   3.7188959774884768`*^9}, 
   3.718896180996697*^9},ExpressionUUID->"865d59d8-94fc-4640-a7dd-\
e8b8d4794941"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Kinematic Tree", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 
  3.686580485530325*^9}},ExpressionUUID->"1c79a023-5933-4467-a67f-\
99c9f6093877"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetTree", "[", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "t", ",", "tind"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"get", " ", "parent"}], "-", 
        RowBox[{"child", " ", "relationships"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"KeySelect", "[", 
         RowBox[{"rb", ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"StringQ", "[", "#", "]"}], " ", "&&", " ", 
            RowBox[{"AssociationQ", "@", 
             RowBox[{"rb", "[", "#", "]"}]}]}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "p"}], " ", "\[Equal]", " ", "0"}], ",", " ",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"KeyDropFrom", "[", 
           RowBox[{"rb", ",", " ", 
            RowBox[{"{", 
             RowBox[{"ParentList", ",", " ", "TreeForm", ",", " ", "Links"}], 
             "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"<|", "|>"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"KeyValueMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#2", "[", "\"\<p\>\"", "]"}], "\[Rule]", "#1"}], "&"}], 
          ",", "p"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"Merge", "[", 
         RowBox[{"p", ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"get", " ", "tree", " ", "structure", " ", 
         RowBox[{"w", "/", " ", "names"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Lookup", "[", 
           RowBox[{"p", ",", "#", ",", 
            RowBox[{"{", "}"}]}], "]"}]}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"NestList", "[", 
         RowBox[{"t", ",", 
          RowBox[{"p", "[", "Root", "]"}], ",", 
          RowBox[{
           RowBox[{"Length", "@", "p"}], "-", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"Flatten", "@", "t"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"get", " ", "tree", " ", "structure", " ", 
         RowBox[{"w", "/", " ", "#s"}]}], " ", "*)"}], 
       RowBox[{"tind", " ", "=", " ", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"{", "Root", "}"}], ",", "t"}], "]"}], "\[Rule]", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{"Length", "@", "t"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"tind", "[", 
           RowBox[{"rb", "\[LeftDoubleBracket]", 
            RowBox[{"#", ",", "\"\<p\>\""}], "\[RightDoubleBracket]"}], "]"}],
           "&"}], " ", "/@", " ", "t"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"AssociationThread", "[", 
         RowBox[{"t", "\[Rule]", "p"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{"tind", ",", "Root"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"AssociateTo", "[", 
         RowBox[{"rb", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ParentList", "\[Rule]", "p"}], ",", 
            RowBox[{"TreeForm", "\[Rule]", "t"}]}], "}"}]}], "]"}], "[", 
        "TreeForm", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"GetExpandedTree", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"f", ",", " ", "p", ",", " ", "j"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"j", " ", "=", " ", 
       RowBox[{"RBDGetLinkInfo", "[", 
        RowBox[{"\"\<joint\>\"", ",", " ", "True"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "j"}], " ", "\[Equal]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "@", "j"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"j", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringQ", "[", 
            RowBox[{"joint", "\[LeftDoubleBracket]", 
             RowBox[{"#1", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], ",", 
           " ", 
           RowBox[{
           "joint", "\[LeftDoubleBracket]", "#1", "\[RightDoubleBracket]"}], 
           ",", " ", 
           RowBox[{"{", "#1", "}"}]}], "]"}], "&"}], " ", "/@", " ", "j"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"rb", "[", "ParentList", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"nb", " ", "=", " ", 
       RowBox[{"Length", "@", "j"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ni", " ", "=", " ", 
       RowBox[{"Length", " ", "/@", " ", "j"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nq", " ", "=", " ", 
       RowBox[{"Total", "[", "ni", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nx", " ", "=", " ", 
       RowBox[{"2", "nq"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nc", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"rb", ",", " ", "\"\<nc\>\"", ",", " ", "0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"allocate", " ", "mem"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"parent", " ", "=", " ", 
       RowBox[{
        RowBox[{"Range", "[", "nq", "]"}], " ", "-", " ", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"map", " ", "=", " ", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", " ", "nb"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"zq", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", "nq"}], "]"}]}], ";", " ", 
      RowBox[{"(*", " ", "RNEA", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"zspat", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", "nq", ",", " ", "nm"}], "]"}]}], ";", " ", 
      RowBox[{"(*", " ", "RNEA", " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ZM", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{"0", ",", " ", "nq", ",", " ", "nq"}], "]"}]}], ";", " ", 
      RowBox[{"(*", " ", "CRB", " ", "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "create", " ", "mapping", " ", "from", " ", "original", " ", "to", " ",
         "extended", " ", "tree"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"map", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       " ", "=", " ", 
       RowBox[{"ni", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
         "map", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
         "=", " ", 
         RowBox[{
          RowBox[{"map", "\[LeftDoubleBracket]", 
           RowBox[{"i", "-", "1"}], "\[RightDoubleBracket]"}], "+", 
          RowBox[{
          "ni", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
        ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "2", ",", " ", "nb"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "create", " ", "extended", " ", "tree", " ", "and", " ", "body", " ", 
        "arrays"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "parent", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
       "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"parent", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"map", "\[LeftDoubleBracket]", 
            RowBox[{"i", "-", "1"}], "\[RightDoubleBracket]"}], "+", "1"}], 
          "\[RightDoubleBracket]"}], " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "p", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ", 
            "\[NotEqual]", " ", "0"}], ",", " ", 
           RowBox[{"map", "\[LeftDoubleBracket]", 
            RowBox[{
            "p", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
            "\[RightDoubleBracket]"}], ",", " ", "0"}], "]"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "2", ",", " ", "nb"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"update", " ", "nca"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"MakeNearestCommonAncestor", "[", 
       RowBox[{"parent", ",", " ", "nq"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "tree", " ", "structure", " ", 
        RowBox[{"w", "/", " ", "joints"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"j", " ", "=", " ", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"i", " ", "<>", " ", "\"\<-\>\"", " ", "<>", " ", "k"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", 
            RowBox[{"Keys", "@", "j"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"k", ",", " ", 
            RowBox[{"j", "[", "i", "]"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"j", " ", "=", " ", 
       RowBox[{"AssociationThread", "[", 
        RowBox[{"j", " ", "\[Rule]", " ", 
         RowBox[{"Range", "@", "nq"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"AssociateTo", "[", 
        RowBox[{"rb", ",", 
         RowBox[{"Links", "\[Rule]", 
          RowBox[{"<|", " ", 
           RowBox[{
            RowBox[{"ParentList", "\[Rule]", "parent"}], ",", 
            RowBox[{"TreeForm", "\[Rule]", "j"}]}], " ", "|>"}]}]}], "]"}], 
       "[", "Links", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6710203143021083`*^9, 3.671020335425206*^9}, {
   3.671020574068858*^9, 3.671020635983886*^9}, {3.6710411707467566`*^9, 
   3.671041192502906*^9}, {3.6711071517043867`*^9, 3.6711071958403397`*^9}, {
   3.671107229661975*^9, 3.6711072611440873`*^9}, {3.6711073640236435`*^9, 
   3.6711073774979153`*^9}, {3.6711074126459913`*^9, 
   3.6711074274753933`*^9}, {3.6711075092694707`*^9, 3.671107525845162*^9}, {
   3.6711077209898987`*^9, 3.671107721481968*^9}, {3.671109177242817*^9, 
   3.67110929123164*^9}, {3.6711094184874587`*^9, 3.671109429196262*^9}, 
   3.671109471820416*^9, {3.6711095866779413`*^9, 3.6711095900349884`*^9}, {
   3.6711096247228565`*^9, 3.671109698341575*^9}, {3.671109742404545*^9, 
   3.6711097593473177`*^9}, {3.6711101706161823`*^9, 3.67111022623352*^9}, {
   3.671110279900738*^9, 3.6711102952861733`*^9}, {3.6711103340298624`*^9, 
   3.6711104096408772`*^9}, {3.67111047209239*^9, 3.671110474947933*^9}, {
   3.6711105113872614`*^9, 3.671110553290621*^9}, {3.671110629349578*^9, 
   3.671110631526738*^9}, {3.6711107052301083`*^9, 3.671110706281056*^9}, {
   3.671113258531432*^9, 3.671113259547351*^9}, {3.671116580768721*^9, 
   3.6711166043892183`*^9}, {3.671116662113367*^9, 3.6711167887925954`*^9}, {
   3.6711168867895746`*^9, 3.6711169180046773`*^9}, {3.671117001025756*^9, 
   3.6711170159995933`*^9}, {3.6711170762280803`*^9, 3.671117119311077*^9}, {
   3.671117171117518*^9, 3.6711172265280633`*^9}, {3.6711173231267138`*^9, 
   3.671117327540268*^9}, {3.671118649805401*^9, 3.671118659367464*^9}, {
   3.7173568586536617`*^9, 3.7173568594036684`*^9}, 3.7173571441097183`*^9, {
   3.717372571949004*^9, 3.717372572245883*^9}, {3.717372961202999*^9, 
   3.7173729701405926`*^9}, 3.7175068250567207`*^9, {3.7175564871764603`*^9, 
   3.717556493660886*^9}, {3.717556531192519*^9, 3.7175565313956633`*^9}, {
   3.7176461026882124`*^9, 3.717646126110326*^9}, {3.7177785606624317`*^9, 
   3.717778562912442*^9}, 3.7177786180379515`*^9, {3.718645696018306*^9, 
   3.7186457506438303`*^9}, {3.7186457890660996`*^9, 3.718645802534978*^9}, {
   3.7186458361290655`*^9, 3.718645873988797*^9}, {3.718649426900755*^9, 
   3.7186494275726233`*^9}, {3.7186494773699865`*^9, 3.718649478479373*^9}, {
   3.718651799244267*^9, 3.71865182633827*^9}, {3.718651869135585*^9, 
   3.718651881073185*^9}, {3.718651949542614*^9, 3.71865195015201*^9}, {
   3.7186519813866787`*^9, 3.718651983042943*^9}, {3.7186586154166346`*^9, 
   3.718658638559167*^9}, 3.718658686090887*^9, {3.718659589050527*^9, 
   3.7186595908005447`*^9}, {3.7186596399697275`*^9, 
   3.7186596498760757`*^9}, {3.71866012836518*^9, 3.71866022406925*^9}, {
   3.7186604176961665`*^9, 3.7186604726326485`*^9}, {3.7186606762596607`*^9, 
   3.7186607210569773`*^9}, {3.7186607512447777`*^9, 3.718660752697916*^9}, {
   3.7186607933545837`*^9, 3.7186607949327235`*^9}, {3.7188917390015936`*^9, 
   3.7188917396422415`*^9}, {3.718891798127179*^9, 3.7188917993615675`*^9}, {
   3.719118539293887*^9, 3.7191185492158613`*^9}, {3.719118626769057*^9, 
   3.719118626925308*^9}, 
   3.7191620803123093`*^9},ExpressionUUID->"e75fc780-62af-484d-9104-\
e8a26a29ddd1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MakeNearestCommonAncestor", "[", 
     RowBox[{"parent_", ",", " ", "n_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "p", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"nearest", " ", "common", " ", "ancestor", " ", 
        RowBox[{"(", "nca", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nca", " ", "=", " ", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", " ", 
          RowBox[{"{", 
           RowBox[{"n", ",", " ", "n"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"nca", "\[LeftDoubleBracket]", 
            RowBox[{"i", ",", " ", "i"}], "\[RightDoubleBracket]"}], " ", "=",
            " ", "i"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"your", " ", 
            RowBox[{"parent", "'"}], "s", " ", "ncas", " ", "are", " ", 
            "your", " ", "ncas"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"p", " ", "=", " ", 
           RowBox[{
           "parent", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"p", " ", "\[NotEqual]", " ", "0"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"parent", "'"}], "s", " ", "ancestors"}], " ", "+", 
              " ", "siblings"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"nca", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", " ", 
                RowBox[{"1", ";;", "p"}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", 
              RowBox[{"nca", "\[LeftDoubleBracket]", 
               RowBox[{"p", ",", " ", 
                RowBox[{"1", ";;", "p"}]}], "\[RightDoubleBracket]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"parent", "'"}], "s", " ", "siblings"}], " ", "+", 
               " ", "kids"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"nca", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", " ", 
                RowBox[{
                 RowBox[{"p", "+", "1"}], ";;", 
                 RowBox[{"i", "-", "1"}]}]}], "\[RightDoubleBracket]"}], " ", 
              "=", " ", 
              RowBox[{"nca", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                 RowBox[{"p", "+", "1"}], ";;", 
                 RowBox[{"i", "-", "1"}]}], ",", " ", "p"}], 
               "\[RightDoubleBracket]"}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}], "\[IndentingNewLine]", ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "n"}], "}"}]}], "\[IndentingNewLine]", "]"}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"nca", " ", "=", " ", 
        RowBox[{"nca", " ", "+", " ", 
         RowBox[{
          RowBox[{"LowerTriangularize", "[", 
           RowBox[{"nca", ",", " ", 
            RowBox[{"-", "1"}]}], "]"}], "\[Transpose]"}]}]}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"GetPath", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetPath", "[", 
    RowBox[{"i_", ",", " ", 
     RowBox[{"j_:", "0"}]}], "]"}], " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", " ", "i2a", ",", " ", "j2a"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "returns", " ", "the", " ", "path", " ", "from", " ", "i", " ", "to", 
       " ", "j"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "this", " ", "can", " ", "also", " ", "be", " ", "used", " ", "to", 
        " ", "return", " ", "the", " ", "children", " ", "on", " ", "a", " ", 
        "path", " ", "if", " ", "a"}], " ", "\[Element]", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "j"}], "}"}], "."}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"i", " ", "\[Equal]", " ", "0"}], " ", "||", " ", 
          RowBox[{"j", " ", "\[Equal]", " ", "0"}]}], ",", " ", "0", ",", " ", 
         RowBox[{"nca", "\[LeftDoubleBracket]", 
          RowBox[{"i", ",", " ", "j"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"i2a", " ", "=", " ", 
       RowBox[{"NestWhileList", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "parent", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
          "&"}], ",", " ", "i", ",", " ", 
         RowBox[{
          RowBox[{"#", "\[NotEqual]", " ", "a"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"j2a", " ", "=", " ", 
       RowBox[{"NestWhileList", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
          "parent", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
          "&"}], ",", " ", "j", ",", " ", 
         RowBox[{
          RowBox[{"#", "\[NotEqual]", " ", "a"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Join", "[", 
       RowBox[{"i2a", ",", " ", 
        RowBox[{"Rest", "@", 
         RowBox[{"Reverse", "@", "j2a"}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.591667817527995*^9, 3.591668923825349*^9, {3.5916697599352307`*^9, 
   3.591669819815657*^9}, {3.5916698753458366`*^9, 3.5916698888766146`*^9}, {
   3.5916699961457586`*^9, 3.591669997476833*^9}, {3.59167068192603*^9, 
   3.59167070374928*^9}, {3.5917208858180676`*^9, 3.591720889380574*^9}, {
   3.5917221970292563`*^9, 3.591722203732394*^9}, {3.591722238732463*^9, 
   3.591722239091839*^9}, {3.591930526907305*^9, 3.5919305664205675`*^9}, {
   3.5919306118141713`*^9, 3.591930612108184*^9}, 3.591930660729968*^9, {
   3.591930696356006*^9, 3.5919307386704297`*^9}, {3.5919308258974266`*^9, 
   3.5919308840727587`*^9}, {3.591931024599806*^9, 3.591931025034828*^9}, {
   3.591931958433284*^9, 3.5919319593043294`*^9}, {3.5919331117973347`*^9, 
   3.5919331580109777`*^9}, {3.591933250024245*^9, 3.591933252427383*^9}, {
   3.591985667141246*^9, 3.5919857313879256`*^9}, {3.591987361798293*^9, 
   3.591987364276435*^9}, {3.5919978599754896`*^9, 3.59199787152915*^9}, 
   3.5919979113604307`*^9, {3.5919979589681625`*^9, 3.5919979727709627`*^9}, 
   3.5919982080554256`*^9, {3.5920191973504057`*^9, 3.592019234797552*^9}, {
   3.5921518015301204`*^9, 3.592151821661277*^9}, {3.5921518519500084`*^9, 
   3.5921518784545245`*^9}, {3.5921519174737606`*^9, 3.592151918642827*^9}, {
   3.5921519914750166`*^9, 3.5921519924810553`*^9}, 3.5921521161271386`*^9, {
   3.5921521472189164`*^9, 3.592152245920565*^9}, {3.5921524640720634`*^9, 
   3.5921524695633802`*^9}, {3.5921527028097334`*^9, 
   3.5921527107801905`*^9}, {3.59215278839163*^9, 3.592152817779317*^9}, 
   3.5921530282183657`*^9, {3.59215320443246*^9, 3.5921532065185785`*^9}, {
   3.5922519586863747`*^9, 3.592251999186454*^9}, {3.592254165862566*^9, 
   3.5922542064876456`*^9}, {3.5922558428788123`*^9, 
   3.5922558607708282`*^9}, {3.5922558957868533`*^9, 3.592255901201167*^9}, 
   3.592255970324107*^9, {3.5922580456873465`*^9, 3.592258045853349*^9}, {
   3.5922581158633614`*^9, 3.592258139375705*^9}, {3.592258226580702*^9, 
   3.592258231348975*^9}, {3.592258396619439*^9, 3.5922584020647693`*^9}, {
   3.592258438962861*^9, 3.592258459774053*^9}, {3.5922591760830736`*^9, 
   3.5922591855486183`*^9}, {3.592259257920762*^9, 3.5922592787549534`*^9}, {
   3.5922594413162627`*^9, 3.592259469596903*^9}, {3.592259570929685*^9, 
   3.5922595851425023`*^9}, {3.592259622531643*^9, 3.5922596920396233`*^9}, {
   3.5922597847129307`*^9, 3.59225978836014*^9}, {3.592265284603904*^9, 
   3.592265302772931*^9}, {3.5922660757641973`*^9, 3.592266168732519*^9}, {
   3.592266745226554*^9, 3.5922667453035393`*^9}, 3.5922667840087557`*^9, {
   3.592266872124799*^9, 3.592266894180065*^9}, {3.5922669756537285`*^9, 
   3.5922669960148973`*^9}, {3.5922671554480267`*^9, 
   3.5922672007746234`*^9}, {3.592267352764331*^9, 3.592267352851329*^9}, {
   3.5922673878293343`*^9, 3.5922674271685877`*^9}, {3.5922677518271804`*^9, 
   3.592267753864293*^9}, {3.592269365102566*^9, 3.5922693810894814`*^9}, {
   3.5922694704245977`*^9, 3.59226951552118*^9}, 3.592269559872718*^9, {
   3.592269596464834*^9, 3.592269605997359*^9}, {3.592269651011939*^9, 
   3.5922696511789675`*^9}, {3.592269686507972*^9, 3.59226972943143*^9}, {
   3.5922698283110924`*^9, 3.5922699566064405`*^9}, {3.5922700800495105`*^9, 
   3.592270104246894*^9}, {3.5922701343156166`*^9, 3.5922701411890078`*^9}, {
   3.5922701729868326`*^9, 3.592270182028349*^9}, {3.59227026813428*^9, 
   3.592270307654543*^9}, {3.592270789010106*^9, 3.592270804936021*^9}, {
   3.592271003227376*^9, 3.5922710164511337`*^9}, {3.5922710767405863`*^9, 
   3.592271096212701*^9}, {3.5922712492224765`*^9, 3.59227124969849*^9}, 
   3.5922713284640007`*^9, {3.592271377491807*^9, 3.5922713780178576`*^9}, {
   3.5922714086255894`*^9, 3.592271408733595*^9}, {3.5922714892252083`*^9, 
   3.592271557448115*^9}, {3.5922717878813114`*^9, 3.592271820858195*^9}, 
   3.5922718793635445`*^9, {3.592271916862694*^9, 3.592271917492734*^9}, {
   3.592271975838073*^9, 3.5922719809793663`*^9}, {3.5922721103467903`*^9, 
   3.592272167605055*^9}, {3.592272355126795*^9, 3.5922723559508424`*^9}, {
   3.592272387750682*^9, 3.592272430457106*^9}, {3.5922724624049335`*^9, 
   3.592272486586323*^9}, {3.592272554254202*^9, 3.5922725606365767`*^9}, {
   3.5922726000188184`*^9, 3.5922726042520723`*^9}, {3.592272771832677*^9, 
   3.5922727837953434`*^9}, {3.5922728195993934`*^9, 
   3.5922728631518846`*^9}, {3.5922729410483484`*^9, 
   3.5922729655267687`*^9}, {3.5922731177624674`*^9, 
   3.5922731543115797`*^9}, {3.592273310760521*^9, 3.5922734737338514`*^9}, {
   3.5922735108949947`*^9, 3.592273518410412*^9}, {3.5922735543504705`*^9, 
   3.59227358123601*^9}, {3.592273646181729*^9, 3.592273726257312*^9}, {
   3.5922737869537907`*^9, 3.5922738520135164`*^9}, {3.5922740041642246`*^9, 
   3.592274023666346*^9}, {3.592274258321784*^9, 3.5922742741106863`*^9}, {
   3.592274419230996*^9, 3.5922744193890047`*^9}, {3.59227448977404*^9, 
   3.5922745196417465`*^9}, {3.5922745553427935`*^9, 3.592274595237076*^9}, {
   3.592274638285543*^9, 3.5922746696913414`*^9}, {3.5922747972366467`*^9, 
   3.5922748309945784`*^9}, {3.592274966500351*^9, 3.592274991427766*^9}, {
   3.592275022895569*^9, 3.592275031693086*^9}, {3.5922750665360675`*^9, 
   3.5922752337196403`*^9}, {3.5922753371725636`*^9, 
   3.5922753612429485`*^9}, {3.592275404604432*^9, 3.592275406126515*^9}, {
   3.5922755649776125`*^9, 3.5922756207168036`*^9}, {3.5922758717241945`*^9, 
   3.5922758743503284`*^9}, {3.5922805198023577`*^9, 3.592280560296678*^9}, {
   3.592280648507742*^9, 3.592280653503023*^9}, {3.59228859193862*^9, 
   3.592288631802901*^9}, {3.5922886637607336`*^9, 3.592288669778076*^9}, {
   3.5922887474895287`*^9, 3.5922887482945967`*^9}, {3.592288778321295*^9, 
   3.5922887893069234`*^9}, {3.5922930252875032`*^9, 
   3.5922930261875534`*^9}, {3.59232216412803*^9, 3.5923221645760417`*^9}, {
   3.5923222141038747`*^9, 3.5923222146439095`*^9}, {3.592322303587002*^9, 
   3.5923223085062847`*^9}, {3.592322455802719*^9, 3.592322482674258*^9}, 
   3.592322568846193*^9, {3.592323716015887*^9, 3.5923238349947195`*^9}, {
   3.5923238811463437`*^9, 3.592323903579629*^9}, {3.592323947101121*^9, 
   3.592323958546775*^9}, 3.592325020905615*^9, 3.5923250924057074`*^9, {
   3.592325178768654*^9, 3.5923251847249947`*^9}, {3.592325509846614*^9, 
   3.592325579905626*^9}, {3.592325610773393*^9, 3.592325610986409*^9}, {
   3.5923256480075245`*^9, 3.592325653257824*^9}, {3.592326357953201*^9, 
   3.5923263611073627`*^9}, {3.5923264423020124`*^9, 
   3.5923264641812835`*^9}, {3.592326512038006*^9, 3.5923266042622867`*^9}, {
   3.5923266497838936`*^9, 3.59232674643143*^9}, {3.592326830500261*^9, 
   3.5923268797860622`*^9}, {3.5923269342291837`*^9, 
   3.5923269986578894`*^9}, {3.5923270362190285`*^9, 3.592327117486677*^9}, {
   3.5923272314232144`*^9, 3.5923272715754995`*^9}, {3.5923273065705056`*^9, 
   3.592327350989049*^9}, {3.5923274125735755`*^9, 3.592327418064891*^9}, {
   3.5923275140303864`*^9, 3.5923276062176657`*^9}, {3.5923276532933617`*^9, 
   3.592327654185412*^9}, {3.5923276926456146`*^9, 3.592327692772622*^9}, {
   3.5923277288566885`*^9, 3.592327904489751*^9}, {3.592327939983777*^9, 
   3.5923279946489096`*^9}, {3.5923280273017793`*^9, 
   3.5923280708432727`*^9}, {3.592328256381916*^9, 3.592328311494054*^9}, {
   3.592328377548837*^9, 3.5923283784428883`*^9}, {3.5923290216127205`*^9, 
   3.592329030903251*^9}, 3.5923293277412486`*^9, {3.5923294589187665`*^9, 
   3.5923294903285656`*^9}, {3.592329543190589*^9, 3.59232954460567*^9}, {
   3.5923295995248127`*^9, 3.5923297137353554`*^9}, {3.5923297507114735`*^9, 
   3.5923297799551473`*^9}, {3.5923298456749153`*^9, 
   3.5923298638739705`*^9}, {3.592329916913991*^9, 3.5923299180660534`*^9}, {
   3.5923300051120396`*^9, 3.592330006966149*^9}, {3.592330040054043*^9, 
   3.5923300669505844`*^9}, {3.592330118277522*^9, 3.592330208584695*^9}, {
   3.5923302807648277`*^9, 3.5923303462545786`*^9}, {3.5923307023329697`*^9, 
   3.59233075823417*^9}, 3.59233085839291*^9, {3.5923309133830557`*^9, 
   3.592330926128785*^9}, {3.5923309567205377`*^9, 3.59233098767231*^9}, {
   3.5923310282886353`*^9, 3.592331084900878*^9}, {3.5923312539095697`*^9, 
   3.5923312777179203`*^9}, {3.5923313996679215`*^9, 3.592331563625311*^9}, {
   3.5923316207045584`*^9, 3.5923316484191484`*^9}, {3.592331710373694*^9, 
   3.59233173455208*^9}, {3.592331766743924*^9, 3.592331818322875*^9}, {
   3.592331902011675*^9, 3.5923319996242604`*^9}, {3.5923320770106974`*^9, 
   3.5923321816526823`*^9}, {3.592332323052782*^9, 3.5923323245848713`*^9}, {
   3.5923323692014256`*^9, 3.5923324045414486`*^9}, {3.592332447873933*^9, 
   3.592332509325468*^9}, {3.592332544584469*^9, 3.592332612939383*^9}, {
   3.5923327382425585`*^9, 3.592332893818468*^9}, {3.592332937962996*^9, 
   3.5923329423152466`*^9}, {3.5923330114832063`*^9, 
   3.5923330471242476`*^9}, {3.592333090562735*^9, 3.5923331256457443`*^9}, {
   3.592333182797021*^9, 3.5923332001360097`*^9}, {3.5923333254841843`*^9, 
   3.5923333524377313`*^9}, {3.5923334143242755`*^9, 3.59233362061009*^9}, {
   3.592333653265959*^9, 3.592333655125065*^9}, {3.592333718847728*^9, 
   3.5923337979862437`*^9}, {3.592333836173434*^9, 3.5923338582126956`*^9}, {
   3.592334017578822*^9, 3.592334021541049*^9}, {3.5923340968783627`*^9, 
   3.592334161335054*^9}, {3.592334191952804*^9, 3.592334217431267*^9}, {
   3.5923345274470387`*^9, 3.592334642373602*^9}, {3.5923347077953486`*^9, 
   3.59233471623883*^9}, {3.592334765200636*^9, 3.592334767330758*^9}, {
   3.592335071649193*^9, 3.5923350768634834`*^9}, {3.5923356715045385`*^9, 
   3.592335680606055*^9}, {3.5923538222759776`*^9, 3.592353831584521*^9}, {
   3.592370916535984*^9, 3.5923709463356905`*^9}, {3.5923711734726973`*^9, 
   3.5923711932798505`*^9}, {3.5923716758344617`*^9, 3.592371686130056*^9}, {
   3.592371744953433*^9, 3.59237175434396*^9}, {3.592371797994459*^9, 
   3.5923718202977347`*^9}, {3.5923747656754103`*^9, 
   3.5923747663284464`*^9}, {3.592383856791027*^9, 3.5923838888468666`*^9}, {
   3.5925242672389746`*^9, 3.592524267779004*^9}, {3.5926274023654532`*^9, 
   3.592627408631096*^9}, {3.5926275824752035`*^9, 3.592627592350204*^9}, {
   3.592629248489919*^9, 3.592629249235964*^9}, {3.592666598963564*^9, 
   3.5926666238073626`*^9}, {3.5927480544837275`*^9, 3.592748086640041*^9}, {
   3.592748144796405*^9, 3.5927481617651877`*^9}, {3.5927573412623234`*^9, 
   3.5927574347756777`*^9}, {3.59275746746855*^9, 3.5927575284640436`*^9}, {
   3.592757602718296*^9, 3.592757738909095*^9}, {3.5927578052508936`*^9, 
   3.592757817615602*^9}, {3.5927579162412496`*^9, 3.5927579330742135`*^9}, {
   3.5927579847871747`*^9, 3.5927581240521483`*^9}, {3.5927583344062004`*^9, 
   3.5927583505581193`*^9}, 3.5927585361497507`*^9, {3.5927585961802025`*^9, 
   3.5927586271859827`*^9}, {3.592760178720814*^9, 3.5927601805439177`*^9}, {
   3.5927609618316603`*^9, 3.5927609624546967`*^9}, {3.592761705624259*^9, 
   3.5927617295366244`*^9}, {3.592761761840474*^9, 3.5927618444832067`*^9}, {
   3.5927618954711266`*^9, 3.5927618971682234`*^9}, 3.5927722880152674`*^9, 
   3.5927724400529785`*^9, 3.5927737486189156`*^9, {3.59278532976274*^9, 
   3.5927853310748105`*^9}, 3.592865011885339*^9, {3.592998251903042*^9, 
   3.5929982578093033`*^9}, {3.5930049819943275`*^9, 3.593005031978801*^9}, {
   3.593005091775792*^9, 3.593005112619583*^9}, {3.5933134779669466`*^9, 
   3.59331348117008*^9}, {3.5933135216232977`*^9, 3.5933135244045515`*^9}, {
   3.593973417214839*^9, 3.5939735067199636`*^9}, {3.593973769481007*^9, 
   3.5939737843378735`*^9}, {3.593973926281987*^9, 3.5939739276240625`*^9}, {
   3.593973963001085*^9, 3.593973963648127*^9}, {3.5962988837573338`*^9, 
   3.596298891054226*^9}, 3.602506267571031*^9, {3.6025063148457375`*^9, 
   3.602506402993786*^9}, {3.602506500207349*^9, 3.6025065026015034`*^9}, {
   3.602506611266713*^9, 3.602506621027272*^9}, {3.602509813708104*^9, 
   3.6025099441475735`*^9}, {3.6025099971836133`*^9, 
   3.6025101057698507`*^9}, {3.6025101538775997`*^9, 3.602510229888958*^9}, {
   3.602510285548126*^9, 3.6025103031511345`*^9}, 3.6025103712620354`*^9, {
   3.6025106022062607`*^9, 3.602510602658305*^9}, {3.602510656901393*^9, 
   3.60251070207498*^9}, {3.602510802510731*^9, 3.6025108054909024`*^9}, {
   3.6025121567533035`*^9, 3.602512157485327*^9}, {3.60251219992276*^9, 
   3.602512200076767*^9}, {3.602512281343419*^9, 3.6025123251379414`*^9}, 
   3.6025125282475586`*^9, {3.6025966892036605`*^9, 3.602596699266176*^9}, {
   3.6025967547975307`*^9, 3.6025968008601246`*^9}, {3.602596848282092*^9, 
   3.6025971048919706`*^9}, {3.6025971520639367`*^9, 3.602597153173314*^9}, {
   3.6025971908765125`*^9, 3.6025972346109724`*^9}, {3.6025972927985888`*^9, 
   3.602597342548684*^9}, {3.6025974649082985`*^9, 3.6025976055804496`*^9}, {
   3.6025976636274366`*^9, 3.602597667002463*^9}, 3.6025977256588087`*^9, {
   3.6025978610965734`*^9, 3.6025978702215953`*^9}, {3.6025979252217007`*^9, 
   3.602597925846697*^9}, {3.602617382638736*^9, 3.602617385560906*^9}, {
   3.602617653775265*^9, 3.6026176554283595`*^9}, {3.6029523465110755`*^9, 
   3.6029524321529803`*^9}, {3.602952477023546*^9, 3.6029525481266174`*^9}, {
   3.602952585175739*^9, 3.6029527691302776`*^9}, {3.6029529444623194`*^9, 
   3.6029529847096233`*^9}, {3.6029530168964667`*^9, 
   3.6029530434289865`*^9}, {3.6029531722483597`*^9, 
   3.6029532409792995`*^9}, {3.6029533074591055`*^9, 3.602953361388194*^9}, {
   3.6029534057507305`*^9, 3.602953429736112*^9}, {3.6029535698391314`*^9, 
   3.602953571048201*^9}, {3.602953642985321*^9, 3.6029537167455444`*^9}, {
   3.6029541173585005`*^9, 3.602954121300716*^9}, {3.602954377371375*^9, 
   3.602954378678451*^9}, 3.602954652728149*^9, {3.6029546972957115`*^9, 
   3.602954698771778*^9}, {3.6029547301385784`*^9, 3.602954744615408*^9}, {
   3.602954899802294*^9, 3.60295491549119*^9}, {3.602955301105277*^9, 
   3.602955319944354*^9}, {3.6029555879787035`*^9, 3.602955588589757*^9}, {
   3.602955897617435*^9, 3.602955907039975*^9}, {3.60295600858179*^9, 
   3.602956018622365*^9}, {3.6029561243724213`*^9, 3.6029561266775503`*^9}, 
   3.6029563218817315`*^9, {3.6029563673443346`*^9, 3.6029564084766865`*^9}, {
   3.6029564517091703`*^9, 3.6029564699192095`*^9}, {3.6029565033221188`*^9, 
   3.6029565072423477`*^9}, {3.6029567736456065`*^9, 
   3.6029567782808685`*^9}, {3.602956831387929*^9, 3.6029568782775946`*^9}, {
   3.602956916415781*^9, 3.6029569226721363`*^9}, {3.6029569843666706`*^9, 
   3.602957001643659*^9}, {3.6029573658195143`*^9, 3.6029573717038517`*^9}, {
   3.602957476031826*^9, 3.60295747646585*^9}, 3.6029575386804132`*^9, {
   3.6029587364290037`*^9, 3.602958742506352*^9}, {3.602958783710713*^9, 
   3.6029587991195946`*^9}, {3.6029588820713444`*^9, 
   3.6029589062437325`*^9}, {3.6029589412967367`*^9, 
   3.6029590180841336`*^9}, {3.6029590560793095`*^9, 3.602959106976224*^9}, {
   3.602959217108531*^9, 3.6029592766829467`*^9}, {3.6029595178287525`*^9, 
   3.6029595632373533`*^9}, {3.602959761513707*^9, 3.602959803309101*^9}, {
   3.6029598473936253`*^9, 3.6029598686178412`*^9}, {3.6029599010917015`*^9, 
   3.602959950482529*^9}, {3.6029600302720985`*^9, 3.6029600303581038`*^9}, {
   3.602960850203639*^9, 3.6029608518447523`*^9}, {3.602960903631263*^9, 
   3.6029609256385264`*^9}, {3.602960968222962*^9, 3.6029609699570785`*^9}, {
   3.6029612888623233`*^9, 3.60296131552185*^9}, {3.6029618183656454`*^9, 
   3.6029618947290196`*^9}, {3.6029619730715046`*^9, 3.602962028017649*^9}, {
   3.6029625562919044`*^9, 3.6029626014205017`*^9}, {3.602962631990238*^9, 
   3.602962639976696*^9}, {3.60296272822775*^9, 3.602962799688843*^9}, {
   3.6029628535869255`*^9, 3.6029628841596932`*^9}, {3.6029629919988556`*^9, 
   3.6029630347893057`*^9}, {3.602963137118165*^9, 3.6029631564672747`*^9}, {
   3.60296321960389*^9, 3.602963219675894*^9}, {3.60296328509064*^9, 
   3.6029633169344635`*^9}, {3.6029635775603895`*^9, 3.602963582387665*^9}, {
   3.6029636540077667`*^9, 3.6029637102060027`*^9}, {3.602963759040806*^9, 
   3.6029637656941624`*^9}, {3.602963901903962*^9, 3.602963903123048*^9}, 
   3.6029639535339193`*^9, {3.6029640178896046`*^9, 3.602964060555048*^9}, {
   3.602964153937393*^9, 3.602964177311735*^9}, {3.602964217314025*^9, 
   3.6029642449776134`*^9}, {3.602964332434617*^9, 3.6029644393267393`*^9}, {
   3.6029645381954*^9, 3.602964541063565*^9}, {3.6029648000013933`*^9, 
   3.602964980560733*^9}, {3.602972116556387*^9, 3.602972128788083*^9}, {
   3.602972967100095*^9, 3.602972968268162*^9}, {3.6029737834128428`*^9, 
   3.6029738663145905`*^9}, {3.6029739256689887`*^9, 
   3.6029739324243765`*^9}, {3.6029739672423697`*^9, 3.602974020391432*^9}, 
   3.6029741064033346`*^9, 3.602974606913001*^9, {3.603245692484913*^9, 
   3.6032458066264677`*^9}, {3.6032460361925964`*^9, 3.60324608747753*^9}, {
   3.60324628115562*^9, 3.603246284855855*^9}, {3.603246343610201*^9, 
   3.603246372112834*^9}, {3.6032464222237053`*^9, 3.603246505115445*^9}, {
   3.6032467420050154`*^9, 3.6032467446061645`*^9}, {3.603248047280764*^9, 
   3.603248081244709*^9}, {3.6032481541118817`*^9, 3.6032481563040066`*^9}, {
   3.6032483709412994`*^9, 3.6032484012280307`*^9}, {3.6032484745502367`*^9, 
   3.6032484773493896`*^9}, {3.6032485276062703`*^9, 
   3.6032485326845617`*^9}, {3.603248754459262*^9, 3.603248755188302*^9}, {
   3.6032488600583086`*^9, 3.603248864841584*^9}, {3.6032493268680415`*^9, 
   3.6032493271940794`*^9}, {3.603249396643039*^9, 3.6032494081336956`*^9}, {
   3.6032496022218285`*^9, 3.603249664997405*^9}, {3.6032497423078365`*^9, 
   3.6032498828528943`*^9}, {3.6032499363879466`*^9, 3.603249940222164*^9}, {
   3.603250015505478*^9, 3.6032500208347826`*^9}, {3.6032500543217*^9, 
   3.6032500591239753`*^9}, 3.603250134109269*^9, {3.6032505617237544`*^9, 
   3.6032505760435734`*^9}, 3.6032518442672043`*^9, {3.6032525682936673`*^9, 
   3.6032525690497117`*^9}, {3.6032526569597445`*^9, 3.603252670753533*^9}, {
   3.6032527661949997`*^9, 3.6032527856381316`*^9}, {3.6032535116856456`*^9, 
   3.6032536768051147`*^9}, {3.6032537203075924`*^9, 
   3.6032538631327715`*^9}, {3.603253893347515*^9, 3.6032539212560997`*^9}, {
   3.603253957019148*^9, 3.6032539640205493`*^9}, {3.603254048824405*^9, 
   3.603254049812463*^9}, {3.6032540825973396`*^9, 3.6032541801589303`*^9}, {
   3.6032542495339*^9, 3.603254449149331*^9}, {3.603254574010481*^9, 
   3.6032546914142137`*^9}, {3.6032547367598147`*^9, 3.603254741613083*^9}, {
   3.603254856376651*^9, 3.6032549116348157`*^9}, {3.6032549468238306`*^9, 
   3.603255010237462*^9}, {3.603255087311874*^9, 3.6032552616288595`*^9}, {
   3.6032554106433926`*^9, 3.6032554165017405`*^9}, {3.603255463340411*^9, 
   3.6032554712538633`*^9}, {3.6032555055888295`*^9, 3.603255512901248*^9}, {
   3.6032559375845685`*^9, 3.6032559386066275`*^9}, {3.603255975896776*^9, 
   3.6032559764987965`*^9}, {3.6032560238935103`*^9, 3.603256028384774*^9}, {
   3.603256093071472*^9, 3.603256106045215*^9}, {3.603256218338646*^9, 
   3.603256287660616*^9}, {3.6032563220165834`*^9, 3.603256349674167*^9}, {
   3.603256448078806*^9, 3.6032565479715242`*^9}, {3.603256583766573*^9, 
   3.603256626610026*^9}, 3.603256682037201*^9, {3.6032568989846287`*^9, 
   3.6032569060370283`*^9}, {3.6032569908728857`*^9, 3.603257150121003*^9}, {
   3.6032571807877617`*^9, 3.60325718147482*^9}, {3.603257277423296*^9, 
   3.6032572913990965`*^9}, {3.6032573548837323`*^9, 
   3.6032574131450663`*^9}, {3.6032574999990425`*^9, 3.603257500795085*^9}, 
   3.603257609387311*^9, {3.6032576652945085`*^9, 3.6032577259679823`*^9}, {
   3.6032578000962253`*^9, 3.6032578206904078`*^9}, {3.603257852050203*^9, 
   3.603257858170554*^9}, {3.603258071757799*^9, 3.6032580968102193`*^9}, {
   3.603258157351688*^9, 3.6032582259036136`*^9}, {3.60325828771115*^9, 
   3.603258289722267*^9}, {3.6032583209700565`*^9, 3.6032583222521296`*^9}, {
   3.603258461536106*^9, 3.6032585323561587`*^9}, {3.6032585966808453`*^9, 
   3.60325859691687*^9}, {3.6032587630793743`*^9, 3.603258768451683*^9}, {
   3.6032846406756654`*^9, 3.603284685397222*^9}, {3.6032847293527393`*^9, 
   3.603284883592572*^9}, {3.6032849340884647`*^9, 3.6032849843163557`*^9}, {
   3.6032852674165525`*^9, 3.6032852687296305`*^9}, {3.603285841034401*^9, 
   3.6032858605605183`*^9}, {3.6032861150190916`*^9, 
   3.6032861194823465`*^9}, {3.6032873247603693`*^9, 
   3.6032873357559986`*^9}, {3.603287388440016*^9, 3.6032874103162656`*^9}, {
   3.6032875693603764`*^9, 3.6032876738203597`*^9}, {3.6032877262293596`*^9, 
   3.6032877309496303`*^9}, {3.6032878998673034`*^9, 
   3.6032879372374434`*^9}, {3.603287979183843*^9, 3.6032880413194036`*^9}, {
   3.603288542142084*^9, 3.6032885423080935`*^9}, {3.6032886050996895`*^9, 
   3.6032886185114756`*^9}, {3.603288670735448*^9, 3.603288720492298*^9}, {
   3.6032887634377565`*^9, 3.6032888261983643`*^9}, {3.6032888818225546`*^9, 
   3.603288914965434*^9}, 3.6032889496064186`*^9, {3.603289299666465*^9, 
   3.603289313396264*^9}, {3.603289497849814*^9, 3.6032896594460683`*^9}, {
   3.6032899980764565`*^9, 3.6032900032847548`*^9}, {3.603290297697619*^9, 
   3.6032903042870097`*^9}, {3.603290371819865*^9, 3.6032903739049826`*^9}, {
   3.6032904088649845`*^9, 3.6032904096650305`*^9}, {3.603290506322566*^9, 
   3.6032905067515907`*^9}, {3.6032906151338153`*^9, 
   3.6032906422593503`*^9}, {3.603290685921847*^9, 3.603290702549803*^9}, {
   3.603290802969554*^9, 3.6032908193494916`*^9}, {3.603291006146187*^9, 
   3.603291006584214*^9}, {3.6032912576735935`*^9, 3.6032912717023964`*^9}, {
   3.603291968372297*^9, 3.6032920285237403`*^9}, {3.603292116445772*^9, 
   3.603292202311689*^9}, {3.603292248306323*^9, 3.6032922528245955`*^9}, {
   3.6032923021274056`*^9, 3.6032923595886965`*^9}, 3.603292438155197*^9, {
   3.6032927104928055`*^9, 3.603292789137295*^9}, {3.6032928523099127`*^9, 
   3.603292896129423*^9}, {3.6032929370427647`*^9, 3.6032931291307683`*^9}, {
   3.6032942520500846`*^9, 3.603294286420039*^9}, {3.6032946668958273`*^9, 
   3.6032946699140005`*^9}, {3.603294761375238*^9, 3.6032947749160323`*^9}, {
   3.6032948108020678`*^9, 3.6032948569947157`*^9}, {3.6032952684642773`*^9, 
   3.603295268579298*^9}, {3.6032954313396044`*^9, 3.603295431833633*^9}, {
   3.603295567511403*^9, 3.6032956118319407`*^9}, {3.6032956515612173`*^9, 
   3.60329565322733*^9}, {3.6032957343709574`*^9, 3.603295750193864*^9}, 
   3.603296008958683*^9, {3.603296362999958*^9, 3.6032963894864883`*^9}, {
   3.603296738414456*^9, 3.603296738866482*^9}, {3.6032967832540293`*^9, 
   3.603296808660495*^9}, {3.603296902867874*^9, 3.6032969204548817`*^9}, {
   3.603297008364916*^9, 3.603297011456106*^9}, {3.603297369470595*^9, 
   3.6032973866935997`*^9}, {3.603297418610409*^9, 3.6032974341793003`*^9}, {
   3.6032974700023527`*^9, 3.603297540570393*^9}, {3.6032975881211176`*^9, 
   3.6032975946934967`*^9}, {3.6032985302240667`*^9, 
   3.6032985308131003`*^9}, {3.6032985696983275`*^9, 3.603298624861487*^9}, {
   3.6032986558232594`*^9, 3.6032986584484096`*^9}, {3.603298692216344*^9, 
   3.60329869362342*^9}, {3.603298749265629*^9, 3.603298750268668*^9}, {
   3.603298853652589*^9, 3.603298902482386*^9}, {3.603301357722988*^9, 
   3.6033013883927574`*^9}, {3.603302380462552*^9, 3.6033023810095882`*^9}, {
   3.6033027906450467`*^9, 3.6033027963733916`*^9}, {3.6033036885004635`*^9, 
   3.6033037291127853`*^9}, {3.603303786267062*^9, 3.603303792990466*^9}, {
   3.603303964662278*^9, 3.603303973814803*^9}, {3.603304748163147*^9, 
   3.6033047678362923`*^9}, {3.6033048101987*^9, 3.60330488116777*^9}, {
   3.60330494571546*^9, 3.6033049988005133`*^9}, {3.6033050700585804`*^9, 
   3.6033050898367324`*^9}, {3.6033051749455876`*^9, 3.603305176006648*^9}, {
   3.6033053199388905`*^9, 3.603305320111904*^9}, {3.603305367063589*^9, 
   3.6033053682416525`*^9}, {3.603305436520567*^9, 3.603305563685853*^9}, {
   3.6033056687158637`*^9, 3.6033057012717285`*^9}, {3.603305799075328*^9, 
   3.6033059700671177`*^9}, {3.603306093992218*^9, 3.60330618588148*^9}, {
   3.6033062261877885`*^9, 3.603306317478017*^9}, {3.603306575325782*^9, 
   3.6033065818481555`*^9}, {3.6033074196511335`*^9, 
   3.6033074258784904`*^9}, {3.6033074765343914`*^9, 3.603307478034477*^9}, {
   3.6033076977720613`*^9, 3.603307722296465*^9}, {3.6033077546963205`*^9, 
   3.603307758020512*^9}, 3.6033077909413967`*^9, {3.6033078367800226`*^9, 
   3.603307905480956*^9}, {3.6033079390488777`*^9, 3.6033080138931637`*^9}, {
   3.6033080440448914`*^9, 3.6033080868503604`*^9}, 3.603308377418982*^9, {
   3.6033085085554914`*^9, 3.6033085160009193`*^9}, {3.603308600155737*^9, 
   3.6033086046279926`*^9}, 3.6033086458463535`*^9, 3.603308687436735*^9, {
   3.6033088336161313`*^9, 3.603308842328619*^9}, {3.6033097947821493`*^9, 
   3.6033098497022953`*^9}, 3.6033099395144377`*^9, {3.603310008917412*^9, 
   3.603310010387515*^9}, {3.603310081882591*^9, 3.6033100868458757`*^9}, {
   3.603310205408668*^9, 3.6033102149662113`*^9}, {3.6033103853269653`*^9, 
   3.603310386032008*^9}, {3.6033104200479555`*^9, 3.6033104232321386`*^9}, {
   3.6033104833895874`*^9, 3.603310505232835*^9}, {3.60331055386862*^9, 
   3.603310582248245*^9}, {3.6033106197713904`*^9, 3.6033107380181665`*^9}, 
   3.6033107997687006`*^9, {3.6033108882117853`*^9, 3.6033108963042297`*^9}, {
   3.603310928924097*^9, 3.603310930890229*^9}, {3.603310965921216*^9, 
   3.6033109972410097`*^9}, {3.6033114297627788`*^9, 
   3.6033114411114473`*^9}, {3.6033115169937744`*^9, 3.603311546219448*^9}, {
   3.603311633315436*^9, 3.6033117542693653`*^9}, {3.6033118871129704`*^9, 
   3.603311924500112*^9}, {3.603311976363081*^9, 3.6033119931780434`*^9}, {
   3.6033120251878767`*^9, 3.603312054168536*^9}, {3.6033120912806616`*^9, 
   3.6033120947818623`*^9}, {3.6033124645110393`*^9, 3.603312503861289*^9}, {
   3.6033125955745406`*^9, 3.6033126328076916`*^9}, {3.6033127131932735`*^9, 
   3.603312713840314*^9}, {3.6033164122675548`*^9, 3.603316476400231*^9}, {
   3.6033165725467334`*^9, 3.603316624776725*^9}, {3.603316761685566*^9, 
   3.6033167618265705`*^9}, {3.6033168069691577`*^9, 3.6033168076981993`*^9}, 
   3.603316839609027*^9, {3.6033168722198944`*^9, 3.6033168848036194`*^9}, {
   3.60331693640357*^9, 3.6033169893296013`*^9}, {3.6033170336731405`*^9, 
   3.603317131134719*^9}, {3.603317216726621*^9, 3.603317294979105*^9}, {
   3.6033178406633544`*^9, 3.6033178453866234`*^9}, {3.603318152152191*^9, 
   3.603318178770712*^9}, {3.603318246037572*^9, 3.603318248846733*^9}, {
   3.6033183421740775`*^9, 3.6033183454112587`*^9}, {3.6033183842974896`*^9, 
   3.603318391585903*^9}, {3.6033185422915335`*^9, 3.603318675357154*^9}, {
   3.6033188304790373`*^9, 3.6033188370864344`*^9}, {3.603318949408848*^9, 
   3.6033189502938986`*^9}, 3.6033189850708904`*^9, 3.603319071397834*^9, {
   3.603319112749202*^9, 3.603319116247405*^9}, {3.6033191550946226`*^9, 
   3.603319159997907*^9}, {3.603319199092144*^9, 3.603319254259305*^9}, 
   3.6033193649726458`*^9, {3.6033194726208115`*^9, 3.6033194784071417`*^9}, {
   3.6033195508032875`*^9, 3.603319559508787*^9}, {3.603319942125701*^9, 
   3.6033200227383175`*^9}, {3.603320296074967*^9, 3.603320319741322*^9}, {
   3.603320414811767*^9, 3.6033204160888395`*^9}, {3.6033205293993287`*^9, 
   3.603320529731349*^9}, {3.6033207340260468`*^9, 3.6033207490989137`*^9}, {
   3.603320851225758*^9, 3.603321017137257*^9}, {3.603321100747048*^9, 
   3.6033211281196156`*^9}, {3.603321211839409*^9, 3.6033212484355054`*^9}, {
   3.603321354619586*^9, 3.6033213566227016`*^9}, {3.603322227606579*^9, 
   3.603322235408044*^9}, {3.6033222764313745`*^9, 3.6033223038369627`*^9}, {
   3.603322364237405*^9, 3.603322557542474*^9}, {3.603322788504716*^9, 
   3.6033228305961103`*^9}, {3.603322868050255*^9, 3.6033229053173904`*^9}, {
   3.6033230580691366`*^9, 3.6033231881915903`*^9}, {3.6033461160300274`*^9, 
   3.60334617123326*^9}, {3.6033777584318285`*^9, 3.6033778231545343`*^9}, {
   3.6033778771106267`*^9, 3.603377950254817*^9}, {3.6033780800562644`*^9, 
   3.60337809176992*^9}, {3.603490401867557*^9, 3.6034904309769897`*^9}, {
   3.6034904619458*^9, 3.6034904650239325`*^9}, {3.6034906637430696`*^9, 
   3.6034906687430787`*^9}, {3.603490731415082*^9, 3.603490750805759*^9}, {
   3.603490994712467*^9, 3.6034909999312468`*^9}, {3.603491063931353*^9, 
   3.6034910944470367`*^9}, {3.603491132712737*^9, 3.6034911447440143`*^9}, {
   3.6034911933378563`*^9, 3.6034911946659875`*^9}, {3.603491309088085*^9, 
   3.603491309650584*^9}, 3.60350665225144*^9, {3.603506727501587*^9, 
   3.6035067420328655`*^9}, {3.603506787767331*^9, 3.603506791923588*^9}, {
   3.603567322012684*^9, 3.6035673484658613`*^9}, {3.6035674294035206`*^9, 
   3.6035674299191446`*^9}, {3.603567666653983*^9, 3.6035676817946405`*^9}, {
   3.6035797542839475`*^9, 3.6035798214247*^9}, {3.603581621240738*^9, 
   3.603581662022049*^9}, {3.6035818160067253`*^9, 3.603581818350479*^9}, {
   3.603581862741192*^9, 3.6035818978818865`*^9}, {3.603581947303857*^9, 
   3.6035820028039646`*^9}, {3.6035821437886257`*^9, 3.603582261679471*^9}, {
   3.603582311492073*^9, 3.6035824621954927`*^9}, {3.6035826070395226`*^9, 
   3.603582617320792*^9}, 3.6035826486489983`*^9, {3.603582698774077*^9, 
   3.6035827067115917`*^9}, {3.60358882875681*^9, 3.6035888290878286`*^9}, {
   3.603602648986827*^9, 3.6036026526730366`*^9}, {3.6036086241460047`*^9, 
   3.6036086678215065`*^9}, {3.603649460520569*^9, 3.603649518508894*^9}, {
   3.6041964678164263`*^9, 3.6041964690075006`*^9}, {3.6041965175212746`*^9, 
   3.604196518536333*^9}, {3.6041965746735477`*^9, 3.6041966013780775`*^9}, {
   3.604765832080041*^9, 3.604765857809517*^9}, {3.604765896962761*^9, 
   3.604765924525335*^9}, {3.6152091584160957`*^9, 3.615209158525474*^9}, {
   3.6153202758675003`*^9, 3.61532031985194*^9}, {3.615320353586384*^9, 
   3.6153204819928875`*^9}, {3.6153205420711327`*^9, 
   3.6153205622274213`*^9}, {3.615320729993369*^9, 3.6153207365246334`*^9}, {
   3.615320779805983*^9, 3.6153208983687015`*^9}, 3.61532106904091*^9, {
   3.6153212830725794`*^9, 3.6153212925101123`*^9}, {3.615324220359584*^9, 
   3.615324233562726*^9}, {3.6159914512518625`*^9, 3.6159914645946455`*^9}, {
   3.6521434833286915`*^9, 3.6521434842884436`*^9}, {3.652144091998911*^9, 
   3.6521440932786427`*^9}, {3.6521448029176173`*^9, 3.652144803562322*^9}, {
   3.6521451870664916`*^9, 3.652145274727522*^9}, {3.6711213018259664`*^9, 
   3.6711213026384945`*^9}, 3.671121367627757*^9, 3.7173571441097183`*^9, {
   3.717811736643201*^9, 
   3.717811741268247*^9}},ExpressionUUID->"d29474ed-b4db-46b2-8298-\
e98825be38a6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Visualize Tree", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717361836037048*^9, 
  3.717361836927682*^9}},ExpressionUUID->"ac3409df-bc11-4c24-a0f3-\
1a5ebbff91ce"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RBDTree", "[", 
    RowBox[{
     RowBox[{"expanded_:", "True"}], ",", " ", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "TreePlot", "]"}]}]}], "]"}], " ", ":=", 
   " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", " ", "p"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{"expanded", ",", " ", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"extended", " ", "tree"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"GetExpandedTree", "[", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"p", " ", "=", " ", 
          RowBox[{"n", "[", "ParentList", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"Keys", "@", 
           RowBox[{"n", "[", "TreeForm", "]"}]}]}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"original", " ", "tree"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"p", " ", "=", " ", 
          RowBox[{"rb", "[", "ParentList", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"RBDGetLinkInfo", "[", "\"\<joint\>\"", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"KeyValueMap", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
             "#1", " ", "<>", " ", "\"\<-\>\"", " ", "<>", " ", "#2"}], "&"}],
             ",", "n"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
            "p", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
            "\[Rule]", " ", "i"}], ",", " ", 
           RowBox[{
           "n", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
          "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", 
           RowBox[{"Length", "@", "n"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TreePlot", "[", 
       RowBox[{
       "n", ",", " ", "Automatic", ",", " ", "0", ",", " ", "opts", ",", " ", 
        RowBox[{"VertexLabeling", "\[Rule]", "True"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.671102655711939*^9, 3.6711026835007963`*^9}, {
   3.6711027341629467`*^9, 3.6711027636304708`*^9}, {3.6711028033965206`*^9, 
   3.6711028037871485`*^9}, {3.6711064716225758`*^9, 
   3.6711064745666437`*^9}, {3.67110654114824*^9, 3.6711065760825434`*^9}, {
   3.6711066418409815`*^9, 3.6711067073939548`*^9}, {3.671106751098378*^9, 
   3.6711068383860064`*^9}, {3.671106939643931*^9, 3.6711069650008245`*^9}, {
   3.6711137443443456`*^9, 3.6711137993012514`*^9}, {3.6711138425204988`*^9, 
   3.6711138591792283`*^9}, {3.6711138917863617`*^9, 3.671113894792734*^9}, {
   3.6711139293531623`*^9, 3.6711140028687487`*^9}, {3.671114204527142*^9, 
   3.671114234173607*^9}, {3.6711143340618315`*^9, 3.6711144414944553`*^9}, {
   3.671114475448741*^9, 3.671114616640785*^9}, {3.6711146949853706`*^9, 
   3.6711147043292184`*^9}, {3.671114783194213*^9, 3.6711148266676865`*^9}, {
   3.671115057138851*^9, 3.6711150647106805`*^9}, {3.671115285916157*^9, 
   3.671115298401064*^9}, {3.6711153602188044`*^9, 3.671115404918303*^9}, {
   3.6711159229144945`*^9, 3.6711159737549067`*^9}, {3.6711160083334*^9, 
   3.6711160143722715`*^9}, {3.6711175593867188`*^9, 
   3.6711175621670227`*^9}, {3.671117745726397*^9, 3.6711177731376085`*^9}, {
   3.67111781248376*^9, 3.6711178166497197`*^9}, {3.671117858024945*^9, 
   3.671117932654458*^9}, {3.671118003407549*^9, 3.671118086153264*^9}, {
   3.671118130671825*^9, 3.671118150343604*^9}, {3.671118185392086*^9, 
   3.671118190631768*^9}, {3.671118368130473*^9, 3.671118370129876*^9}, {
   3.671118402885066*^9, 3.671118464656571*^9}, {3.6711185025636063`*^9, 
   3.671118523550441*^9}, {3.67111856819955*^9, 3.6711185708764696`*^9}, {
   3.671118681171275*^9, 3.6711186826150084`*^9}, {3.6858374950003476`*^9, 
   3.6858374953685975`*^9}, {3.7173568899196067`*^9, 3.717356900763468*^9}, 
   3.7175068250567207`*^9, 
   3.7191620803123093`*^9},ExpressionUUID->"21555fdb-4581-46f5-932d-\
7adee438c986"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Expanded Tree Index of States and Parameters", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717361836037048*^9, 3.717361836927682*^9}, {3.717469190519846*^9, 
  3.7174692100981727`*^9}, {3.7175063780990095`*^9, 
  3.7175063864428596`*^9}},ExpressionUUID->"7f0fef03-d0f9-4263-a51a-\
c1eb1123ecca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "RBDGetIndex", ",", " ", "RBDGetPositionIndex", ",", " ", 
       "RBDGetValue"}], "}"}], ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "::", "x"}], " ", "=", " ", "\[IndentingNewLine]", 
   "\"\<Cannot use a string as an index for \[DoubleStruckX]; indices 1...`1` \
are valid.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "::", "dof"}], " ", "=", " ", 
   "\[IndentingNewLine]", 
   "\"\<Invalid index `1` for body `2`; the body only has `3` degrees of \
freedom.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "::", "n"}], " ", "=", " ", "\[IndentingNewLine]", 
   "\"\<`2` is not a valid index for `1`; indices 1...`3` are valid.\>\""}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "::", "var"}], " ", "=", " ", 
   "\[IndentingNewLine]", 
   "\"\<`1` is not a valid parameter; valid parameters are \[DoubleStruckQ], \
\[DoubleStruckV], \[DoubleStruckX], and \[DoubleStruckC].\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "::", "s"}], " ", "=", " ", "\[IndentingNewLine]", 
   "\"\<`1` is not a valid link name; links `2` are valid.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "::", "jnt"}], " ", "=", " ", 
   "\[IndentingNewLine]", 
   "\"\<`1` is not a valid joint name; links `2` are valid.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetIndex", "::", "arg"}], " ", "=", " ", 
    "\"\<`1` is an invalid argument.\>\""}], ";"}], "\n", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"replaces", " ", "q", " ", "or", " ", "v"}], ",", " ", 
    RowBox[{"not", " ", 
     RowBox[{"x", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetIndex", "[", 
    RowBox[{"f_", "[", 
     RowBox[{
      RowBox[{"Root", "|", "0"}], ",", " ", "_"}], "]"}], "]"}], " ", ":=", 
   " ", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetIndex", "[", 
     RowBox[{"f_", "[", 
      RowBox[{"i_String", ",", " ", "j_"}], "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "b", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"rb", ",", " ", "TreeForm", ",", " ", 
          RowBox[{"GetTree", "[", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"b", ",", " ", "i", ",", " ", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{
            RowBox[{"Keys", "@", "b"}], ",", " ", "\"\<, \>\""}], "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"IntegerQ", "[", "b", "]"}], ",", " ", 
         RowBox[{"RBDGetIndex", "[", 
          RowBox[{"f", "[", 
           RowBox[{"b", ",", " ", "j"}], "]"}], "]"}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RBDGetIndex", "::", "s"}], ",", " ", "i", ",", " ", "b"}],
           "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetIndex", "[", 
     RowBox[{"f_", "[", 
      RowBox[{"i_String", ",", " ", "j_String"}], "]"}], "]"}], " ", ":=", 
    " ", 
    RowBox[{"RBDGetIndex", "@", 
     RowBox[{"RBDGetDOF", "[", 
      RowBox[{"f", "[", 
       RowBox[{"i", ",", " ", "j"}], "]"}], "]"}]}]}], ";"}], "\n", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"x", " ", "is", " ", "undetermined", " ", 
    RowBox[{"w", "/", " ", "just"}], " ", "name"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetIndex", "[", 
     RowBox[{"\[DoubleStruckX]", "[", "i_String", "]"}], "]"}], " ", ":=", 
    " ", "\[IndentingNewLine]", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"RBDGetIndex", "::", "x"}], ",", " ", "i", ",", " ", "nx"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetIndex", "[", 
     RowBox[{"f_", "[", 
      RowBox[{"i_Integer", ",", " ", "j___Integer"}], "]"}], "]"}], " ", ":=",
     " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"f", " ", "===", " ", "\[DoubleStruckV]"}], ",", " ", "nq", 
          ",", " ", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"f", " ", "===", " ", "\[DoubleStruckQ]"}], " ", "||", " ", 
          RowBox[{"f", " ", "===", " ", "\[DoubleStruckV]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"(", 
             RowBox[{
             "0", " ", "<", " ", "i", " ", "\[LessEqual]", " ", "nb"}], 
             ")"}]}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", 
             "\"\<\[DoubleStruckQ] or \[DoubleStruckV]\>\"", ",", " ", "i", 
             ",", " ", "nb"}], "]"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"!", 
            RowBox[{"(", 
             RowBox[{"0", "<", 
              RowBox[{"Abs", "[", "j", "]"}], " ", "\[LessEqual]", " ", 
              RowBox[{
              "ni", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
             ")"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RBDGetIndex", "::", "dof"}], ",", " ", "j", ",", " ", 
             "i", ",", " ", 
             RowBox[{
             "ni", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"j", " ", ">", " ", "0"}], ",", " ", 
           RowBox[{
            RowBox[{
            "map", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
            "+", "j", " ", "-", " ", 
            RowBox[{
            "ni", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], " ",
             "+", " ", "n"}], ",", "\[IndentingNewLine]", "True", " ", 
           RowBox[{"(*", 
            RowBox[{"j", " ", "<", " ", "0"}], "*)"}], ",", " ", 
           RowBox[{
            RowBox[{
            "map", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
            "+", "j", " ", "+", " ", "1", " ", "+", " ", "n"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"f", " ", "===", " ", "\[DoubleStruckC]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"0", "<", "i", " ", "\[LessEqual]", " ", "nc"}], ",", " ", 
           "i", ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"-", "nc"}], " ", "\[LessEqual]", " ", "i", " ", "<", " ",
             "0"}], ",", " ", 
           RowBox[{"nc", " ", "+", " ", "i", " ", "+", " ", "1"}], ",", 
           "\[IndentingNewLine]", "True", ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", 
             "\"\<\[DoubleStruckC]\>\"", ",", " ", "i", ",", " ", "nc"}], 
            "]"}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"f", " ", "===", " ", "\[DoubleStruckX]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Which", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"0", "<", "i", " ", "\[LessEqual]", " ", "nx"}], ",", " ", 
           "i", ",", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"-", "nx"}], " ", "\[LessEqual]", " ", "i", " ", "<", " ",
             "0"}], ",", " ", 
           RowBox[{"nx", " ", "+", " ", "i", " ", "+", " ", "1"}], ",", 
           "\[IndentingNewLine]", "True", ",", " ", 
           RowBox[{"Message", "[", 
            RowBox[{
             RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", 
             "\"\<\[DoubleStruckX]\>\"", ",", " ", "i", ",", " ", "nx"}], 
            "]"}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]",
          "\[IndentingNewLine]", "True", ",", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RBDGetIndex", "::", "var"}], ",", " ", "f"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetPositionIndex", "[", "b_", "]"}], " ", ":=", " ", 
    RowBox[{"Which", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"IntegerQ", "[", "b", "]"}], " ", "&&", " ", 
       RowBox[{
       "1", " ", "\[LessEqual]", " ", "b", " ", "\[LessEqual]", " ", "nq"}]}],
       ",", " ", "b", ",", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"StringQ", "[", "b", "]"}], " ", "||", " ", 
       RowBox[{"b", " ", "===", " ", "Root"}]}], ",", " ", 
      RowBox[{"RBDGetIndex", "[", 
       RowBox[{"\[DoubleStruckQ]", "[", 
        RowBox[{"b", ",", " ", 
         RowBox[{"-", "1"}]}], "]"}], "]"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Head", "[", "b", "]"}], " ", "===", " ", "\[DoubleStruckQ]"}],
       ",", " ", 
      RowBox[{"RBDGetIndex", "[", "b", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"IntegerQ", "[", "b", "]"}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", 
        "\"\<\[DoubleStruckQ]\>\"", ",", " ", "b", ",", " ", "nq"}], "]"}], 
      ",", "\[IndentingNewLine]", "True", ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RBDGetIndex", "::", "arg"}], ",", " ", "b"}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RBDGetValue", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<e\>\"", " ", "\[Rule]", " ", "True"}], ",", " ", 
      RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "False"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetValue", "[", 
     RowBox[{"i_Integer", ",", " ", "j_Integer", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"RBDGetValue", "[", 
     RowBox[{
      RowBox[{"Range", "[", 
       RowBox[{"i", ",", " ", "j"}], "]"}], ",", " ", "opts"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetValue", "[", 
    RowBox[{"i_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "k", ",", " ", "f", ",", " ", "exp", ",", " ", "nam"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{"body", " ", "index", " ", "or", " ", "expanded", " ", 
       RowBox[{"index", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"exp", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<e\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"numeric", " ", "or", " ", "string", " ", 
        RowBox[{"name", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"nam", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"state", " ", "index"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"exp", " ", "&&", " ", 
         RowBox[{"1", " ", "\[LessEqual]", " ", "i", " ", "\[LessEqual]", " ", 
          RowBox[{"3", "nq"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", " ", "n"}], "}"}], " ", "=", " ", 
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{"i", " ", ">", " ", "nx"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckA]", ",", " ", 
              RowBox[{"i", "-", "nx"}]}], "}"}], ",", " ", 
            RowBox[{"i", " ", ">", " ", "nq"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckV]", ",", " ", 
              RowBox[{"i", "-", "nq"}]}], "}"}], ",", " ", "True", ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckQ]", ",", " ", "i"}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"k", " ", "=", " ", 
          RowBox[{
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"Range", "@", 
              RowBox[{"Length", "@", "map"}]}], ",", " ", 
             RowBox[{
              RowBox[{"n", " ", "\[LessEqual]", " ", 
               RowBox[{
               "map", "\[LeftDoubleBracket]", "#", 
                "\[RightDoubleBracket]"}]}], "&"}], ",", " ", "1"}], "]"}], 
           "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"k", " ", "\[Equal]", " ", "1"}], ",", " ", "n", ",", " ", 
            RowBox[{"n", " ", "-", " ", 
             RowBox[{"map", "\[LeftDoubleBracket]", 
              RowBox[{"k", "-", "1"}], "\[RightDoubleBracket]"}]}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"k", " ", "=", " ", 
          RowBox[{
           RowBox[{"Keys", "[", 
            RowBox[{"Lookup", "[", 
             RowBox[{"rb", ",", " ", "TreeForm", ",", " ", 
              RowBox[{"GetTree", "[", "]"}]}], "]"}], "]"}], 
           "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"nam", ",", " ", 
           RowBox[{"RBDGetDOF", "[", 
            RowBox[{"f", "[", 
             RowBox[{"k", ",", " ", "n"}], "]"}], "]"}], ",", " ", 
           RowBox[{"f", "[", 
            RowBox[{"k", ",", " ", "n"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"body", " ", "index"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
        "1", " ", "\[LessEqual]", " ", "i", " ", "\[LessEqual]", " ", "nb"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f", ",", " ", "k"}], "}"}], " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"i", " ", ">", " ", "nb"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckV]", ",", " ", 
              RowBox[{"i", " ", "-", " ", "nb"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"\[DoubleStruckQ]", ",", " ", "i"}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"n", " ", "=", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"k", " ", "\[Equal]", " ", "1"}], ",", " ", 
            RowBox[{
            "map", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
            ",", " ", 
            RowBox[{
             RowBox[{
             "map", "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}], 
             "-", 
             RowBox[{"map", "\[LeftDoubleBracket]", 
              RowBox[{"k", "-", "1"}], "\[RightDoubleBracket]"}]}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"k", " ", "=", " ", 
          RowBox[{
           RowBox[{"Keys", "[", 
            RowBox[{"Lookup", "[", 
             RowBox[{"rb", ",", " ", "TreeForm", ",", " ", 
              RowBox[{"GetTree", "[", "]"}]}], "]"}], "]"}], 
           "\[LeftDoubleBracket]", "k", "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"nam", ",", " ", 
           RowBox[{"RBDGetDOF", "[", 
            RowBox[{"f", "[", 
             RowBox[{"k", ",", " ", "n"}], "]"}], "]"}], ",", " ", 
           RowBox[{"f", "[", 
            RowBox[{"k", ",", " ", "n"}], "]"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"error", " ", "messages"}], " ", "*)"}], 
        "\[IndentingNewLine]", "exp", ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", 
          "\"\<\[DoubleStruckX]\>\"", ",", " ", "i", ",", " ", "nx"}], "]"}], 
        ",", "\[IndentingNewLine]", "True", ",", " ", 
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", 
          "\"\<\[DoubleStruckQ] or \[DoubleStruckV]\>\"", ",", " ", "i", ",", 
          " ", "nb"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6710210789446063`*^9, 3.6710212234911823`*^9}, {
   3.6710213828291287`*^9, 3.671021562727497*^9}, {3.671038848830686*^9, 
   3.671038849808981*^9}, {3.6780542797169676`*^9, 3.6780543315066338`*^9}, {
   3.678064434746092*^9, 3.6780644979887795`*^9}, {3.690372034244158*^9, 
   3.690372038134823*^9}, 3.6903720726891065`*^9, 3.6905744717114334`*^9, 
   3.6920522545926385`*^9, {3.6920524230150566`*^9, 3.6920524612584934`*^9}, {
   3.6920525109726753`*^9, 3.6920525178184457`*^9}, {3.6920526642039557`*^9, 
   3.6920526903072367`*^9}, 3.692052781631654*^9, {3.7174691349723997`*^9, 
   3.717469156191368*^9}, {3.7174692394734735`*^9, 3.7174692398797264`*^9}, {
   3.7174693574278183`*^9, 3.7174693574590716`*^9}, {3.71746990260528*^9, 
   3.7174699658246937`*^9}, {3.717469998856266*^9, 3.717470005246957*^9}, {
   3.7174701144668283`*^9, 3.7174701818268933`*^9}, {3.717470540049339*^9, 
   3.717470568096489*^9}, {3.717470606878148*^9, 3.717470668222511*^9}, {
   3.7174707002384806`*^9, 3.7174707527702703`*^9}, {3.7174708096927147`*^9, 
   3.717470811458358*^9}, {3.7174708542713127`*^9, 3.7174708625682726`*^9}, {
   3.7174710028196964`*^9, 3.717471026444954*^9}, {3.717471108211404*^9, 
   3.7174711182115064`*^9}, {3.717471204165512*^9, 3.717471211790592*^9}, {
   3.717471260353589*^9, 3.71747126661928*^9}, {3.7174713260261393`*^9, 
   3.717471409948876*^9}, {3.7174714682307224`*^9, 3.7174715013560796`*^9}, {
   3.7174715400595856`*^9, 3.717471627357357*^9}, {3.7174716825610495`*^9, 
   3.717471749952365*^9}, {3.717471806312317*^9, 3.7174718548753166`*^9}, {
   3.7175063214265614`*^9, 3.717506350348723*^9}, {3.7175117697861137`*^9, 
   3.7175117813956075`*^9}, 3.7175122977602835`*^9, {3.717512699884669*^9, 
   3.717512710791031*^9}, {3.717516609473488*^9, 3.7175166727553854`*^9}, {
   3.7175361488167763`*^9, 3.717536161582534*^9}, {3.7175472449411955`*^9, 
   3.7175472671289234`*^9}, {3.7175473001605234`*^9, 
   3.7175474097554026`*^9}, {3.71754744981831*^9, 3.7175475981323204`*^9}, {
   3.717547633195181*^9, 3.7175476526641417`*^9}, {3.717548157966191*^9, 
   3.7175481630912437`*^9}, 3.717548194560317*^9, {3.717548427187704*^9, 
   3.717548431406496*^9}, {3.717549578360484*^9, 3.717549579001118*^9}, {
   3.717549722690092*^9, 3.717549724174498*^9}, 3.717550112334714*^9, {
   3.7176023395362396`*^9, 3.717602377130334*^9}, {3.7176024760531626`*^9, 
   3.7176024767875443`*^9}, {3.717602617866994*^9, 3.717602618210765*^9}, {
   3.717603085377366*^9, 3.717603128159006*^9}, {3.7176033616143665`*^9, 
   3.7176033997709618`*^9}, {3.717603432630662*^9, 3.717603459927801*^9}, {
   3.7176034917874784`*^9, 3.7176036142730007`*^9}, {3.7176036866487007`*^9, 
   3.717603691804988*^9}, {3.717603747258659*^9, 3.7176037677119713`*^9}, {
   3.7176037983059998`*^9, 3.7176037992435265`*^9}, {3.717603830243821*^9, 
   3.717603866275395*^9}, {3.7176039466511607`*^9, 3.7176039472605424`*^9}, {
   3.7176039953078713`*^9, 3.717604101217413*^9}, 3.717604141764674*^9, {
   3.717604173921213*^9, 3.7176042713986893`*^9}, {3.717604325946082*^9, 
   3.717604343211857*^9}, {3.717604380442892*^9, 3.71760439055238*^9}, {
   3.7176044364590664`*^9, 3.7176044650999637`*^9}, {3.7176045271318035`*^9, 
   3.7176045902886405`*^9}, {3.7176047430557137`*^9, 
   3.7176047456807394`*^9}, {3.7176048358691072`*^9, 3.717604836759746*^9}, {
   3.7176049284637375`*^9, 3.7176049303075094`*^9}, {3.7176049885892982`*^9, 
   3.7176050177770863`*^9}, {3.7176051336531878`*^9, 
   3.7176051929350014`*^9}, {3.7176054467967777`*^9, 
   3.7176054544062233`*^9}, {3.7176055762355084`*^9, 3.717605580251184*^9}, {
   3.717605901207347*^9, 3.7176059023323727`*^9}, {3.7176178701991014`*^9, 
   3.7176179044025517`*^9}, {3.7176364963128815`*^9, 
   3.7176365650478973`*^9}, {3.717681907521494*^9, 3.717681907521494*^9}, {
   3.71768235753091*^9, 3.7176824808289833`*^9}, {3.7176826721901655`*^9, 
   3.717682737456411*^9}, {3.7176828831296697`*^9, 3.7176830370529933`*^9}, {
   3.717683078678404*^9, 3.717683294586692*^9}, {3.717683386150072*^9, 
   3.717683406994008*^9}, {3.717683625292974*^9, 3.7176836661214714`*^9}, {
   3.7176860968774357`*^9, 3.7176861092838044`*^9}, {3.7176861455341663`*^9, 
   3.7176861458779187`*^9}, {3.717687458717377*^9, 3.7176876045443716`*^9}, {
   3.717688131158737*^9, 3.7176881594558816`*^9}, 3.717688321144918*^9, {
   3.717736743350108*^9, 3.717736779319187*^9}, 3.7186577257983503`*^9, {
   3.7188917248139553`*^9, 3.718891732907786*^9}, {3.7188918192759924`*^9, 
   3.7188918290260873`*^9}, {3.7253657448540397`*^9, 
   3.7253657709636927`*^9}, {3.7253658087922187`*^9, 
   3.7253658096984763`*^9}, {3.725365875027314*^9, 3.725365982856572*^9}, {
   3.7253664747876387`*^9, 3.7253664757876377`*^9}, {3.7306374067872524`*^9, 
   3.73063741294352*^9}, {3.73063764746964*^9, 3.730637654375942*^9}, {
   3.730637788314455*^9, 3.730637891893357*^9}, {3.7306381775986533`*^9, 
   3.7306383862248383`*^9}, {3.730638490460034*^9, 3.7306385159914336`*^9}, {
   3.730638571804373*^9, 3.7306385744137535`*^9}, {3.7306386319804487`*^9, 
   3.7306386331367073`*^9}, {3.7306386813558245`*^9, 
   3.7306386918402796`*^9}, {3.7306388513076897`*^9, 3.730638881964161*^9}, {
   3.730638913917529*^9, 3.7306389200113263`*^9}, {3.7306389590428724`*^9, 
   3.7306390138557897`*^9}, {3.730639061590539*^9, 3.7306391382289505`*^9}, {
   3.730639226323371*^9, 3.73063929802704*^9}, {3.7306393354960756`*^9, 
   3.730639354918098*^9}, {3.7306394201217012`*^9, 3.730639522384393*^9}, {
   3.730639565603468*^9, 3.730639612556205*^9}, {3.730640332014284*^9, 
   3.73064044630881*^9}, {3.7306405273094225`*^9, 3.7306405378407516`*^9}, {
   3.730640751050209*^9, 3.730640753783139*^9}, {3.730644168732315*^9, 
   3.730644214736327*^9}, {3.7306442896151104`*^9, 3.730644344818652*^9}, {
   3.7306484732991457`*^9, 3.7306484834242373`*^9}, {3.7306487181816726`*^9, 
   3.7306487316192517`*^9}, {3.7306557805277977`*^9, 
   3.7306557813559275`*^9}, {3.7997162845639277`*^9, 
   3.799716285988488*^9}},ExpressionUUID->"9233ae40-d42d-4e87-885b-\
5cf453f7009d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConvertToXL", "[", "expr_", "]"}], " ", ":=", " ", 
    RowBox[{
     RowBox[{"RBDExpandExpression", "[", "expr", "]"}], " ", "/.", " ", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"h_", " ", "/;", " ", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "\[DoubleStruckQ]", ",", " ", "\[DoubleStruckV]", ",", " ", 
             "\[DoubleStruckX]"}], "}"}], ",", " ", 
           RowBox[{"Head", "[", "h", "]"}]}], "]"}]}], " ", "\[RuleDelayed]", 
        " ", 
        RowBox[{"\[DoubleStruckX]", "[", 
         RowBox[{"RBDGetIndex", "[", "h", "]"}], "]"}]}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"h_", " ", "/;", " ", 
         RowBox[{
          RowBox[{"Head", "[", "h", "]"}], " ", "===", " ", 
          "\[DoubleStruckC]"}]}], " ", "\[RuleDelayed]", " ", 
        RowBox[{"\[DoubleStruckC]", "[", 
         RowBox[{"RBDGetIndex", "[", "h", "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "ConvertToXLFunction", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<dot\>\"", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"\"\<c\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
      RowBox[{"\"\<cdot\>\"", " ", "\[Rule]", " ", "Automatic"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConvertToXLFunction", "[", 
    RowBox[{"expr_", ",", " ", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dot", ",", " ", "e", ",", " ", "edot", ",", " ", "f", ",", " ", "c", 
       ",", " ", "cdot"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dot", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<dot\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"a", " ", "=", " ", 
            RowBox[{"ConvertToXL", "@", "#"}]}], "}"}], ",", " ", 
          RowBox[{"a", "&"}]}], "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"e", " ", "=", " ", 
       RowBox[{"f", "[", "expr", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"edot", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{"dot", ",", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"c", " ", "=", " ", 
           RowBox[{"OptionValue", "[", "\"\<c\>\"", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"c", " ", "===", " ", "Automatic"}], ",", " ", 
            RowBox[{"c", " ", "=", " ", 
             RowBox[{"RBDGetValue", "[", 
              RowBox[{"1", ",", " ", "nq", ",", " ", 
               RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "False"}]}], 
              "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"cdot", " ", "=", " ", 
           RowBox[{"OptionValue", "[", "\"\<cdot\>\"", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"cdot", " ", "===", " ", "Automatic"}], ",", " ", 
            RowBox[{"cdot", " ", "=", " ", 
             RowBox[{"RBDGetValue", "[", 
              RowBox[{
               RowBox[{"nq", "+", "1"}], ",", " ", "nx", ",", " ", 
               RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "False"}]}], 
              "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"f", "[", 
           RowBox[{"Con", "[", 
            RowBox[{"expr", ",", " ", "c", ",", " ", "cdot"}], "]"}], "]"}]}],
          ",", " ", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"{", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", "Part", "}"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"\[DoubleStruckX]", "[", "i__", "]"}], " ", 
             "\[RuleDelayed]", " ", 
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Slot", "[", "1", "]"}], ",", " ", "i"}], "]"}]}], ",",
             " ", 
            RowBox[{
             RowBox[{"\[DoubleStruckC]", "[", "i__", "]"}], " ", 
             "\[RuleDelayed]", " ", 
             RowBox[{"Part", "[", 
              RowBox[{
               RowBox[{"Slot", "[", "2", "]"}], ",", " ", "i"}], "]"}]}]}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"dot", ",", " ", 
            RowBox[{"{", 
             RowBox[{"e", ",", " ", "edot"}], "}"}], ",", " ", "e"}], "]"}], 
          "  ", "/.", " ", "f"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6710210789446063`*^9, 3.6710212234911823`*^9}, {
   3.6710213828291287`*^9, 3.671021562727497*^9}, {3.671038848830686*^9, 
   3.671038849808981*^9}, {3.6780542797169676`*^9, 3.6780543315066338`*^9}, {
   3.678064434746092*^9, 3.6780644979887795`*^9}, {3.690372034244158*^9, 
   3.690372038134823*^9}, 3.6903720726891065`*^9, 3.6905744717114334`*^9, 
   3.6920522545926385`*^9, {3.6920524230150566`*^9, 3.6920524612584934`*^9}, {
   3.6920525109726753`*^9, 3.6920525178184457`*^9}, {3.6920526642039557`*^9, 
   3.6920526903072367`*^9}, 3.692052781631654*^9, {3.7174691349723997`*^9, 
   3.717469156191368*^9}, {3.7174692394734735`*^9, 3.7174692398797264`*^9}, {
   3.7174693574278183`*^9, 3.7174693574590716`*^9}, {3.71746990260528*^9, 
   3.7174699658246937`*^9}, {3.717469998856266*^9, 3.717470005246957*^9}, {
   3.7174701144668283`*^9, 3.7174701818268933`*^9}, {3.717470540049339*^9, 
   3.717470568096489*^9}, {3.717470606878148*^9, 3.717470668222511*^9}, {
   3.7174707002384806`*^9, 3.7174707527702703`*^9}, {3.7174708096927147`*^9, 
   3.717470811458358*^9}, {3.7174708542713127`*^9, 3.7174708625682726`*^9}, {
   3.7174710028196964`*^9, 3.717471026444954*^9}, {3.717471108211404*^9, 
   3.7174711182115064`*^9}, {3.717471204165512*^9, 3.717471211790592*^9}, {
   3.717471260353589*^9, 3.71747126661928*^9}, {3.7174713260261393`*^9, 
   3.717471409948876*^9}, {3.7174714682307224`*^9, 3.7174715013560796`*^9}, {
   3.7174715400595856`*^9, 3.717471627357357*^9}, {3.7174716825610495`*^9, 
   3.717471749952365*^9}, {3.717471806312317*^9, 3.7174718548753166`*^9}, {
   3.7175063214265614`*^9, 3.717506350348723*^9}, {3.7175117697861137`*^9, 
   3.7175117813956075`*^9}, 3.7175122977602835`*^9, {3.717512699884669*^9, 
   3.717512710791031*^9}, {3.717516609473488*^9, 3.7175166727553854`*^9}, {
   3.7175361488167763`*^9, 3.717536161582534*^9}, {3.7175472449411955`*^9, 
   3.7175472671289234`*^9}, {3.7175473001605234`*^9, 
   3.7175474097554026`*^9}, {3.71754744981831*^9, 3.7175475981323204`*^9}, {
   3.717547633195181*^9, 3.7175476526641417`*^9}, {3.717548157966191*^9, 
   3.7175481630912437`*^9}, 3.717548194560317*^9, {3.717548427187704*^9, 
   3.717548431406496*^9}, {3.717549578360484*^9, 3.717549579001118*^9}, {
   3.717549722690092*^9, 3.717549724174498*^9}, 3.717550112334714*^9, {
   3.7176023395362396`*^9, 3.717602377130334*^9}, {3.7176024760531626`*^9, 
   3.7176024767875443`*^9}, {3.717602617866994*^9, 3.717602618210765*^9}, {
   3.717603085377366*^9, 3.717603128159006*^9}, {3.7176033616143665`*^9, 
   3.7176033997709618`*^9}, {3.717603432630662*^9, 3.717603459927801*^9}, {
   3.7176034917874784`*^9, 3.7176036142730007`*^9}, {3.7176036866487007`*^9, 
   3.717603691804988*^9}, {3.717603747258659*^9, 3.7176037677119713`*^9}, {
   3.7176037983059998`*^9, 3.7176037992435265`*^9}, {3.717603830243821*^9, 
   3.717603866275395*^9}, {3.7176039466511607`*^9, 3.7176039472605424`*^9}, {
   3.7176039953078713`*^9, 3.717604101217413*^9}, 3.717604141764674*^9, {
   3.717604173921213*^9, 3.7176042713986893`*^9}, {3.717604325946082*^9, 
   3.717604343211857*^9}, {3.717604380442892*^9, 3.71760439055238*^9}, {
   3.7176044364590664`*^9, 3.7176044650999637`*^9}, {3.7176045271318035`*^9, 
   3.7176045902886405`*^9}, {3.7176047430557137`*^9, 
   3.7176047456807394`*^9}, {3.7176048358691072`*^9, 3.717604836759746*^9}, {
   3.7176049284637375`*^9, 3.7176049303075094`*^9}, {3.7176049885892982`*^9, 
   3.7176050177770863`*^9}, {3.7176051336531878`*^9, 
   3.7176051929350014`*^9}, {3.7176054467967777`*^9, 
   3.7176054544062233`*^9}, {3.7176055762355084`*^9, 3.717605580251184*^9}, {
   3.717605901207347*^9, 3.7176059023323727`*^9}, {3.7176178701991014`*^9, 
   3.7176179044025517`*^9}, {3.7176364963128815`*^9, 
   3.7176365650478973`*^9}, {3.717681907521494*^9, 3.717681907521494*^9}, {
   3.71768235753091*^9, 3.7176824808289833`*^9}, {3.7176826721901655`*^9, 
   3.717682737456411*^9}, {3.7176828831296697`*^9, 3.7176830370529933`*^9}, {
   3.717683078678404*^9, 3.717683294586692*^9}, {3.717683386150072*^9, 
   3.717683406994008*^9}, {3.717683625292974*^9, 3.7176836661214714`*^9}, {
   3.7176860968774357`*^9, 3.7176861092838044`*^9}, {3.7176861455341663`*^9, 
   3.7176861458779187`*^9}, {3.717687458717377*^9, 3.7176876045443716`*^9}, {
   3.717688131158737*^9, 3.7176881594558816`*^9}, 3.717688321144918*^9, {
   3.717736743350108*^9, 3.717736779319187*^9}, 3.7186577257983503`*^9, {
   3.7188918390105624`*^9, 3.7188918526200705`*^9}, {3.73064827040484*^9, 
   3.730648301983221*^9}, {3.73064844845522*^9, 3.7306484660334816`*^9}, {
   3.730648577042516*^9, 3.7306485927144933`*^9}, {3.7306491465421467`*^9, 
   3.730649149995288*^9}},ExpressionUUID->"cb6d3249-c8f3-48b8-bbba-\
526d3c1196f3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.591486801989799*^9, 
  3.5914868026208353`*^9}},ExpressionUUID->"b059c6f5-1e81-4f81-b380-\
8ec973d1bcf6"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1509},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2879, 58, 547, "Code",ExpressionUUID->"c9ace131-5d4c-4ace-bb35-b13857154674",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3462, 82, 204, 4, 95, "Section",ExpressionUUID->"f486e300-efa0-4a17-aba6-c663751b4bc4"],
Cell[3669, 88, 587, 12, 172, "Text",ExpressionUUID->"8eee5e81-1527-4fa2-a501-5083044af063"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4293, 105, 160, 3, 95, "Section",ExpressionUUID->"d826a602-14aa-4b57-a86e-f8f86a87ab7e"],
Cell[4456, 110, 4168, 81, 422, "Input",ExpressionUUID->"865d59d8-94fc-4640-a7dd-e8b8d4794941",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[8661, 196, 313, 5, 95, "Section",ExpressionUUID->"1c79a023-5933-4467-a67f-99c9f6093877"],
Cell[8977, 203, 14209, 311, 2462, "Input",ExpressionUUID->"e75fc780-62af-484d-9104-e8a26a29ddd1",
 InitializationCell->True],
Cell[23189, 516, 36662, 562, 1262, "Input",ExpressionUUID->"d29474ed-b4db-46b2-8298-e98825be38a6",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[59888, 1083, 362, 6, 95, "Section",ExpressionUUID->"ac3409df-bc11-4c24-a0f3-1a5ebbff91ce"],
Cell[60253, 1091, 4563, 95, 622, "Input",ExpressionUUID->"21555fdb-4581-46f5-932d-7adee438c986",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[64853, 1191, 493, 7, 95, "Section",ExpressionUUID->"7f0fef03-d0f9-4263-a51a-c1eb1123ecca"],
Cell[65349, 1200, 23661, 508, 3905, "Input",ExpressionUUID->"9233ae40-d42d-4e87-885b-5cf453f7009d",
 InitializationCell->True],
Cell[89013, 1710, 10071, 194, 1182, "Input",ExpressionUUID->"cb6d3249-c8f3-48b8-bbba-526d3c1196f3",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[99121, 1909, 30, 0, 95, "Section",ExpressionUUID->"2a6edcc4-088f-4665-b582-66fede76e8bf"],
Cell[99154, 1911, 267, 6, 102, "Input",ExpressionUUID->"b059c6f5-1e81-4f81-b380-8ec973d1bcf6",
 InitializationCell->True]
}, Open  ]]
}
]
*)

