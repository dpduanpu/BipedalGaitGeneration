(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     67763,       1482]
NotebookOptionsPosition[     64568,       1413]
NotebookOutlinePosition[     64934,       1429]
CellTagsIndexPosition[     64891,       1426]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"RigidBodySystem", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{"High", "-", 
      RowBox[{
      "level", " ", "functions", " ", "used", " ", "to", " ", "define", " ", 
       "a", " ", "rigid", " ", 
       RowBox[{"body", ".", "\n", "Copyright"}], " ", 
       RowBox[{"(", "C", ")"}], " ", "2014", " ", "Nelson", " ", "Rosa", " ", 
       RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", 
       " ", "free", " ", "software"}]}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 3.6103712325731497`*^9}, {
  3.610371305900334*^9, 3.610371331708816*^9}, {3.610371368620943*^9, 
  3.61037139802861*^9}, {3.6103714917959795`*^9, 
  3.6103715279410496`*^9}},ExpressionUUID->"38fd979c-26d8-4d65-8d61-\
ea8e462eafe1"],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"acd34d90-1e81-4d2c-8dfb-\
bb82c2bd5c0b"],

Cell[BoxData[{
 RowBox[{"BeginPackage", "[", 
  RowBox[{
  "\"\<RigidBodyDynamics`\>\"", ",", " ", "\"\<GlobalVariables`\>\""}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rb", " ", "=", " ", 
    RowBox[{"<|", "|>"}]}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "description", " ", "of", " ", "the", " ", "current", " ", "rigid", " ", 
     "body", " ", "system"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"info", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<p\>\"", ",", " ", "\"\<joint\>\"", ",", " ", "\"\<frame\>\"", ",", 
      " ", "\"\<inertia\>\""}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RBDindex", " ", "=", " ", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<n\>\"", "  ", "\[Rule]", " ", "1"}], ",", " ", 
     RowBox[{"\"\<p\>\"", "  ", "\[Rule]", " ", "2"}], ",", " ", 
     RowBox[{"\"\<S\>\"", "  ", "\[Rule]", " ", "3"}], ",", " ", 
     RowBox[{"\"\<f\>\"", "  ", "\[Rule]", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"4", ",", "9"}], "]"}]}], ",", 
     RowBox[{"\"\<f[x]\>\"", "  ", "\[Rule]", " ", "7"}], ",", " ", 
     RowBox[{"\"\<f[y]\>\"", "  ", "\[Rule]", " ", "8"}], ",", " ", 
     RowBox[{"\"\<f[z]\>\"", "  ", "\[Rule]", " ", "9"}], ",", "  ", 
     RowBox[{"\"\<f[xyz]\>\"", "  ", "\[Rule]", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"7", ",", "9"}], "]"}]}], ",", " ", 
     RowBox[{"\"\<mcI\>\"", "  ", "\[Rule]", "  ", 
      RowBox[{"Range", "[", 
       RowBox[{"10", ",", " ", "25"}], "]"}]}], ",", " ", 
     RowBox[{"\"\<m\>\"", "  ", "\[Rule]", " ", "10"}], ",", " ", 
     RowBox[{"\"\<c\>\"", "  ", "\[Rule]", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"11", ",", " ", "16"}], "]"}]}], ",", " ", 
     RowBox[{"\"\<c[x]\>\"", "  ", "\[Rule]", " ", "14"}], ",", " ", 
     RowBox[{"\"\<c[y]\>\"", "  ", "\[Rule]", " ", "15"}], ",", " ", 
     RowBox[{"\"\<c[z]\>\"", "  ", "\[Rule]", " ", "16"}], ",", " ", 
     RowBox[{"\"\<c[xyz]\>\"", "  ", "\[Rule]", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"14", ",", " ", "16"}], "]"}]}], ",", " ", 
     RowBox[{"\"\<I\>\"", "  ", "\[Rule]", " ", 
      RowBox[{"Range", "[", 
       RowBox[{"17", ",", "25"}], "]"}]}]}], "\[IndentingNewLine]", "|>"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.7173555785467887`*^9, {3.717357254876494*^9, 3.7173572604546714`*^9}, {
   3.717362838844215*^9, 3.7173628503130817`*^9}, {3.717363438819139*^9, 
   3.7173634904759026`*^9}, {3.717364780361294*^9, 3.717364783861329*^9}, {
   3.717367854925305*^9, 3.7173678611910095`*^9}, {3.717371686955558*^9, 
   3.7173716991119375`*^9}, {3.7173729000304985`*^9, 
   3.7173729103743544`*^9}, {3.717406095322135*^9, 3.717406113587948*^9}, {
   3.717505183557301*^9, 3.7175051859284964`*^9}, {3.717552364560851*^9, 
   3.717552365576485*^9}, 3.718896172068509*^9, {3.722254028402295*^9, 
   3.722254036871125*^9}, {3.722254196588372*^9, 3.7222544284938803`*^9}, {
   3.7222544839319057`*^9, 3.7222544841819086`*^9}, {3.7223453587737303`*^9, 
   3.72234544472754*^9}, {3.7223455157124825`*^9, 3.7223455861974216`*^9}, 
   3.730649046470122*^9, 
   3.730649126458541*^9},ExpressionUUID->"19795b72-35ef-40f5-a8ca-\
fea3292b0999"]
}, Open  ]],

Cell[CellGroupData[{

Cell["TODO", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717357331502265*^9, 3.717357331752267*^9}, {3.7173628890166035`*^9, 
  3.717362889391608*^9}, {3.7173817984083195`*^9, 
  3.7173817987677093`*^9}},ExpressionUUID->"4e6eb7bf-b131-4d8d-a2f9-\
2e8dbfd36468"],

Cell["\<\
what should defaults for g and nc be in RBDCreateModel?  Should optional \
arguments be mandatory?\
\>", "Text",
 CellChangeTimes->{{3.717381806767779*^9, 3.7173819001124873`*^9}, {
  3.7188968342396574`*^9, 
  3.7188968601930494`*^9}},ExpressionUUID->"f97df2ab-6f58-4545-89dc-\
f956eb5d672a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Notes", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717357331502265*^9, 3.717357331752267*^9}, {3.7173628890166035`*^9, 
  3.717362889391608*^9}},ExpressionUUID->"8c176e24-2c08-4a3b-b668-\
fbaea69b023f"],

Cell["\<\
* rb has global scope in this package
* useful DOI references: 
\t* 10.1109/MRA.2010.937853
\t* 10.1109/MRA.2010.939560
\t* 10.1007/978-3-540-30301-5 (Ch. 2, Dynamics)\
\>", "Text",
 CellChangeTimes->{{3.7173628543131237`*^9, 3.7173628937666655`*^9}, {
  3.7173645901485977`*^9, 3.7173647295809984`*^9}, {3.717364761173608*^9, 
  3.717364762126731*^9}},ExpressionUUID->"a9b85cda-c1c2-42f4-91c7-\
839c6207b70b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Model", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717357331502265*^9, 3.717357331752267*^9}, {3.7186576368931932`*^9, 
  3.718657638609999*^9}},ExpressionUUID->"6634d764-4529-4f5a-9af1-\
bc84122a8610"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RBDNewModel", "[", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"rb", " ", "=", " ", 
      RowBox[{"<|", "|>"}]}], ";", " ", 
     RowBox[{"con", " ", "=", " ", 
      RowBox[{"{", "}"}]}], ";"}], ")"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6710203143021083`*^9, 3.671020335425206*^9}, {
   3.671020574068858*^9, 3.671020635983886*^9}, {3.6710411707467566`*^9, 
   3.671041192502906*^9}, {3.6711071517043867`*^9, 3.6711071958403397`*^9}, {
   3.671107229661975*^9, 3.6711072611440873`*^9}, {3.6711073640236435`*^9, 
   3.6711073774979153`*^9}, {3.6711074126459913`*^9, 
   3.6711074274753933`*^9}, {3.6711075092694707`*^9, 3.671107525845162*^9}, {
   3.6711077209898987`*^9, 3.671107721481968*^9}, {3.671109177242817*^9, 
   3.67110929123164*^9}, {3.6711094184874587`*^9, 3.671109429196262*^9}, 
   3.671109471820416*^9, {3.6711095866779413`*^9, 3.6711095900349884`*^9}, {
   3.6711096247228565`*^9, 3.671109698341575*^9}, {3.671109742404545*^9, 
   3.6711097593473177`*^9}, {3.6711101706161823`*^9, 3.67111022623352*^9}, {
   3.671110279900738*^9, 3.6711102952861733`*^9}, {3.6711103340298624`*^9, 
   3.6711104096408772`*^9}, {3.67111047209239*^9, 3.671110474947933*^9}, {
   3.6711105113872614`*^9, 3.671110553290621*^9}, {3.671110629349578*^9, 
   3.671110631526738*^9}, {3.6711107052301083`*^9, 3.671110706281056*^9}, {
   3.671113258531432*^9, 3.671113259547351*^9}, {3.671116580768721*^9, 
   3.6711166043892183`*^9}, {3.671116662113367*^9, 3.6711167887925954`*^9}, {
   3.6711168867895746`*^9, 3.6711169180046773`*^9}, {3.671117001025756*^9, 
   3.6711170159995933`*^9}, {3.6711170762280803`*^9, 3.671117119311077*^9}, {
   3.671117171117518*^9, 3.6711172265280633`*^9}, {3.6711173231267138`*^9, 
   3.671117327540268*^9}, {3.671118649805401*^9, 3.671118659367464*^9}, {
   3.717357311236433*^9, 3.7173573187052593`*^9}, {3.717363383099802*^9, 
   3.7173634083656855`*^9}, {3.7175051416350107`*^9, 3.7175051693384047`*^9}, 
   3.717506811540959*^9, {3.717513440704773*^9, 3.7175134413766556`*^9}, {
   3.7186392371826506`*^9, 3.7186393205115995`*^9}, {3.7186400063152523`*^9, 
   3.718640010362183*^9}, {3.718640049737558*^9, 3.718640170223138*^9}, {
   3.718653101947305*^9, 3.718653111322398*^9}, {3.7186531966357255`*^9, 
   3.718653437731948*^9}, {3.7186568532135873`*^9, 3.718656890620206*^9}, {
   3.718656981933605*^9, 3.71865701244952*^9}, {3.7186571524509063`*^9, 
   3.7186571922325487`*^9}, {3.7186572945148087`*^9, 
   3.71865732596826*^9}},ExpressionUUID->"3ef36ebf-cbee-4466-bb4b-\
2eccec4ae15a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "RBDCreateModel", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<L\>\"", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\"\<C\>\"", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\"\<cons\>\"", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\"\<g\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
     RowBox[{"\"\<nc\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", " ", 
     RowBox[{"\"\<\[Epsilon]\>\"", " ", "\[Rule]", " ", "Automatic"}], ",", 
     " ", 
     RowBox[{"\"\<spat\>\"", " ", "\[Rule]", " ", "True"}]}], "}"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDCreateModel", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], " ", ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"L", ",", " ", "C", ",", " ", "cons"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"L", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<L\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"C", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<C\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cons", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<cons\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<g\>\"", "]"}], " ", "=!=", " ", 
         "Automatic"}], ",", " ", 
        RowBox[{"RBDGravity", "[", 
         RowBox[{"OptionValue", "[", "\"\<g\>\"", "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<nc\>\"", "]"}], " ", "=!=", " ", 
         "Automatic"}], ",", " ", 
        RowBox[{"RBDParameters", "[", 
         RowBox[{"OptionValue", "[", "\"\<nc\>\"", "]"}], "]"}]}], "]"}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<\[Epsilon]\>\"", "]"}], " ", "=!=", 
         " ", "Automatic"}], ",", " ", 
        RowBox[{"RBDSetEpsilon", "[", 
         RowBox[{"OptionValue", "[", "\"\<\[Epsilon]\>\"", "]"}], "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"L", " ", "=!=", " ", 
         RowBox[{"{", "}"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"RBDLink", "[", 
          RowBox[{"All", ",", " ", "Remove"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"RBDLinks", "[", "L", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "\"\<spat\>\"", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"RBDSpatialFunctions", "[", "]"}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GetExpandedTree", "[", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"C", " ", "=!=", " ", 
         RowBox[{"{", "}"}]}], ",", "  ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"RBDRemoveConstraint", "[", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"RBDAddConstraints", "[", "C", "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"cons", " ", "===", " ", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"RBDConstraintFunctions", "[", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"RBDConstraintFunctions", "[", "cons", "]"}]}], 
       "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6710203143021083`*^9, 3.671020335425206*^9}, {
   3.671020574068858*^9, 3.671020635983886*^9}, {3.6710411707467566`*^9, 
   3.671041192502906*^9}, {3.6711071517043867`*^9, 3.6711071958403397`*^9}, {
   3.671107229661975*^9, 3.6711072611440873`*^9}, {3.6711073640236435`*^9, 
   3.6711073774979153`*^9}, {3.6711074126459913`*^9, 
   3.6711074274753933`*^9}, {3.6711075092694707`*^9, 3.671107525845162*^9}, {
   3.6711077209898987`*^9, 3.671107721481968*^9}, {3.671109177242817*^9, 
   3.67110929123164*^9}, {3.6711094184874587`*^9, 3.671109429196262*^9}, 
   3.671109471820416*^9, {3.6711095866779413`*^9, 3.6711095900349884`*^9}, {
   3.6711096247228565`*^9, 3.671109698341575*^9}, {3.671109742404545*^9, 
   3.6711097593473177`*^9}, {3.6711101706161823`*^9, 3.67111022623352*^9}, {
   3.671110279900738*^9, 3.6711102952861733`*^9}, {3.6711103340298624`*^9, 
   3.6711104096408772`*^9}, {3.67111047209239*^9, 3.671110474947933*^9}, {
   3.6711105113872614`*^9, 3.671110553290621*^9}, {3.671110629349578*^9, 
   3.671110631526738*^9}, {3.6711107052301083`*^9, 3.671110706281056*^9}, {
   3.671113258531432*^9, 3.671113259547351*^9}, {3.671116580768721*^9, 
   3.6711166043892183`*^9}, {3.671116662113367*^9, 3.6711167887925954`*^9}, {
   3.6711168867895746`*^9, 3.6711169180046773`*^9}, {3.671117001025756*^9, 
   3.6711170159995933`*^9}, {3.6711170762280803`*^9, 3.671117119311077*^9}, {
   3.671117171117518*^9, 3.6711172265280633`*^9}, {3.6711173231267138`*^9, 
   3.671117327540268*^9}, {3.671118649805401*^9, 3.671118659367464*^9}, {
   3.717357311236433*^9, 3.7173573187052593`*^9}, {3.717363383099802*^9, 
   3.7173634083656855`*^9}, {3.7175051416350107`*^9, 3.7175051693384047`*^9}, 
   3.717506811540959*^9, {3.717513440704773*^9, 3.7175134413766556`*^9}, {
   3.7186392371826506`*^9, 3.7186393205115995`*^9}, {3.7186400063152523`*^9, 
   3.718640010362183*^9}, {3.718640049737558*^9, 3.718640170223138*^9}, {
   3.718653101947305*^9, 3.718653111322398*^9}, {3.7186531966357255`*^9, 
   3.718653437731948*^9}, {3.7186568532135873`*^9, 3.718656890620206*^9}, {
   3.718656981933605*^9, 3.71865701244952*^9}, {3.7186571524509063`*^9, 
   3.7186571922325487`*^9}, {3.7186572945148087`*^9, 3.718657346452821*^9}, {
   3.7186580495516663`*^9, 3.7186580852082777`*^9}, {3.718658468977687*^9, 
   3.718658469587084*^9}, {3.718658955672906*^9, 3.7186589699542804`*^9}, {
   3.718659053501993*^9, 3.7186590576113987`*^9}, {3.7186591450617485`*^9, 
   3.718659231859482*^9}, {3.718659298813279*^9, 3.7186593548450723`*^9}, {
   3.7186707258425136`*^9, 3.7186707286081805`*^9}, {3.7188915806124587`*^9, 
   3.718891585831261*^9}, {3.7188916273130064`*^9, 3.7188916293599014`*^9}, {
   3.7188917546736236`*^9, 3.7188917617830687`*^9}, {3.718891793408393*^9, 
   3.7188917940333877`*^9}, {3.71901586295082*^9, 3.719015877122819*^9}, {
   3.7190824778235807`*^9, 3.7190824933862514`*^9}, {3.7191170151840734`*^9, 
   3.719117127669561*^9}, {3.7218447404259634`*^9, 3.721844743004114*^9}, {
   3.721844787863951*^9, 
   3.7218448353644385`*^9}},ExpressionUUID->"43bb1cec-3574-432c-8c62-\
77481151f698"],

Cell[CellGroupData[{

Cell["Gravity and Parameters", "Subsection",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.686580383987578*^9, 3.686580428813625*^9}, {
  3.7173633734590783`*^9, 3.7173633742872114`*^9}, {3.7173728394986258`*^9, 
  3.7173728414205317`*^9}},ExpressionUUID->"ee32edf4-35ad-4e72-b1e2-\
69d8828c5803"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGravity", "[", 
     RowBox[{"g_:", 
      RowBox[{"{", 
       RowBox[{"0", ",", " ", "9.81", ",", " ", "0"}], "}"}]}], "]"}], " ", ":=",
     " ", 
    RowBox[{
     RowBox[{"AssociateTo", "[", 
      RowBox[{"rb", ",", " ", 
       RowBox[{"\"\<g\>\"", " ", "\[Rule]", " ", 
        RowBox[{"ConvertToXLFunction", "@", 
         RowBox[{"PadLeft", "[", 
          RowBox[{"g", ",", " ", "nm"}], "]"}]}]}]}], "]"}], "[", "\"\<g\>\"",
      "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDParameters", "[", "n_", "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{"nc", " ", "=", " ", 
     RowBox[{
      RowBox[{"AssociateTo", "[", 
       RowBox[{"rb", ",", " ", 
        RowBox[{"\"\<nc\>\"", " ", "\[Rule]", " ", "n"}]}], "]"}], "[", 
      "\"\<nc\>\"", "]"}]}], ")"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6710407302126904`*^9, 3.6710408278075843`*^9}, 
   3.6710408660682087`*^9, {3.671040902912346*^9, 3.671040958423933*^9}, {
   3.671041140434356*^9, 3.6710411558872786`*^9}, {3.676130509490881*^9, 
   3.6761305357280974`*^9}, 3.6771721677656417`*^9, {3.6771777887917953`*^9, 
   3.6771777890058136`*^9}, {3.680439344687929*^9, 3.6804393741147103`*^9}, {
   3.6804394492592106`*^9, 3.680439449446711*^9}, {3.6804394900096483`*^9, 
   3.6804395152583556`*^9}, {3.6806922990380983`*^9, 3.680692299491193*^9}, 
   3.6806923440910816`*^9, {3.6806923925183516`*^9, 3.680692398850547*^9}, {
   3.6865048406068687`*^9, 3.6865048417112803`*^9}, {3.717362066758181*^9, 
   3.7173620925865564`*^9}, {3.7173630672059393`*^9, 3.717363190644702*^9}, {
   3.7173633130053473`*^9, 3.7173633422087564`*^9}, 3.7173633800841455`*^9, {
   3.717372843764311*^9, 3.7173728601082144`*^9}, {3.717636224825926*^9, 
   3.717636238372917*^9}, 3.7176362819827366`*^9, {3.717636386874346*^9, 
   3.717636427359093*^9}, {3.717636796706365*^9, 3.7176368164565487`*^9}, {
   3.7176369641142035`*^9, 3.7176369647235737`*^9}, {3.7177371868230734`*^9, 
   3.7177371871043253`*^9}, {3.7188915937219653`*^9, 3.718891605143951*^9}, {
   3.719117798333439*^9, 3.719117804177247*^9}, {3.719117937912943*^9, 
   3.7191179394598455`*^9}, {3.719118781051817*^9, 3.719118790145667*^9}, {
   3.719118838021145*^9, 
   3.7191188511306334`*^9}},ExpressionUUID->"1b7cab66-5d8b-4b9d-a4b2-\
14aba3dd491e"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Joints", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.5916678891560974`*^9, 3.5916678898031635`*^9}, {3.5922559886651573`*^9, 
  3.5922560027239647`*^9}, {3.6803955606748605`*^9, 
  3.6803956395157037`*^9}},ExpressionUUID->"5b2a2875-80d8-4755-9985-\
b5768438f371"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"joint", " ", "=", " ", 
    RowBox[{"<|", "|>"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"unit", " ", "spatial", " ", "velocity"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<rx\>\"", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"I6", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
    "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<ry\>\"", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"I6", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
    "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<rz\>\"", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"I6", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
    "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<px\>\"", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"I6", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
    "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<py\>\"", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"I6", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
    "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<pz\>\"", "]"}], " ", "=", " ", 
   RowBox[{
    RowBox[{"I6", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], 
    "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<sph\>\"", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<rx\>\"", ",", " ", "\"\<ry\>\"", ",", " ", "\"\<rz\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<fb\>\"", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
    "\"\<px\>\"", ",", " ", "\"\<py\>\"", ",", " ", "\"\<pz\>\"", ",", " ", 
     "\"\<rx\>\"", ",", " ", "\"\<ry\>\"", ",", " ", "\"\<rz\>\""}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<pln\>\"", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<px\>\"", ",", " ", "\"\<py\>\"", ",", " ", "\"\<rz\>\""}], 
    "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joint", "[", "\"\<xy\>\"", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"\"\<px\>\"", ",", " ", "\"\<py\>\""}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"joint", "[", "\"\<xyz\>\"", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{"\"\<px\>\"", ",", " ", "\"\<py\>\"", ",", " ", "\"\<pz\>\""}], 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XJ", " ", "=", " ", 
    RowBox[{"<|", "|>"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"joint", " ", "coordinate", " ", "transform"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XJ", "[", "\"\<rx\>\"", "]"}], " ", "=", "  ", 
   RowBox[{
    RowBox[{"rotX", "[", "#", "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XJ", "[", "\"\<ry\>\"", "]"}], " ", "=", "  ", 
   RowBox[{
    RowBox[{"rotY", "[", "#", "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XJ", "[", "\"\<rz\>\"", "]"}], " ", "=", "  ", 
   RowBox[{
    RowBox[{"rotZ", "[", "#", "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XJ", "[", "\"\<px\>\"", "]"}], " ", "=", "  ", 
   RowBox[{
    RowBox[{"transX", "[", "#", "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"XJ", "[", "\"\<py\>\"", "]"}], " ", "=", "  ", 
   RowBox[{
    RowBox[{"transY", "[", "#", "]"}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"XJ", "[", "\"\<pz\>\"", "]"}], " ", "=", "  ", 
    RowBox[{
     RowBox[{"transZ", "[", "#", "]"}], "&"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDJoint", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Keys", "@", "joint"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDJoint", "[", "s_String", "]"}], " ", ":=", " ", 
    RowBox[{"joint", "[", "s", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDJoint", "[", 
    RowBox[{"type_String", ",", " ", "s_", ",", " ", 
     RowBox[{"xj_:", "None"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"joint", "[", "type", "]"}], " ", "=", " ", "s"}], ";", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"xj", " ", "=!=", " ", "None"}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"XJ", "[", "type", "]"}], " ", "=", " ", "xj"}], ";"}]}], 
      "]"}]}], ")"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.591667817527995*^9, 3.591668923825349*^9, {3.5916697599352307`*^9, 
   3.591669819815657*^9}, {3.5916698753458366`*^9, 3.5916698888766146`*^9}, {
   3.5916699961457586`*^9, 3.591669997476833*^9}, {3.59167068192603*^9, 
   3.59167070374928*^9}, {3.5917208858180676`*^9, 3.591720889380574*^9}, {
   3.5917221970292563`*^9, 3.591722203732394*^9}, {3.591722238732463*^9, 
   3.591722239091839*^9}, {3.591930526907305*^9, 3.5919305664205675`*^9}, {
   3.5919306118141713`*^9, 3.591930612108184*^9}, 3.591930660729968*^9, {
   3.591930696356006*^9, 3.5919307386704297`*^9}, {3.5919308258974266`*^9, 
   3.5919308840727587`*^9}, {3.591931024599806*^9, 3.591931025034828*^9}, {
   3.591931958433284*^9, 3.5919319593043294`*^9}, {3.5919331117973347`*^9, 
   3.5919331580109777`*^9}, {3.591933250024245*^9, 3.591933252427383*^9}, {
   3.591985667141246*^9, 3.5919857313879256`*^9}, {3.591987361798293*^9, 
   3.591987364276435*^9}, {3.5919978599754896`*^9, 3.59199787152915*^9}, 
   3.5919979113604307`*^9, {3.5919979589681625`*^9, 3.5919979727709627`*^9}, 
   3.5919982080554256`*^9, {3.5920191973504057`*^9, 3.592019234797552*^9}, {
   3.5921518015301204`*^9, 3.592151821661277*^9}, {3.5921518519500084`*^9, 
   3.5921518784545245`*^9}, {3.5921519174737606`*^9, 3.592151918642827*^9}, {
   3.5921519914750166`*^9, 3.5921519924810553`*^9}, 3.5921521161271386`*^9, {
   3.5921521472189164`*^9, 3.592152245920565*^9}, {3.5921524640720634`*^9, 
   3.5921524695633802`*^9}, {3.5921527028097334`*^9, 
   3.5921527107801905`*^9}, {3.59215278839163*^9, 3.592152817779317*^9}, 
   3.5921530282183657`*^9, {3.59215320443246*^9, 3.5921532065185785`*^9}, {
   3.5922519586863747`*^9, 3.592251999186454*^9}, {3.592254165862566*^9, 
   3.5922542064876456`*^9}, {3.5922558428788123`*^9, 
   3.5922558607708282`*^9}, {3.5922558957868533`*^9, 3.592255901201167*^9}, {
   3.592255970324107*^9, 3.592255983444855*^9}, {3.5922563270036964`*^9, 
   3.592256338941219*^9}, {3.592257092435753*^9, 3.592257120589362*^9}, {
   3.5922572679818015`*^9, 3.592257307993095*^9}, {3.5922573544977603`*^9, 
   3.5922573588390207`*^9}, {3.5922584862415714`*^9, 
   3.5922584970631905`*^9}, {3.592272339145876*^9, 3.5922723397079115`*^9}, {
   3.5922724406026893`*^9, 3.5922724506392612`*^9}, {3.5923285065322204`*^9, 
   3.5923285261783457`*^9}, {3.592328588945943*^9, 3.5923285926511564`*^9}, {
   3.592378451717498*^9, 3.592378472565692*^9}, {3.592378552618276*^9, 
   3.5923786444545345`*^9}, {3.5927901083724346`*^9, 
   3.5927901285295887`*^9}, {3.592790375934758*^9, 3.5927903911896305`*^9}, {
   3.6029050158908043`*^9, 3.602905051265873*^9}, {3.6029050867971945`*^9, 
   3.602905088515959*^9}, {3.6029052736712055`*^9, 3.6029053061870675`*^9}, {
   3.6029053433141937`*^9, 3.602905467264292*^9}, {3.602905539448423*^9, 
   3.602905567544038*^9}, {3.602905659932325*^9, 3.6029058527183633`*^9}, {
   3.60290612241781*^9, 3.602906123112848*^9}, {3.602906183483305*^9, 
   3.6029062365393453`*^9}, {3.602906850200717*^9, 3.602906870982005*^9}, {
   3.6029076894679813`*^9, 3.6029076959054956`*^9}, {3.602907726530554*^9, 
   3.6029077404993687`*^9}, {3.6029088725828953`*^9, 3.602908874848522*^9}, {
   3.602908929489254*^9, 3.6029089300673695`*^9}, {3.602942582228842*^9, 
   3.6029425829788327`*^9}, {3.6029443143572187`*^9, 3.602944332263501*^9}, {
   3.602947366050737*^9, 3.6029474042070613`*^9}, {3.6029474515040317`*^9, 
   3.6029474823009605`*^9}, {3.6029475137697754`*^9, 
   3.6029475769574127`*^9}, {3.6029551986974106`*^9, 3.60295520163858*^9}, {
   3.602960739910323*^9, 3.6029608166317167`*^9}, {3.602961202992405*^9, 
   3.602961206928632*^9}, 3.6029614427351346`*^9, {3.6029647395409317`*^9, 
   3.602964756047877*^9}, {3.602966411644685*^9, 3.602966426543538*^9}, {
   3.602973043181452*^9, 3.602973148781497*^9}, {3.6029732736306486`*^9, 
   3.6029732903396063`*^9}, {3.6029734096774397`*^9, 3.602973480168474*^9}, {
   3.6029735749329033`*^9, 3.6029736151752214`*^9}, {3.6029736468760233`*^9, 
   3.602973661417856*^9}, {3.602980199173251*^9, 3.6029802551884584`*^9}, {
   3.6029803097355824`*^9, 3.602980319935164*^9}, {3.602980695640682*^9, 
   3.602980782329646*^9}, {3.6029808292983365`*^9, 3.602980898043277*^9}, {
   3.602980951548337*^9, 3.60298099245968*^9}, {3.602981065342868*^9, 
   3.6029810678259916`*^9}, {3.603299027859565*^9, 3.6032990311067505`*^9}, {
   3.603299072887146*^9, 3.6032990781684465`*^9}, {3.603299150755603*^9, 
   3.603299188582769*^9}, {3.603309528748914*^9, 3.6033095689362125`*^9}, {
   3.6033136064714317`*^9, 3.6033136388592863`*^9}, {3.6033781849172535`*^9, 
   3.60337818553929*^9}, {3.670980018371112*^9, 3.6709800622645097`*^9}, {
   3.6786168865394325`*^9, 3.67861701097393*^9}, {3.680394236315405*^9, 
   3.6803943508930836`*^9}, {3.6858371052947083`*^9, 3.68583711996673*^9}, {
   3.691361631051895*^9, 3.691361641489968*^9}, {3.7173639861528816`*^9, 
   3.717363993340438*^9}, {3.717364025450144*^9, 3.7173640673880787`*^9}, {
   3.717364361087837*^9, 3.7173643677285304`*^9}, {3.717364796923156*^9, 
   3.717364797345051*^9}, {3.730640566597348*^9, 3.7306405900980916`*^9}, {
   3.730640621502411*^9, 3.730640671440243*^9}, {3.730640722456255*^9, 
   3.7306407251281376`*^9}, {3.730640755938013*^9, 3.73064081070407*^9}, {
   3.7306411703319917`*^9, 3.730641170988267*^9}, {3.732895710972522*^9, 
   3.732895732128951*^9}, {3.7329009551481323`*^9, 
   3.7329009683045177`*^9}},ExpressionUUID->"d3efed55-e7c8-4e80-9eb3-\
c5b398932b98"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Links", "Section",
 CellChangeTimes->{{3.671020659624157*^9, 3.671020660936142*^9}, {
  3.6710213675427074`*^9, 3.6710213703516817`*^9}, {3.6710215903447323`*^9, 
  3.6710215911913137`*^9}, {3.6865804809921656`*^9, 3.686580485530325*^9}, {
  3.717357331502265*^9, 3.717357331752267*^9}, {3.717361875584328*^9, 
  3.717361876959343*^9}},ExpressionUUID->"3c86a74a-5d3f-4c9c-a0f4-\
dcdeb2498ceb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetLinkInfo", "[", "Keys", "]"}], " ", ":=", " ", "info"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetLinkInfo", "[", 
     RowBox[{"k_", ",", " ", 
      RowBox[{"rbld_:", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "t", "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{"rbld", ",", " ", 
          RowBox[{"GetTree", "[", "]"}], ",", " ", 
          RowBox[{"Lookup", "[", 
           RowBox[{"rb", ",", " ", "TreeForm", ",", " ", 
            RowBox[{"GetTree", "[", "]"}]}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "t"}], " ", "\[Equal]", " ", "0"}], ",", " ",
          "t", ",", " ", 
         RowBox[{"rb", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"Keys", "@", "t"}], ",", "k"}], 
          "\[RightDoubleBracket]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetLinkNames", "[", 
    RowBox[{"rbld_:", "False"}], "]"}], " ", ":=", " ", 
   RowBox[{"Keys", "@", 
    RowBox[{"If", "[", 
     RowBox[{"rbld", ",", " ", 
      RowBox[{"GetTree", "[", "]"}], ",", " ", 
      RowBox[{"Lookup", "[", 
       RowBox[{"rb", ",", " ", "TreeForm", ",", " ", 
        RowBox[{"GetTree", "[", "]"}]}], "]"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7175134557518015`*^9, 3.7175134692988167`*^9}, {
   3.718646252914419*^9, 3.718646263773902*^9}, {3.7186462967429924`*^9, 
   3.7186463524622927`*^9}, {3.718646474291623*^9, 3.7186464749009886`*^9}, {
   3.7186466011991262`*^9, 3.7186466897937355`*^9}, {3.7186467854665565`*^9, 
   3.7186467880915813`*^9}, {3.7186468256075883`*^9, 
   3.7186468382795796`*^9}, {3.7186522273865085`*^9, 
   3.7186522277927647`*^9}, {3.718652831806316*^9, 3.718652832275055*^9}, 
   3.71916205974961*^9, {3.7192351436563587`*^9, 3.7192352296726866`*^9}, {
   3.722253892729148*^9, 3.722253905823018*^9}, {3.722253959432906*^9, 
   3.7222540022926846`*^9}, 3.722254049621246*^9, {3.7306411270660505`*^9, 
   3.7306412181761365`*^9}, {3.7306418236807246`*^9, 3.7306422990029974`*^9}, 
   3.7306423467760334`*^9, {3.730642445464301*^9, 3.7306424872614784`*^9}, 
   3.7306425417150326`*^9, {3.730642589481021*^9, 3.730642599449829*^9}, {
   3.7306426387470264`*^9, 3.730642640387657*^9}, {3.730642701669374*^9, 
   3.7306428376082306`*^9}, {3.730643546254574*^9, 
   3.730643567598505*^9}},ExpressionUUID->"e70e9115-9592-4433-b606-\
3a95c69d3bc3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetDOF", "::", "args"}], " ", "=", " ", 
    "\"\<First argument (`1`) must be string and second argument (`2`) must \
either be a string, integer, Values (for all dof names), or Integers (for all \
dof indices).\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"RBDGetDOF", ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetDOF", "[", "i_String", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"b", ",", " ", "k"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"get", " ", "combined", " ", "link"}], "-", 
        RowBox[{"dof", " ", "names"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"k", " ", "=", " ", 
        RowBox[{"Keys", "@", 
         RowBox[{"rb", "[", 
          RowBox[{"Links", ",", " ", "TreeForm"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"k", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{"k", ",", " ", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{"#", ",", " ", "i"}], "]"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"return", " ", "dof", " ", "names"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"k", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RBDGetIndex", "::", "s"}], ",", " ", "i", ",", " ", 
           RowBox[{"RBDGetLinkNames", "[", "]"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"StringDrop", "[", 
        RowBox[{"k", ",", " ", 
         RowBox[{
          RowBox[{"StringLength", "@", "i"}], "+", "1"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDGetDOF", "[", 
     RowBox[{"f_", "[", 
      RowBox[{"i_", ",", " ", "j_"}], "]"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "k", "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"k", " ", "=", " ", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"j", " ", "===", " ", "Values"}], ",", " ", 
          RowBox[{"RBDGetDOF", "@", "i"}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"j", " ", "===", " ", "Integers"}], ",", " ", 
          RowBox[{"Range", "@", 
           RowBox[{"Length", "@", 
            RowBox[{"RBDGetDOF", "@", "i"}]}]}], ",", "\[IndentingNewLine]", 
          "True", ",", " ", 
          RowBox[{"RBDGetDOF", "[", 
           RowBox[{"i", ",", " ", "j"}], "]"}]}], "\[IndentingNewLine]", 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Thread", "@", 
        RowBox[{"f", "[", 
         RowBox[{"i", ",", " ", "k"}], "]"}]}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetDOF", "[", 
    RowBox[{"i_", ",", " ", "j_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"RBDGetDOF", "::", "args"}], ",", " ", "i", ",", " ", "j"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDGetDOF", "[", 
    RowBox[{"i_String", ",", " ", "j_Integer"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"k", ",", " ", "n"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"k", " ", "=", " ", 
       RowBox[{"RBDGetDOF", "[", "i", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Length", "@", "k"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Abs", "[", "j", "]"}], " ", "\[LessEqual]", " ", "n"}], 
         " ", "&&", " ", 
         RowBox[{"j", " ", "\[NotEqual]", " ", "0"}]}], ",", " ", 
        RowBox[{"k", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
        ",", " ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"RBDGetIndex", "::", "n"}], ",", " ", "i", ",", " ", "j", 
           ",", " ", "n"}], "]"}], ";", " ", 
         RowBox[{"{", "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RBDGetDOF", "[", 
   RowBox[{"i_String", ",", " ", "j_String"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"k", ",", " ", "b"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"b", " ", "=", " ", 
      RowBox[{"RBDGetDOF", "[", "i", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"k", " ", "=", " ", 
      RowBox[{"Pick", "[", 
       RowBox[{
        RowBox[{"Range", "@", 
         RowBox[{"Length", "@", "b"}]}], ",", " ", 
        RowBox[{"StringContainsQ", "[", 
         RowBox[{"b", ",", " ", "j"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"k", " ", "===", " ", 
        RowBox[{"{", "}"}]}], ",", "  ", 
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"RBDGetIndex", "::", "jnt"}], ",", " ", "j", ",", " ", "b"}],
         "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"b", " ", "=", " ", 
      RowBox[{"Length", "@", "k"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"b", " ", "\[Equal]", " ", "1"}], ",", " ", 
       RowBox[{"k", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       ",", " ", "k"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7175134557518015`*^9, 3.7175134692988167`*^9}, {
   3.718646252914419*^9, 3.718646263773902*^9}, {3.7186462967429924`*^9, 
   3.7186463524622927`*^9}, {3.718646474291623*^9, 3.7186464749009886`*^9}, {
   3.7186466011991262`*^9, 3.7186466897937355`*^9}, {3.7186467854665565`*^9, 
   3.7186467880915813`*^9}, {3.7186468256075883`*^9, 
   3.7186468382795796`*^9}, {3.7186522273865085`*^9, 
   3.7186522277927647`*^9}, {3.718652831806316*^9, 3.718652832275055*^9}, 
   3.71916205974961*^9, {3.7192351436563587`*^9, 3.7192352296726866`*^9}, {
   3.722253892729148*^9, 3.722253905823018*^9}, {3.722253959432906*^9, 
   3.7222540022926846`*^9}, 3.722254049621246*^9, {3.7306411270660505`*^9, 
   3.7306412181761365`*^9}, {3.7306418236807246`*^9, 3.7306422990029974`*^9}, 
   3.7306423467760334`*^9, {3.730642445464301*^9, 3.7306424872614784`*^9}, 
   3.7306425417150326`*^9, {3.730642589481021*^9, 3.730642599449829*^9}, {
   3.7306426387470264`*^9, 3.730642640387657*^9}, {3.730642701669374*^9, 
   3.7306428376082306`*^9}, {3.730643546254574*^9, 3.730643567598505*^9}, {
   3.730643623547859*^9, 3.730643656110611*^9}, {3.730643697418174*^9, 
   3.7306437076526256`*^9}, {3.7306437761624794`*^9, 3.730643821569075*^9}, {
   3.730644023526573*^9, 3.7306440245890813`*^9}, {3.730644615429471*^9, 
   3.7306446164607286`*^9}, {3.730645248185662*^9, 3.7306453022017407`*^9}, {
   3.7306454044212246`*^9, 3.730645432280812*^9}, {3.730645462702917*^9, 
   3.7306455703495865`*^9}, {3.7306456944495044`*^9, 3.730645694871397*^9}, {
   3.7306466772357144`*^9, 3.730646682641988*^9}, {3.73064672794693*^9, 
   3.7306467283375435`*^9}, {3.730646949290835*^9, 3.7306470770574317`*^9}, {
   3.730647110745166*^9, 3.730647114120204*^9}, 3.7306471542298837`*^9, {
   3.730647202167736*^9, 3.730647211199067*^9}, {3.7306472487774706`*^9, 
   3.73064725566816*^9}, {3.7306474330906982`*^9, 3.73064745410647*^9}, {
   3.73064751622223*^9, 3.7306475242535563`*^9}, {3.7306476709818573`*^9, 
   3.730647884260318*^9}, {3.7306490335950613`*^9, 3.7306490379857006`*^9}, {
   3.730649102380232*^9, 
   3.7306491175990987`*^9}},ExpressionUUID->"661bac0c-0aad-459e-8531-\
b9a1267951fb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetAttributes", "[", 
    RowBox[{"RBDLink", ",", " ", "Listable"}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "RBDLink", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<m\>\"", "\[Rule]", " ", "1"}], ",", " ", 
      RowBox[{"\"\<com\>\"", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ",", " ", 
      RowBox[{"\"\<I\>\"", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", " ", 
      RowBox[{"\"\<S\>\"", "\[Rule]", " ", "\"\<rz\>\""}], ",", " ", 
      RowBox[{"\"\<loc\>\"", "\[Rule]", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDLinks", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "p", ",", " ", "j", ",", " ", "f", ",", " ", "i"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Keys", "@", 
        RowBox[{"GetTree", "[", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"n", " ", "===", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"Return", "[", "n", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"RBDGetLinkInfo", "[", 
         RowBox[{"\"\<p\>\"", ",", " ", "False"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"j", " ", "=", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"RBDGetLinkInfo", "[", 
         RowBox[{"\"\<joint\>\"", ",", " ", "False"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"RBDGetLinkInfo", "[", 
         RowBox[{"\"\<frame\>\"", ",", " ", "False"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i", " ", "=", " ", 
       RowBox[{"Values", "@", 
        RowBox[{"RBDGetLinkInfo", "[", 
         RowBox[{"\"\<inertia\>\"", ",", " ", "False"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"{", "##", "}"}]}], "&"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
         "n", ",", " ", "p", ",", " ", "j", ",", " ", "f", ",", " ", "i"}], 
         "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7175134557518015`*^9, 3.7175134692988167`*^9}, {
  3.718646252914419*^9, 3.718646263773902*^9}, {3.7186462967429924`*^9, 
  3.7186463524622927`*^9}, {3.718646474291623*^9, 3.7186464749009886`*^9}, {
  3.7186466011991262`*^9, 3.7186466897937355`*^9}, {3.7186467854665565`*^9, 
  3.7186467880915813`*^9}, {3.7186468256075883`*^9, 3.718646855982895*^9}, {
  3.7186476274954863`*^9, 3.7186476295423822`*^9}, {3.718647664011488*^9, 
  3.7186476828554087`*^9}, {3.718652243511669*^9, 3.718652250261737*^9}, {
  3.7186595135028906`*^9, 3.718659515268533*^9}, {3.718661196749628*^9, 
  3.718661197077773*^9}, {3.71916205974961*^9, 3.71916205974961*^9}, {
  3.7222541118093376`*^9, 
  3.7222541222619057`*^9}},ExpressionUUID->"dd692eb7-f151-4e47-bbaf-\
f23079dd1cc7"],

Cell[CellGroupData[{

Cell["Add Link", "Subsection",
 CellChangeTimes->{{3.718646751075591*^9, 
  3.71864675399751*^9}},ExpressionUUID->"51273989-b744-487b-bc41-\
daec17556034"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDLink", "[", 
     RowBox[{"name_", ",", " ", "parent_", ",", " ", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", " ", "=", " ", 
        RowBox[{"OptionValue", "[", 
         RowBox[{"{", 
          RowBox[{
          "\"\<m\>\"", ",", " ", "\"\<com\>\"", ",", " ", "\"\<I\>\""}], 
          "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
        " ", "=", " ", 
        RowBox[{"PadLeft", "[", 
         RowBox[{
          RowBox[{"r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
           ",", " ", "nm"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", 
           RowBox[{
           "r", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], " ",
           "\[Equal]", " ", "mm"}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "r", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], " ", 
           "=", " ", 
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{
            "r", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
            "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"rb", "[", "name", "]"}], " ", "=", " ", 
        RowBox[{"<|", "\[IndentingNewLine]", " ", 
         RowBox[{
          RowBox[{"\"\<p\>\"", "\[Rule]", " ", "parent"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<joint\>\"", "\[Rule]", " ", 
           RowBox[{"OptionValue", "[", "\"\<S\>\"", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"\"\<frame\>\"", "\[Rule]", " ", 
           RowBox[{"PadLeft", "[", 
            RowBox[{
             RowBox[{"OptionValue", "[", "\"\<loc\>\"", "]"}], ",", " ", 
             "nm"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
          RowBox[{"\"\<inertia\>\"", "\[Rule]", " ", 
           RowBox[{"Flatten", "@", "r"}]}]}], "\[IndentingNewLine]", "|>"}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"Values", "@", 
           RowBox[{"rb", "\[LeftDoubleBracket]", 
            RowBox[{"name", ",", " ", "info"}], "\[RightDoubleBracket]"}]}], 
          ",", " ", "name"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDLinks", "[", "bodies_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "p", ",", " ", "s", ",", " ", "f", ",", " ", "m", ",", 
       " ", "com", ",", " ", "I", ",", " ", "g"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<n\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<p\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"s", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<S\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<f\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<m\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"com", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<c\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"I", " ", "=", " ", 
       RowBox[{"bodies", "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", " ", 
         RowBox[{"RBDindex", "[", "\"\<I\>\"", "]"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"g", " ", "=", " ", 
       RowBox[{
        RowBox[{"RBDLink", "[", 
         RowBox[{"#1", ",", " ", "#2", ",", " ", 
          RowBox[{"\"\<S\>\"", " ", "\[Rule]", " ", "#3"}], ",", " ", 
          RowBox[{"\"\<loc\>\"", " ", "\[Rule]", " ", "#4"}], ",", " ", 
          RowBox[{"\"\<m\>\"", " ", "\[Rule]", " ", "#5"}], ",", " ", 
          RowBox[{"\"\<com\>\"", " ", "\[Rule]", " ", "#6"}], ",", " ", 
          RowBox[{"\"\<I\>\"", " ", "\[Rule]", " ", "#7"}]}], "]"}], "&"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{"g", ",", " ", 
        RowBox[{"{", 
         RowBox[{
         "n", ",", " ", "p", ",", " ", "s", ",", " ", "f", ",", " ", "m", ",",
           " ", "com", ",", " ", "I"}], "}"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.717362114836784*^9, 3.7173621824312267`*^9}, 
   3.7173622200878644`*^9, {3.7173622725415277`*^9, 3.7173622793540993`*^9}, {
   3.717362335776552*^9, 3.717362337307819*^9}, {3.7173623832301636`*^9, 
   3.7173623836520433`*^9}, {3.7173624478089523`*^9, 
   3.7173624592465696`*^9}, {3.717362569482076*^9, 3.7173625720914774`*^9}, {
   3.717362602388664*^9, 3.7173626184982038`*^9}, {3.717362676889427*^9, 
   3.717362684998885*^9}, {3.7173628213284082`*^9, 3.71736282168779*^9}, 
   3.717367754006484*^9, {3.717368076083825*^9, 3.71736807809947*^9}, {
   3.7173687149818172`*^9, 3.717368746763379*^9}, {3.7175110108095727`*^9, 
   3.7175111098887157`*^9}, {3.7175111630767765`*^9, 3.717511169233089*^9}, {
   3.7175123526662455`*^9, 3.7175123533850036`*^9}, 3.717512409041826*^9, 
   3.7175125351642303`*^9, 3.7175127979013023`*^9, {3.717512964934265*^9, 
   3.7175129660592775`*^9}, 3.71751318023335*^9, {3.717513908616623*^9, 
   3.7175139361012793`*^9}, {3.71753282288931*^9, 3.7175328241705875`*^9}, {
   3.7175330003598804`*^9, 3.717533001516141*^9}, {3.7175558877409954`*^9, 
   3.717555919397571*^9}, {3.717594864811406*^9, 3.7175949539841466`*^9}, {
   3.718112949076076*^9, 3.71811296241996*^9}, {3.718113066999126*^9, 
   3.7181130729210515`*^9}, {3.718113126218452*^9, 3.7181131361872997`*^9}, {
   3.718113281641863*^9, 3.7181132846731424`*^9}, {3.7181133695958576`*^9, 
   3.7181133697521086`*^9}, {3.7181134823782234`*^9, 3.718113483018854*^9}, {
   3.718637349606061*^9, 3.718637391247099*^9}, {3.718637432763134*^9, 
   3.718637518170211*^9}, {3.718637548779906*^9, 3.7186375502799053`*^9}, {
   3.718637626952553*^9, 3.7186377018439016`*^9}, {3.718637792532298*^9, 
   3.7186377999542627`*^9}, {3.7186378538297796`*^9, 
   3.7186378570485773`*^9}, {3.718637889314516*^9, 3.7186379266117477`*^9}, 
   3.7186379893623705`*^9, {3.7186380992495413`*^9, 3.7186381250935507`*^9}, {
   3.718638205797457*^9, 3.718638215485055*^9}, {3.7186382479697485`*^9, 
   3.718638248922901*^9}, {3.718638338361267*^9, 3.7186384414091616`*^9}, {
   3.718638489565889*^9, 3.7186384968628335`*^9}, {3.7186385295975323`*^9, 
   3.71863853469135*^9}, {3.718638574629227*^9, 3.718638588957511*^9}, {
   3.7186386263484907`*^9, 3.7186387657873793`*^9}, {3.71864097842605*^9, 
   3.71864102611402*^9}, {3.7186413496222816`*^9, 3.7186413653567953`*^9}, {
   3.7186415190122595`*^9, 3.718641519199763*^9}, {3.7186415956223917`*^9, 
   3.7186417004501553`*^9}, {3.7186417456849775`*^9, 
   3.7186418022480326`*^9}, {3.718641839779643*^9, 3.7186418540297976`*^9}, {
   3.718641887452004*^9, 3.7186419498119955`*^9}, {3.7186419911248856`*^9, 
   3.718642169673543*^9}, {3.71864224229926*^9, 3.7186423321751347`*^9}, {
   3.7186423727536745`*^9, 3.718642463379571*^9}, {3.718642655584581*^9, 
   3.71864274574172*^9}, {3.718642813961154*^9, 3.718642819133073*^9}, {
   3.718642862305373*^9, 3.718642908540207*^9}, {3.718642973056483*^9, 
   3.718642973400237*^9}, {3.718643106042156*^9, 3.7186431199016705`*^9}, {
   3.718643173089694*^9, 3.7186432518404737`*^9}, {3.7186432969503098`*^9, 
   3.7186433803573837`*^9}, {3.7186434236390467`*^9, 
   3.7186434279203544`*^9}, {3.7186434621237993`*^9, 
   3.7186434638894587`*^9}, {3.718643494733513*^9, 3.718643510561781*^9}, {
   3.718643623966561*^9, 3.718643762155427*^9}, 3.718643804343359*^9, {
   3.718644136877881*^9, 3.718644193847193*^9}, {3.7186442317538185`*^9, 
   3.7186442544884243`*^9}, {3.7186443315204444`*^9, 
   3.7186443878022346`*^9}, {3.718644476912507*^9, 3.718644478475004*^9}, {
   3.7186445132565994`*^9, 3.7186445134753504`*^9}, {3.7186446127263327`*^9, 
   3.71864461553886*^9}, {3.718644646961045*^9, 3.718644649382944*^9}, {
   3.71864475605589*^9, 3.718644759868415*^9}, {3.7186448072438807`*^9, 
   3.718644810462679*^9}, {3.7186449629485455`*^9, 3.718644974292408*^9}, {
   3.7186450648557997`*^9, 3.71864506894959*^9}, {3.7186459945837545`*^9, 
   3.7186460188808565`*^9}, {3.718646209538992*^9, 3.718646211992152*^9}, 
   3.718646246664356*^9, {3.7186463851813507`*^9, 3.7186463853844757`*^9}, {
   3.718646699668833*^9, 3.7186467005438433`*^9}, {3.7186467811696415`*^9, 
   3.718646830138874*^9}, 3.718646901030198*^9, {3.7222540944341717`*^9, 
   3.7222540946841774`*^9}, {3.7697283456043377`*^9, 
   3.7697283883119917`*^9}},ExpressionUUID->"31bab5c8-7fc2-4fde-9288-\
cc7b7aca225c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Remove Link", "Subsection",
 CellChangeTimes->{{3.718646751075591*^9, 
  3.718646769982044*^9}},ExpressionUUID->"6c213b1d-9ddf-49d2-84e8-\
34bd30a963d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RBDLink", "[", 
     RowBox[{"name_", ",", " ", "Remove"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"P", ",", " ", "C"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"P", " ", "=", " ", 
        RowBox[{"RBDGetLinkInfo", "[", 
         RowBox[{"\"\<p\>\"", ",", " ", "True"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"name", " ", "===", " ", "All"}], ",", " ", 
         RowBox[{"RBDLink", "[", 
          RowBox[{
           RowBox[{"Keys", "@", "P"}], ",", " ", "Remove"}], "]"}]}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"KeyFreeQ", "[", 
          RowBox[{"P", ",", " ", "name"}], "]"}], ",", " ", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "reference", " ", "children", " ", "to", " ", "parent", " ", "link", 
         " ", "frame"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Position", "[", 
           RowBox[{"P", ",", " ", "name"}], "]"}]}], " ", "/.", " ", 
         RowBox[{"Key", " ", "\[Rule]", " ", "Identity"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"rb", "[", 
            RowBox[{"c", ",", " ", "\"\<frame\>\""}], "]"}], " ", "=", " ", 
           RowBox[{
            RowBox[{"rb", "[", 
             RowBox[{"c", ",", " ", "\"\<frame\>\""}], "]"}], " ", "+", " ", 
            RowBox[{"rb", "[", 
             RowBox[{"name", ",", " ", "\"\<frame\>\""}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"rb", "[", 
            RowBox[{"c", ",", " ", "\"\<p\>\""}], "]"}], " ", "=", " ", 
           RowBox[{"rb", "[", 
            RowBox[{"name", ",", " ", "\"\<p\>\""}], "]"}]}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"c", ",", " ", "C"}], "}"}]}], "\[IndentingNewLine]", "]"}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"KeyDropFrom", "[", 
        RowBox[{"rb", ",", " ", 
         RowBox[{"{", 
          RowBox[{
          "name", ",", " ", "ParentList", ",", " ", "TreeForm", ",", " ", 
           "Links"}], "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RBDLink", "[", 
    RowBox[{"name_", ",", " ", "Merge"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"p", ",", " ", "I"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"rb", "[", 
        RowBox[{"name", ",", " ", "\"\<p\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MissingQ", "[", "p", "]"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "combine", " ", "link", " ", "and", " ", "parent", " ", "link", " ", 
        "inertias"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "=!=", " ", "Root"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"place", " ", "COM", " ", "in", " ", 
          RowBox[{"parent", "'"}], "s", " ", "frame"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"I", " ", "=", " ", 
          RowBox[{"rb", "[", 
           RowBox[{"name", ",", " ", "\"\<inertia\>\""}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"I", "\[LeftDoubleBracket]", 
           RowBox[{"2", ";;", "7"}], "\[RightDoubleBracket]"}], " ", "=", " ", 
          RowBox[{
           RowBox[{"I", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", "7"}], "\[RightDoubleBracket]"}], " ", "+", 
           " ", 
           RowBox[{"rb", "[", 
            RowBox[{"name", ",", " ", "\"\<frame\>\""}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"combine", " ", "inertias"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"rb", "[", 
           RowBox[{"p", ",", " ", "\"\<inertia\>\""}], "]"}], " ", "=", " ", 
          RowBox[{"mcI", "@", 
           RowBox[{"Itot", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"rb", "[", 
               RowBox[{"p", ",", " ", "\"\<inertia\>\""}], "]"}], ",", " ", 
              "I"}], "}"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"RBDLink", "[", 
       RowBox[{"name", ",", " ", "Remove"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7186468123730893`*^9, 3.7186468145137196`*^9}, {
   3.7186470363646574`*^9, 3.718647270616959*^9}, {3.7186474839315796`*^9, 
   3.718647516197528*^9}, {3.7186476356830673`*^9, 3.718647635933069*^9}, {
   3.7186522739650955`*^9, 3.718652274261989*^9}, {3.718652572069374*^9, 
   3.7186525729131165`*^9}, {3.7186611072487507`*^9, 3.7186611211238804`*^9}, 
   3.7191620597652326`*^9, {3.733702155152108*^9, 3.7337021595114937`*^9}, {
   3.7337022081234293`*^9, 3.733702208717246*^9}, {3.7337022429206953`*^9, 
   3.7337022660614805`*^9}, {3.7337023396559935`*^9, 
   3.733702343140338*^9}},ExpressionUUID->"51719753-fc8d-4593-8303-\
13943046da64"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->
  True,ExpressionUUID->"ad11166c-884d-435c-a8ac-6d98d7d64165"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{718, 718},
WindowMargins->{{0, Automatic}, {Automatic, 60}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2880, 58, 531, "Code",ExpressionUUID->"38fd979c-26d8-4d65-8d61-ea8e462eafe1",
 InitializationCell->False],
Cell[CellGroupData[{
Cell[3463, 82, 160, 3, 95, "Section",ExpressionUUID->"acd34d90-1e81-4d2c-8dfb-bb82c2bd5c0b"],
Cell[3626, 87, 3375, 70, 902, "Input",ExpressionUUID->"19795b72-35ef-40f5-a8ca-fea3292b0999",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[7038, 162, 453, 7, 67, "Section",ExpressionUUID->"4e6eb7bf-b131-4d8d-a2f9-2e8dbfd36468"],
Cell[7494, 171, 303, 7, 56, "Text",ExpressionUUID->"f97df2ab-6f58-4545-89dc-f956eb5d672a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[7834, 183, 401, 6, 67, "Section",ExpressionUUID->"8c176e24-2c08-4a3b-b668-fbaea69b023f"],
Cell[8238, 191, 420, 10, 122, "Text",ExpressionUUID->"a9b85cda-c1c2-42f4-91c7-839c6207b70b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[8695, 206, 401, 6, 67, "Section",ExpressionUUID->"6634d764-4529-4f5a-9af1-bc84122a8610"],
Cell[9099, 214, 2619, 42, 44, "Input",ExpressionUUID->"3ef36ebf-cbee-4466-bb4b-2eccec4ae15a",
 InitializationCell->True],
Cell[11721, 258, 7266, 144, 653, "Input",ExpressionUUID->"43bb1cec-3574-432c-8c62-77481151f698",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[19012, 406, 425, 6, 53, "Subsection",ExpressionUUID->"ee32edf4-35ad-4e72-b1e2-69d8828c5803"],
Cell[19440, 414, 2419, 48, 102, "Input",ExpressionUUID->"1b7cab66-5d8b-4b9d-a4b2-14aba3dd491e",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[21908, 468, 309, 5, 67, "Section",ExpressionUUID->"5b2a2875-80d8-4755-9985-b5768438f371"],
Cell[22220, 475, 10433, 220, 539, "Input",ExpressionUUID->"d3efed55-e7c8-4e80-9eb3-c5b398932b98",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[32690, 700, 399, 6, 67, "Section",ExpressionUUID->"3c86a74a-5d3f-4c9c-a0f4-dcdeb2498ceb"],
Cell[33092, 708, 2815, 62, 216, "Input",ExpressionUUID->"e70e9115-9592-4433-b606-3a95c69d3bc3",
 InitializationCell->True],
Cell[35910, 772, 8482, 190, 881, "Input",ExpressionUUID->"661bac0c-0aad-459e-8531-b9a1267951fb",
 InitializationCell->True],
Cell[44395, 964, 3579, 86, 292, "Input",ExpressionUUID->"dd692eb7-f151-4e47-bbaf-f23079dd1cc7",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[47999, 1054, 155, 3, 53, "Subsection",ExpressionUUID->"51273989-b744-487b-bc41-daec17556034"],
Cell[48157, 1059, 10049, 191, 577, "Input",ExpressionUUID->"31bab5c8-7fc2-4fde-9288-cc7b7aca225c",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[58243, 1255, 159, 3, 53, "Subsection",ExpressionUUID->"6c213b1d-9ddf-49d2-84e8-34bd30a963d4"],
Cell[58405, 1260, 5885, 138, 615, "Input",ExpressionUUID->"51719753-fc8d-4593-8303-13943046da64",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[64339, 1404, 30, 0, 70, "Section",ExpressionUUID->"479b2212-2fbe-4de4-b630-ba93213996bc"],
Cell[64372, 1406, 180, 4, 66, "Input",ExpressionUUID->"ad11166c-884d-435c-a8ac-6d98d7d64165",
 InitializationCell->True]
}, Open  ]]
}
]
*)

