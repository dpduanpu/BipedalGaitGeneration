(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     82610,       1747]
NotebookOptionsPosition[     79520,       1681]
NotebookOutlinePosition[     79887,       1697]
CellTagsIndexPosition[     79844,       1694]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["TO DO", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.7420599808069344`*^9, 
  3.742059985587877*^9}},ExpressionUUID->"5942d252-24c7-4407-be58-\
878fb8e76629"],

Cell["\<\
nothing

https://stackoverflow.com/questions/14614252/how-to-fit-camera-to-object

https://duckduckgo.com/?q=three.js+avoid+two+overlapping+shapes+flickering&t=\
ffab&ia=web
https://stackoverflow.com/questions/25165013/three-js-overlapping-layers-\
flickering

https://stemkoski.github.io/Three.js/#gui

https://github.com/dataarts/dat.gui/blob/master/API.md

https://katex.org/

http://gnuplot.respawned.com/\
\>", "Text",
 CellChangeTimes->{{3.742059987993923*^9, 3.742060022054002*^9}, {
  3.766312340829488*^9, 3.7663123413919373`*^9}, {3.766461887499259*^9, 
  3.7664619527523174`*^9}, {3.766462006318879*^9, 
  3.7664620137871017`*^9}},ExpressionUUID->"1d8a9f1a-38c6-4ada-a22e-\
e56da96c9f9c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"7ccc636b-f0ba-4d68-af49-\
6676cbfa4980"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<BipedalLocomotion`\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<GlobalVariables`\>\"", ",", " ", "\"\<RigidBodyDynamics`\>\"", ",", 
      " ", "\"\<HybridDynamics`\>\"", ",", " ", 
      "\"\<BipedalLocomotion`Model`\>\""}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"base16", " ", "=", " ", "16"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"THREE", ".", "InterpolateSmooth"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"interpolation", " ", "=", " ", "2302"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.5922422663532963`*^9, 3.592242267056429*^9}, {3.5922818277082567`*^9, 
   3.59228183637475*^9}, {3.593367625062662*^9, 3.5933676251720285`*^9}, {
   3.704468357519539*^9, 3.704468459841198*^9}, {3.7044685529026203`*^9, 
   3.704468620873731*^9}, {3.7044692938575964`*^9, 3.704469294201355*^9}, {
   3.7044693718565884`*^9, 3.7044694237922263`*^9}, 3.7044696047095137`*^9, {
   3.704469723121451*^9, 3.7044697494763565`*^9}, {3.7044713775105753`*^9, 
   3.7044713779682055`*^9}, {3.7044721790672703`*^9, 3.704472195124174*^9}, {
   3.7100937038557262`*^9, 3.7100937138377705`*^9}, {3.710094467877513*^9, 
   3.7100944759752245`*^9}, {3.718967969224544*^9, 3.718967976177737*^9}, 
   3.71916004211183*^9, {3.7191663815473833`*^9, 3.719166477501439*^9}, {
   3.7191668135047617`*^9, 3.719166817067297*^9}, {3.719167489745819*^9, 
   3.719167506964756*^9}, {3.7191680417044163`*^9, 3.719168056876441*^9}, {
   3.719168126439624*^9, 3.7191681280958776`*^9}, {3.7191681615962257`*^9, 
   3.719168167393141*^9}, 3.7191688253527856`*^9, {3.7191694186552997`*^9, 
   3.719169427686659*^9}, {3.719169607516552*^9, 3.719169625766738*^9}, {
   3.719169936711547*^9, 3.7191699368990507`*^9}, {3.7192001221847486`*^9, 
   3.7192001223409824`*^9}, {3.7192001678883085`*^9, 3.719200179888439*^9}, {
   3.7192312450161033`*^9, 3.7192312752819977`*^9}, {3.7192317027507443`*^9, 
   3.71923170383801*^9}, {3.719231750919241*^9, 3.7192317512449694`*^9}, {
   3.719231786415862*^9, 3.7192317885548663`*^9}, {3.719232072420457*^9, 
   3.7192320757658167`*^9}, {3.7192328308766713`*^9, 
   3.7192328346110773`*^9}, {3.7192331029414616`*^9, 
   3.7192331068321037`*^9}, {3.719233153863763*^9, 3.719233153941874*^9}, {
   3.719236308681711*^9, 3.7192363124786177`*^9}, {3.7192381916264877`*^9, 
   3.719238193876506*^9}, {3.719628143079067*^9, 3.7196281469697256`*^9}, {
   3.7202296325982018`*^9, 3.720229634348221*^9}, {3.7202300253363085`*^9, 
   3.7202300290863404`*^9}, {3.7203202790828934`*^9, 
   3.7203202806766634`*^9}, {3.720322270535414*^9, 3.720322285238694*^9}, {
   3.7203223608800216`*^9, 3.720322378052061*^9}, {3.721831079973121*^9, 
   3.7218310978639307`*^9}, {3.7218311290986247`*^9, 
   3.7218311348018084`*^9}, {3.7302105363606887`*^9, 
   3.7302105656109505`*^9}, {3.730421014476018*^9, 3.7304211006156764`*^9}, {
   3.73042118975216*^9, 3.7304212235180655`*^9}, {3.730421392925746*^9, 
   3.7304213934726124`*^9}, {3.7304214251013966`*^9, 3.730421473142557*^9}, {
   3.730460455771121*^9, 3.7304604660837374`*^9}, {3.7304605596626005`*^9, 
   3.7304605691157885`*^9}, {3.7304606234912415`*^9, 
   3.7304606390070143`*^9}, {3.7304646668648434`*^9, 3.730464667364848*^9}, {
   3.7330119314900928`*^9, 3.7330119424240627`*^9}, {3.7372957691535797`*^9, 
   3.73729578112151*^9}, {3.7373154842766895`*^9, 3.7373155030409966`*^9}, {
   3.7373157226321545`*^9, 3.737315733803262*^9}, {3.7373159844023285`*^9, 
   3.737315997385816*^9}, {3.737876552458494*^9, 3.737876573035163*^9}, {
   3.766312357796985*^9, 3.7663123598906207`*^9}, {3.7663124977286243`*^9, 
   3.766312535036016*^9}},
 CellLabel->
  "In[150]:=",ExpressionUUID->"0115de21-8c8b-4e46-bc49-37dc9143e7f8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Helper Functions", "Section",
 CellChangeTimes->{{3.684678566296839*^9, 3.684678566812415*^9}, {
   3.684678602969049*^9, 3.6846786252973766`*^9}, {3.6846787712362127`*^9, 
   3.6846787718768377`*^9}, {3.6846794135590725`*^9, 
   3.6846794243138685`*^9}, {3.684679499221797*^9, 3.684679500708866*^9}, {
   3.6943224932304945`*^9, 3.694322498229063*^9}, 3.694322896850048*^9, {
   3.696876852021453*^9, 3.696876854640302*^9}, {3.719166459376278*^9, 
   3.7191664595325117`*^9}, {3.719167363385213*^9, 3.7191673692758904`*^9}, {
   3.719169818022891*^9, 3.7191698200697823`*^9}, {3.766312388825984*^9, 
   3.766312390841461*^9}},ExpressionUUID->"b159ae4f-fa50-4abd-aacb-\
d86a024420c8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"ColorToInteger", ",", " ", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ColorToInteger", "[", "c_", "]"}], " ", ":=", " ", 
   RowBox[{"FromDigits", "[", 
    RowBox[{
     RowBox[{"StringJoin", "@", 
      RowBox[{"IntegerString", "[", 
       RowBox[{
        RowBox[{"Round", "[", 
         RowBox[{"255", " ", 
          RowBox[{"List", "@@", 
           RowBox[{"ColorConvert", "[", 
            RowBox[{"c", ",", " ", "\"\<RGB\>\""}], "]"}]}]}], "]"}], ",", 
        " ", "base16"}], "]"}]}], ",", " ", "base16"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"addMu", "[", "\[Mu]_", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", ",", " ", "n", ",", " ", "c", ",", " ", "mu"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"m", " ", "=", " ", 
      RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"Length", "@", 
       RowBox[{"(", 
        RowBox[{"Join", "@@", 
         RowBox[{"BLbiped", "[", 
          RowBox[{"\"\<p\>\"", ",", " ", "m"}], "]"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", " ", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"mu", " ", "=", " ", 
      RowBox[{"BLbiped", "[", 
       RowBox[{"\"\<p\>\"", ",", " ", "m", ",", " ", "\"\<\[Mu]\>\""}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"mu", " ", "=!=", " ", 
        RowBox[{"{", "}"}]}], ",", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"c", "\[LeftDoubleBracket]", "mu", "\[RightDoubleBracket]"}],
          " ", "=", " ", "\[Mu]"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"BLc", "[", 
        RowBox[{"m", ",", " ", "c"}], "]"}], "]"}], "\[LeftDoubleBracket]", 
      RowBox[{"1", ";;", "nc"}], "\[RightDoubleBracket]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.766242101650022*^9, 3.766242169196809*^9}, {
   3.7662421999662914`*^9, 3.766242292288838*^9}, {3.7662423492265086`*^9, 
   3.766242349710837*^9}, {3.7662424264127045`*^9, 3.7662424466331816`*^9}, {
   3.766242534121373*^9, 3.766242689706374*^9}, {3.7662427389706106`*^9, 
   3.7662427412985835`*^9}, 3.7662429242034655`*^9, {3.766243926834197*^9, 
   3.7662439557851973`*^9}, {3.7662440281654563`*^9, 3.766244033227619*^9}, {
   3.766244065600237*^9, 3.7662441211573906`*^9}, {3.7662441856459455`*^9, 
   3.7662444301886177`*^9}, {3.76624449846832*^9, 3.7662445000463324`*^9}, {
   3.766244828876336*^9, 3.7662448612646303`*^9}, {3.766244896612959*^9, 
   3.7662448973003936`*^9}, 3.766245107635459*^9, {3.766245137758266*^9, 
   3.7662452186996455`*^9}, 3.7662452577592735`*^9, {3.76624813889734*^9, 
   3.766248215195197*^9}, {3.7662482452242823`*^9, 3.766248285129352*^9}, {
   3.7662483416137075`*^9, 3.76624847654792*^9}, {3.7662485066675973`*^9, 
   3.7662486508886204`*^9}, {3.766248734769859*^9, 3.7662487362854347`*^9}, {
   3.766248810480931*^9, 3.7662489121739044`*^9}, 3.766312385732481*^9, {
   3.7663125072723894`*^9, 3.7663125089129086`*^9}, {3.777901565570858*^9, 
   3.777901618363673*^9}},
 CellLabel->
  "In[154]:=",ExpressionUUID->"f999365b-3a7b-4e32-9802-21dce7ed3395"],

Cell["\<\
We plan on calling .matrix to update scene; Three.JS stores transforms in \
column-major order; Don\[CloseCurlyQuote]t forget to set .matrixAutoUpdate = \
false for this to work.

see https://threejs.org/docs/#manual/en/introduction/Matrix-transformations \
for more details\
\>", "Text",
 CellChangeTimes->{{3.7663125797671547`*^9, 
  3.7663126464704103`*^9}},ExpressionUUID->"305bf461-3b0c-4639-b9ad-\
ddc829eb164c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CreateTba", "[", 
     RowBox[{"M_", "?", "MatrixQ"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"T", ",", " ", "R", ",", " ", "p"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"RigidBodyDynamics`Private`Tba", "[", "M", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"invert", " ", 
          RowBox[{"frame", ":", " ", 
           RowBox[{"T", "^", 
            RowBox[{"-", "1"}]}]}]}], " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"R", "^", "T"}], ",", " ", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"R", "^", "T"}]}], " ", "p"}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "1"}], "}"}]}], "}"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"R", " ", "=", " ", 
        RowBox[{"T", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", " ", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"T", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", " ", "4"}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"T", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", " ", 
          RowBox[{"1", ";;", "3"}]}], "\[RightDoubleBracket]"}], " ", "=", 
        " ", 
        RowBox[{"R", "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"T", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "3"}], ",", " ", "4"}], 
         "\[RightDoubleBracket]"}], " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{
          RowBox[{"R", "\[Transpose]"}], ".", "p"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Transpose", "@", "T"}]}]}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CreateTba", "[", 
     RowBox[{"v_", "?", "VectorQ"}], "]"}], " ", ":=", " ", 
    RowBox[{"CreateTba", "@", 
     RowBox[{"RigidBodyDynamics`Private`Xba", "[", 
      RowBox[{"PadLeft", "[", 
       RowBox[{"v", ",", " ", "nm"}], "]"}], "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CreateTransforms", "[", 
     RowBox[{"t_", ",", " ", "x_", ",", " ", "c_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Xba", ",", " ", "X"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"X", " ", "=", " ", 
          RowBox[{"XLfun", "[", 
           RowBox[{
            RowBox[{"x", "[", "s", "]"}], ",", " ", 
            RowBox[{"c", "[", "s", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"RBDExpandExpression", "[", 
          RowBox[{"CreateTba", " ", "/@", " ", "X"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"s", ",", " ", "t"}], "}"}]}], "\[IndentingNewLine]", 
       "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CreateTransforms", "[", 
    RowBox[{"\[Mu]_:", "1"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "c", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"addMu", "[", "\[Mu]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"First", "@", 
       RowBox[{"CreateTransforms", "[", 
        RowBox[{
         RowBox[{"{", "0", "}"}], ",", " ", 
         RowBox[{
          RowBox[{"c", "\[LeftDoubleBracket]", 
           RowBox[{"1", ";;", "nx"}], "\[RightDoubleBracket]"}], "&"}], ",", 
         " ", 
         RowBox[{"c", "&"}]}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7661886759682007`*^9, 3.7661887173716354`*^9}, {
   3.7661887670489273`*^9, 3.766188844428892*^9}, {3.766188886095071*^9, 
   3.7661889428992243`*^9}, {3.7661895125218563`*^9, 
   3.7661895133811607`*^9}, {3.766189561903083*^9, 3.7661895672464623`*^9}, {
   3.766189853308792*^9, 3.766189853543191*^9}, {3.7661898955871487`*^9, 
   3.7661898978057795`*^9}, {3.7661899337564116`*^9, 3.766190053922583*^9}, {
   3.7661901035053997`*^9, 3.766190104442853*^9}, {3.766190361681032*^9, 
   3.766190535760556*^9}, {3.766190966059412*^9, 3.7661910206962447`*^9}, 
   3.766191083920703*^9, {3.7661911354171686`*^9, 3.7661911378796415`*^9}, {
   3.766191191884364*^9, 3.7661912263351245`*^9}, {3.766191494976612*^9, 
   3.7661915942370853`*^9}, {3.766191625156845*^9, 3.7661916848984356`*^9}, {
   3.766228984496524*^9, 3.7662290482328215`*^9}, {3.766229078261907*^9, 
   3.7662290881205673`*^9}, {3.7662291530058393`*^9, 
   3.7662291598803396`*^9}, {3.766229191299979*^9, 3.766229238851492*^9}, {
   3.766229314265201*^9, 3.7662293767728415`*^9}, {3.7662294221825047`*^9, 
   3.766229424557317*^9}, 3.7662294618671074`*^9, {3.7662309863563204`*^9, 
   3.766231029993777*^9}, {3.766231946674907*^9, 3.766231995099841*^9}, {
   3.7662320461586156`*^9, 3.766232052142559*^9}, {3.7662320824803543`*^9, 
   3.7662320831521654`*^9}, {3.766232150147312*^9, 3.7662321533502073`*^9}, {
   3.766232369407194*^9, 3.766232376265718*^9}, {3.7662324304570866`*^9, 
   3.766232449252613*^9}, {3.766234025764334*^9, 3.766234052727234*^9}, {
   3.766235139970929*^9, 3.766235143048827*^9}, {3.766235242329611*^9, 
   3.7662352529538584`*^9}, {3.7662355432138524`*^9, 3.7662355440575457`*^9}, 
   3.766239341317542*^9, {3.7662394868229394`*^9, 3.766239488510302*^9}, {
   3.766239685316469*^9, 3.766239687003871*^9}, 3.7662398778348527`*^9, {
   3.7662404597668715`*^9, 3.7662405043068223`*^9}, {3.766246139150042*^9, 
   3.7662461410873475`*^9}, {3.7662494202622657`*^9, 
   3.7662495612342916`*^9}, {3.7662496070581074`*^9, 3.76624961374513*^9}, {
   3.766249664116463*^9, 3.766249669203153*^9}, {3.7662497320237956`*^9, 
   3.7662497470852146`*^9}, {3.7662498369715023`*^9, 
   3.7662498380339093`*^9}, {3.7662498783191357`*^9, 3.766249893609902*^9}, {
   3.766249926638755*^9, 3.766249936122453*^9}, {3.7662500011448956`*^9, 
   3.7662500113472643`*^9}, {3.766250060874908*^9, 3.7662500969569817`*^9}, {
   3.7662501778871517`*^9, 3.7662502796809425`*^9}, {3.76625032791183*^9, 
   3.7662503317396617`*^9}, 3.766250378111825*^9, {3.7662508880086017`*^9, 
   3.766250961362649*^9}, {3.766251024030636*^9, 3.76625102956148*^9}, {
   3.7662510776960626`*^9, 3.766251144669486*^9}, {3.766251215223178*^9, 
   3.76625123319065*^9}, {3.766283437087902*^9, 3.766283438090805*^9}, {
   3.766283556834058*^9, 3.7662835676458015`*^9}, {3.7663124713074017`*^9, 
   3.766312474291568*^9}, {3.766312546269575*^9, 3.766312572705145*^9}, {
   3.7663126526574297`*^9, 3.7663126528293285`*^9}, {3.7663143862991505`*^9, 
   3.7663146273294096`*^9}, 3.766315223256608*^9, 3.766315341369635*^9, {
   3.7663315337105722`*^9, 3.766331533788677*^9}, {3.7663383543087645`*^9, 
   3.7663383598396106`*^9}, {3.766367200364656*^9, 3.7663672275596757`*^9}, {
   3.7663673023445497`*^9, 3.766367314093703*^9}, {3.766367409859454*^9, 
   3.7663674109999766`*^9}, {3.76636758990209*^9, 3.7663675915738745`*^9}, {
   3.7663679764899735`*^9, 3.766367991973221*^9}, {3.766368064779547*^9, 
   3.766368065123271*^9}, {3.769279470229945*^9, 3.7692794837017603`*^9}, {
   3.769281059091186*^9, 3.7692810781522875`*^9}, 3.7692811191719766`*^9, {
   3.7692811676372905`*^9, 3.7692811896406236`*^9}, {3.7692812243614683`*^9, 
   3.769281270451954*^9}, {3.7703281660911703`*^9, 3.7703281696377945`*^9}, 
   3.770328429304269*^9, {3.7703286110876746`*^9, 3.7703288402615366`*^9}, {
   3.777901941794916*^9, 3.777901962791257*^9}},
 CellLabel->
  "In[157]:=",ExpressionUUID->"83bb9741-aacf-4eeb-8124-654ac6a6da32"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CreateTracks", "[", 
     RowBox[{"n_", ",", " ", "x_", ",", " ", "c_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tn", ",", " ", "t", ",", " ", "v"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"create", " ", "track", " ", "name"}], ";", " ", 
        RowBox[{"key", " ", 
         RowBox[{"on", " ", ".", "matrix"}], " ", "property"}]}], " ", "*)"}],
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"n", " ", "===", " ", "Automatic"}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{"tn", " ", "=", " ", 
          RowBox[{"Keys", "[", 
           RowBox[{
            RowBox[{"RigidBodyDynamics`Private`GetExpandedTree", "[", "]"}], 
            "[", "TreeForm", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"tn", " ", "=", " ", "n"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"tn", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", " ", "<>", " ", "\"\<.matrix\>\""}], "&"}], " ", "/@",
          " ", "tn"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"get", " ", "track", " ", "data"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"t", " ", "=", " ", 
        RowBox[{"Flatten", "@", 
         RowBox[{"x", "[", "\"\<Grid\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v", " ", "=", " ", 
        RowBox[{"Flatten", " ", "/@", " ", 
         RowBox[{"Transpose", "@", 
          RowBox[{"CreateTransforms", "[", 
           RowBox[{"t", ",", " ", "x", ",", " ", "c"}], "]"}]}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"create", " ", "track"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "#1"}], ",", " ", 
            RowBox[{"\"\<type\>\"", " ", "\[Rule]", " ", "\"\<vector\>\""}], 
            ",", " ", 
            RowBox[{"\"\<times\>\"", " ", "\[Rule]", " ", "t"}], ",", " ", 
            RowBox[{"\"\<values\>\"", " ", "\[Rule]", " ", "#2"}], ",", " ", 
            RowBox[{
            "\"\<interpolation\>\"", " ", "\[Rule]", " ", "interpolation"}]}],
            "|>"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"tn", ",", " ", "v"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CreateClips", "[", 
     RowBox[{"M_Association", ",", " ", "tn_", ",", " ", 
      RowBox[{"d_:", "-", "1"}], ",", " ", 
      RowBox[{"fps_:", "1"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"KeyValueMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"CreateClip", "[", 
        RowBox[{"#1", ",", " ", "tn", ",", " ", 
         RowBox[{"#2", "[", "\"\<x[t]\>\"", "]"}], ",", " ", 
         RowBox[{"#2", "[", "\"\<c[t]\>\"", "]"}], ",", " ", "d", ",", " ", 
         "fps"}], "]"}], "&"}], ",", " ", "M"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CreateClip", "[", 
    RowBox[{"n_", ",", " ", "tn_", ",", " ", "x_", ",", " ", "c_", ",", " ", 
     RowBox[{"d_:", "-", "1"}], ",", " ", 
     RowBox[{"fps_:", "1"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"<|", 
    RowBox[{
     RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "n"}], ",", " ", 
     RowBox[{"\"\<fps\>\"", " ", "\[Rule]", " ", "1"}], ",", " ", 
     RowBox[{"\"\<duration\>\"", " ", "\[Rule]", " ", "d"}], ",", " ", 
     RowBox[{"\"\<tracks\>\"", " ", "\[Rule]", " ", 
      RowBox[{"CreateTracks", "[", 
       RowBox[{"tn", ",", " ", "x", ",", " ", "c"}], "]"}]}]}], "|>"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7661886759682007`*^9, 3.7661887173716354`*^9}, {
   3.7661887670489273`*^9, 3.766188844428892*^9}, {3.766188886095071*^9, 
   3.7661889428992243`*^9}, {3.7661895125218563`*^9, 
   3.7661895133811607`*^9}, {3.766189561903083*^9, 3.7661895672464623`*^9}, {
   3.766189853308792*^9, 3.766189853543191*^9}, {3.7661898955871487`*^9, 
   3.7661898978057795`*^9}, {3.7661899337564116`*^9, 3.766190053922583*^9}, {
   3.7661901035053997`*^9, 3.766190104442853*^9}, {3.766190361681032*^9, 
   3.766190535760556*^9}, {3.766190966059412*^9, 3.7661910206962447`*^9}, 
   3.766191083920703*^9, {3.7661911354171686`*^9, 3.7661911378796415`*^9}, {
   3.766191191884364*^9, 3.7661912263351245`*^9}, {3.766191494976612*^9, 
   3.7661915942370853`*^9}, {3.766191625156845*^9, 3.7661916848984356`*^9}, {
   3.766228984496524*^9, 3.7662290482328215`*^9}, {3.766229078261907*^9, 
   3.7662290881205673`*^9}, {3.7662291530058393`*^9, 
   3.7662291598803396`*^9}, {3.766229191299979*^9, 3.766229238851492*^9}, {
   3.766229314265201*^9, 3.7662293767728415`*^9}, {3.7662294221825047`*^9, 
   3.766229424557317*^9}, 3.7662294618671074`*^9, {3.7662309863563204`*^9, 
   3.766231029993777*^9}, {3.766231946674907*^9, 3.766231995099841*^9}, {
   3.7662320461586156`*^9, 3.766232052142559*^9}, {3.7662320824803543`*^9, 
   3.7662320831521654`*^9}, {3.766232150147312*^9, 3.7662321533502073`*^9}, {
   3.766232369407194*^9, 3.766232376265718*^9}, {3.7662324304570866`*^9, 
   3.766232449252613*^9}, {3.766234025764334*^9, 3.766234052727234*^9}, {
   3.766235139970929*^9, 3.766235143048827*^9}, {3.766235242329611*^9, 
   3.7662352529538584`*^9}, {3.7662355432138524`*^9, 3.7662355440575457`*^9}, 
   3.766239341317542*^9, {3.7662394868229394`*^9, 3.766239488510302*^9}, {
   3.766239685316469*^9, 3.766239687003871*^9}, 3.7662398778348527`*^9, {
   3.7662404597668715`*^9, 3.7662405043068223`*^9}, {3.766246139150042*^9, 
   3.7662461410873475`*^9}, {3.7662494202622657`*^9, 
   3.7662495612342916`*^9}, {3.7662496070581074`*^9, 3.76624961374513*^9}, {
   3.766249664116463*^9, 3.766249669203153*^9}, {3.7662497320237956`*^9, 
   3.7662497470852146`*^9}, {3.7662498369715023`*^9, 
   3.7662498380339093`*^9}, {3.7662498783191357`*^9, 3.766249893609902*^9}, {
   3.766249926638755*^9, 3.766249936122453*^9}, {3.7662500011448956`*^9, 
   3.7662500113472643`*^9}, {3.766250060874908*^9, 3.7662500969569817`*^9}, {
   3.7662501778871517`*^9, 3.7662502796809425`*^9}, {3.76625032791183*^9, 
   3.7662503317396617`*^9}, 3.766250378111825*^9, {3.7662508880086017`*^9, 
   3.766250961362649*^9}, {3.766251024030636*^9, 3.76625102956148*^9}, {
   3.7662510776960626`*^9, 3.766251144669486*^9}, {3.766251215223178*^9, 
   3.76625123319065*^9}, {3.766283437087902*^9, 3.766283438090805*^9}, {
   3.766283556834058*^9, 3.7662835676458015`*^9}, {3.7663124713074017`*^9, 
   3.766312474291568*^9}, {3.766312546269575*^9, 3.7663125664243755`*^9}, {
   3.766314973864313*^9, 3.766315045865594*^9}, {3.766367670527254*^9, 
   3.766367675230039*^9}, {3.76636772021113*^9, 3.766367725751175*^9}, {
   3.766367765617961*^9, 3.766367776601528*^9}, 3.7663679151505923`*^9, {
   3.770638667836358*^9, 3.770638678288709*^9}, {3.770638842817486*^9, 
   3.7706388789242425`*^9}, {3.770638908946982*^9, 3.7706389303829575`*^9}, {
   3.7706389761764574`*^9, 3.770638991936099*^9}, {3.7706392682028165`*^9, 
   3.770639377564494*^9}, {3.7706394853501973`*^9, 3.7706395341841497`*^9}, {
   3.7706396519354563`*^9, 3.7706396892585545`*^9}, {3.7706397230787506`*^9, 
   3.770639805709487*^9}, {3.77063992570194*^9, 3.7706400176961575`*^9}, {
   3.770640168887705*^9, 3.7706401715437565`*^9}, 3.7706928259913692`*^9, {
   3.770692951483365*^9, 3.7706929917032948`*^9}, {3.77651416911016*^9, 
   3.7765141766149883`*^9}, {3.7765142587354183`*^9, 3.776514290037223*^9}, {
   3.7765143807711973`*^9, 3.776514444816856*^9}, 3.776521253090096*^9, {
   3.776521289020364*^9, 3.776521338425322*^9}, {3.776521373195361*^9, 
   3.7765213920107603`*^9}, {3.776772916767323*^9, 3.776772926665565*^9}, {
   3.776773008480083*^9, 3.7767730088758507`*^9}, {3.776773066456998*^9, 
   3.776773111611826*^9}, {3.7767731849173403`*^9, 3.776773197967083*^9}, {
   3.776863252752121*^9, 3.776863256669464*^9}, {3.776864071381929*^9, 
   3.776864072839305*^9}},
 CellLabel->
  "In[161]:=",ExpressionUUID->"8dbd2996-082b-420b-a147-b7faf0e56b4c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetSurfaceAngles", "[", "M_Association", "]"}], " ", ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"KeyValueMap", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"GetSurfaceAngle", "[", 
        RowBox[{"#1", ",", " ", 
         RowBox[{
          RowBox[{"#2", "[", "\"\<m\>\"", "]"}], "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"#2", "[", "\"\<x-\>\"", "]"}], "\[LeftDoubleBracket]", 
            "1", "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", " ", "nx", ",", " ", "1"}], "]"}]}], "}"}], ",",
          " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"#2", "[", "\"\<c\>\"", "]"}], "\[LeftDoubleBracket]", 
            "1", "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"Table", "[", 
            RowBox[{"0", ",", " ", "nc", ",", " ", "1"}], "]"}]}], "}"}]}], 
        "]"}], "&"}], ",", " ", "M"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetSurfaceAngle", "[", 
   RowBox[{"n_", ",", " ", "m_", ",", " ", "x_", ",", " ", "c_"}], "]"}], " ",
   ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"a", ",", " ", "norm", ",", " ", "g"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"a", " ", "=", " ", 
      RowBox[{"CreateSurface", "[", 
       RowBox[{"m", ",", " ", "x", ",", " ", "c"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"norm", " ", "=", " ", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"a", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
        ",", " ", 
        RowBox[{"a", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"g", " ", "=", " ", 
      RowBox[{"I3", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"Lookup", "[", 
         RowBox[{
          RowBox[{"BLbiped", "[", "\"\<draw\>\"", "]"}], ",", " ", 
          "\"\<axes\>\"", ",", " ", "axes"}], "]"}], "\[LeftDoubleBracket]", 
        RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], 
       "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<c\>\"", " ", "\[Rule]", " ", 
        RowBox[{"-", 
         RowBox[{"norm", ".", 
          RowBox[{
          "a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}]}], 
       ",", " ", 
       RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "norm"}], ",", " ", 
       RowBox[{"\"\<d\>\"", " ", "\[Rule]", " ", 
        RowBox[{"-", 
         RowBox[{"g", ".", 
          RowBox[{
          "a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}]}], 
       ",", " ", 
       RowBox[{"\"\<o\>\"", " ", "\[Rule]", " ", 
        RowBox[{
        "a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      "|>"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.778500842821003*^9, 3.778500867521284*^9}, {
   3.778501017860936*^9, 3.7785011341404037`*^9}, 3.778501170236569*^9, {
   3.7785012365596867`*^9, 3.778501286929873*^9}, {3.7785013991096067`*^9, 
   3.778501408155999*^9}, {3.778501443808407*^9, 3.77850153654042*^9}, 
   3.778501574264086*^9, {3.7785016126665287`*^9, 3.7785016366625843`*^9}, 
   3.778501682242052*^9, {3.778501720219388*^9, 3.778501724726809*^9}, {
   3.7785019736096973`*^9, 3.778501997624908*^9}, 3.778545135650489*^9, {
   3.778546359222677*^9, 3.778546378928709*^9}, 3.77854774596826*^9, {
   3.7786064355084248`*^9, 3.778606484697465*^9}, {3.7786065372959347`*^9, 
   3.778606591496955*^9}, {3.7786066219070187`*^9, 3.778606640634638*^9}, {
   3.7786066753033953`*^9, 3.7786066832858047`*^9}, {3.778606719413209*^9, 
   3.778606834217866*^9}, {3.778606871636375*^9, 3.778606899023532*^9}, {
   3.77860694448777*^9, 3.778607017533073*^9}, {3.778607103709564*^9, 
   3.77860710853507*^9}, 3.778607188242424*^9, {3.778887695264248*^9, 
   3.778887731978362*^9}, {3.778888098033478*^9, 3.778888122067835*^9}, {
   3.778888158258668*^9, 3.778888159878353*^9}, {3.778888661148875*^9, 
   3.778888694451825*^9}, {3.778892752371344*^9, 3.778892799177112*^9}, {
   3.778892838331465*^9, 3.778892846234519*^9}, {3.780865262450623*^9, 
   3.780865334482972*^9}, {3.780865455832692*^9, 3.7808654826555767`*^9}, {
   3.789146897432735*^9, 3.7891468977770844`*^9}, {3.789217488207123*^9, 
   3.789217498324489*^9}, {3.789217561086203*^9, 3.7892175653480473`*^9}, {
   3.7892239845019493`*^9, 3.789223994808049*^9}, {3.789226681945462*^9, 
   3.7892266822847*^9}, {3.789390535834494*^9, 3.789390538828494*^9}, {
   3.789390609064601*^9, 3.78939065173149*^9}, {3.789390701768738*^9, 
   3.789390715272024*^9}, {3.799718578939394*^9, 
   3.7997185795340014`*^9}},ExpressionUUID->"4ea9f8ce-7cfe-4349-8671-\
5afc3cf52aed"],

Cell["\<\
TODO : this function is redundant with OneSurface in DrawBiped.nb and \
AtlasSurface in Atlas.nb; should combine them under one common function.\
\>", "Text",
 CellChangeTimes->{{3.778676933527131*^9, 3.778676971045765*^9}, {
  3.778809611924209*^9, 
  3.778809642249406*^9}},ExpressionUUID->"586390b2-7760-4c7d-8006-\
cf74e37852e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"get", " ", "post"}], "-", 
     RowBox[{"impact", " ", "m"}]}], ",", " ", "x", ",", " ", "c"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CreateSurface", "[", "M_", "]"}], " ", ":=", " ", 
     RowBox[{"CreateSurface", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"M", "[", "\"\<m[t]\>\"", "]"}], "[", "0", "]"}], ",", " ", 
       RowBox[{"devec", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"M", "[", "\"\<x[t]\>\"", "]"}], "[", "0", "]"}], ",", " ", 
         "nx"}], "]"}], ",", " ", 
       RowBox[{"devec", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"M", "[", "\"\<c[t]\>\"", "]"}], "[", "0", "]"}], ",", " ", 
         "nc"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CreateSurface", "[", 
      RowBox[{"m_", ",", " ", "x_", ",", " ", "c_"}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "d", ",", " ", "\[Sigma]", ",", " ", "r", ",", " ", "ax", ",", " ", 
         "p", ",", " ", "n"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"d", " ", "=", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{"BLbiped", ",", " ", "\"\<draw\>\"", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ax", " ", "=", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{
          "d", ",", " ", "\"\<axes\>\"", ",", " ", 
           "BipedalLocomotion`Private`axes"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"n", " ", "=", " ", 
         RowBox[{"Length", "[", "ax", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", " ", "\[Equal]", " ", "2"}], ",", " ", 
          RowBox[{
           RowBox[{"ax", " ", "=", " ", 
            RowBox[{"Insert", "[", 
             RowBox[{"ax", ",", " ", 
              RowBox[{"First", "@", 
               RowBox[{"Complement", "[", 
                RowBox[{
                 RowBox[{"Range", "[", "mm", "]"}], ",", "  ", "ax"}], 
                "]"}]}], ",", " ", "2"}], "]"}]}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"compute", " ", "slope"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"\[Sigma]", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"BLbiped", "[", 
            RowBox[{"\"\<\[Sigma]\>\"", ",", " ", "m"}], "]"}], "[", 
           RowBox[{"x", ",", " ", "c"}], "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"1", ";;", "mm"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"get", " ", 
          RowBox[{"(", 
           RowBox[{"post", "-", "impact"}], ")"}], " ", "stance", " ", "foot",
           " ", "location"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"p", " ", "=", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{"d", ",", " ", "\"\<surface\>\"", ",", " ", "Automatic"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"p", " ", "=", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"p", " ", "===", " ", "Automatic"}], ",", " ", 
           RowBox[{"BLSide", "[", 
            RowBox[{"m", ",", " ", 
             RowBox[{"BLbiped", "[", "\"\<feet\>\"", "]"}], ",", " ", "2"}], 
            "]"}], ",", " ", 
           RowBox[{"p", "[", 
            RowBox[{"m", ",", " ", "x", ",", " ", "c"}], "]"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"p", " ", "=", " ", 
         RowBox[{
          RowBox[{"RBDSpatialPosition", "[", 
           RowBox[{
            RowBox[{
            "p", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{
            "p", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{"\"\<x\>\"", " ", "\[Rule]", " ", 
             RowBox[{
             "x", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            ",", " ", 
            RowBox[{"\"\<\[Lambda]\>\"", " ", "\[Rule]", " ", 
             RowBox[{
             "c", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
           "]"}], "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"mm", "+", "1"}], ";;", "nm"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Sigma]", " ", "=", " ", 
         RowBox[{
         "\[Sigma]", "\[LeftDoubleBracket]", "ax", 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"r", " ", "=", " ", 
         RowBox[{
          RowBox[{"IdentityMatrix", "[", "mm", "]"}], "\[LeftDoubleBracket]", 
          "ax", "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", " ", "\[Equal]", " ", "2"}], ",", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
            "r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
            "=", " ", 
            RowBox[{"-", 
             RowBox[{
             "r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], 
           ";"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"p", ",", " ", 
          RowBox[{
           RowBox[{"RotationMatrix", "[", 
            RowBox[{
             RowBox[{
             "\[Sigma]", "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{"-", 
              RowBox[{
              "r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}],
             "]"}], ".", 
           RowBox[{
           "r", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], ",",
           " ", 
          RowBox[{
           RowBox[{"RotationMatrix", "[", 
            RowBox[{
             RowBox[{
             "\[Sigma]", "\[LeftDoubleBracket]", "3", 
              "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{
             "r", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
            "]"}], ".", 
           RowBox[{
           "r", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7786768821545553`*^9, 3.778676911664693*^9}, {
   3.7786769829913473`*^9, 3.778677001460874*^9}, 3.778677051338011*^9, {
   3.7786770928812237`*^9, 3.7786772308753843`*^9}, {3.7786772617208357`*^9, 
   3.7786772814193*^9}, 3.778677335331334*^9, {3.7786773772466993`*^9, 
   3.7786774431379957`*^9}, {3.7786774752440577`*^9, 3.778677479474901*^9}, {
   3.778677601670801*^9, 3.778677645217895*^9}, {3.778677874491331*^9, 
   3.778677998910348*^9}, {3.7786780967913227`*^9, 3.778678113782833*^9}, {
   3.7787232605913343`*^9, 3.7787233340467653`*^9}, {3.7787233710809383`*^9, 
   3.778723386368902*^9}, {3.778723507932592*^9, 3.7787235921462708`*^9}, {
   3.7788089833045*^9, 3.7788090105935497`*^9}, {3.778809115597621*^9, 
   3.778809138045813*^9}, {3.778809194847498*^9, 3.7788092015076*^9}, {
   3.778809248975958*^9, 3.7788092791380243`*^9}, {3.778809355324143*^9, 
   3.778809356338593*^9}, {3.778809393486257*^9, 3.7788094233606987`*^9}, {
   3.7788095064995317`*^9, 3.778809578117292*^9}, {3.778810942863451*^9, 
   3.7788109524845324`*^9}, {3.778811073173497*^9, 3.778811091515272*^9}, {
   3.778811139422666*^9, 3.778811188011405*^9}, 3.778813188045495*^9, {
   3.778814375684598*^9, 3.778814381027145*^9}, {3.778815030085697*^9, 
   3.7788150311416683`*^9}, {3.778815109022797*^9, 3.778815109201635*^9}, {
   3.778815495067307*^9, 3.778815534940773*^9}, 3.778815566148099*^9, {
   3.778817203325972*^9, 3.77881727282647*^9}, {3.778818834887169*^9, 
   3.778819007993432*^9}, {3.778819052714365*^9, 3.778819094321281*^9}, {
   3.7788191638844013`*^9, 3.778819175454842*^9}, {3.77881933936168*^9, 
   3.778819366979398*^9}, {3.778819407811513*^9, 3.778819409883131*^9}, {
   3.778819440051841*^9, 3.7788194467528763`*^9}, {3.778819510817985*^9, 
   3.778819530273138*^9}, {3.778819757763495*^9, 3.77881978619557*^9}, {
   3.7788198756654778`*^9, 3.778819899549859*^9}, {3.7788199392188063`*^9, 
   3.778819940618053*^9}, {3.778820067685534*^9, 3.778820072784153*^9}, {
   3.778820113176401*^9, 3.778820114334826*^9}, {3.778820152598887*^9, 
   3.778820153135909*^9}, {3.778820226689789*^9, 3.7788202272183933`*^9}, {
   3.778820311416191*^9, 3.7788203273517523`*^9}, {3.778820361311675*^9, 
   3.7788203797499037`*^9}, {3.7788204110025473`*^9, 3.778820417613905*^9}, {
   3.7788210187701273`*^9, 3.7788210209326267`*^9}, {3.778821116961041*^9, 
   3.778821147086482*^9}, {3.778821548736902*^9, 3.778821548933969*^9}, {
   3.778821696566517*^9, 3.778821799585102*^9}, {3.778821838673884*^9, 
   3.77882198395188*^9}, {3.7788221184173326`*^9, 3.778822146849642*^9}, {
   3.7788222152651653`*^9, 3.77882227723555*^9}, {3.778822634816889*^9, 
   3.7788226887934437`*^9}, {3.778822816207232*^9, 3.778822827055213*^9}, {
   3.7788229113531*^9, 3.778822921955069*^9}, {3.778822972244789*^9, 
   3.778822976036601*^9}, {3.7788230191320753`*^9, 3.778823019733389*^9}, 
   3.778823071233624*^9, {3.7788231329932537`*^9, 3.778823190618588*^9}, {
   3.778823239826247*^9, 3.7788232945929537`*^9}, {3.778823368407675*^9, 
   3.778823412617093*^9}, {3.778844400234494*^9, 3.7788444005478*^9}, {
   3.778844456366362*^9, 3.7788444743969316`*^9}, {3.77884470007493*^9, 
   3.778844717790185*^9}, {3.778844780437141*^9, 3.77884478701976*^9}, {
   3.778845074940357*^9, 3.778845088485011*^9}, {3.7788451275156813`*^9, 
   3.778845130705517*^9}, 3.778845616340048*^9, 3.7788457283682756`*^9, 
   3.778845800293322*^9, {3.778886353639032*^9, 3.7788863597950697`*^9}, 
   3.778886492106347*^9, {3.778886682792959*^9, 3.778886685264526*^9}, {
   3.7788867262220078`*^9, 3.778886778247113*^9}, 3.778886831452767*^9, 
   3.778886874211956*^9, {3.778887623415173*^9, 3.7788876503008633`*^9}, {
   3.778887750442134*^9, 3.7788878345426292`*^9}, 3.7788878888522587`*^9, {
   3.778887925115508*^9, 3.7788880385274153`*^9}, {3.778888423856538*^9, 
   3.7788884298876963`*^9}, 3.77888853502462*^9, {3.780618911399419*^9, 
   3.7806189780827913`*^9}, {3.780620455692789*^9, 3.780620460665132*^9}, 
   3.780620578048341*^9, {3.780620617062312*^9, 3.780620621304965*^9}, {
   3.780620884208624*^9, 3.7806208888517847`*^9}, 3.780667911974256*^9, 
   3.780670712618743*^9, 3.780670759651865*^9, {3.780671500638215*^9, 
   3.780671507410808*^9}, {3.780869511261895*^9, 3.7808696128415403`*^9}, {
   3.789229336490693*^9, 3.789229337639344*^9}, {3.789390350779892*^9, 
   3.7893904019873037`*^9}, {3.79971866108461*^9, 
   3.79971866167101*^9}},ExpressionUUID->"5edd07c7-1df7-4fb5-a6ab-\
5f6efcdfbabd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Base Class", "Section",
 CellChangeTimes->{{3.684678566296839*^9, 3.684678566812415*^9}, {
   3.684678602969049*^9, 3.6846786252973766`*^9}, {3.6846787712362127`*^9, 
   3.6846787718768377`*^9}, {3.6846794135590725`*^9, 
   3.6846794243138685`*^9}, {3.684679499221797*^9, 3.684679500708866*^9}, {
   3.6943224932304945`*^9, 3.694322498229063*^9}, 3.694322896850048*^9, {
   3.696876852021453*^9, 3.696876854640302*^9}, {3.719166459376278*^9, 
   3.7191664595325117`*^9}, {3.719167363385213*^9, 3.7191673692758904`*^9}, {
   3.719169818022891*^9, 3.7191698200697823`*^9}, {3.766312388825984*^9, 
   3.7663124037654295`*^9}},ExpressionUUID->"8b2009df-a48f-4f7d-9e63-\
6b1725f75de2"],

Cell["\<\
special keys for objopts are joint, link, mesh, dof...technically, \
name/parent, but those shouldn\[CloseCurlyQuote]t be modified under most \
circumstances\
\>", "Text",
 CellChangeTimes->{{3.769381927072977*^9, 
  3.769381981051119*^9}},ExpressionUUID->"ba866565-2c08-4d35-8739-\
d2996edc9b28"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Object3D", "[", 
   RowBox[{"n_", ",", " ", "p_", ",", " ", 
    RowBox[{"objopts_:", 
     RowBox[{"<|", "|>"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A", ",", " ", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", " ", "=", " ", 
      RowBox[{"<|", 
       RowBox[{
        RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "n"}], ",", " ", 
        RowBox[{"\"\<parent\>\"", " ", "\[Rule]", " ", 
         RowBox[{"Quiet", "@", 
          RowBox[{"Check", "[", 
           RowBox[{
            RowBox[{"RBDGetPositionIndex", "@", "p"}], ",", " ", "0"}], 
           "]"}]}]}], ",", " ", "objopts"}], "|>"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"KeyFreeQ", "[", 
        RowBox[{"A", ",", " ", "\"\<dof\>\""}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"StringEndsQ", "[", 
           RowBox[{"n", ",", " ", "\"\<px\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
           "\"\<px\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"StringEndsQ", "[", 
           RowBox[{"n", ",", " ", "\"\<py\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
           "\"\<py\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"StringEndsQ", "[", 
           RowBox[{"n", ",", " ", "\"\<pz\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
           "\"\<pz\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"StringEndsQ", "[", 
           RowBox[{"n", ",", " ", "\"\<rx\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
           "\"\<rx\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"StringEndsQ", "[", 
           RowBox[{"n", ",", " ", "\"\<ry\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
           "\"\<ry\>\""}], ",", "\[IndentingNewLine]", 
          RowBox[{"StringEndsQ", "[", 
           RowBox[{"n", ",", " ", "\"\<rz\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
           "\"\<rz\>\""}], ",", "\[IndentingNewLine]", "True", ",", "  ", 
          RowBox[{
           RowBox[{
            RowBox[{"A", "[", "\"\<dof\>\"", "]"}], " ", "=", " ", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"StringContainsQ", "[", 
               RowBox[{"n", ",", " ", "\"\<foot\>\"", ",", " ", 
                RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], ",", " ", 
              "\"\<poi\>\"", ",", " ", "\"\<poi-flat\>\""}], "]"}]}], ";"}]}],
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"KeyFreeQ", "[", 
        RowBox[{"A", ",", " ", "\"\<mesh\>\""}], "]"}], ",", " ", 
       RowBox[{
        RowBox[{"A", "[", "\"\<mesh\>\"", "]"}], " ", "=", " ", 
        RowBox[{"<|", "|>"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"draw", "/", "render"}], " ", "link", " ", "for", " ", 
       "relevant", " ", "joint", " ", "types"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"StringMatchQ", "[", 
       RowBox[{
        RowBox[{"A", "[", "\"\<dof\>\"", "]"}], ",", " ", 
        RowBox[{
        "\"\<rx\>\"", "|", "\"\<ry\>\"", "|", "\"\<rz\>\"", "|", 
         "\"\<poi\>\"", "|", "\"\<poi-flat\>\"", "|", "\"\<poi-circ\>\""}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"c", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"BLbiped", "[", 
          RowBox[{"\"\<draw\>\"", ",", " ", "\"\<lc\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"hack", " ", "to", " ", "remove"}], ",", " ", 
          RowBox[{"e", ".", "g", "."}], ",", " ", 
          RowBox[{"\"\<-rx\>\"", " ", "from", " ", "string"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{"c", ",", " ", "n", ",", " ", 
           RowBox[{"Lookup", "[", 
            RowBox[{"c", ",", " ", 
             RowBox[{"StringTake", "[", 
              RowBox[{"n", ",", " ", 
               RowBox[{"{", 
                RowBox[{"1", ",", " ", 
                 RowBox[{"-", "4"}]}], "}"}]}], "]"}], ",", " ", "lc"}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"KeyFreeQ", "[", 
           RowBox[{
            RowBox[{"A", "[", "\"\<mesh\>\"", "]"}], ",", " ", 
            "\"\<link\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", 
            RowBox[{"\"\<mesh\>\"", ",", " ", "\"\<link\>\""}], "]"}], " ", 
           "=", " ", 
           RowBox[{"<|", "|>"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"KeyFreeQ", "[", 
           RowBox[{
            RowBox[{"A", "[", 
             RowBox[{"\"\<mesh\>\"", ",", " ", "\"\<link\>\""}], "]"}], ",", 
            " ", "\"\<color\>\""}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"A", "[", 
             RowBox[{
             "\"\<mesh\>\"", ",", " ", "\"\<link\>\"", ",", " ", 
              "\"\<color\>\""}], "]"}], " ", "=", " ", 
            RowBox[{"ColorToInteger", "[", "c", "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"draw", "/", "render"}], " ", "joint", " ", "for", " ", 
       "relevant", " ", "joint", " ", "types"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"StringMatchQ", "[", 
       RowBox[{
        RowBox[{"A", "[", "\"\<dof\>\"", "]"}], ",", " ", 
        RowBox[{
        "\"\<rx\>\"", "|", "\"\<ry\>\"", "|", "\"\<rz\>\"", "|", 
         "\"\<poi-circ\>\""}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"c", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{
           RowBox[{"BLbiped", "[", "\"\<draw\>\"", "]"}], ",", " ", 
           "\"\<jc\>\"", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"c", " ", "=", " ", 
         RowBox[{"Lookup", "[", 
          RowBox[{"c", ",", " ", "n", ",", " ", 
           RowBox[{"Lookup", "[", 
            RowBox[{"c", ",", " ", 
             RowBox[{"StringTake", "[", 
              RowBox[{"n", ",", " ", 
               RowBox[{"{", 
                RowBox[{"1", ",", " ", 
                 RowBox[{"-", "4"}]}], "}"}]}], "]"}], ",", " ", "jc"}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"KeyFreeQ", "[", 
           RowBox[{
            RowBox[{"A", "[", "\"\<mesh\>\"", "]"}], ",", " ", 
            "\"\<joint\>\""}], "]"}], ",", " ", 
          RowBox[{
           RowBox[{"A", "[", 
            RowBox[{"\"\<mesh\>\"", ",", " ", "\"\<joint\>\""}], "]"}], " ", 
           "=", " ", 
           RowBox[{"<|", "|>"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"KeyFreeQ", "[", 
           RowBox[{
            RowBox[{"A", "[", 
             RowBox[{"\"\<mesh\>\"", ",", " ", "\"\<joint\>\""}], "]"}], ",", 
            " ", "\"\<color\>\""}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"A", "[", 
             RowBox[{
             "\"\<mesh\>\"", ",", " ", "\"\<joint\>\"", ",", " ", 
              "\"\<color\>\""}], "]"}], " ", "=", " ", 
            RowBox[{"ColorToInteger", "[", "c", "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "A"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.766242101650022*^9, 3.766242169196809*^9}, {
   3.7662421999662914`*^9, 3.766242292288838*^9}, {3.7662423492265086`*^9, 
   3.766242349710837*^9}, {3.7662424264127045`*^9, 3.7662424466331816`*^9}, {
   3.766242534121373*^9, 3.766242689706374*^9}, {3.7662427389706106`*^9, 
   3.7662427412985835`*^9}, 3.7662429242034655`*^9, {3.766243926834197*^9, 
   3.7662439557851973`*^9}, {3.7662440281654563`*^9, 3.766244033227619*^9}, {
   3.766244065600237*^9, 3.7662441211573906`*^9}, {3.7662441856459455`*^9, 
   3.7662444301886177`*^9}, {3.76624449846832*^9, 3.7662445000463324`*^9}, {
   3.766244828876336*^9, 3.7662448612646303`*^9}, {3.766244896612959*^9, 
   3.7662448973003936`*^9}, 3.766245107635459*^9, {3.766245137758266*^9, 
   3.7662452186996455`*^9}, 3.7662452577592735`*^9, {3.76624813889734*^9, 
   3.766248215195197*^9}, {3.7662482452242823`*^9, 3.766248285129352*^9}, {
   3.7662483416137075`*^9, 3.76624847654792*^9}, {3.7662485066675973`*^9, 
   3.7662486508886204`*^9}, {3.766248734769859*^9, 3.7662487362854347`*^9}, {
   3.766248810480931*^9, 3.7662489121739044`*^9}, 3.766312385732481*^9, {
   3.7663139455721827`*^9, 3.7663139945487585`*^9}, 3.7663271156901474`*^9, {
   3.7663339358062787`*^9, 3.766333938360693*^9}, {3.7663340072416186`*^9, 
   3.7663340143035865`*^9}, 3.76633404714775*^9, {3.766334347980524*^9, 
   3.7663344019729557`*^9}, {3.766334448261603*^9, 3.7663344712755566`*^9}, {
   3.766334553753195*^9, 3.7663345663460298`*^9}, {3.7663346046190095`*^9, 
   3.7663346067282248`*^9}, {3.7663346483685226`*^9, 3.766334670679406*^9}, {
   3.7663347120357647`*^9, 3.766334712223277*^9}, {3.766408337195126*^9, 
   3.766408347319363*^9}, 3.7664083998755636`*^9, {3.7664089685498223`*^9, 
   3.7664089773616214`*^9}, {3.7664091687068644`*^9, 3.766409238242532*^9}, {
   3.7664097238956165`*^9, 3.7664097880500827`*^9}, {3.768736667961972*^9, 
   3.7687366715867033`*^9}, {3.7687395115024443`*^9, 
   3.7687395269680834`*^9}, {3.7687395733866386`*^9, 
   3.7687395782613077`*^9}, {3.76873985530334*^9, 3.7687400428261805`*^9}, {
   3.7687408242525806`*^9, 3.7687408882222385`*^9}, {3.7687410470594277`*^9, 
   3.768741051012267*^9}, {3.769339371281315*^9, 3.7693394264200025`*^9}, 
   3.769372979887347*^9, {3.769381842685368*^9, 3.7693819205266027`*^9}, {
   3.7693820981847267`*^9, 3.769382120964292*^9}, {3.7693821964013224`*^9, 
   3.7693821975262403`*^9}, {3.7693822311956167`*^9, 3.769382322419691*^9}, {
   3.7700349030695066`*^9, 3.7700349307550097`*^9}, {3.770035331815683*^9, 
   3.770035370801794*^9}, {3.770035718118847*^9, 3.770035718462556*^9}, {
   3.7701496053305197`*^9, 3.770149607299128*^9}, {3.772323983342112*^9, 
   3.7723240128637857`*^9}, {3.7779057068498487`*^9, 3.777905731041374*^9}, {
   3.777905796036652*^9, 3.777905922469678*^9}, {3.777905957648435*^9, 
   3.77790602307688*^9}, {3.777906118555594*^9, 3.777906169659388*^9}, {
   3.7781661824544773`*^9, 3.778166194606501*^9}, {3.7781677892585087`*^9, 
   3.778167816892243*^9}, {3.778167952847867*^9, 3.778167977518958*^9}, {
   3.77819305301324*^9, 3.7781930556084642`*^9}, {3.799718612257544*^9, 
   3.799718613195237*^9}},ExpressionUUID->"0b4f5337-4efa-4971-8d6c-\
569edcde47d9"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Specialized Classes", "Section",
 CellChangeTimes->{{3.684678566296839*^9, 3.684678566812415*^9}, {
   3.684678602969049*^9, 3.6846786252973766`*^9}, {3.6846787712362127`*^9, 
   3.6846787718768377`*^9}, {3.6846794135590725`*^9, 
   3.6846794243138685`*^9}, {3.684679499221797*^9, 3.684679500708866*^9}, {
   3.6943224932304945`*^9, 3.694322498229063*^9}, 3.694322896850048*^9, {
   3.696876852021453*^9, 3.696876854640302*^9}, {3.719166459376278*^9, 
   3.7191664595325117`*^9}, {3.719167363385213*^9, 3.7191673692758904`*^9}, {
   3.719169818022891*^9, 3.7191698200697823`*^9}, {3.766312388825984*^9, 
   3.7663124037654295`*^9}, {3.766312446371748*^9, 
   3.766312450074566*^9}},ExpressionUUID->"196775b4-1298-4ddd-8a63-\
acecd4b90159"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"CreatePOI", "[", 
    RowBox[{
     RowBox[{"\[Mu]_:", "1"}], ",", " ", 
     RowBox[{"objopts_:", " ", 
      RowBox[{"<|", "|>"}]}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"o", ",", " ", "c", ",", " ", "poi", ",", " ", "f"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", " ", "=", " ", 
       RowBox[{"addMu", "[", "\[Mu]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"poi", " ", "=", " ", 
       RowBox[{
        RowBox[{"BLbiped", "[", 
         RowBox[{"\"\<draw\>\"", ",", " ", "\"\<poi\>\""}], "]"}], " ", "/.", 
        " ", 
        RowBox[{
         RowBox[{"\[DoubleStruckC]", "[", "i_", "]"}], " ", "\[RuleDelayed]", 
         " ", 
         RowBox[{
         "c", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"o", " ", "=", " ", 
       RowBox[{
        RowBox[{"Lookup", "[", 
         RowBox[{"objopts", ",", " ", "#", ",", " ", 
          RowBox[{"<|", "|>"}]}], "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"Object3D", "[", 
           RowBox[{"#1", ",", " ", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",",
             " ", 
            RowBox[{"o", "[", "#1", "]"}]}], "]"}], ",", " ", 
          RowBox[{"\"\<value\>\"", " ", "\[Rule]", " ", 
           RowBox[{"CreateTba", "[", 
            RowBox[{
            "#2", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
            "]"}]}]}], "|>"}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"KeyValueMap", "[", 
       RowBox[{"f", ",", " ", "poi"}], "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CreateJoints", "[", 
   RowBox[{
    RowBox[{"rb_:", "Automatic"}], ",", " ", 
    RowBox[{"\[Mu]_:", "1"}], ",", " ", 
    RowBox[{"objopts_:", " ", 
     RowBox[{"<|", "|>"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "r", ",", " ", "p", ",", " ", "n", ",", " ", "v", ",", " ", "o"}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r", " ", "=", " ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"rb", " ", "===", " ", "Automatic"}], ",", " ", 
        RowBox[{"RigidBodyDynamics`Private`GetExpandedTree", "[", "]"}], ",", 
        " ", "rb"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"p", " ", "=", " ", 
      RowBox[{"r", "[", "ParentList", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"n", " ", "=", " ", 
      RowBox[{"Keys", "[", 
       RowBox[{"r", "[", "TreeForm", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"v", " ", "=", " ", 
      RowBox[{"CreateTransforms", "[", "\[Mu]", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"o", " ", "=", " ", 
      RowBox[{
       RowBox[{"Lookup", "[", 
        RowBox[{"objopts", ",", " ", "#", ",", " ", 
         RowBox[{"<|", "|>"}]}], "]"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"Object3D", "[", 
           RowBox[{"#1", ",", " ", "#2", ",", " ", 
            RowBox[{"o", "[", "#1", "]"}]}], "]"}], ",", " ", 
          RowBox[{"\"\<value\>\"", " ", "\[Rule]", " ", "#3"}]}], "|>"}], 
        "&"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "p", ",", " ", "v"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7662408442538724`*^9, 3.7662408569560623`*^9}, {
   3.766241615184949*^9, 3.7662416216219845`*^9}, {3.7662417957962866`*^9, 
   3.766241796280555*^9}, {3.7662418313405256`*^9, 3.766241925374895*^9}, {
   3.7662447233433247`*^9, 3.7662447863950577`*^9}, {3.7662461587891874`*^9, 
   3.7662461914828424`*^9}, {3.766312428982361*^9, 3.7663124292792006`*^9}, 
   3.766368196613822*^9, 3.766398981021534*^9, {3.766400253704421*^9, 
   3.7664002629849973`*^9}, {3.7687394096885223`*^9, 
   3.7687394221999693`*^9}, {3.768740364269068*^9, 3.7687404188189435`*^9}, {
   3.768740456058071*^9, 3.768740494570959*^9}, {3.7687409233422565`*^9, 
   3.768740951364049*^9}, {3.769339202527977*^9, 3.7693392032310343`*^9}, {
   3.7693392344787583`*^9, 3.769339307517637*^9}, 3.7693401956145*^9, {
   3.7779008667489347`*^9, 3.777900876489931*^9}, {3.777901519878327*^9, 
   3.777901527316876*^9}, {3.7779016474646587`*^9, 3.7779017248742037`*^9}, {
   3.777901757622389*^9, 3.777901759472623*^9}, {3.777901882006493*^9, 
   3.777901903954211*^9}},
 CellLabel->
  "In[169]:=",ExpressionUUID->"f327a82a-afb3-41e3-9ab6-0b223a7788dd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Common Mesh Options", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.672922910157816*^9, 3.6729229104546924`*^9}, {3.7663126782337365`*^9, 
  3.766312683608323*^9}, {3.791839406763708*^9, 
  3.791839413515422*^9}},ExpressionUUID->"adfe0e8c-f89c-4688-854f-\
2a1adf691b09"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Options", "[", "BLMeshOptions", "]"}], " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{"Length", " ", "\[Rule]", " ", "0.1"}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLMeshOptions", "[", 
    RowBox[{"OptionsPattern", "[", "]"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "w", ",", " ", "f", ",", " ", "info", ",", " ", "joints", ",", " ", 
       "links", ",", " ", "A"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"w", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "Length", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", " ", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"List", "@@", "x"}], ",", " ", "\"\<-\>\""}], "]"}], ",", 
         " ", "Listable"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "all", " ", "joint", " ", "names"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"f", "[", 
        RowBox[{"RBDGetValue", "[", 
         RowBox[{"1", ",", " ", "nq", ",", " ", 
          RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "True"}]}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"A", " ", "=", " ", 
       RowBox[{"Association", "@", 
        RowBox[{"Thread", "[", 
         RowBox[{"A", " ", "\[Rule]", " ", 
          RowBox[{"<|", 
           RowBox[{"\"\<mesh\>\"", " ", "\[Rule]", " ", 
            RowBox[{"<|", 
             RowBox[{
              RowBox[{"\"\<joint\>\"", " ", "\[Rule]", " ", 
               RowBox[{"<|", 
                RowBox[{
                 RowBox[{"\"\<height\>\"", " ", "\[Rule]", " ", 
                  RowBox[{"1.1", " ", "w"}]}], ",", " ", 
                 RowBox[{"\"\<radius\>\"", " ", "\[Rule]", " ", 
                  RowBox[{"w", "/", "2"}]}]}], "|>"}]}], ",", 
              RowBox[{"\"\<link\>\"", " ", "\[Rule]", " ", 
               RowBox[{"<|", 
                RowBox[{"\"\<width\>\"", " ", "\[Rule]", " ", "w"}], 
                "|>"}]}]}], "|>"}]}], "|>"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "A"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.791824176982395*^9, 3.791824180198513*^9}, {
  3.791839506444077*^9, 
  3.791839581051406*^9}},ExpressionUUID->"d25dfcf4-85e7-4637-92bf-\
42ad008aa37c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export to JSON", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.672922910157816*^9, 3.6729229104546924`*^9}, {3.7663126782337365`*^9, 
  3.766312683608323*^9}},ExpressionUUID->"e860885d-8473-4ad8-ba46-\
28029292bd00"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLCreateBipedToThreeJS", "[", "A_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "T", ",", " ", "K", ",", " ", "mu", ",", " ", "j", ",", " ", "f", ",", 
        " ", "ax", ",", " ", "mopts", ",", " ", "mroot"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "kinematic", " ", "tree", " ", "properties"}], " ",
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"RigidBodyDynamics`Private`GetExpandedTree", "[", "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "functions", " ", "for", " ", "a", " ", "model", " ", "entry"}], ",",
          " ", 
         RowBox[{
         "model", " ", "defined", " ", "by", " ", "\[Mu]", " ", "vector", " ",
           "in", " ", "\[DoubleStruckC]"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"K", " ", "=", " ", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{"Key", "@", "Options"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"mu", " ", "assumes", " ", "no", " ", "derivatives"}], ",", 
         " ", 
         RowBox[{"i", ".", "e", "."}], ",", " ", 
         RowBox[{
          RowBox[{"Length", "[", "mu", "]"}], " ", "===", " ", "nc"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"mu", " ", "=", " ", 
        RowBox[{
         RowBox[{"#", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", " ", "\"\<c\>\"", ",", " ", "1", ",", " ", 
           RowBox[{"BLbiped", "[", 
            RowBox[{"\"\<c\>\"", ",", " ", 
             RowBox[{"#", "\[LeftDoubleBracket]", 
              RowBox[{"1", ",", " ", "\"\<m\>\"", ",", " ", "1"}], 
              "\[RightDoubleBracket]"}], ",", " ", "\"\<\[Mu]\>\""}], "]"}]}],
           "\[RightDoubleBracket]"}], "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"j", " ", "=", " ", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"CreateJoints", "[", 
            RowBox[{"T", ",", " ", "#1", ",", " ", "#2"}], "]"}], ",", " ", 
           RowBox[{"CreatePOI", "[", 
            RowBox[{"#1", ",", " ", "#2"}], "]"}]}], "]"}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mopts", " ", "=", " ", 
        RowBox[{
         RowBox[{"Lookup", "[", 
          RowBox[{"#", ",", " ", "Options", ",", " ", 
           RowBox[{"<|", "|>"}]}], "]"}], "&"}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"ax", " ", "=", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<x\>\"", ",", " ", "\"\<y\>\"", ",", " ", "\"\<z\>\""}],
           "}"}], "\[LeftDoubleBracket]", 
         RowBox[{"Lookup", "[", 
          RowBox[{
           RowBox[{"BLbiped", "[", "\"\<draw\>\"", "]"}], ",", " ", 
           "\"\<axes\>\"", ",", " ", "axes"}], "]"}], 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mroot", " ", "=", " ", 
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<axes\>\"", " ", "\[Rule]", " ", "ax"}], ",", " ", 
           RowBox[{
           "\"\<loader\>\"", " ", "\[Rule]", " ", "\"\<DefaultMesh.js\>\""}], 
           ",", " ", 
           RowBox[{"Lookup", "[", 
            RowBox[{
             RowBox[{"mopts", "[", "#", "]"}], ",", " ", "Root", ",", " ", 
             RowBox[{"<|", "|>"}]}], "]"}]}], "|>"}], "&"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<joints\>\"", " ", "\[Rule]", " ", 
            RowBox[{"j", "[", 
             RowBox[{
              RowBox[{"mu", "[", "#", "]"}], ",", " ", 
              RowBox[{"mopts", "[", "#", "]"}]}], "]"}]}], ",", 
           RowBox[{"\"\<clips\>\"", " ", "\[Rule]", " ", 
            RowBox[{"CreateClips", "[", 
             RowBox[{
              RowBox[{"K", "@", "#"}], ",", " ", "Automatic"}], "]"}]}], ",", 
           " ", 
           RowBox[{"mroot", "[", "#", "]"}], ",", " ", 
           RowBox[{"\"\<surfaces\>\"", " ", "\[Rule]", " ", 
            RowBox[{"GetSurfaceAngles", "[", 
             RowBox[{"K", "@", "#"}], "]"}]}]}], "|>"}], "&"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"<|", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", 
          RowBox[{"BLbiped", "[", "\"\<name\>\"", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"\"\<models\>\"", " ", "\[Rule]", " ", 
          RowBox[{"KeyValueMap", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"<|", 
              RowBox[{
               RowBox[{"\"\<name\>\"", " ", "\[Rule]", " ", "#1"}], ",", " ", 
               RowBox[{"f", "[", "#2", "]"}]}], "|>"}], "&"}], ",", " ", 
            "A"}], "]"}]}]}], "\[IndentingNewLine]", "|>"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLExportBipedToThreeJS", "[", 
    RowBox[{"A_", ",", " ", 
     RowBox[{"folder_:", "Automatic"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", " ", "e", ",", " ", "biped", ",", " ", "file", ",", " ", 
       "m"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", " ", "=", " ", 
       RowBox[{"Lookup", "[", 
        RowBox[{"A", ",", " ", "\"\<name\>\"", ",", " ", "Null"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"biped", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"StringQ", "[", "n", "]"}]}], ",", " ", 
         RowBox[{"BLCreateBipedToThreeJS", "[", "A", "]"}], ",", " ", "A"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"file", " ", "=", " ", 
       RowBox[{
        RowBox[{"biped", "[", "\"\<name\>\"", "]"}], " ", "<>", " ", 
        "\"\<.json\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"folder", " ", "===", " ", "Automatic"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"BLExportTo", "[", 
         RowBox[{"\"\<JSON\>\"", ",", " ", "file", ",", " ", "biped"}], "]"}],
         ",", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Export", "[", 
         RowBox[{
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{"folder", ",", " ", "file"}], "}"}], "]"}], ",", " ", 
          "biped"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.766192391740167*^9, 3.7661924487314844`*^9}, {
   3.766192846380107*^9, 3.766193102348945*^9}, {3.766193260741802*^9, 
   3.7661933860872264`*^9}, {3.7661936891405535`*^9, 3.766193689781149*^9}, {
   3.766193737606019*^9, 3.7661937379810247`*^9}, {3.7661940643639746`*^9, 
   3.766194117375942*^9}, {3.766194605589248*^9, 3.7661946100576696`*^9}, {
   3.7661957093503723`*^9, 3.7661957783581853`*^9}, {3.76619586672004*^9, 
   3.766195873578936*^9}, {3.766195959387126*^9, 3.7661960283980017`*^9}, {
   3.7661960803264437`*^9, 3.766196094606715*^9}, {3.76619616574154*^9, 
   3.766196165882156*^9}, {3.7662490475202875`*^9, 3.7662491298689957`*^9}, {
   3.7662491691877704`*^9, 3.7662492221741004`*^9}, {3.766249263546132*^9, 
   3.7662492677176695`*^9}, {3.7662512653133516`*^9, 3.766251367209744*^9}, {
   3.7662517782673903`*^9, 3.7662518162348433`*^9}, {3.7662521146592855`*^9, 
   3.7662521236429896`*^9}, {3.766281038695607*^9, 3.766281049195106*^9}, {
   3.766281081284356*^9, 3.7662810818624663`*^9}, {3.7663126984827504`*^9, 
   3.766312742446351*^9}, {3.7663127996180067`*^9, 3.7663130363264604`*^9}, {
   3.7663130970831933`*^9, 3.766313098618843*^9}, {3.7663132340887527`*^9, 
   3.7663132364792137`*^9}, {3.7663133214110785`*^9, 3.766313352049466*^9}, {
   3.766313396942276*^9, 3.766313495294489*^9}, {3.7663140207047205`*^9, 
   3.766314021657776*^9}, {3.766364733275357*^9, 3.7663647453682103`*^9}, {
   3.766365586165901*^9, 3.7663657827036023`*^9}, {3.766365894724619*^9, 
   3.766365940212389*^9}, {3.766365997192627*^9, 3.7663661220625553`*^9}, {
   3.766400210860544*^9, 3.7664002123604455`*^9}, {3.766400311778328*^9, 
   3.7664003365619817`*^9}, {3.766400612121193*^9, 3.766400664764904*^9}, {
   3.7664132489720645`*^9, 3.7664132801885643`*^9}, {3.7664366717840843`*^9, 
   3.7664367226930957`*^9}, {3.7664386514342184`*^9, 
   3.7664386744325485`*^9}, {3.7664439234307313`*^9, 
   3.7664439841113167`*^9}, {3.766446008997205*^9, 3.76644610330169*^9}, {
   3.7664461463883123`*^9, 3.7664461586217957`*^9}, {3.766446212745013*^9, 
   3.76644632010883*^9}, {3.7664463523972397`*^9, 3.766446374083178*^9}, {
   3.766446417515792*^9, 3.76644644315454*^9}, {3.766446578987031*^9, 
   3.766446626443577*^9}, 3.7664466611910524`*^9, {3.766446700759631*^9, 
   3.766446749558028*^9}, {3.766446802006143*^9, 3.766446802623501*^9}, {
   3.7664469772519293`*^9, 3.7664470221197786`*^9}, {3.7664470612731743`*^9, 
   3.766447103337222*^9}, {3.7664471828135977`*^9, 3.76644726757412*^9}, {
   3.766447336779193*^9, 3.766447381164427*^9}, {3.7664474555176706`*^9, 
   3.766447478375388*^9}, {3.76644761395658*^9, 3.7664476167688756`*^9}, {
   3.766447728957385*^9, 3.7664477292386155`*^9}, {3.7664478115896997`*^9, 
   3.76644781526131*^9}, {3.767530237660493*^9, 3.76753023873853*^9}, 
   3.7687349069434195`*^9, {3.7687391920772295`*^9, 3.7687391993266935`*^9}, {
   3.7687392444021378`*^9, 3.7687393117410564`*^9}, {3.7687425935007877`*^9, 
   3.768742594297638*^9}, {3.769339500209255*^9, 3.7693395295013323`*^9}, {
   3.769339954749755*^9, 3.769339962327323*^9}, {3.769340072032575*^9, 
   3.7693401678196583`*^9}, {3.7700441700886307`*^9, 
   3.7700441714239445`*^9}, {3.7706370018515873`*^9, 
   3.7706370722321625`*^9}, {3.771255701546032*^9, 3.771255704770637*^9}, {
   3.771255885405299*^9, 3.771255890078877*^9}, {3.771256748394526*^9, 
   3.771256759073512*^9}, {3.771257951355015*^9, 3.7712579515043917`*^9}, {
   3.771257983449946*^9, 3.771258129577117*^9}, {3.771258167305964*^9, 
   3.771258196648094*^9}, {3.7712582675501547`*^9, 3.771258267614407*^9}, {
   3.771258318391451*^9, 3.77125839306861*^9}, {3.771258431552722*^9, 
   3.7712584447773657`*^9}, {3.771258488007883*^9, 3.771258523537529*^9}, {
   3.771258770518112*^9, 3.771258777369988*^9}, {3.771258808486909*^9, 
   3.7712588118678637`*^9}, {3.77125893704174*^9, 3.7712589540937*^9}, {
   3.771259092436948*^9, 3.771259144170265*^9}, {3.771282893242341*^9, 
   3.771282918047147*^9}, {3.7721480059901657`*^9, 3.772148066598934*^9}, {
   3.772148752873451*^9, 3.772148754979632*^9}, {3.772148968718453*^9, 
   3.772148969756927*^9}, {3.77214902941074*^9, 3.772149134089023*^9}, {
   3.7721554034336977`*^9, 3.7721554699106197`*^9}, {3.772155501363481*^9, 
   3.7721555278173227`*^9}, {3.772155579779763*^9, 3.772155655180784*^9}, 
   3.772180077409709*^9, {3.772333237480303*^9, 3.772333280347353*^9}, {
   3.772333334791977*^9, 3.772333360604697*^9}, 3.772338887599126*^9, {
   3.777901258142449*^9, 3.7779013029845133`*^9}, {3.778498363135942*^9, 
   3.77849836525673*^9}, {3.778500354202722*^9, 3.778500476304194*^9}, {
   3.778500638915119*^9, 3.77850065628314*^9}, {3.778501338830044*^9, 
   3.778501357217753*^9}, {3.789232156212158*^9, 3.789232163349023*^9}, {
   3.799718625254262*^9, 3.799718651037056*^9}, {3.799778141420497*^9, 
   3.799778142954521*^9}, {3.7997781924493437`*^9, 3.799778195432942*^9}, {
   3.799778812572456*^9, 3.7997789748218603`*^9}, {3.79977920539746*^9, 
   3.79977920912643*^9}, {3.799779411882743*^9, 3.799779413422064*^9}, {
   3.799779688121655*^9, 3.799779688608308*^9}, 
   3.799788235687634*^9},ExpressionUUID->"eb95d5c4-dfd0-4fdf-9bf0-\
edc14468c445"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.672922910157816*^9, 
  3.6729229104546924`*^9}},ExpressionUUID->"7763f1fd-3f31-4fe6-a458-\
46e8b19904fe"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6729231090809507`*^9, 3.6729231097997046`*^9}},
 CellLabel->
  "In[173]:=",ExpressionUUID->"9e692824-408c-4178-91b3-94d404c368e1"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1505},
WindowMargins->{{0, Automatic}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 203, 4, 95, "Section",ExpressionUUID->"5942d252-24c7-4407-be58-878fb8e76629"],
Cell[786, 28, 709, 22, 572, "Text",ExpressionUUID->"1d8a9f1a-38c6-4ada-a22e-e56da96c9f9c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1532, 55, 160, 3, 95, "Section",ExpressionUUID->"7ccc636b-f0ba-4d68-af49-6676cbfa4980"],
Cell[1695, 60, 5010, 81, 422, "Input",ExpressionUUID->"0115de21-8c8b-4e46-bc49-37dc9143e7f8",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[6742, 146, 690, 10, 95, "Section",ExpressionUUID->"b159ae4f-fa50-4abd-aacb-d86a024420c8"],
Cell[7435, 158, 3566, 79, 582, "Input",ExpressionUUID->"f999365b-3a7b-4e32-9802-21dce7ed3395",
 InitializationCell->True],
Cell[11004, 239, 428, 10, 172, "Text",ExpressionUUID->"305bf461-3b0c-4639-b9ad-ddc829eb164c"],
Cell[11435, 251, 8354, 173, 1062, "Input",ExpressionUUID->"83bb9741-aacf-4eeb-8124-654ac6a6da32",
 InitializationCell->True],
Cell[19792, 426, 8552, 159, 1062, "Input",ExpressionUUID->"8dbd2996-082b-420b-a147-b7faf0e56b4c",
 InitializationCell->True],
Cell[28347, 587, 5035, 107, 502, "Input",ExpressionUUID->"4ea9f8ce-7cfe-4349-8671-5afc3cf52aed",
 InitializationCell->True],
Cell[33385, 696, 343, 7, 92, "Text",ExpressionUUID->"586390b2-7760-4c7d-8006-cf74e37852e0"],
Cell[33731, 705, 11117, 225, 982, "Input",ExpressionUUID->"5edd07c7-1df7-4fb5-a6ab-5f6efcdfbabd",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[44885, 935, 686, 10, 95, "Section",ExpressionUUID->"8b2009df-a48f-4f7d-9e63-6b1725f75de2"],
Cell[45574, 947, 307, 7, 92, "Text",ExpressionUUID->"ba866565-2c08-4d35-8739-d2996edc9b28"],
Cell[45884, 956, 11966, 249, 1908, "Input",ExpressionUUID->"0b4f5337-4efa-4971-8d6c-569edcde47d9",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[57887, 1210, 745, 11, 95, "Section",ExpressionUUID->"196775b4-1298-4ddd-8a63-acecd4b90159"],
Cell[58635, 1223, 4875, 114, 662, "Input",ExpressionUUID->"f327a82a-afb3-41e3-9ab6-0b223a7788dd",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[63547, 1342, 341, 6, 95, "Section",ExpressionUUID->"adfe0e8c-f89c-4688-854f-2a1adf691b09",
 InitializationCell->True],
Cell[63891, 1350, 2591, 62, 622, "Input",ExpressionUUID->"d25dfcf4-85e7-4637-92bf-42ad008aa37c",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[66519, 1417, 287, 5, 95, "Section",ExpressionUUID->"e860885d-8473-4ad8-ba46-28029292bd00",
 InitializationCell->True],
Cell[66809, 1424, 12144, 236, 1382, "Input",ExpressionUUID->"eb95d5c4-dfd0-4fdf-9bf0-edc14468c445",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[78990, 1665, 236, 5, 95, "Section",ExpressionUUID->"7763f1fd-3f31-4fe6-a458-46e8b19904fe",
 InitializationCell->True],
Cell[79229, 1672, 275, 6, 102, "Input",ExpressionUUID->"9e692824-408c-4178-91b3-94d404c368e1",
 InitializationCell->True]
}, Open  ]]
}
]
*)

