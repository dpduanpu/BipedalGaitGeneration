(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     51041,       1107]
NotebookOptionsPosition[     49559,       1070]
NotebookOutlinePosition[     49926,       1086]
CellTagsIndexPosition[     49883,       1083]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"(*", "\n", 
  RowBox[{
   RowBox[{"CoreDynamicAlgorithms", ".", 
    RowBox[{"nb", ":", " ", 
     RowBox[{
     "An", " ", "implementation", " ", "of", " ", "the", " ", "RNEA", " ", 
      "algorithm", "\n", "and", " ", "its", " ", 
      RowBox[{"derivative", ".", "\n", "Copyright"}], " ", 
      RowBox[{"(", "C", ")"}], " ", "2017", " ", "Nelson", " ", "Rosa", " ", 
      RowBox[{"Jr", ".", "\n", "\n", "This"}], " ", "program", " ", "is", " ",
       "free", " ", "software"}], ":", " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], " ", "modify", "\n", "it", " ", "under", 
      " ", "the", " ", "terms", " ", "of", " ", "the", " ", "GNU", " ", 
      "General", " ", "Public", " ", "License", " ", "as", " ", "published", 
      " ", "by", "\n", 
      RowBox[{"the", " ", "Free", " ", "Software", " ", "Foundation"}]}]}]}], 
   ",", " ", 
   RowBox[{
   "either", " ", "version", " ", "3", " ", "of", " ", "the", " ", 
    "License"}], ",", " ", 
   RowBox[{"or", "\n", 
    RowBox[{"(", 
     RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
    "later", " ", 
    RowBox[{"version", ".", " ", "This"}], " ", "program", " ", "is", " ", 
    "distributed", " ", "in", " ", "the", " ", "\n", "hope", " ", "that", " ",
     "it", " ", "will", " ", "be", " ", "useful"}], ",", " ", 
   RowBox[{
    RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
    RowBox[{
    "without", " ", "even", " ", "the", " ", "\n", "implied", " ", "warranty",
      " ", "of", " ", "MERCHANTABILITY", " ", "or", " ", "FITNESS", " ", 
     "FOR", " ", "A", " ", "PARTICULAR", " ", 
     RowBox[{"PURPOSE", ".", "\n", "See"}], " ", "the", " ", "GNU", " ", 
     "General", " ", "Public", " ", "License", " ", "for", " ", "more", " ", 
     RowBox[{"details", ".", " ", "You"}], " ", "should", " ", "have", " ", 
     "\n", "received", " ", "a", " ", "copy", " ", "of", " ", "the", " ", 
     "GNU", " ", "General", " ", "Public", " ", "License", " ", "along", " ", 
     "with", " ", "this", " ", 
     RowBox[{"program", ".", "\n", "If"}], " ", "not"}]}], ",", " ", 
   RowBox[{
    RowBox[{"see", " ", "<", 
     RowBox[{"http", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"www", ".", "gnu", ".", "org"}], "/", "licenses"}], "/"}], ">",
      "."}]}]}], "\n", "*)"}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.6103707836964283`*^9, 3.610370783709448*^9}, {
  3.610370828952024*^9, 3.610370962648698*^9}, {3.6103710877518406`*^9, 
  3.610371111376195*^9}, {3.6103711469392376`*^9, 3.6103712325731497`*^9}, {
  3.610371305900334*^9, 3.610371331708816*^9}, {3.610371368620943*^9, 
  3.61037139802861*^9}, {3.6103715538125486`*^9, 3.6103716079966354`*^9}, {
  3.717206562929199*^9, 
  3.7172065683823853`*^9}},ExpressionUUID->"59f5aa58-c7ae-458c-ae67-\
8abe32970981"],

Cell[CellGroupData[{

Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"04ab2fc5-9b64-4da9-9a70-\
e61022bce381"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<BipedalLocomotion`Model`\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<GlobalVariables`\>\"", ",", " ", "\"\<RigidBodyDynamics`\>\"", ",", 
      " ", "\"\<BipedalLocomotion`\>\"", ",", " ", "\"\<Derivatives`\>\""}], 
     "}"}]}], "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.5922422663532963`*^9, 3.592242267056429*^9}, {3.5922818277082567`*^9, 
   3.59228183637475*^9}, {3.593367625062662*^9, 3.5933676251720285`*^9}, {
   3.7184128948341675`*^9, 3.718412898099818*^9}, {3.718416354686819*^9, 
   3.7184163558899565`*^9}, {3.718670146894775*^9, 3.718670151254195*^9}, {
   3.719590694620596*^9, 3.7195906956518383`*^9}, {3.7195911685464177`*^9, 
   3.7195911814840426`*^9}, {3.7195913052350626`*^9, 3.7195913055006876`*^9}, 
   3.7196175404013443`*^9, {3.7196178879823756`*^9, 3.7196179349515204`*^9}, 
   3.719618147062685*^9, {3.7196214232007027`*^9, 3.719621444685259*^9}, {
   3.7196890250604086`*^9, 3.719689031029211*^9}, {3.7197151624303107`*^9, 
   3.71971516285218*^9}, 3.7197626088119507`*^9, {3.7197641205828533`*^9, 
   3.7197641213640995`*^9}, {3.7197688823218393`*^9, 3.7197688990563655`*^9}, 
   3.720100717143484*^9, {3.7201012030543346`*^9, 3.720101256695471*^9}, {
   3.720102686334072*^9, 3.720102690834099*^9}, {3.7201057819413333`*^9, 
   3.720105783925744*^9}, {3.720134400852599*^9, 3.720134406383883*^9}, {
   3.7201407388883142`*^9, 3.720140739794585*^9}, {3.730712418017831*^9, 
   3.730712422017863*^9}, {3.7312253458251934`*^9, 
   3.731225346387697*^9}},ExpressionUUID->"50144e8c-ac6c-42cd-a7b3-\
19a20c36fc82"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Continuation methods & HZD feedback controller", "Section",
 CellChangeTimes->{{3.669631812504639*^9, 3.669631819769997*^9}, {
  3.6697210032317576`*^9, 3.6697210049036465`*^9}, {3.6697580388066244`*^9, 
  3.6697580398473396`*^9}, {3.6811438602412176`*^9, 3.681143862046855*^9}, {
  3.7193181990604544`*^9, 3.7193181998416986`*^9}, {3.7193288884340954`*^9, 
  3.7193289031060944`*^9}},ExpressionUUID->"6a9e4002-07c0-457b-8a8f-\
34e1b23fd01c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Theta]0", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "eta", "}"}], ",", " ", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
         "\[Alpha]\[Theta]", "\[LeftDoubleBracket]", "1", 
          "\[RightDoubleBracket]"}], " ", "\[NotEqual]", " ", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "is", " ", "clock", " ", "value", " ", "given", " ", "by", " ", "a", 
          " ", 
          RowBox[{"constraint", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
          "RigidBodyDynamics`Private`q", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}], " ", "=", " ", 
          RowBox[{"RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", " ", 
            RowBox[{
            "\[Alpha]\[Theta]", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "\[Alpha]\[Theta]", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}], " ", "\[Equal]", " ", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"reset", " ", "to", " ", "zero"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
          "RigidBodyDynamics`Private`q", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}], " ", "=", " ", "z1"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"else", " ", "clock", " ", "is", " ", "time", " ", "based"}], 
       ",", " ", 
       RowBox[{"leave", " ", "it", " ", "alone"}]}], " ", "*)"}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Eta]0", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"c0", ",", " ", "eta", ",", " ", "\[Alpha]"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"c0", " ", "=", " ", "\[DoubleStruckC]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", 
           RowBox[{
           "\[Alpha]0", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], " ", ">", " ", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"eta", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{
             "RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{
             "RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"eta", " ", "=", " ", 
           RowBox[{"eta", "\[LeftDoubleBracket]", 
            RowBox[{
            "\[Alpha]0", "\[LeftDoubleBracket]", "2", 
             "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Alpha]", " ", "=", " ", 
           RowBox[{"LinearSolve", "[", 
            RowBox[{"B0fun", ",", " ", "eta"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"c0", "\[LeftDoubleBracket]", 
            RowBox[{
            "\[Alpha]0", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], " ", "=", 
           " ", "\[Alpha]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "c0", "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Eta]T", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"cT", ",", " ", "eta", ",", " ", "\[Alpha]"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cT", " ", "=", " ", "\[DoubleStruckC]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", 
           RowBox[{
           "\[Alpha]T", "\[LeftDoubleBracket]", "2", 
            "\[RightDoubleBracket]"}]}], " ", ">", " ", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"eta", " ", "=", " ", 
           RowBox[{"Join", "[", 
            RowBox[{
             RowBox[{
             "RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], ",", " ", 
             RowBox[{
             "RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", "2", 
              "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"eta", " ", "=", " ", 
           RowBox[{"eta", "\[LeftDoubleBracket]", 
            RowBox[{
            "\[Alpha]T", "\[LeftDoubleBracket]", "2", 
             "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Alpha]", " ", "=", " ", 
           RowBox[{"LinearSolve", "[", 
            RowBox[{"BTfun", ",", " ", "eta"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"cT", "\[LeftDoubleBracket]", 
            RowBox[{
            "\[Alpha]T", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], " ", "=", 
           " ", "\[Alpha]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "cT", "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Ucon", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bv", ",", " ", "nqf", ",", " ", "nqfv", ",", " ", "nqfub"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nqf", " ", "=", " ", 
        RowBox[{"nq", " ", "+", " ", "nf"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nqfv", " ", "=", " ", 
        RowBox[{"nq", " ", "+", " ", "nf", " ", "+", " ", "nv"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nqfub", " ", "=", " ", 
        RowBox[{
        "nq", " ", "+", " ", "nf", " ", "+", " ", "nu", " ", "+", " ", 
         "1"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"nf", " ", ">", " ", "0"}], " ", "&&", " ", 
          RowBox[{"nv", " ", ">", " ", "0"}], " ", "&&", " ", 
          RowBox[{
           RowBox[{"Length", "@", "Pfun"}], " ", ">", " ", "0"}]}], ",", " ", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"bv", " ", "=", " ", 
           RowBox[{"Pfun", ".", 
            RowBox[{"RigidBodyDynamics`Private`Ab", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"nqf", "+", "1"}], ";;", "nqfv"}], ",", " ", "nqfub"}],
              "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"RigidBodyDynamics`Private`Ab", "\[LeftDoubleBracket]", 
            RowBox[{
             RowBox[{
              RowBox[{"nqf", "+", "1"}], ";;", "nqfv"}], ",", " ", "nqfub"}], 
            "\[RightDoubleBracket]"}], " ", "=", " ", "bv"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Jac", "[", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "x", ",", " ", "i", ",", " ", "j", ",", " ", "A", ",", " ", "b"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i", " ", "=", " ", 
        RowBox[{
        "\[Alpha]Jp", "\[LeftDoubleBracket]", "2", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"j", " ", "=", " ", 
        RowBox[{
        "\[Alpha]Jp", "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"RigidBodyDynamics`Private`J", "\[LeftDoubleBracket]", 
         RowBox[{"i", ",", " ", "j"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"-", 
         RowBox[{"RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", " ", "i"}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"LinearSolve", "[", 
         RowBox[{"A", ",", " ", "b"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "x", "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Sigma]", "[", "]"}], ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"st", ",", " ", "sw", ",", " ", "a", ",", " ", "ret"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"st", " ", "=", " ", 
       RowBox[{"RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", " ", 
         RowBox[{"1", ";;", "mm"}]}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sw", " ", "=", " ", 
       RowBox[{"RigidBodyDynamics`Private`\[Eta]", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", " ", 
         RowBox[{
          RowBox[{"mm", "+", "1"}], ";;", "nm"}]}], 
        "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"difference", " ", "of", " ", "foot", " ", "locations"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"a", " ", "=", " ", 
       RowBox[{"sw", " ", "-", " ", "st"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ret", " ", "=", " ", "z3"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"a", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
           " ", "\[NotEqual]", " ", "0"}], " ", "||", " ", 
         RowBox[{
          RowBox[{"a", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           " ", "\[NotEqual]", " ", "0"}]}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "ret", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], " ", 
          "=", " ", 
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{
            "a", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{
            "a", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           " ", "\[NotEqual]", " ", "0"}], " ", "||", " ", 
         RowBox[{
          RowBox[{"a", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}],
           " ", "\[NotEqual]", " ", "0"}]}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "ret", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], " ", 
          "=", " ", 
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{
            "a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{
            "a", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           " ", "\[NotEqual]", " ", "0"}], " ", "||", " ", 
         RowBox[{
          RowBox[{"a", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
           " ", "\[NotEqual]", " ", "0"}]}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "ret", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], " ", 
          "=", " ", 
          RowBox[{"ArcTan", "[", 
           RowBox[{
            RowBox[{
            "a", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", 
            RowBox[{
            "a", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", "ret", "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7186307344821634`*^9, 3.71863073513842*^9}, {
   3.718631316409791*^9, 3.7186313428944283`*^9}, 3.7186315726154475`*^9, {
   3.7186316170846524`*^9, 3.7186317015854874`*^9}, {3.718631841711857*^9, 
   3.7186318422587385`*^9}, {3.718631885509164*^9, 3.7186319106500373`*^9}, {
   3.7186320584171295`*^9, 3.71863217229325*^9}, {3.7186322222000084`*^9, 
   3.71863222501252*^9}, {3.7186323254041386`*^9, 3.7186323630451355`*^9}, {
   3.7186324650617685`*^9, 3.718632474405609*^9}, {3.7186325270936317`*^9, 
   3.7186325332499537`*^9}, 3.71863257746913*^9, {3.7186327761117325`*^9, 
   3.7186328187840147`*^9}, {3.718632851331209*^9, 3.7186328524405966`*^9}, {
   3.7186328938316298`*^9, 3.718632901847351*^9}, {3.7186329410196133`*^9, 
   3.7186329604729147`*^9}, {3.7186330009889545`*^9, 3.718633117849471*^9}, {
   3.7186332002252827`*^9, 3.7186332073034782`*^9}, {3.7186333737894983`*^9, 
   3.718633386852129*^9}, {3.718633423021131*^9, 3.7186334752872715`*^9}, {
   3.7186336631797667`*^9, 3.718633724445985*^9}, {3.718633940948127*^9, 
   3.7186339810735235`*^9}, {3.7186340182301407`*^9, 3.718634058793041*^9}, {
   3.718634154919007*^9, 3.718634208857024*^9}, 3.71863462522882*^9, 
   3.718634743589349*^9, {3.7186348073087454`*^9, 3.7186348302777214`*^9}, {
   3.718634868715602*^9, 3.7186348689499626`*^9}, {3.718634936044392*^9, 
   3.7186349510913982`*^9}, 3.7186350737019863`*^9, {3.7186368832155123`*^9, 
   3.718636890606204*^9}, {3.7193184167885284`*^9, 3.719318445335642*^9}, 
   3.7193185030392494`*^9, {3.719318628102807*^9, 3.7193186302434545`*^9}, {
   3.719318772588377*^9, 3.719318784760356*^9}, {3.7193189605430756`*^9, 
   3.7193190054340754`*^9}, {3.719329398432249*^9, 3.719329399104148*^9}, {
   3.7193294832142105`*^9, 3.7193295226207895`*^9}, {3.719329580558773*^9, 
   3.719329617746601*^9}, 3.7193296529500046`*^9, 3.719329835123404*^9, {
   3.7193298680768023`*^9, 3.7193299015614576`*^9}, {3.7193299517962523`*^9, 
   3.719329976546459*^9}, {3.7193300228437233`*^9, 3.7193300243906107`*^9}, {
   3.7193300569690104`*^9, 3.7193301213914366`*^9}, {3.719330173626234*^9, 
   3.719330257955065*^9}, {3.719330324533745*^9, 3.71933034075263*^9}, {
   3.7193308739445906`*^9, 3.7193310240708466`*^9}, {3.7193311454000006`*^9, 
   3.7193312339475994`*^9}, {3.71933171290473*^9, 3.7193318138118243`*^9}, 
   3.719340688974197*^9, {3.7193411366608467`*^9, 3.719341142364004*^9}, 
   3.7193412178802795`*^9, {3.719341882234809*^9, 3.7193419147663145`*^9}, {
   3.7193420132984047`*^9, 3.719342017142188*^9}, {3.71934205939254*^9, 
   3.7193420773770485`*^9}, {3.719342136955674*^9, 3.719342138049432*^9}, {
   3.7193681648018303`*^9, 3.719368173176901*^9}, {3.719527455024352*^9, 
   3.7195274572899857`*^9}, 3.719532877806651*^9, {3.71953406920368*^9, 
   3.7195340908132205`*^9}, {3.719534578192293*^9, 3.7195345875361395`*^9}, {
   3.7195350146959457`*^9, 3.7195350177740946`*^9}, {3.719535073212059*^9, 
   3.719535083040283*^9}, {3.719538699656804*^9, 3.71953871367253*^9}, {
   3.7195394699913564`*^9, 3.7195395088354425`*^9}, {3.719539617820729*^9, 
   3.7195396198519845`*^9}, {3.719539790994041*^9, 3.719539791556546*^9}, {
   3.719580101848796*^9, 3.7195802877409706`*^9}, {3.719582665665413*^9, 
   3.7195826739935927`*^9}, {3.7195828054946985`*^9, 3.71958280580721*^9}, 
   3.7195866734862647`*^9, {3.71958749528605*^9, 3.7195875097549257`*^9}, {
   3.719587924774023*^9, 3.719587953883644*^9}, {3.719588298902155*^9, 
   3.719588299636532*^9}, {3.7196070824326615`*^9, 3.719607089713972*^9}, 
   3.7196172491645374`*^9, {3.719617280914816*^9, 3.7196172986649647`*^9}, 
   3.7196175578390074`*^9, {3.719627185242922*^9, 3.719627227946419*^9}, {
   3.719627263868579*^9, 3.7196272737280474`*^9}, {3.719688420898662*^9, 
   3.7196884698834677`*^9}, {3.7196885193995457`*^9, 3.719688703416849*^9}, {
   3.719688794355194*^9, 3.7196887951364365`*^9}, {3.7198494489488697`*^9, 
   3.7198494517172585`*^9}, {3.7198497920920925`*^9, 3.719849792277722*^9}, {
   3.7200604815561523`*^9, 3.720060537728544*^9}, {3.7201344235403123`*^9, 
   3.7201344391966953`*^9}, {3.720140725935068*^9, 3.720140726231944*^9}, {
   3.720152892882126*^9, 3.7201528968352933`*^9}, {3.7201529344762745`*^9, 
   3.7201529548670936`*^9}, {3.7201530453054533`*^9, 
   3.7201530801182685`*^9}, {3.7201539522548265`*^9, 3.72015396648932*^9}, {
   3.7201549813114758`*^9, 3.72015504492146*^9}, {3.720155883308957*^9, 
   3.720155957497163*^9}, 3.720156380001193*^9, {3.7201564740645723`*^9, 
   3.720156541737091*^9}, {3.7201565950188465`*^9, 3.7201565980345*^9}, {
   3.7201566605038605`*^9, 3.720156702910513*^9}, {3.720157444253688*^9, 
   3.72015744606622*^9}, {3.720157879144577*^9, 3.7201578994103775`*^9}, {
   3.7201589578735776`*^9, 3.7201589580766897`*^9}, {3.7201627870765123`*^9, 
   3.720162844420806*^9}, {3.7201629217027736`*^9, 3.7201629250153217`*^9}, {
   3.720163182705271*^9, 3.720163249284028*^9}, {3.720163287784379*^9, 
   3.7201632928625517`*^9}, 3.720163324784746*^9, 3.720163424316925*^9, {
   3.7201635303335795`*^9, 3.720163532286702*^9}, 3.7201635877559953`*^9, {
   3.720195491022702*^9, 3.7201955291011887`*^9}, {3.7201955612577443`*^9, 
   3.7201955971487103`*^9}, {3.7201956951340156`*^9, 3.7201957145717125`*^9}, 
   3.7201957983537626`*^9, {3.7201959089641733`*^9, 3.7201959168548737`*^9}, {
   3.7201964791417327`*^9, 3.7201965571580973`*^9}, {3.7201966029554243`*^9, 
   3.7201966340182037`*^9}, {3.720196670081047*^9, 3.720196731175376*^9}, {
   3.720196777175813*^9, 3.720196779800838*^9}, {3.7201968324107313`*^9, 
   3.720196849379628*^9}, 3.7201970697410955`*^9, {3.7201993001543913`*^9, 
   3.720199309201352*^9}, {3.7201995037500753`*^9, 3.720199508718871*^9}, {
   3.7201997694088345`*^9, 3.720199774815152*^9}, 3.720199997817272*^9, {
   3.726424325808963*^9, 3.7264243615436335`*^9}, {3.726426838684843*^9, 
   3.726426840653288*^9}, {3.726426887068595*^9, 3.7264269476190395`*^9}, {
   3.726426985982113*^9, 3.726427045037635*^9}, {3.726427083746792*^9, 
   3.7264270867353716`*^9}, 3.7264273597253294`*^9, 3.7264277202355947`*^9, 
   3.726428847387982*^9, {3.7264293178738737`*^9, 3.726429363111005*^9}, {
   3.726493224334654*^9, 3.7264932612724624`*^9}, {3.7264940036837096`*^9, 
   3.726494087450034*^9}, {3.726494572829132*^9, 3.7264945941417894`*^9}, 
   3.7264959956447616`*^9, {3.7266764879035006`*^9, 3.7266764919660397`*^9}, {
   3.7306651378559794`*^9, 3.7306651760280824`*^9}, {3.7306655840593853`*^9, 
   3.73066558488752*^9}, {3.73067399206491*^9, 3.730674017033847*^9}, {
   3.7306740519260044`*^9, 3.7306740601760454`*^9}, {3.730674793260854*^9, 
   3.730674800885886*^9}, {3.730675451322533*^9, 3.7306754521037903`*^9}, {
   3.730675487135302*^9, 3.7306755679015884`*^9}, {3.7306756005947714`*^9, 
   3.730675603382348*^9}, 3.730675669184087*^9, {3.7306791070502825`*^9, 
   3.730679115159721*^9}, {3.730679158910071*^9, 3.7306791646288652`*^9}, {
   3.730679441156531*^9, 3.730679503828905*^9}, {3.7306796601582794`*^9, 
   3.7306796605489216`*^9}, {3.7306797648309746`*^9, 3.730679842628485*^9}, 
   3.7306804040520716`*^9, {3.730680450360489*^9, 3.7306804695481243`*^9}, {
   3.730691356157193*^9, 3.730691380407387*^9}, {3.7307252334204617`*^9, 
   3.7307252442173815`*^9}, {3.73101844263258*^9, 3.7310184637889986`*^9}, {
   3.7310187909947367`*^9, 3.731018796651032*^9}, {3.7310190936690273`*^9, 
   3.7310190946377983`*^9}, 3.7333317011410146`*^9, {3.737150640184734*^9, 
   3.7371506403409834`*^9}, {3.745333235602314*^9, 3.7453332412113266`*^9}, {
   3.7453333505878057`*^9, 3.7453333509627204`*^9}, {3.7453334841458025`*^9, 
   3.745333491395306*^9}, {3.745333555431038*^9, 3.7453335556028943`*^9}, {
   3.745333618145347*^9, 3.745333618489072*^9}, {3.7453337240568953`*^9, 
   3.74533373377501*^9}, {3.745334430202915*^9, 3.745334447061081*^9}, {
   3.7453359646961155`*^9, 3.7453359823823633`*^9}, {3.7453360514712267`*^9, 
   3.7453360555647035`*^9}, {3.745516438768465*^9, 3.745516439216441*^9}, {
   3.7609464074894733`*^9, 3.7609464138483744`*^9}, {3.760946490907714*^9, 
   3.7609465080002236`*^9}, {3.7609468400550547`*^9, 
   3.7609468705371127`*^9}, {3.7609469105493107`*^9, 3.76094693732857*^9}, {
   3.7614805840070295`*^9, 3.7614806066017723`*^9}, 3.761480959453441*^9, 
   3.761791134071992*^9, {3.769778521277241*^9, 3.769778584784967*^9}, {
   3.7697786534361615`*^9, 3.769778662357366*^9}, {3.769781425597082*^9, 
   3.769781491215057*^9}, {3.7697860063896017`*^9, 3.769786009186256*^9}, {
   3.7698129486383896`*^9, 3.7698130156492777`*^9}, {3.79113216630197*^9, 
   3.79113217094934*^9}, {3.791165680748521*^9, 3.791165681692232*^9}, {
   3.799716993566197*^9, 
   3.799716994200357*^9}},ExpressionUUID->"94cf90fa-ccef-4010-b4bd-\
3065495f3d67"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Recipes", "Section",
 CellChangeTimes->{{3.669631812504639*^9, 3.669631819769997*^9}, {
  3.6697210032317576`*^9, 3.6697210049036465`*^9}, {3.6697580388066244`*^9, 
  3.6697580398473396`*^9}, {3.6811438602412176`*^9, 3.681143862046855*^9}, {
  3.7191601507066483`*^9, 3.719160151769163*^9}, {3.719532050596613*^9, 
  3.719532052909133*^9}, {3.7197625471940784`*^9, 
  3.71976254799096*^9}},ExpressionUUID->"afcbee4a-2302-4677-867c-\
a5dcd9820ed7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blmfCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"F", ",", " ", "confun"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"F", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{
            "RigidBodyDynamics`Private`UpperTriangularizeAb", ",", " ", 
             "Ucon", ",", " ", "RigidBodyDynamics`Private`F"}], "}"}]}], ",", 
          " ", 
          RowBox[{"\"\<v\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"Pfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], 
            "}"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"F", " ", "=", " ", 
        RowBox[{"RBDMergeRecipes", "[", 
         RowBox[{"\"\<FMbJ\>\"", ",", " ", "F"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"F", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<f\>\"", "]"}], " ", "=", " ", "F"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blmhCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "H", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"H", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"\[Theta]0", ",", " ", "RigidBodyDynamics`Private`H"}], 
            "}"}]}], ",", " ", 
          RowBox[{"\"\<d\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
             "\[Alpha]\[Theta]", ",", " ", "_Integer", ",", " ", "1"}], "}"}],
             "}"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"H", " ", "=", " ", 
        RowBox[{"RBDMergeRecipes", "[", 
         RowBox[{"\"\<HMbJ\>\"", ",", " ", "H"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"H", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<h\>\"", "]"}], " ", "=", " ", "H"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Eta]0Con", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", "\[Eta]0", "}"}]}], ",", " ", 
          RowBox[{"\"\<v\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"B0fun", ",", " ", "_Real", ",", " ", "2"}], "}"}], 
            "}"}]}], ",", " ", 
          RowBox[{"\"\<d\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]0", ",", " ", "_Integer", ",", " ", "2"}], 
             "}"}], "}"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDMergeRecipes", "[", 
         RowBox[{"\"\<\[Eta]MbJ\>\"", ",", " ", "E"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Eta]0\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Eta]0\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Eta]TCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"<|", 
         RowBox[{
          RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", "\[Eta]T", "}"}]}], ",", " ", 
          RowBox[{"\"\<v\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"BTfun", ",", " ", "_Real", ",", " ", "2"}], "}"}], 
            "}"}]}], ",", " ", 
          RowBox[{"\"\<d\>\"", " ", "\[RuleDelayed]", " ", 
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]T", ",", " ", "_Integer", ",", " ", "2"}], 
             "}"}], "}"}]}]}], "|>"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDMergeRecipes", "[", 
         RowBox[{"\"\<\[Eta]MbJ\>\"", ",", " ", "E"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Eta]T\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Eta]T\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Eta]pCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDGetRecipe", "[", "\"\<\[Eta]MbJ\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Eta]p\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Eta]p\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Eta]vCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDGetRecipe", "[", "\"\<\[Eta]MbJ\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Eta]v\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Eta]v\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Eta]aCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDGetRecipe", "[", "\"\<\[Eta]MbJ\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Eta]a\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Eta]a\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Eta]dCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDGetRecipe", "[", "\"\<\[Eta]MbJ\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Eta]d\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Eta]d\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blmJpCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDMergeRecipes", "[", 
         RowBox[{"\"\<\[Eta]MbJ\>\"", ",", " ", 
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
             RowBox[{"{", "Jac", "}"}]}], ",", " ", 
            RowBox[{"\"\<d\>\"", " ", "\[RuleDelayed]", " ", 
             RowBox[{"{", 
              RowBox[{"{", 
               RowBox[{"\[Alpha]Jp", ",", " ", "_Integer", ",", " ", "2"}], 
               "}"}], "}"}]}]}], "|>"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<J[p]\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<J[p]\>\"", "]"}], " ", "=", " ", "E"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blmxTCon", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDGetRecipe", "[", "\"\<\[Eta]MbJ\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"E", " ", "=", " ", 
          RowBox[{"RBDMergeRecipes", "[", 
           RowBox[{"\"\<\[Eta]MbJ\>\"", ",", " ", 
            RowBox[{"<|", 
             RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
              RowBox[{"{", "xTTest", "}"}]}], "|>"}]}], "]"}]}], ";"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<xT\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<xT\>\"", "]"}], " ", "=", " ", "E"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blm\[Sigma]Con", "[", "cons_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "E", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"E", " ", "=", " ", 
        RowBox[{"RBDMergeRecipes", "[", 
         RowBox[{"\"\<\[Eta]MbJ\>\"", ",", " ", 
          RowBox[{"<|", 
           RowBox[{"\"\<f\>\"", " ", "\[RuleDelayed]", " ", 
            RowBox[{"{", "\[Sigma]", "}"}]}], "|>"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<name\>\"", "]"}], " ", "=", " ", 
        "\"\<\[Sigma]\>\""}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"E", "[", "\"\<C\>\"", "]"}], " ", "=", " ", "cons"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"con", "[", "\"\<\[Sigma]\>\"", "]"}], " ", "=", " ", 
        "E"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blmPCon", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<P\>\"", "]"}], " ", "=", " ", "cons"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blmB0Con", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<B0\>\"", "]"}], " ", "=", " ", "cons"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blmBTCon", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<BT\>\"", "]"}], " ", "=", " ", "cons"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blm\[Alpha]0Con", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<\[Alpha]0\>\"", "]"}], " ", "=", " ", "cons"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blm\[Alpha]TCon", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<\[Alpha]T\>\"", "]"}], " ", "=", " ", "cons"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blm\[Alpha]\[Theta]Con", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<\[Alpha]\[Theta]\>\"", "]"}], " ", "=", " ", 
    "cons"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blm\[Alpha]JpCon", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<\[Alpha]J[p]\>\"", "]"}], " ", "=", " ", 
    "cons"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blmDTCon", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<t\>\"", "]"}], " ", "=", " ", "cons"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7195298412187457`*^9, 3.7195300259546814`*^9}, {
   3.7195301558151484`*^9, 3.719530307300785*^9}, {3.7195304409893975`*^9, 
   3.7195304454581738`*^9}, {3.719530551037198*^9, 3.7195305891624994`*^9}, {
   3.719530622803423*^9, 3.719530636131655*^9}, {3.7195326811018696`*^9, 
   3.7195326817425165`*^9}, {3.7195328289156218`*^9, 
   3.7195328432751164`*^9}, {3.719532992620112*^9, 3.7195330144952984`*^9}, {
   3.7195330459955473`*^9, 3.7195330462299256`*^9}, {3.7195331114769144`*^9, 
   3.7195331225238714`*^9}, {3.7195332076183443`*^9, 
   3.7195332234934654`*^9}, {3.7195339019835153`*^9, 
   3.7195339186086693`*^9}, {3.719533964515303*^9, 3.7195339965780716`*^9}, {
   3.7195377307580614`*^9, 3.7195377415706525`*^9}, {3.719539431991037*^9, 
   3.7195394342566986`*^9}, {3.7195795586688185`*^9, 
   3.7195796578415227`*^9}, {3.7195796900136538`*^9, 3.71957969232619*^9}, {
   3.719579879268792*^9, 3.719579903722122*^9}, {3.719579937613031*^9, 
   3.7195799791133766`*^9}, {3.7195831363724575`*^9, 
   3.7195831366849766`*^9}, {3.719617515244913*^9, 3.7196175726672564`*^9}, {
   3.7196177221372395`*^9, 3.719617812013008*^9}, {3.7196178572789974`*^9, 
   3.7196178827479744`*^9}, 3.719618137281353*^9, {3.7196214572791147`*^9, 
   3.7196214978107023`*^9}, {3.7196890416699467`*^9, 3.719689070310837*^9}, {
   3.7196891021236105`*^9, 3.7196891099361935`*^9}, {3.7196891402646*^9, 
   3.719689177093045*^9}, 3.719689675193981*^9, {3.719715150805209*^9, 
   3.719715171383507*^9}, {3.720105169998018*^9, 3.7201051791543665`*^9}, {
   3.7201344502280617`*^9, 3.7201344590250087`*^9}, {3.720140713419339*^9, 
   3.720140720669391*^9}, {3.720154006177214*^9, 3.720154090131137*^9}, 
   3.720156385845*^9, 3.7201564313923063`*^9, 3.720156747504671*^9, {
   3.720156891623452*^9, 3.7201569182799387`*^9}, {3.720156962842862*^9, 
   3.7201569774836383`*^9}, {3.7201629464217587`*^9, 3.720162948937425*^9}, {
   3.720162990625305*^9, 3.720163012297397*^9}, {3.7202218372089806`*^9, 
   3.7202218433995404`*^9}, 3.720222226135738*^9, {3.720362334310906*^9, 
   3.72036234220162*^9}, {3.7209155086878185`*^9, 3.7209155087190704`*^9}, {
   3.7264239775173416`*^9, 3.726423981079872*^9}, {3.7264240550567503`*^9, 
   3.7264240622286854`*^9}, {3.72642439376267*^9, 3.7264243965126925`*^9}, {
   3.7264272797743635`*^9, 3.7264273080280085`*^9}, {3.7264273496127253`*^9, 
   3.726427353696379*^9}, 3.726428206553508*^9, {3.7306757423722153`*^9, 
   3.730675743372225*^9}, {3.730675788638211*^9, 3.730675859669983*^9}, {
   3.7310741140069723`*^9, 3.7310741164288764`*^9}, {3.7310741491836247`*^9, 
   3.7310741493711443`*^9}, {3.7332393803590717`*^9, 
   3.7332393949841547`*^9}, {3.7333320196803684`*^9, 3.733332024307872*^9}, {
   3.733391268336278*^9, 3.7333912685035954`*^9}, {3.74551527617677*^9, 
   3.7455153068308077`*^9}, {3.760946348103318*^9, 3.7609463840693436`*^9}, {
   3.7616525312871723`*^9, 3.761652533943215*^9}, {3.7697815058702326`*^9, 
   3.7697815059327283`*^9}, 3.769785879992505*^9, {3.791216441527092*^9, 
   3.791216452081184*^9}, {3.791216501573495*^9, 
   3.7912165017296267`*^9}},ExpressionUUID->"d586db29-4c3b-4681-a464-\
2385cc52f04e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"blmp", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<p\>\"", "]"}], " ", "=", " ", "cons"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blmcT", "[", "cons_", "]"}], " ", ":=", " ", 
   RowBox[{
    RowBox[{"con", "[", "\"\<cT\>\"", "]"}], " ", "=", " ", "cons"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7195298412187457`*^9, 3.7195300259546814`*^9}, {
   3.7195301558151484`*^9, 3.719530307300785*^9}, {3.7195304409893975`*^9, 
   3.7195304454581738`*^9}, {3.719530551037198*^9, 3.7195305891624994`*^9}, {
   3.719530622803423*^9, 3.719530636131655*^9}, {3.7195326811018696`*^9, 
   3.7195326817425165`*^9}, {3.7195328289156218`*^9, 
   3.7195328432751164`*^9}, {3.719532992620112*^9, 3.7195330144952984`*^9}, {
   3.7195330459955473`*^9, 3.7195330462299256`*^9}, {3.7195331114769144`*^9, 
   3.7195331225238714`*^9}, {3.7195332076183443`*^9, 
   3.7195332234934654`*^9}, {3.7195339019835153`*^9, 
   3.7195339186086693`*^9}, {3.719533964515303*^9, 3.7195339965780716`*^9}, {
   3.7195377307580614`*^9, 3.7195377415706525`*^9}, {3.719539431991037*^9, 
   3.7195394342566986`*^9}, {3.7195795586688185`*^9, 
   3.7195796578415227`*^9}, {3.7195796900136538`*^9, 3.71957969232619*^9}, {
   3.719579879268792*^9, 3.719579903722122*^9}, {3.719579937613031*^9, 
   3.7195799791133766`*^9}, {3.7195831363724575`*^9, 
   3.7195831366849766`*^9}, {3.719617515244913*^9, 3.7196175726672564`*^9}, {
   3.7196177221372395`*^9, 3.719617812013008*^9}, {3.7196178572789974`*^9, 
   3.7196178827479744`*^9}, 3.719618137281353*^9, {3.7196214572791147`*^9, 
   3.7196214978107023`*^9}, {3.7196890416699467`*^9, 3.719689070310837*^9}, {
   3.7196891021236105`*^9, 3.7196891099361935`*^9}, {3.7196891402646*^9, 
   3.719689177093045*^9}, 3.719689675193981*^9, {3.719715150805209*^9, 
   3.719715171383507*^9}, {3.719768291108984*^9, 3.7197683035309615`*^9}, {
   3.720105181560644*^9, 3.720105184810676*^9}, {3.7201343872118273`*^9, 
   3.720134393071272*^9}, {3.720140895749192*^9, 3.7201408963585625`*^9}, 
   3.720412596112371*^9, 3.7204126282064257`*^9, {3.7209155087190704`*^9, 
   3.7209155087190704`*^9}},ExpressionUUID->"e1bf1e0e-5b22-41c1-8aab-\
3a58687d67d1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",ExpressionUUID->"1d964aff-3d18-4ba8-81cc-221ea29e2078"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.591486801989799*^9, 
  3.5914868026208353`*^9}},ExpressionUUID->"a100829e-e148-4b7b-ad64-\
278794228295"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1505},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 2924, 58, 584, "Code",ExpressionUUID->"59f5aa58-c7ae-458c-ae67-8abe32970981",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[3507, 82, 160, 3, 95, "Section",ExpressionUUID->"04ab2fc5-9b64-4da9-9a70-e61022bce381"],
Cell[3670, 87, 2741, 42, 222, "Input",ExpressionUUID->"50144e8c-ac6c-42cd-a7b3-19a20c36fc82",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[6448, 134, 448, 6, 95, "Section",ExpressionUUID->"6a9e4002-07c0-457b-8a8f-34e1b23fd01c"],
Cell[6899, 142, 22233, 450, 2902, "Input",ExpressionUUID->"94cf90fa-ccef-4010-b4bd-3065495f3d67",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[29169, 597, 453, 7, 95, "Section",ExpressionUUID->"afcbee4a-2302-4677-867c-a5dcd9820ed7"],
Cell[29625, 606, 17235, 406, 3702, "Input",ExpressionUUID->"d586db29-4c3b-4681-a464-2385cc52f04e",
 InitializationCell->True],
Cell[46863, 1014, 2288, 40, 102, "Input",ExpressionUUID->"e1bf1e0e-5b22-41c1-8aab-3a58687d67d1",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[49188, 1059, 85, 0, 95, "Section",ExpressionUUID->"1d964aff-3d18-4ba8-81cc-221ea29e2078"],
Cell[49276, 1061, 267, 6, 102, "Input",ExpressionUUID->"a100829e-e148-4b7b-ad64-278794228295",
 InitializationCell->True]
}, Open  ]]
}
]
*)

