(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     86541,       1963]
NotebookOptionsPosition[     84136,       1908]
NotebookOutlinePosition[     84503,       1924]
CellTagsIndexPosition[     84460,       1921]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Begin Package", "Section",
 CellChangeTimes->{{3.5914870039053636`*^9, 
  3.591487004222381*^9}},ExpressionUUID->"39e9dbc5-5d7b-4441-82c6-\
0811eadac5b2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<BipedalLocomotion`Model`\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{
     "\"\<GlobalVariables`\>\"", ",", " ", "\"\<Derivatives`\>\"", ",", " ", 
      "\"\<RigidBodyDynamics`\>\"", ",", " ", "\"\<BipedalLocomotion`\>\"", 
      ",", " ", "\"\<HybridDynamics`\>\""}], "}"}]}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.5844197483839703`*^9, {3.5844250604318256`*^9, 3.5844250721475377`*^9}, {
   3.5844251233785*^9, 3.5844251234877005`*^9}, {3.5844253988774505`*^9, 
   3.5844254390946617`*^9}, {3.5844254919948354`*^9, 3.5844254990149255`*^9}, 
   3.584425543397398*^9, {3.584425574800518*^9, 3.584425581945394*^9}, {
   3.5844256737523947`*^9, 3.5844257230957055`*^9}, {3.5844279668250203`*^9, 
   3.5844279860756264`*^9}, {3.584428374816189*^9, 3.584428378919037*^9}, {
   3.5914865865694637`*^9, 3.591486626255737*^9}, {3.5914867823906765`*^9, 
   3.5914867827646985`*^9}, {3.591486817520689*^9, 3.5914868205858636`*^9}, {
   3.591486965884186*^9, 3.5914869664642324`*^9}, {3.5915022447717495`*^9, 
   3.5915022459698176`*^9}, {3.591542902441803*^9, 3.591542929051241*^9}, {
   3.59154329988008*^9, 3.591543327692632*^9}, 3.5915439898189273`*^9, {
   3.5915443331789765`*^9, 3.5915443348977413`*^9}, {3.591544409656703*^9, 
   3.591544412687962*^9}, {3.591721260928192*^9, 3.591721326772053*^9}, {
   3.5922422663532963`*^9, 3.592242267056429*^9}, {3.5922818277082567`*^9, 
   3.59228183637475*^9}, {3.593367625062662*^9, 3.5933676251720285`*^9}, {
   3.704468357519539*^9, 3.704468459841198*^9}, {3.7044685529026203`*^9, 
   3.704468620873731*^9}, {3.7044692938575964`*^9, 3.704469294201355*^9}, {
   3.7044693718565884`*^9, 3.7044694237922263`*^9}, 3.7044696047095137`*^9, {
   3.704469723121451*^9, 3.7044697494763565`*^9}, {3.7044713775105753`*^9, 
   3.7044713779682055`*^9}, {3.71007627184459*^9, 3.7100763129700594`*^9}, {
   3.710085252492481*^9, 3.710085269273345*^9}, {3.710085701211694*^9, 
   3.710085704820245*^9}, {3.71008573624848*^9, 3.7100857468419538`*^9}, {
   3.7100858618232365`*^9, 3.710085866727702*^9}, {3.710085919261855*^9, 
   3.7100859355283422`*^9}, {3.7100860101270795`*^9, 3.710086010815563*^9}, {
   3.7100862247653303`*^9, 3.7100862253687563`*^9}, {3.7100876279638534`*^9, 
   3.7100876368821716`*^9}, {3.710247193222289*^9, 3.710247196972357*^9}, {
   3.710249077736276*^9, 3.710249078486265*^9}, {3.719112887775036*^9, 
   3.719112914478425*^9}, {3.719112998854257*^9, 3.719113000323023*^9}, {
   3.7191136395085473`*^9, 3.719113649164892*^9}, 3.719114879496228*^9, {
   3.7192011247884035`*^9, 3.7192011277727957`*^9}, {3.7192296580574007`*^9, 
   3.719229673151224*^9}, {3.7192816589156504`*^9, 3.7192816633531713`*^9}, {
   3.7193169534786367`*^9, 3.719316953853657*^9}, {3.719336319403597*^9, 
   3.719336334153718*^9}, {3.7193364584516335`*^9, 3.719336463561051*^9}, {
   3.71950185152522*^9, 3.719501861181549*^9}, {3.7195019833075695`*^9, 
   3.7195020203343954`*^9}, {3.719530068564412*^9, 3.7195300955490136`*^9}, {
   3.7195306954134054`*^9, 3.719530696085286*^9}, {3.719597904783529*^9, 
   3.7195979049866543`*^9}, {3.7196226085231285`*^9, 
   3.7196226091324964`*^9}, {3.7196227964365115`*^9, 
   3.7196228051084423`*^9}, {3.7197626459998045`*^9, 
   3.7197626746250496`*^9}, {3.719763675144528*^9, 3.7197637064071875`*^9}, {
   3.7197637914235907`*^9, 3.719763805376841*^9}, {3.7197640585666513`*^9, 
   3.719764059097907*^9}, {3.7201058143322835`*^9, 3.720105814676036*^9}, {
   3.7201150733708487`*^9, 3.72011509416792*^9}, 3.7201163713861895`*^9, {
   3.720204772026026*^9, 3.7202047855886374`*^9}, 3.720204829948434*^9, {
   3.720205327463756*^9, 3.720205337276333*^9}, 3.7202054013394423`*^9, {
   3.7204085125413747`*^9, 3.7204085151820154`*^9}, {3.7204087023556695`*^9, 
   3.7204087127464094`*^9}, {3.7209170877947655`*^9, 3.720917118326327*^9}, {
   3.7222535967297506`*^9, 3.722253606964246*^9}, 3.7222548193882217`*^9, {
   3.730464488406597*^9, 3.7304644919847593`*^9}, {3.730464703240232*^9, 
   3.7304647055058794`*^9}, {3.7306345171980762`*^9, 
   3.7306345226981273`*^9}, {3.730635092666782*^9, 3.730635095713682*^9}, {
   3.7306451553201303`*^9, 3.730645161382688*^9}, {3.7307254342099323`*^9, 
   3.7307254419755917`*^9}, {3.731005895607005*^9, 3.73100589876328*^9}, {
   3.731083787678485*^9, 3.73108379236596*^9}, {3.731159130440482*^9, 
   3.731159130659233*^9}, {3.7312252702308226`*^9, 3.7312252710902205`*^9}, {
   3.7315023485039034`*^9, 3.7315023498946047`*^9}},
 CellLabel->
  "In[1014]:=",ExpressionUUID->"2b48c04c-aed4-40f4-8f8c-f7daa783cbb0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pick a side", "Section",
 CellChangeTimes->{{3.684678566296839*^9, 3.684678566812415*^9}, {
  3.684678602969049*^9, 3.6846786252973766`*^9}, {3.6846787712362127`*^9, 
  3.6846787718768377`*^9}, {3.6846794135590725`*^9, 3.6846794243138685`*^9}, {
  3.710321447247677*^9, 3.710321456810295*^9}, {3.719316306771861*^9, 
  3.719316307803119*^9}, {3.7439544742889366`*^9, 
  3.743954475632575*^9}},ExpressionUUID->"c6d4db97-53c6-4902-801c-\
71424e600f67"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BLSide", "[", 
    RowBox[{"s_", ",", " ", 
     RowBox[{"f_:", "Automatic"}], ",", " ", 
     RowBox[{"i_:", "All"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "F", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"F", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"f", " ", "===", " ", "Automatic"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"\"\<left\>\"", ",", " ", "\"\<right\>\""}], "}"}], ",", 
         " ", "f"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"StringContainsQ", "[", 
          RowBox[{"s", ",", " ", "\"\<left\>\"", ",", " ", 
           RowBox[{"IgnoreCase", "\[Rule]", "True"}]}], "]"}], ",", " ", "F", 
         ",", " ", 
         RowBox[{"Reverse", "@", "F"}]}], "]"}], "\[LeftDoubleBracket]", "i", 
       "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.743954398778734*^9, 3.7439544655083203`*^9}, {
  3.7439546161033664`*^9, 3.7439547014253597`*^9}},
 CellLabel->
  "In[1016]:=",ExpressionUUID->"d7ddfa87-56c8-4d4b-b412-8c7c9adb0336"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fix angles and impact map coordinate system", "Section",
 CellChangeTimes->{{3.684678566296839*^9, 3.684678566812415*^9}, {
  3.684678602969049*^9, 3.6846786252973766`*^9}, {3.6846787712362127`*^9, 
  3.6846787718768377`*^9}, {3.6846794135590725`*^9, 3.6846794243138685`*^9}, {
  3.710321447247677*^9, 3.710321456810295*^9}, {3.719316306771861*^9, 
  3.719316307803119*^9}},ExpressionUUID->"4e4f3495-7405-44bd-b231-\
44032f82e8c3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{" ", 
    RowBox[{"a", " ", "=", " ", 
     RowBox[{
      RowBox[{"2", "\[Pi]"}], " ", "=", 
      RowBox[{
       RowBox[{">", " ", "\[Theta]"}], " ", "\[Element]", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "pi"}], " ", "pi"}]}]}]}]}], "]"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetAttributes", "[", 
     RowBox[{"BLAngle", ",", " ", "Listable"}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BLAngle", "[", 
      RowBox[{"q_", ",", " ", 
       RowBox[{"a_:", "2", "\[Pi]"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", " ", "=", " ", 
         RowBox[{"Mod", "[", 
          RowBox[{"q", ",", " ", "a"}], "]"}]}], "}"}], ",", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"x", ">", "\[Pi]"}], ",", " ", 
         RowBox[{"x", " ", "-", " ", "a"}], ",", " ", "x"}], "]"}]}], "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BLSetAngles", "[", 
      RowBox[{"r_:", 
       RowBox[{"{", 
        RowBox[{
        "\"\<rx\>\"", ",", " ", "\"\<ry\>\"", ",", " ", "\"\<rz\>\""}], 
        "}"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", " ", "f", ",", " ", "n"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"angles", " ", "=", " ", 
         RowBox[{"BLIndices", "[", 
          RowBox[{"\"\<\>\"", ",", " ", "r"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "get", " ", "all", " ", "reduced", " ", "space", " ", "variables"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"m", " ", "=", " ", 
         RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "has", " ", "BLCreateContinuationParametes", " ", "been", " ", 
          RowBox[{"called", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"angs", " ", "=", " ", 
         RowBox[{"RBDGetValue", "[", 
          RowBox[{
           RowBox[{"BLbiped", "[", 
            RowBox[{"\"\<c\>\"", ",", " ", "m", ",", " ", "\"\<x\>\""}], 
            "]"}], ",", " ", 
           RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "True"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "keep", " ", "angles", " ", "in", " ", "reduced", " ", "space"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"n", " ", "=", " ", 
         RowBox[{"Range", "@", 
          RowBox[{"Length", "@", "angs"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"f", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", 
             RowBox[{
             "angs", "\[LeftDoubleBracket]", "#", "\[RightDoubleBracket]"}], 
             "]"}], " ", "===", " ", "\[DoubleStruckQ]"}], " ", "&&", " ", 
           RowBox[{"StringContainsQ", "[", 
            RowBox[{
             RowBox[{"angs", "\[LeftDoubleBracket]", 
              RowBox[{"#", ",", " ", "2"}], "\[RightDoubleBracket]"}], ",", 
             " ", "r"}], "]"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"angs", " ", "=", " ", 
         RowBox[{"Transpose", "@", 
          RowBox[{"List", "@", 
           RowBox[{"Select", "[", 
            RowBox[{"n", ",", " ", "f"}], "]"}]}]}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "BLState", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{"\"\<a\>\"", " ", "\[Rule]", " ", "True"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"BLState", "[", 
      RowBox[{"x_", ",", " ", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "\"\<a\>\"", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"assume", " ", "reduced", " ", "coordinates"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"MapAt", "[", 
        RowBox[{"BLAngle", ",", " ", "x", ",", " ", "angs"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"else", " ", "full", " ", "coordinates"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"MapAt", "[", 
        RowBox[{"BLAngle", ",", " ", "x", ",", " ", "angles"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.707735390469975*^9, 3.707735391501251*^9}, {
   3.7077354391396484`*^9, 3.7077356633133*^9}, {3.70773586581739*^9, 
   3.7077359460211563`*^9}, {3.70773619524051*^9, 3.7077363156334686`*^9}, {
   3.7077363499266586`*^9, 3.7077363632300444`*^9}, {3.707736491760619*^9, 
   3.7077365504510207`*^9}, {3.707736823907444*^9, 3.7077368240949435`*^9}, {
   3.707738853337065*^9, 3.707738881149785*^9}, {3.707738990713166*^9, 
   3.7077390878076735`*^9}, {3.707739120432948*^9, 3.7077391258861017`*^9}, {
   3.7077391566363606`*^9, 3.7077391879022226`*^9}, {3.707739250410734*^9, 
   3.7077392533347797`*^9}, {3.707742927596059*^9, 3.7077429282367077`*^9}, {
   3.7077432116132393`*^9, 3.7077432507854424`*^9}, {3.7077433323173394`*^9, 
   3.707743334661112*^9}, {3.707743385583376*^9, 3.7077434234586797`*^9}, {
   3.7077434643652554`*^9, 3.7077435558816237`*^9}, {3.7077437807584224`*^9, 
   3.707743948041005*^9}, {3.7077441061360207`*^9, 3.70774410624539*^9}, 
   3.707744141808181*^9, {3.7077449063508587`*^9, 3.707745114727527*^9}, {
   3.7077452141319885`*^9, 3.7077452931951194`*^9}, {3.707745325726636*^9, 
   3.7077453349454594`*^9}, {3.707746753137072*^9, 3.7077467845123096`*^9}, {
   3.7077468310908003`*^9, 3.7077468664660964`*^9}, {3.7077469625293703`*^9, 
   3.707747027951766*^9}, {3.707747064670809*^9, 3.707747079358425*^9}, {
   3.7077471097961683`*^9, 3.707747136749505*^9}, {3.707747300297673*^9, 
   3.7077473453574724`*^9}, {3.7077473772014685`*^9, 
   3.7077473946859846`*^9}, {3.707747534468351*^9, 3.707747537390254*^9}, {
   3.7077476073439302`*^9, 3.707747625781584*^9}, {3.707747694219612*^9, 
   3.707747771642118*^9}, {3.7077478627678494`*^9, 3.7077479118932257`*^9}, {
   3.7077479853157043`*^9, 3.707747986362588*^9}, {3.707748032691081*^9, 
   3.7077482120049973`*^9}, {3.7077485162898035`*^9, 3.707748805811531*^9}, {
   3.7077488650932617`*^9, 3.707748883187148*^9}, {3.707748982922309*^9, 
   3.7077490691104994`*^9}, {3.7077492594245167`*^9, 
   3.7077493006279874`*^9}, {3.707749354065914*^9, 3.7077493867224236`*^9}, {
   3.707749846976093*^9, 3.7077498507417526`*^9}, {3.7077513455779567`*^9, 
   3.707751371765661*^9}, {3.707751436141163*^9, 3.7077514833134146`*^9}, {
   3.7077515387044997`*^9, 3.707751554923377*^9}, {3.7077515893767776`*^9, 
   3.707751640961842*^9}, {3.70775197088636*^9, 3.7077519767926507`*^9}, {
   3.707752061387086*^9, 3.7077520622308297`*^9}, {3.7077520932467155`*^9, 
   3.707752111981246*^9}, {3.7077521449281197`*^9, 3.7077521462093782`*^9}, {
   3.707752218837871*^9, 3.7077522716976624`*^9}, {3.7077524985744605`*^9, 
   3.70775251441835*^9}, 3.707752555043662*^9, {3.7077525874814386`*^9, 
   3.7077526804978056`*^9}, {3.707755281259742*^9, 3.707755294228595*^9}, {
   3.7077555192227135`*^9, 3.707755545706338*^9}, {3.707755587418268*^9, 
   3.707755606246545*^9}, {3.7077556669188995`*^9, 3.7077557274349957`*^9}, 
   3.7077557680945597`*^9, {3.70775581187906*^9, 3.707755853129384*^9}, {
   3.7077559397394586`*^9, 3.707756076506157*^9}, {3.707756132553489*^9, 
   3.7077561679287777`*^9}, {3.707756236824436*^9, 3.7077563369033594`*^9}, {
   3.7077564011851172`*^9, 3.7077564674043837`*^9}, {3.7077564997015285`*^9, 
   3.7077566205931234`*^9}, {3.7077567135313644`*^9, 
   3.7077567476722574`*^9}, {3.707756838344863*^9, 3.707756845313649*^9}, {
   3.7077569068297806`*^9, 3.707756976814699*^9}, {3.7077571268343487`*^9, 
   3.707757136022458*^9}, {3.7077575815353036`*^9, 3.7077576546603394`*^9}, {
   3.70775773817663*^9, 3.7077577386922474`*^9}, {3.707757933256313*^9, 
   3.70775794689705*^9}, {3.7077589121843967`*^9, 3.707758912825035*^9}, {
   3.707954293244898*^9, 3.707954313543235*^9}, {3.7079545231971254`*^9, 
   3.7079545234502993`*^9}, 3.707989030224156*^9, {3.7081003252204103`*^9, 
   3.7081003303830366`*^9}, {3.7081004254821205`*^9, 3.708100436704052*^9}, 
   3.708100523787467*^9, 3.708102309633274*^9, {3.708104295137659*^9, 
   3.7081042993366213`*^9}, 3.7081820251632686`*^9, {3.708182483562975*^9, 
   3.708182485281766*^9}, {3.708182889464712*^9, 3.7081828933710546`*^9}, {
   3.70899532153708*^9, 3.7089953318253207`*^9}, {3.7090355277225437`*^9, 
   3.7090355282709417`*^9}, {3.7090373884143686`*^9, 
   3.7090373887576194`*^9}, {3.7090428012541475`*^9, 3.709042810957988*^9}, {
   3.7090429847064753`*^9, 3.7090429912461023`*^9}, {3.7090430376608257`*^9, 
   3.7090430443705406`*^9}, 3.709043078855854*^9, {3.7090440291540527`*^9, 
   3.7090440340134916`*^9}, {3.709044082734831*^9, 3.7090441214991603`*^9}, {
   3.7090441556162148`*^9, 3.7090442012403917`*^9}, {3.7090442399226685`*^9, 
   3.7090442731571007`*^9}, {3.7090505308495226`*^9, 
   3.7090505941211157`*^9}, {3.709050706844605*^9, 3.709050859541257*^9}, {
   3.7090508933901205`*^9, 3.7090510867879114`*^9}, {3.7090511518707986`*^9, 
   3.709051220861856*^9}, {3.7188482671982765`*^9, 3.718848273807702*^9}, {
   3.7193157335654926`*^9, 3.7193157339248714`*^9}, {3.7193157657538223`*^9, 
   3.7193157661756845`*^9}, 3.719316287287339*^9, {3.719316740320621*^9, 
   3.7193168118368263`*^9}, {3.7193168823842916`*^9, 
   3.7193168987594275`*^9}, {3.720204513054796*^9, 3.7202045133047996`*^9}, {
   3.7202045809773183`*^9, 3.7202046307590404`*^9}, {3.7202052314784684`*^9, 
   3.7202053394013553`*^9}, 3.7202054013550673`*^9, 3.7202056220919895`*^9, {
   3.722253614667419*^9, 3.7222536453864613`*^9}, {3.7222536918385015`*^9, 
   3.7222537007604475`*^9}, {3.7308084036610603`*^9, 3.730808502568099*^9}, 
   3.730808546459107*^9, {3.7308087873672647`*^9, 3.730808791726719*^9}, {
   3.731005998025755*^9, 3.7310060078852*^9}, {3.731083183657628*^9, 
   3.7310832671201363`*^9}, {3.7310833187652445`*^9, 
   3.7310833565780773`*^9}, {3.7310833966123667`*^9, 3.731083417768783*^9}, 
   3.73108388633969*^9, {3.731084321289375*^9, 3.731084401802849*^9}, {
   3.731084621947063*^9, 3.7310846534259653`*^9}, {3.733102636896511*^9, 
   3.7331026427403154`*^9}},
 CellLabel->
  "In[1017]:=",ExpressionUUID->"c6e2239b-4b6c-4ccb-8e34-a1a3bc10ef55"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Feet at pre- and post-impacts", "Section",
 CellChangeTimes->{{3.684678566296839*^9, 3.684678566812415*^9}, {
  3.684678602969049*^9, 3.6846786252973766`*^9}, {3.6846787712362127`*^9, 
  3.6846787718768377`*^9}, {3.6846794135590725`*^9, 3.6846794243138685`*^9}, {
  3.710321447247677*^9, 3.710321456810295*^9}, {3.719316306771861*^9, 
  3.719316307803119*^9}, {3.730464526547578*^9, 
  3.730464530813252*^9}},ExpressionUUID->"d21fd076-bbf3-45c2-9ef6-\
c220c5969dbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BLGetBipedBase", "[", 
    RowBox[{"base_:", "Automatic"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", " ", "b"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"b", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"VectorQ", "[", "base", "]"}], ",", " ", 
         RowBox[{
         "base", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
         " ", "base"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"b", " ", "===", " ", "Automatic"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"b", " ", "=", " ", 
          RowBox[{"KeyDrop", "[", 
           RowBox[{
            RowBox[{"RBDGetLinkInfo", "[", "\"\<p\>\"", "]"}], ",", " ", 
            "\"\<\[Theta]\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"b", " ", "=", " ", 
          RowBox[{"First", "@", 
           RowBox[{"Keys", "@", 
            RowBox[{"Select", "[", 
             RowBox[{"b", ",", " ", 
              RowBox[{
               RowBox[{"#", " ", "===", " ", "Root"}], "&"}]}], "]"}]}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"VectorQ", "[", "base", "]"}], ",", " ", 
           RowBox[{"b", " ", "=", " ", 
            RowBox[{"Prepend", "[", 
             RowBox[{
              RowBox[{"base", "\[LeftDoubleBracket]", 
               RowBox[{"2", ";;"}], "\[RightDoubleBracket]"}], ",", " ", 
              "b"}], "]"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "b"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellLabel->
  "In[1022]:=",ExpressionUUID->"4de0103b-35a6-432d-a8b7-a15315b43b61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLFeet", "[", 
     RowBox[{"feet_", ",", " ", "Automatic"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "d", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", " ", "=", " ", 
        RowBox[{
         RowBox[{"BLValues", "[", 
          RowBox[{
           RowBox[{"BLGetBipedBase", "[", "]"}], ",", " ", "\"\<p\>\""}], 
          "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "2"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"d", " ", "=", " ", 
        RowBox[{"d", " ", "/.", " ", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "\"\<px\>\"", ",", " ", "\"\<py\>\"", ",", " ", "\"\<pz\>\""}], 
            "}"}], "\[Rule]", " ", 
           RowBox[{"Range", "[", 
            RowBox[{
             RowBox[{"mm", "+", "1"}], ",", " ", "nm"}], "]"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"BLFeet", "[", 
        RowBox[{"feet", ",", " ", "d"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLFeet", "[", 
    RowBox[{"feet_", ",", " ", "2"}], "]"}], " ", ":=", " ", 
   RowBox[{"BLFeet", "[", 
    RowBox[{"feet", ",", " ", 
     RowBox[{"Range", "[", 
      RowBox[{
       RowBox[{"mm", "+", "1"}], ",", " ", 
       RowBox[{"nm", "-", "1"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLFeet", "[", 
     RowBox[{"feet_", ",", " ", "3"}], "]"}], " ", ":=", " ", 
    RowBox[{"BLFeet", "[", 
     RowBox[{"feet", ",", " ", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"mm", "+", "1"}], ",", " ", "nm"}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLFeet", "[", 
     RowBox[{"feet_", ",", " ", "dof_"}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"f", ",", " ", "b", ",", " ", "d"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Which", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"feet", " ", "===", " ", 
          RowBox[{"{", "}"}]}], ",", " ", 
         RowBox[{"Return", "@", 
          RowBox[{"<|", "|>"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"StringQ", "[", 
          RowBox[{
          "feet", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}], ",", " ", 
         RowBox[{
          RowBox[{"f", " ", "=", " ", 
           RowBox[{"{", "feet", "}"}]}], ";"}], ",", " ", 
         "\[IndentingNewLine]", "True", ",", " ", 
         RowBox[{
          RowBox[{"f", " ", "=", " ", "feet"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\[DoubleStruckB]", "[", 
           RowBox[{
            RowBox[{
            "i", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
            " ", "j", ",", " ", 
            RowBox[{
            "i", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "f"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"j", ",", " ", "dof"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"i", " ", "\[Rule]", " ", 
           RowBox[{
           "b", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], ",",
           " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", 
            RowBox[{"Length", "@", "b"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"<|", 
        RowBox[{"Prepend", "[", 
         RowBox[{"b", ",", " ", 
          RowBox[{"\"\<f\>\"", " ", "\[Rule]", " ", "f"}]}], "]"}], 
        "|>"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BLGetFootFalls", "[", "\[CurlyPhi]_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "xpre", ",", " ", "xpost", ",", " ", "x", ",", " ", "c", ",", " ", "f", 
       ",", " ", "p", ",", " ", "a", ",", " ", "b"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"c", ",", " ", "xpre", ",", " ", "xpost"}], "}"}], " ", "=", 
       " ", 
       RowBox[{"Values", "@", 
        RowBox[{"\[CurlyPhi]", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "\"\<c\>\"", ",", " ", "\"\<x-\>\"", ",", " ", "\"\<x+\>\""}], 
           "}"}], ",", " ", 
          RowBox[{"2", ";;"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "c"}], " ", "\[LessEqual]", " ", "1"}], " ", 
         "||", " ", 
         RowBox[{
          RowBox[{"Length", "@", "xpre"}], " ", "\[LessEqual]", " ", "1"}], 
         " ", "||", " ", 
         RowBox[{
          RowBox[{"Length", "@", "xpost"}], " ", "\[LessEqual]", " ", "1"}]}],
         ",", " ", 
        RowBox[{"Return", "@", 
         RowBox[{"{", "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", " ", 
         RowBox[{"{", 
          RowBox[{"xpost", ",", " ", 
           RowBox[{"xpre", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;"}], "\[RightDoubleBracket]"}]}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"BLbiped", "[", "\"\<feet\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"p", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"x0", " ", "=", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"6", "D", " ", "foot", " ", "location"}], ",", " ", 
               RowBox[{"6", "D", " ", "foot", " ", "location"}]}], "}"}]}], 
            ",", " ", "xf"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"x0", ",", " ", "xf"}], "}"}], ",", " ", "...", ","}], " ",
          "}"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"p", " ", "=", " ", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"RBDSpatialPosition", "[", 
          RowBox[{
           RowBox[{"f", "\[LeftDoubleBracket]", 
            RowBox[{"k", ",", " ", "2"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"f", "\[LeftDoubleBracket]", 
            RowBox[{"k", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
           RowBox[{"\"\<x\>\"", " ", "\[Rule]", " ", 
            RowBox[{"x", "\[LeftDoubleBracket]", 
             RowBox[{"i", ",", " ", "j"}], "\[RightDoubleBracket]"}]}], ",", 
           " ", 
           RowBox[{"\"\<\[Lambda]\>\"", " ", "\[Rule]", " ", 
            RowBox[{
            "c", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", 
           RowBox[{"Length", "@", "c"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"j", ",", " ", 
           RowBox[{"Length", "@", 
            RowBox[{
            "x", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
          "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"k", ",", " ", 
           RowBox[{"Length", "@", "f"}]}], "}"}]}], "\[IndentingNewLine]", 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"order", " ", "p", " ", 
         RowBox[{"s", ".", "t", ".", " ", 
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", " ", "k"}], "\[RightDoubleBracket]"}]}]}], " ", 
        "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"stance", " ", "foot"}], ",", " ", 
          RowBox[{"swing", " ", "foot"}]}], "}"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{
        RowBox[{"First", "@", 
         RowBox[{"Ordering", "[", 
          RowBox[{"(", 
           RowBox[{"Norm", " ", "/@", " ", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"#1", "-", "#2"}], ",", " ", 
              RowBox[{
               RowBox[{"Reverse", "@", "#1"}], " ", "-", " ", "#2"}]}], 
             "]"}]}], ")"}], "]"}]}], "&"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"a", " ", "=", " ", 
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"b", " ", "=", " ", 
          RowBox[{"p", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", " ", "2"}], "\[RightDoubleBracket]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Switch", "[", 
          RowBox[{
           RowBox[{"f", "[", 
            RowBox[{"a", ",", " ", "b"}], "]"}], ",", "\[IndentingNewLine]", 
           "1", ",", " ", 
           RowBox[{"{", 
            RowBox[{"a", ",", " ", "b"}], "}"}], ",", "\[IndentingNewLine]", 
           "2", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Reverse", "@", "a"}], ",", " ", 
             RowBox[{"Reverse", "@", "b"}]}], "}"}], ",", 
           "\[IndentingNewLine]", "3", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Reverse", "@", "a"}], ",", " ", "b"}], "}"}], ",", 
           "\[IndentingNewLine]", "4", ",", " ", 
           RowBox[{"{", 
            RowBox[{"a", ",", " ", 
             RowBox[{"Reverse", "@", "b"}]}], "}"}]}], "\[IndentingNewLine]", 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", 
          RowBox[{"Length", "@", "p"}]}], "}"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7304644684688835`*^9, 3.730464468671981*^9}, {
   3.7307255646640873`*^9, 3.7307255994144087`*^9}, {3.730725709993372*^9, 
   3.7307257859158535`*^9}, {3.7307264806714053`*^9, 3.730726530937426*^9}, {
   3.730726595984816*^9, 3.7307265997661448`*^9}, {3.7307267004075413`*^9, 
   3.7307267895488796`*^9}, {3.730909102674181*^9, 3.730909105752328*^9}, {
   3.7309091521745596`*^9, 3.7309092568703394`*^9}, {3.7309118717832127`*^9, 
   3.730911924967254*^9}, {3.730912171486799*^9, 3.730912183582918*^9}, {
   3.730912265185977*^9, 3.7309122656859927`*^9}, {3.7309123985541315`*^9, 
   3.7309125229943695`*^9}, {3.7309200747696066`*^9, 
   3.7309200908009863`*^9}, {3.730926058615965*^9, 3.7309261722731333`*^9}, {
   3.7311583364383073`*^9, 3.7311583825011435`*^9}, {3.7311586122079988`*^9, 
   3.7311586390988336`*^9}, {3.731158719005725*^9, 3.7311587231307707`*^9}, {
   3.731158763224887*^9, 3.7311587777405677`*^9}, {3.7311588203714046`*^9, 
   3.7311589625444155`*^9}, 3.731159237078665*^9, {3.731189648463704*^9, 
   3.731189649307428*^9}, {3.7330108120167723`*^9, 3.7330108643287168`*^9}, 
   3.733011171455638*^9, {3.7330112021033525`*^9, 3.733011255696865*^9}, {
   3.7330113027238307`*^9, 3.733011343254224*^9}, {3.7330115138128033`*^9, 
   3.7330115627763567`*^9}, {3.7330117786299534`*^9, 3.733011789182721*^9}, {
   3.7330118593190184`*^9, 3.7330118900144424`*^9}, {3.733012099307073*^9, 
   3.7330121091335106`*^9}, {3.7331013146705866`*^9, 
   3.7331013278738356`*^9}, {3.733246261127*^9, 3.7332463068149185`*^9}},
 CellLabel->
  "In[1023]:=",ExpressionUUID->"afa50212-b452-4158-8ab9-4892bcbb14ee"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Options", "[", "BLLinks", "]"}], " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<b\>\"", " ", "\[RuleDelayed]", " ", 
       RowBox[{"RBDLinks", "[", "]"}]}], ",", " ", 
      RowBox[{"\"\<i\>\"", " ", "\[Rule]", " ", "False"}], ",", " ", 
      RowBox[{"Not", " ", "\[Rule]", " ", "False"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLLinks", "[", 
     RowBox[{"form_", ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"b", ",", " ", "i", ",", " ", "f"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<b\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "Not", "]"}], ",", " ", "StringFreeQ", 
          ",", " ", "StringContainsQ"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"i", " ", "=", " ", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{"Range", "@", 
           RowBox[{"Length", "@", "b"}]}], ",", " ", 
          RowBox[{
           RowBox[{"f", "[", 
            RowBox[{
             RowBox[{"b", "\[LeftDoubleBracket]", 
              RowBox[{"#", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", 
             " ", "form"}], "]"}], "&"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"return", " ", "indices", " ", "or", " ", 
         RowBox[{"sublist", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "\"\<i\>\"", "]"}], ",", " ", "i", ",", 
         " ", 
         RowBox[{
         "b", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BLValues", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<n\>\"", " ", "\[Rule]", " ", "\[DoubleStruckQ]"}], ",", " ", 
     RowBox[{"BLLinks", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"Not", " ", "\[Rule]", " ", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLValues", "[", 
     RowBox[{"fb_", ",", " ", 
      RowBox[{"fd_:", "\"\<\>\""}], ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"q", ",", " ", "n", ",", " ", "b", ",", " ", "f"}], "}"}], ",",
       " ", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "get", " ", "links", " ", "that", " ", "match", " ", "form", " ", 
        "fb"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"b", " ", "=", " ", 
        RowBox[{"BLLinks", "[", 
         RowBox[{"fb", ",", " ", 
          RowBox[{"OptionValue", "[", "BLLinks", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"get", " ", "string", " ", "name", " ", "for", " ", "dof"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"RBDGetDOF", "[", 
            RowBox[{"\[DoubleStruckQ]", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", " ", "Values"}], "]"}], "]"}], "&"}], " ", "/@", " ", 
          "b"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "get", " ", "dofs", " ", "that", " ", "match", " ", "form", " ", 
         "fd"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"OptionValue", "[", "Not", "]"}], ",", " ", "StringFreeQ", 
          ",", " ", "StringContainsQ"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"q", " ", "=", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{"q", ",", " ", 
          RowBox[{
           RowBox[{"\[DoubleStruckQ]", "[", 
            RowBox[{"_", ",", " ", "n_"}], "]"}], " ", "/;", " ", 
           RowBox[{"f", "[", 
            RowBox[{"n", ",", " ", "fd"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"change", " ", "head"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<n\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"VectorQ", "[", "n", "]"}], ",", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"q", " ", "/.", " ", 
             RowBox[{"\[DoubleStruckQ]", " ", "\[Rule]", " ", "#"}]}], "&"}], 
           " ", "/@", " ", "n"}], "]"}], ",", " ", 
         RowBox[{"q", " ", "/.", " ", 
          RowBox[{"\[DoubleStruckQ]", " ", "\[Rule]", " ", "n"}]}]}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BLIndices", "[", 
   RowBox[{"fb_", ",", " ", 
    RowBox[{"fd_:", "\"\<\>\""}], ",", " ", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
  RowBox[{"RBDGetIndex", "@", 
   RowBox[{"BLValues", "[", 
    RowBox[{"fb", ",", " ", "fd", ",", " ", "opts"}], "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7306339732407923`*^9, 3.730634030663166*^9}, {
   3.7306340816635084`*^9, 3.7306341223513193`*^9}, 3.730634152382842*^9, {
   3.730634182648647*^9, 3.730634369806325*^9}, {3.7306344324630504`*^9, 
   3.7306344464475183`*^9}, {3.730635018041154*^9, 3.730635083447933*^9}, {
   3.730635113510647*^9, 3.7306351439483624`*^9}, {3.7306351934643793`*^9, 
   3.730635252277319*^9}, {3.730635291574484*^9, 3.7306353219184637`*^9}, {
   3.73063540035656*^9, 3.7306354010128765`*^9}, {3.730644460601585*^9, 
   3.730644468929757*^9}, {3.7306448562789764`*^9, 3.730644900919958*^9}, 
   3.7306451488044553`*^9, {3.7306464978468866`*^9, 3.7306465399878025`*^9}, {
   3.7306479314285192`*^9, 3.730647932147271*^9}, {3.7306479765052466`*^9, 
   3.730647979989648*^9}, {3.7308059417599616`*^9, 3.730806004826599*^9}, {
   3.73080612145253*^9, 3.730806196312502*^9}, {3.730806242521983*^9, 
   3.7308062536314588`*^9}, {3.7308063911953444`*^9, 3.730806462617773*^9}, {
   3.7308065233516235`*^9, 3.7308065978209677`*^9}, {3.730806676930981*^9, 
   3.73080667727471*^9}, 3.73080676161915*^9, {3.7308100951916895`*^9, 
   3.730810173145434*^9}, {3.7308102105519943`*^9, 3.7308102324896727`*^9}, {
   3.7308103282716813`*^9, 3.7308103431155415`*^9}, {3.7308103749595594`*^9, 
   3.73081039255345*^9}, {3.73082244155945*^9, 3.730822441934439*^9}, {
   3.7310058517745447`*^9, 3.731005887185063*^9}, 3.731006007900817*^9, {
   3.731064372103198*^9, 3.7310643774313717`*^9}, {3.7310746306600013`*^9, 
   3.731074763206458*^9}, {3.7311896585418987`*^9, 3.731189658963788*^9}},
 CellLabel->
  "In[1028]:=",ExpressionUUID->"265410aa-8c24-40c1-bd9a-dd581233f642"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compute Eigenvalues", "Section",
 CellChangeTimes->{{3.7402438108020816`*^9, 
  3.740243816411277*^9}},ExpressionUUID->"48ae6b94-01cf-48ac-a276-\
43975f7d6e1d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLJacobian", "[", "p_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i", ",", " ", "M", ",", " ", "m", ",", " ", "\[Sigma]T", ",", " ", 
        "\[Sigma]0", ",", " ", "x", ",", " ", "c", ",", " ", "\[Sigma]", ",", 
        " ", "S", ",", " ", "dSdT", ",", " ", "dSdc", ",", " ", "dTdc", ",", 
        " ", "f", ",", " ", "A"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"M", " ", "=", " ", 
        RowBox[{"BLSim", "[", "p", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"M", "\[LeftDoubleBracket]", 
         RowBox[{"\"\<m\>\"", ",", " ", "1"}], "\[RightDoubleBracket]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"i", " ", "=", " ", 
        RowBox[{"BLbiped", "[", 
         RowBox[{"\"\<c\>\"", ",", " ", "m", ",", " ", "\"\<x\>\""}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"BLbiped", ",", " ", "\"\<A\>\"", ",", " ", 
          RowBox[{"BLA", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"A", "\[LeftDoubleBracket]", 
         RowBox[{"i", ",", " ", "i"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"M", "\[LeftDoubleBracket]", 
         RowBox[{"\"\<m\>\"", ",", " ", 
          RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"c", " ", "=", " ", 
        RowBox[{"devec", "[", 
         RowBox[{
          RowBox[{"M", "\[LeftDoubleBracket]", 
           RowBox[{"\"\<c\>\"", ",", " ", 
            RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], ",", " ", "nc"}],
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"t", " ", "=", " ", "0"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"devec", "[", 
         RowBox[{
          RowBox[{"M", "\[LeftDoubleBracket]", 
           RowBox[{"\"\<x+\>\"", ",", " ", "2"}], "\[RightDoubleBracket]"}], 
          ",", " ", "nx"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]0", " ", "=", " ", 
        RowBox[{
         RowBox[{"devec", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BLbiped", "[", 
             RowBox[{"\"\<\[Sigma]\>\"", ",", " ", "m"}], "]"}], "[", 
            RowBox[{"x", ",", " ", "c"}], "]"}], ",", " ", "mm"}], "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "3"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"t", " ", "=", " ", "T"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"x", " ", "=", " ", 
        RowBox[{"devec", "[", 
         RowBox[{
          RowBox[{"M", "\[LeftDoubleBracket]", 
           RowBox[{"\"\<x-\>\"", ",", " ", 
            RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], ",", " ", "nx"}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]T", " ", "=", " ", 
        RowBox[{
         RowBox[{"devec", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"BLbiped", "[", 
             RowBox[{"\"\<\[Sigma]\>\"", ",", " ", "m"}], "]"}], "[", 
            RowBox[{"x", ",", " ", "c"}], "]"}], ",", " ", "mm"}], "]"}], 
         "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "3"}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]", " ", "=", " ", 
        RowBox[{"\[Sigma]T", "-", "\[Sigma]0"}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"(*", " ", "dTdc", " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"S", " ", "=", " ", 
        RowBox[{"Sin", "[", 
         RowBox[{
         "\[Sigma]", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dSdT", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{
          "\[Sigma]", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}], " ", 
         RowBox[{"\[Sigma]", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", " ", 
           RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dSdc", " ", "=", " ", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{
          "\[Sigma]", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}], " ", 
         RowBox[{
         "\[Sigma]", "\[LeftDoubleBracket]", "2", 
          "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dTdc", " ", "=", " ", 
        RowBox[{
         RowBox[{"-", "dSdc"}], "/", "dSdT"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"get", " ", "state"}], "-", 
         RowBox[{"based", " ", "derivative"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{"x", "\[LeftDoubleBracket]", 
         RowBox[{"2", ",", " ", "All", ",", " ", 
          RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "=", " ", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{"f", ",", " ", "dTdc"}], "]"}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"A", ".", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"x", "\[LeftDoubleBracket]", 
             RowBox[{"2", ",", " ", "i"}], "\[RightDoubleBracket]"}], " ", 
            "+", " ", 
            RowBox[{
            "f", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           ")"}]}], ",", " ", 
         RowBox[{"A", ".", 
          RowBox[{"x", "\[LeftDoubleBracket]", 
           RowBox[{"2", ",", " ", "i"}], "\[RightDoubleBracket]"}]}]}], 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"JFD", "[", 
     RowBox[{"c_", ",", " ", 
      RowBox[{"tol_:", 
       RowBox[{"10", "^", 
        RowBox[{"-", "5"}]}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "m", ",", " ", "i", ",", " ", "f", ",", " ", "Jtb", ",", " ", "Jeb", 
        ",", " ", "A"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m", " ", "=", " ", 
        RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"i", " ", "=", " ", 
        RowBox[{"BLbiped", "[", 
         RowBox[{"\"\<c\>\"", ",", " ", "m", ",", " ", "\"\<x\>\""}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"blstate", "[", "#", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"\"\<x-\>\"", ",", " ", 
           RowBox[{"-", "1"}], ",", " ", "i"}], "\[RightDoubleBracket]"}], 
         "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Jeb", " ", "=", " ", 
        RowBox[{
         RowBox[{"FiniteDifferenceJacobian", "[", 
          RowBox[{"f", ",", " ", "c", ",", " ", 
           RowBox[{"N", "@", "tol"}]}], "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"f", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"BLSim", "[", "#", "]"}], "\[LeftDoubleBracket]", 
          RowBox[{"\"\<x-\>\"", ",", " ", 
           RowBox[{"-", "1"}], ",", " ", "i"}], "\[RightDoubleBracket]"}], 
         "&"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Jtb", " ", "=", " ", 
        RowBox[{
         RowBox[{"FiniteDifferenceJacobian", "[", 
          RowBox[{"f", ",", " ", "c", ",", " ", 
           RowBox[{"N", "@", "tol"}]}], "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"A", " ", "=", " ", 
        RowBox[{"Lookup", "[", 
         RowBox[{"BLbiped", ",", " ", "\"\<A\>\"", ",", " ", 
          RowBox[{"BLA", "[", "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"A", ".", "Jeb"}], ",", " ", 
         RowBox[{"A", ".", "Jtb"}]}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BLEigenvalues", "[", 
   RowBox[{"man_", ",", " ", 
    RowBox[{"max_:", "True"}]}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "m", ",", " ", "i", ",", " ", "j", ",", " ", "J", ",", " ", "eigs", ",", 
      " ", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"m", " ", "=", " ", 
      RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"j", " ", "=", " ", 
      RowBox[{"BLbiped", "[", 
       RowBox[{"\"\<p\>\"", ",", " ", "m", ",", " ", "\"\<x\>\""}], "]"}]}], 
     ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "fancier", " ", "select", " ", "would", " ", "ensure", " ", "dSdT"}], 
       " ", "\[NotEqual]", " ", "0"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"c", " ", "=", " ", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{"man", "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"PossibleZeroQ", "[", 
           RowBox[{"Norm", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
            "]"}], "]"}]}], "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"J", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"BLJacobian", "[", "#", "]"}], "\[LeftDoubleBracket]", 
         RowBox[{"All", ",", " ", "All", ",", " ", "j"}], 
         "\[RightDoubleBracket]"}], "&"}], " ", "/@", " ", "c"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eigs", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{"Eigenvalues", ",", " ", "J", ",", " ", 
        RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"max", ",", " ", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "@", 
           RowBox[{"Abs", "@", "#"}]}], "&"}], ",", " ", "eigs", ",", " ", 
         RowBox[{"{", "2", "}"}]}], "]"}], ",", " ", "eigs"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJwdz1kowwEABvBZaWM5kjBizBD9mZGcyS01R64XV+aaSUoKixdka7nJSB4m
DzZnSMo1kSQ8zpErMSSjsckc+X97+Pr1vX2fl6Auu4JKoVC8ycDg8MyWpKvn
+HSeshU+dnx3wkmLWQmM3ODrYaOHhpJMqlVv0GChOo8OfxglNlBQWuwMWb0H
bKghVD7wr0wSZO4mJy6M6O8Lhce7BSnQoXk/C85lTBbDZelxFdTn17fAm3VR
O0wg6AOQ/fo7DNWDOjlUrJrG4K7P2iyUCxbuYA6jTQv3ek2uKdgt93eDA+5a
q1RSHv3J7ALh8QRrFZl6yC5lsirxe7+GAzUTQgLK3qjhMH3pRASHQixqoOpK
Ta0itc6lWkLDRVgT7FmsFkNaQFE3nHJ87Iee7/RRuDrNnYJFLvwZGLtTsgmN
KtkOPP0yHMHD+LszmLs5eg4LlYxryHPj3MIPW3s7IWliw5ojFF6OMKFLQhkL
zjGNfnD7k+DCzy3LaGhc0cXAuHmp+z16eVYgNPiKo+Cir9Ts+MNLKuy6qU2D
/670Mvc=
  "],
 CellLabel->
  "In[1035]:=",ExpressionUUID->"f9e363c1-da44-422f-851e-79ea59b64b80"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Animation", "Section",
 CellChangeTimes->{{3.74041761906295*^9, 
  3.7404176239389343`*^9}},ExpressionUUID->"03ff5911-bbbb-4d8f-a853-\
ae3f69447370"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BLWalk", "]"}], " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"BLAnimateBiped", " ", "\[Rule]", " ", 
      RowBox[{"{", "}"}]}], ",", " ", 
     RowBox[{"\"\<e\>\"", " ", "\[Rule]", " ", "False"}], ",", " ", 
     RowBox[{"\"\<T\>\"", " ", "\[Rule]", " ", 
      RowBox[{"-", "1"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLWalk", "::", "k"}], " ", "=", " ", 
    "\"\<`` `` does not exist.  Valid ones are: ``.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLWalk", "[", 
     RowBox[{"A_Association", ",", " ", 
      RowBox[{"k_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"n_:", "1"}], ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"KeyExistsQ", "[", 
       RowBox[{"A", ",", " ", "k"}], "]"}], ",", " ", 
      RowBox[{"BLWalk", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"A", "[", "k", "]"}], "\[LeftDoubleBracket]", "1", 
         "\[RightDoubleBracket]"}], ",", " ", "n", ",", " ", "opts"}], "]"}], 
      ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"BLWalk", "::", "k"}], ",", " ", "\"\<Key\>\"", ",", " ", "k",
         ",", " ", 
        RowBox[{"Keys", "@", "A"}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLWalk", "[", 
     RowBox[{"A_Association", ",", " ", "k_Integer", ",", " ", 
      RowBox[{"n_:", "1"}], ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "@", "A"}], " ", ">", " ", "k"}], ",", " ", 
      RowBox[{"BLWalk", "[", 
       RowBox[{
        RowBox[{"A", "\[LeftDoubleBracket]", 
         RowBox[{"k", ",", " ", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
        "n", ",", " ", "opts"}], "]"}], ",", " ", 
      RowBox[{"Message", "[", 
       RowBox[{
        RowBox[{"BLWalk", "::", "k"}], ",", " ", "\"\<Index\>\"", ",", " ", 
        "k", ",", " ", 
        RowBox[{"\"\<1 <= k <= \>\"", " ", "<>", " ", 
         RowBox[{"ToString", "@", 
          RowBox[{"Length", "@", "A"}]}]}]}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BLWalk", "[", 
     RowBox[{"c_", ",", " ", 
      RowBox[{"n_:", "1"}], ",", " ", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"o", ",", " ", "e", ",", " ", "T"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"o", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "BLAnimateBiped", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"e", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<e\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"T", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<T\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"e", ",", " ", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"state", "-", "based"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"e", " ", "=", " ", 
           RowBox[{"state", "[", 
            RowBox[{"c", ",", " ", "n"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"T", " ", "=", " ", 
           RowBox[{
            RowBox[{
            "c", "\[LeftDoubleBracket]", "T", "\[RightDoubleBracket]"}], 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "n"}], "}"}]}]}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "else", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"time", "-", "based"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"e", " ", "=", " ", "c"}], ";", "\[IndentingNewLine]", 
          RowBox[{"T", " ", "=", " ", 
           RowBox[{
            RowBox[{
            "c", "\[LeftDoubleBracket]", "T", "\[RightDoubleBracket]"}], 
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", " ", "n"}], "]"}]}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"BLAnimateBiped", "[", 
        RowBox[{"e", ",", " ", "o", ",", " ", 
         RowBox[{"BLSim", " ", "\[Rule]", " ", 
          RowBox[{"{", 
           RowBox[{"\"\<T\>\"", " ", "\[Rule]", " ", "T"}], "}"}]}]}], 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BL\[Sigma]", "[", 
     RowBox[{"c_", "?", "VectorQ"}], "]"}], " ", ":=", 
    RowBox[{"BL\[Sigma]", "@@", 
     RowBox[{"BLmxcp", "[", 
      RowBox[{
       RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}], ",", " ", "c"}], 
      "]"}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BL\[Sigma]", "[", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"x_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"c_", "?", "VectorQ"}]}], "]"}], " ", ":=", 
    RowBox[{"BL\[Sigma]", "[", 
     RowBox[{"m", ",", " ", 
      RowBox[{"devec", "[", 
       RowBox[{"x", ",", " ", "nx"}], "]"}], ",", " ", 
      RowBox[{"devec", "[", 
       RowBox[{"c", ",", " ", "nc"}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BL\[Sigma]", "[", 
     RowBox[{"m_", ",", " ", "x_", ",", " ", "c_"}], "]"}], " ", ":=", 
    RowBox[{"devec", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"BLbiped", "[", 
        RowBox[{"\"\<\[Sigma]\>\"", ",", " ", "m"}], "]"}], "[", 
       RowBox[{"x", ",", " ", "c"}], "]"}], ",", " ", "mm"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"blevent", "[", 
     RowBox[{"m_", ",", " ", 
      RowBox[{"x_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"c_", "?", "VectorQ"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"X", ",", " ", "C", ",", " ", "\[Sigma]", ",", " ", "n"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"X", " ", "=", " ", 
        RowBox[{"devec", "[", 
         RowBox[{"x", ",", " ", "nx"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"C", " ", "=", " ", 
        RowBox[{"devec", "[", 
         RowBox[{"c", ",", " ", "nc"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"n", " ", "=", " ", 
          RowBox[{
           RowBox[{"First", "@", 
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"mm", "+", "1"}], ",", " ", "nm"}], "]"}], ",", "  ", 
              "ax"}], "]"}]}], "-", "mm"}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"n", " ", "=", " ", "mm"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"\[Sigma]", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"BL\[Sigma]", "[", 
             RowBox[{"\"\<left\>\"", ",", " ", "X", ",", " ", "C"}], "]"}], 
            "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", " ", "n"}], "\[RightDoubleBracket]"}], "-", 
           RowBox[{
            RowBox[{"BL\[Sigma]", "[", 
             RowBox[{"\"\<left\>\"", ",", " ", 
              RowBox[{"C", "\[LeftDoubleBracket]", 
               RowBox[{"All", ",", " ", 
                RowBox[{"1", ";;", "nx"}]}], "\[RightDoubleBracket]"}], ",", 
              " ", "C"}], "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", " ", "n"}], "\[RightDoubleBracket]"}]}]}], 
         ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"\[Sigma]", " ", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "x", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], "+", 
           RowBox[{"0.5", 
            RowBox[{
            "x", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}]}], 
          ")"}], "-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
           "c", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], "+", 
           RowBox[{"0.5", 
            RowBox[{
            "c", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}]}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Sin", "[", "\[Sigma]", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"blstate", "[", 
    RowBox[{"p_", ",", " ", 
     RowBox[{"n_Integer:", "1"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Tc", ",", " ", "m", ",", " ", "x", ",", " ", "c", ",", " ", "esw", ",",
        " ", "r"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Tc", " ", "=", " ", 
       RowBox[{"p", "\[LeftDoubleBracket]", 
        RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", " ", "x", ",", " ", "c"}], "}"}], " ", "=", " ", 
       RowBox[{"BLmxcp", "[", 
        RowBox[{"m", ",", " ", "p"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"esw", " ", "=", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"WhenEvent", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[DoubleStruckT]", "-", "0"}], "\[Equal]", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`TF", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`m", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`h", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`d", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`T0", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}], ",", "\"\<RemoveEvent\>\""}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Priority\>\"", "\[Rule]", "1"}], "}"}]}], "]"}], ",",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"WhenEvent", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"blevent", "[", 
             RowBox[{
              RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], ",",
               " ", 
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], ",",
               " ", 
              RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
             "]"}], " ", ">", " ", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\[DoubleStruckT]", ",", " ", "\"\< \>\"", ",", " ", 
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", " ", "\"\< \>\"", ",", " ", 
                RowBox[{"blevent", "[", 
                 RowBox[{
                  RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                  ",", " ", 
                  RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                  ",", " ", 
                  RowBox[{
                  "\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
                 "]"}]}], "]"}], ";", 
              RowBox[{
               RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
               "\[Rule]", 
               RowBox[{"HybridDynamics`Private`TF", "[", 
                RowBox[{
                 RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                 ",", 
                 RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                 ",", 
                 RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                 ",", "0"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`m", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`h", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`d", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`T0", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Priority\>\"", "\[Rule]", "2"}], "}"}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CurlyPhi]", "[", 
       RowBox[{"m", ",", " ", "x", ",", " ", "c", ",", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", 
          RowBox[{"n", " ", "Tc"}]}], "}"}], ",", " ", 
        RowBox[{"\"\<e\>\"", " ", "\[Rule]", " ", "esw"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.737294160062288*^9, 3.7372944200132427`*^9}, {
   3.737294464088397*^9, 3.7372944651664457`*^9}, {3.737294516678547*^9, 
   3.737294716805464*^9}, {3.7372947686143875`*^9, 3.737294849108892*^9}, {
   3.73729496067937*^9, 3.7372949698974895`*^9}, {3.7372950527974167`*^9, 
   3.73729506264049*^9}, 3.740416057758665*^9, {3.740416097308674*^9, 
   3.740416101748548*^9}, {3.740416346038879*^9, 3.740416401743497*^9}, {
   3.740417548319297*^9, 3.740417561869324*^9}, {3.7405028330418515`*^9, 
   3.7405029018181553`*^9}, {3.740503504598968*^9, 3.740503513352833*^9}, {
   3.740503576208825*^9, 3.740503583958912*^9}, {3.740503639808568*^9, 
   3.74050364109338*^9}, {3.740578186335923*^9, 3.7405781979913387`*^9}, {
   3.7405782452657948`*^9, 3.7405782508435383`*^9}, {3.740578283809898*^9, 
   3.7405783145733123`*^9}, {3.740578360866869*^9, 3.7405783611324673`*^9}, {
   3.740579343008505*^9, 3.740579403441616*^9}, {3.7405794365017242`*^9, 
   3.740579463506342*^9}, {3.74057953342857*^9, 3.7405796043297434`*^9}, {
   3.7405798121742005`*^9, 3.7405798130647907`*^9}, {3.740579868810758*^9, 
   3.7405798743572173`*^9}, {3.740579923213067*^9, 3.740579928728325*^9}, {
   3.7405800018524904`*^9, 3.740580110516525*^9}, {3.7405857760137267`*^9, 
   3.7405857775136642`*^9}, {3.740585830056736*^9, 3.7405858669134455`*^9}, {
   3.7405859184409924`*^9, 3.740585982608276*^9}, {3.7405861887207336`*^9, 
   3.740586233936244*^9}, {3.7405863039155817`*^9, 3.7405863310073857`*^9}, {
   3.7405863844879026`*^9, 3.7405863854253664`*^9}, {3.74073970167054*^9, 
   3.74073970167054*^9}, {3.7407400802683363`*^9, 3.7407400835337253`*^9}, {
   3.740740159434523*^9, 3.740740159434523*^9}, {3.7407403421305833`*^9, 
   3.740740400407132*^9}, {3.740740470261464*^9, 3.740740529616586*^9}, {
   3.7407408312774057`*^9, 3.7407408383706465`*^9}, {3.740741113544719*^9, 
   3.7407411145915203`*^9}, {3.7407411596820297`*^9, 
   3.7407411690094852`*^9}, {3.7407412719864607`*^9, 
   3.7407412948285694`*^9}, {3.7407413830121727`*^9, 3.740741389168005*^9}, {
   3.7407414352584124`*^9, 3.7407414615534*^9}, {3.740741525943935*^9, 
   3.7407415380055656`*^9}, {3.7407415801255083`*^9, 3.740741588234331*^9}, {
   3.7407420731496296`*^9, 3.7407420751807346`*^9}, 3.7407421335046687`*^9, {
   3.7407421803294287`*^9, 3.7407421808762674`*^9}, {3.740742593667802*^9, 
   3.7407425938552885`*^9}, {3.7407447705232005`*^9, 3.740744817410454*^9}, {
   3.74074732956949*^9, 3.740747353848956*^9}, {3.741021822615238*^9, 
   3.741021890488179*^9}, {3.750167947991721*^9, 3.7501680932153854`*^9}, 
   3.7501681571794176`*^9, {3.750168319948665*^9, 3.7501683670702224`*^9}, {
   3.7501697003017316`*^9, 3.750169704785791*^9}, {3.7501697669602733`*^9, 
   3.7501698378300457`*^9}, {3.750169876858436*^9, 3.750169912340193*^9}, {
   3.750170915863083*^9, 3.750170942720476*^9}, {3.750171040447611*^9, 
   3.7501710584462996`*^9}, {3.7998903310921392`*^9, 
   3.799890410709477*^9}},ExpressionUUID->"a88115f1-27f7-4e75-bb90-\
559eaf5eccfa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[Sigma]", "[", "q_", "]"}], " ", ":=", 
    RowBox[{
     RowBox[{"q", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], "+", 
     RowBox[{"0.5", 
      RowBox[{
      "q", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"be", "[", 
     RowBox[{
      RowBox[{"x_", "?", "VectorQ"}], ",", " ", 
      RowBox[{"c_", "?", "VectorQ"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Sin", "[", 
     RowBox[{
      RowBox[{"\[Sigma]", "[", "x", "]"}], "-", 
      RowBox[{"\[Sigma]", "[", "c", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"be", "[", 
      RowBox[{"m_", ",", " ", 
       RowBox[{"x_", "?", "VectorQ"}], ",", " ", 
       RowBox[{"c_", "?", "VectorQ"}]}], "]"}], " ", ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"X", ",", " ", "C"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"X", " ", "=", " ", 
         RowBox[{"devec", "[", 
          RowBox[{"x", ",", " ", "nx"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"C", " ", "=", " ", 
         RowBox[{"devec", "[", 
          RowBox[{"c", ",", " ", "nc"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Sin", "[", 
         RowBox[{
          RowBox[{"BL\[Sigma]", "[", 
           RowBox[{"m", ",", " ", "X", ",", " ", "C"}], "]"}], "-", 
          RowBox[{"BL\[Sigma]", "[", 
           RowBox[{"m", ",", " ", 
            RowBox[{"C", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", " ", 
              RowBox[{"1", ";;", "nx"}]}], "\[RightDoubleBracket]"}], ",", 
            " ", "C"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"for", " ", "simulation"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"state", "[", 
    RowBox[{"p_", ",", " ", 
     RowBox[{"n_Integer:", "1"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Tc", ",", " ", "m", ",", " ", "x", ",", " ", "c", ",", " ", "DTsw", 
       ",", " ", "Tsw", ",", " ", "esw", ",", " ", "r"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Tc", " ", "=", " ", 
       RowBox[{"p", "\[LeftDoubleBracket]", 
        RowBox[{"-", "1"}], "\[RightDoubleBracket]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m", " ", "=", " ", 
       RowBox[{"BLbiped", "[", "\"\<m[0]\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", " ", "x", ",", " ", "c"}], "}"}], " ", "=", " ", 
       RowBox[{"BLmxcp", "[", 
        RowBox[{"m", ",", " ", "p"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"esw", " ", "=", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"WhenEvent", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"\[DoubleStruckT]", "-", "0"}], "\[Equal]", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`TF", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`m", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`h", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`d", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`T0", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}], ",", "\"\<RemoveEvent\>\""}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Priority\>\"", "\[Rule]", "1"}], "}"}]}], "]"}], ",",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"WhenEvent", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"be", "[", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], ",",
               " ", 
              RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
             "]"}], " ", ">", " ", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`TF", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`m", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`h", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`d", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}]}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
              "\[Rule]", 
              RowBox[{"HybridDynamics`Private`T0", "[", 
               RowBox[{
                RowBox[{"\[DoubleStruckM]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckX]", "[", "\[DoubleStruckT]", "]"}], 
                ",", 
                RowBox[{"\[DoubleStruckC]", "[", "\[DoubleStruckT]", "]"}], 
                ",", "0"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<Priority\>\"", "\[Rule]", "2"}], "}"}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CurlyPhi]", "[", 
       RowBox[{"m", ",", " ", "x", ",", " ", "c", ",", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", 
          RowBox[{"n", " ", "Tc"}]}], "}"}], ",", " ", 
        RowBox[{"\"\<e\>\"", " ", "\[Rule]", " ", "esw"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7407425835122814`*^9, 3.740742583965386*^9}, {
   3.7407432873217125`*^9, 3.74074334166162*^9}, {3.740743392923501*^9, 
   3.740743439076435*^9}, 3.7407435372963057`*^9, 3.740743571731329*^9, {
   3.7407436637090955`*^9, 3.7407436805360155`*^9}, {3.740744697465955*^9, 
   3.740744703168663*^9}, {3.7407450762565484`*^9, 3.7407451169299526`*^9}, {
   3.7407451488964014`*^9, 3.7407451602237167`*^9}, {3.740745305697638*^9, 
   3.740745328852214*^9}, {3.740745427996909*^9, 3.7407454424958673`*^9}, {
   3.74074612455928*^9, 3.74074613835518*^9}},
 CellLabel->
  "In[1048]:=",ExpressionUUID->"72ee8b39-0e79-4b36-b0be-6209b9230b34"]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Package", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.5914870039053636`*^9, 3.591487004222381*^9}, {
  3.672922910157816*^9, 
  3.6729229104546924`*^9}},ExpressionUUID->"89ca9acb-4053-4b62-ae07-\
011985e5c6d0"],

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\n", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6729231090809507`*^9, 3.6729231097997046`*^9}},
 CellLabel->
  "In[1051]:=",ExpressionUUID->"4658df9e-a842-4ee0-aa85-339f6974490e"]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1373, 1509},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
FrontEndVersion->"11.3 for Linux x86 (64-bit) (March 6, 2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 160, 3, 95, "Section",ExpressionUUID->"39e9dbc5-5d7b-4441-82c6-0811eadac5b2"],
Cell[743, 27, 4734, 70, 222, "Input",ExpressionUUID->"2b48c04c-aed4-40f4-8f8c-f7daa783cbb0",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[5514, 102, 456, 7, 95, "Section",ExpressionUUID->"c6d4db97-53c6-4902-801c-71424e600f67"],
Cell[5973, 111, 1267, 32, 182, "Input",ExpressionUUID->"d7ddfa87-56c8-4d4b-b412-8c7c9adb0336",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[7277, 148, 437, 6, 95, "Section",ExpressionUUID->"4e4f3495-7405-44bd-b231-44032f82e8c3"],
Cell[7717, 156, 10888, 208, 1062, "Input",ExpressionUUID->"c6e2239b-4b6c-4ccb-8e34-a1a3bc10ef55",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[18642, 369, 472, 7, 95, "Section",ExpressionUUID->"d21fd076-bbf3-45c2-9ef6-c220c5969dbf"],
Cell[19117, 378, 1899, 48, 382, "Input",ExpressionUUID->"4de0103b-35a6-432d-a8b7-a15315b43b61",
 InitializationCell->True],
Cell[21019, 428, 12267, 295, 1982, "Input",ExpressionUUID->"afa50212-b452-4158-8ab9-4892bcbb14ee",
 InitializationCell->True],
Cell[33289, 725, 7521, 171, 1062, "Input",ExpressionUUID->"265410aa-8c24-40c1-bd9a-dd581233f642",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[40847, 901, 166, 3, 95, "Section",ExpressionUUID->"48ae6b94-01cf-48ac-a276-43975f7d6e1d"],
Cell[41016, 906, 11676, 275, 2382, "Input",ExpressionUUID->"f9e363c1-da44-422f-851e-79ea59b64b80",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[52729, 1186, 155, 3, 95, "Section",ExpressionUUID->"03ff5911-bbbb-4d8f-a853-ae3f69447370"],
Cell[52887, 1191, 20417, 460, 2902, "Input",ExpressionUUID->"a88115f1-27f7-4e75-bb90-559eaf5eccfa",
 InitializationCell->True],
Cell[73307, 1653, 10261, 234, 1382, "Input",ExpressionUUID->"72ee8b39-0e79-4b36-b0be-6209b9230b34",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[83605, 1892, 236, 5, 67, "Section",ExpressionUUID->"89ca9acb-4053-4b62-ae07-011985e5c6d0",
 InitializationCell->True],
Cell[83844, 1899, 276, 6, 64, "Input",ExpressionUUID->"4658df9e-a842-4ee0-aa85-339f6974490e",
 InitializationCell->True]
}, Open  ]]
}
]
*)

